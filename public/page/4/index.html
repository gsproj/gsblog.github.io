<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gsproj.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="GongSheng Blog">
<meta property="og:url" content="http://gsproj.github.io/page/4/index.html">
<meta property="og:site_name" content="GongSheng Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="GongSheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://gsproj.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>GongSheng Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">GongSheng Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">山川異域，風月同天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/13-Nginx(%E4%B8%83)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/13-Nginx(%E4%B8%83)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/" class="post-title-link" itemprop="url">运维之综合架构--07--Nginx(七)均衡调度</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 11:19:52" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-11 13:55:06" itemprop="dateModified" datetime="2022-07-11T13:55:06+08:00">2022-07-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">（二）综合架构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、Nginx均衡调度算法"><a href="#一、Nginx均衡调度算法" class="headerlink" title="一、Nginx均衡调度算法"></a>一、Nginx均衡调度算法</h2><p>Nginx七层负载均衡分为5种调度算法</p>
<table>
<thead>
<tr>
<th>调度算法</th>
<th>概述</th>
</tr>
</thead>
<tbody><tr>
<td>轮询（常用）</td>
<td>按时间顺序逐一分配到不同的后端服务器(默认)</td>
</tr>
<tr>
<td>weight（面试点）</td>
<td>加权轮询,weight值越大,分配到的访问几率越高</td>
</tr>
<tr>
<td>ip_hash（面试点）</td>
<td>每个请求按访问IP的hash结果分配,这样来自同一IP的固定访问一个后端服务器</td>
</tr>
<tr>
<td>url_hash</td>
<td>按照访问URL的hash结果来分配请求,是每个URL定向到同一个后端服务器</td>
</tr>
<tr>
<td>least_hash</td>
<td>最少链接数,那个机器链接数少就分发</td>
</tr>
</tbody></table>
<h3 id="1-1-加权轮询"><a href="#1-1-加权轮询" class="headerlink" title="1.1 加权轮询"></a>1.1 加权轮询</h3><p>比如实现访问5次web01，1次web02</p>
<p>当web服务器配置不相同，有差距时，可以用此方法</p>
<p>在<code>lb01</code>配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        server 172.16.1.7:80 weight&#x3D;5;
        server 172.16.1.8:80 weight&#x3D;1;
&#125;

server &#123;
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-ip-hash"><a href="#1-2-ip-hash" class="headerlink" title="1.2 ip_hash"></a>1.2 ip_hash</h3><blockquote>
<p>PS：不能与weight一起使用</p>
</blockquote>
<p>根据请求的IP地址，固定访问到某一后端，除非已选择的后端down了，有点浪费资源</p>
<p>在<code>lb01</code>配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        ip_hash;
        server 172.16.1.7:80;
        server 172.16.1.8:80;
&#125;

server &#123; 
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="二、Nginx负载均衡后端状态"><a href="#二、Nginx负载均衡后端状态" class="headerlink" title="二、Nginx负载均衡后端状态"></a>二、Nginx负载均衡后端状态</h2><table>
<thead>
<tr>
<th>状态</th>
<th>概述</th>
</tr>
</thead>
<tbody><tr>
<td>down</td>
<td>当前的server暂时不参与负载均衡</td>
</tr>
<tr>
<td>backup</td>
<td>预留的备份服务器</td>
</tr>
<tr>
<td>max_conns</td>
<td>限制最大的接收连接数</td>
</tr>
<tr>
<td>max_fails（健康检查）</td>
<td>允许请求失败的次数（不够精准，作用不大，得知道，面试会问）</td>
</tr>
<tr>
<td>fail_timeout（健康检查）</td>
<td>经过max_fails失败后, 服务暂停时间</td>
</tr>
</tbody></table>
<h3 id="2-1-down状态"><a href="#2-1-down状态" class="headerlink" title="2.1 down状态"></a>2.1 down状态</h3><blockquote>
<p>一般用于停机维护</p>
</blockquote>
<p>在<code>lb01</code>配置，可见当两台web的Nginx服务都正常时，只能访问web02，当web02的Nginx服务挂了，返回502</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        server 172.16.1.7:80 down;
        server 172.16.1.8:80;
&#125;

server &#123;
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-backup状态"><a href="#2-2-backup状态" class="headerlink" title="2.2 backup状态"></a>2.2 backup状态</h3><p>在<code>lb01</code>配置，可见当两台web都正常时，只能访问web02，如果web02的服务挂了，会访问web01，当web02恢复后，再次访问到的是web02</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        server 172.16.1.7:80 backup;
        server 172.16.1.8:80;
&#125;

server &#123;
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-3-健康检查"><a href="#2-3-健康检查" class="headerlink" title="2.3 健康检查"></a>2.3 健康检查</h3><blockquote>
<p>自带的健康检查不够精准，且看不到信息，面试会问</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        server 172.16.1.7:80 max_fails&#x3D;2 fail_timeout&#x3D;10s;
        server 172.16.1.8:80 max_fails&#x3D;2 fail_timeout&#x3D;10s;
&#125;

server &#123;
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、第三方健康检查模块check-upstream"><a href="#三、第三方健康检查模块check-upstream" class="headerlink" title="三、第三方健康检查模块check_upstream"></a>三、第三方健康检查模块check_upstream</h2><blockquote>
<p>检测更精准，且有页面可以展示服务端的状态，需要编译安装</p>
</blockquote>
<h3 id="3-1-编译安装Nginx"><a href="#3-1-编译安装Nginx" class="headerlink" title="3.1 编译安装Nginx"></a>3.1 编译安装Nginx</h3><p>1、安装依赖包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb02 ~]# yum install -y gcc glibc gcc-c++ pcre-devel openssl-devel  patch libxml2 -libxml2-devel libxslt libxslt-devel gd-devel perl-ExtUtils-Embed gperftools-devel.x86_64 gperftools-libs.x86_64 gperftools.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、下载Nginx源码及第三方模块源码</p>
<blockquote>
<p>PS：为保持一致，先通过yum源安装nginx，这是当前实验环境的Nginx版本</p>
<p>[root@lb01 nginx]# nginx -version<br>nginx version: nginx&#x2F;1.20.1</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb02 ~]# wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.20.1.tar.gz
[root@lb02 ~]# wget https:&#x2F;&#x2F;github.com&#x2F;yaoweibin&#x2F;nginx_upstream_check_module&#x2F;archive&#x2F;master.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>3、解压nginx源码包以及第三方模块</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 ~]# unzip master.zip
[root@lb01 ~]# tar -vxf nginx-1.20.1.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>4、打补丁</p>
<blockquote>
<p>打补丁(nginx的版本是1.20.1补丁就选择1.20.1的,p1代表在nginx目录，p0是不在nginx目录)</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx-1.20.1]# cd nginx-1.20.1&#x2F;
[root@lb01 nginx-1.20.1]# patch -p1 &lt; ..&#x2F;nginx_upstream_check_module-master&#x2F;check_1.20.1+.patch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5、编译Nginx，附带模块参数</p>
<blockquote>
<p>通过nginx -V获取configure参数，尽量保持一致</p>
</blockquote>
<p>–add-module&#x3D;&#x2F;root&#x2F;nginx_upstream_check_module-master</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx-1.20.1]# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;share&#x2F;nginx --sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx --modules-path&#x3D;&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules --conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf --error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log --http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log --http-client-body-temp-path&#x3D;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;client_body --http-proxy-temp-path&#x3D;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;proxy --http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;fastcgi --http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;uwsgi --http-scgi-temp-path&#x3D;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;scgi --pid-path&#x3D;&#x2F;run&#x2F;nginx.pid --lock-path&#x3D;&#x2F;run&#x2F;lock&#x2F;subsys&#x2F;nginx --user&#x3D;nginx --group&#x3D;nginx --with-compat --with-debug --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module&#x3D;dynamic --with-http_mp4_module --with-http_perl_module&#x3D;dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module&#x3D;dynamic --with-mail&#x3D;dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream&#x3D;dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --add-module&#x3D;&#x2F;root&#x2F;nginx_upstream_check_module-master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6、在已有的负载均衡上增加健康检查的功能</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx-1.20.1]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf
upstream node &#123;
        server 172.16.1.7:80;
        server 172.16.1.8:80;
        check interval&#x3D;3000 rise&#x3D;2 fall&#x3D;3 timeout&#x3D;1000 type&#x3D;tcp;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-功能测试"><a href="#3-2-功能测试" class="headerlink" title="3.2 功能测试"></a>3.2 功能测试</h3><p>1、正常情况下的检测数据</p>
<p><img src="/img/image-20210821113447825.png" alt="image-20210821113447825"></p>
<p>2、测试将web01的nginx服务关掉</p>
<p><img src="/img/image-20210821114011230.png" alt="image-20210821114011230"></p>
<p>3、日志分析</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 nginx-1.20.1]# tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log
# 两web服务正常，能获取peer
2021&#x2F;08&#x2F;21 02:42:11 [error] 50522#50522: enable check peer: 172.16.1.8:80
2021&#x2F;08&#x2F;21 02:42:12 [error] 50522#50522: enable check peer: 172.16.1.7:80
2021&#x2F;08&#x2F;21 02:46:17 [error] 50522#50522: *13 connect() failed (111: Connection refused) while connecting to upstream, client: 10.0.0.1, server: node.oldboy.com, request: &quot;GET &#x2F; HTTP&#x2F;1.1&quot;, upstream: &quot;http:&#x2F;&#x2F;172.16.1.7:80&#x2F;&quot;, host: &quot;node.oldboy.com&quot;
# 停止web01的nginx服务
2021&#x2F;08&#x2F;21 02:46:20 [error] 50522#50522: disable check peer: 172.16.1.7:80
# 重新启动web01的nginx服务
2021&#x2F;08&#x2F;21 02:47:59 [error] 50522#50522: enable check peer: 172.16.1.7:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、如何解决网站重复登录的问题"><a href="#四、如何解决网站重复登录的问题" class="headerlink" title="四、如何解决网站重复登录的问题"></a>四、如何解决网站重复登录的问题</h2><p>有三种方法解决：</p>
<ol>
<li>ip_hash – 会造成某一台主机的压力过大</li>
<li>session复制</li>
<li>session共享<ol>
<li>本地文件 –&gt; nfs共享</li>
<li>通过程序，写入redis数据库（常用）</li>
<li>通过程序，写入mysql数据库</li>
</ol>
</li>
</ol>
<p>本案例，选用3.2配置，session共享，写入redis数据库</p>
<h3 id="4-1-安装phpmyadmin重现问题"><a href="#4-1-安装phpmyadmin重现问题" class="headerlink" title="4.1 安装phpmyadmin重现问题"></a>4.1 安装phpmyadmin重现问题</h3><p><code>web01</code>和<code>web02</code>都需要安装</p>
<p>1、配置Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 conf.d]# cat php.conf
server &#123;
	listen 80;
	server_name php.oldboy.com;
	root &#x2F;code&#x2F;phpMyAdmin-4.8.4-all-languages;

	location &#x2F; &#123;
		index index.php index.html;
	&#125;

	location ~ \.php$ &#123;
		fastcgi_pass 127.0.0.1:9000;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		include fastcgi_params;
	&#125;
&#125;
[root@web01 conf.d]# systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、安装phpmyadmin</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 conf.d]# cd &#x2F;code
[root@web01 code]# wget https:&#x2F;&#x2F;files.phpmyadmin.net&#x2F;phpMyAdmin&#x2F;4.8.4&#x2F;phpMyAdmin-4.8.4-all-languages.zip
[root@web01 code]# unzip phpMyAdmin-4.8.4-all-languages.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>3、配置phpmyadmin连接远程数据库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 code]# cd phpMyAdmin-4.8.4-all-languages&#x2F;
[root@web01 phpMyAdmin-4.8.4-all-languages]# cp config.sample.inc.php config.inc.php
[root@web01 phpMyAdmin-4.8.4-all-languages]# vim config.inc.php
&#x2F;* Server parameters *&#x2F;
$cfg[&#39;Servers&#39;][$i][&#39;host&#39;] &#x3D; &#39;172.16.1.51&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、配置授权</p>
<blockquote>
<p>这个文件夹中会记录session，需要权限</p>
<p>session_start(): Failed to read session data: files (path: &#x2F;var&#x2F;lib&#x2F;php&#x2F;session)</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 conf.d]# chown -R www.www &#x2F;var&#x2F;lib&#x2F;php&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>5、将web01上配置好的phpmyadmin以及nginx的配置文件推送到web02主机上</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 code]# scp -rp  phpMyAdmin-4.8.4-all-languages root@172.16.1.8:&#x2F;code&#x2F;
[root@web01 code]# scp &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;php.conf  root@172.16.1.8:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>6、重载Nginx服务，授权访问权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web02 code]# systemctl restart nginx
[root@web02 code]# chown -R www.www &#x2F;var&#x2F;lib&#x2F;php&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>7、接入负载均衡，并重启nginx服务，<code>lb01</code>操作</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 conf.d]# vim proxy_php.com.conf 
upstream php &#123;
        server 172.16.1.7:80;
        server 172.16.1.8:80;
&#125;
server &#123;
        listen 80;
        server_name php.oldboy.com;
        location &#x2F; &#123;
                proxy_pass http:&#x2F;&#x2F;php;
                include proxy_params;
        &#125;
&#125;

[root@lb01 conf.d]# nginx -t
nginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf syntax is ok
nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test is successful
[root@lb01 conf.d]# systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>9、测试访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">网页访问：
	http:&#x2F;&#x2F;php.oldboy.com
登录账户:
	采用db01（172.16.1.51）的mysql远程账户oldboy&#x2F;Bgx123.com
此时访问phpmyadmin登录将一直失败，因为轮询访问，session一直变：
报错：
Failed to set session cookie. Maybe you are using HTTP instead of HTTPS to access phpMyAdmin.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-解决问题"><a href="#4-2-解决问题" class="headerlink" title="4.2 解决问题"></a>4.2 解决问题</h3><p>1、在<code>db01</code>安装redis数据库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@db01 ~]# yum install redis -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、配置并启动redis</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@db01 ~]# sed  -i &#39;&#x2F;^bind&#x2F;c bind 127.0.0.1 172.16.1.51&#39; &#x2F;etc&#x2F;redis.conf
[root@db01 ~]# systemctl start redis
[root@db01 ~]# systemctl enable redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>3、<code>web01</code>的php配置session连接redis</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#1.修改&#x2F;etc&#x2F;php.ini文件
[root@web01 ~]# vim &#x2F;etc&#x2F;php.ini
session.save_handler &#x3D; redis
session.save_path &#x3D; &quot;tcp:&#x2F;&#x2F;172.16.1.51:6379&quot;
;session.save_path &#x3D; &quot;tcp:&#x2F;&#x2F;172.16.1.51:6379?auth&#x3D;123&quot; #如果redis存在密码，则使用该方式
session.auto_start &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、注释php-fpm.d&#x2F;<a target="_blank" rel="noopener" href="http://www.conf里面的两条内容,否则session内容会一直写入/var/lib/php/session%E7%9B%AE%E5%BD%95%E4%B8%AD">www.conf里面的两条内容，否则session内容会一直写入/var/lib/php/session目录中</a></p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">;php_value[session.save_handler] &#x3D; files
;php_value[session.save_path]    &#x3D; &#x2F;var&#x2F;lib&#x2F;php&#x2F;session<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5、重启php-fpm</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web02 code]# systemctl restart php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6、将<code>web01</code>的配置文件推送到<code>web02</code>上</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">[root@web01 code]# scp &#x2F;etc&#x2F;php.ini root@172.16.1.8:&#x2F;etc&#x2F;php.ini  
[root@web01 code]# scp &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf root@172.16.1.8:&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>7、重启服务</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">[root@web02 code]# systemctl restart php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>8、再次测试访问网站</p>
<p>可以登录，并且session的值将记录到redis数据库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@db01 ~]# redis-cli -h 172.16.1.51
172.16.1.51:6379&gt; KEYS *
1) &quot;PHPREDIS_SESSION:716e61cabeb40f974fcbcdcac65f8607&quot;
2) &quot;PHPREDIS_SESSION:42ca5a8ea9375a93a7974427b77b3dd7&quot;
172.16.1.51:6379&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>9、刷新页面的负载均衡效果展示</p>
<p><img src="/img/image-20210823225246243.png" alt="image-20210823225246243"></p>
<p><img src="/img/image-20210823225305632.png" alt="image-20210823225305632"></p>
<p>10、cookie保存到redis展示</p>
<p><img src="/img/image-20210823225412626.png" alt="image-20210823225412626"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/12-Nginx(%E5%85%AD)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/12-Nginx(%E5%85%AD)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" class="post-title-link" itemprop="url">运维之综合架构--07--Nginx(六)七层负载均衡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 11:19:52" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-11 13:54:22" itemprop="dateModified" datetime="2022-07-11T13:54:22+08:00">2022-07-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">（二）综合架构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、七层负载均衡简介-需补充"><a href="#一、七层负载均衡简介-需补充" class="headerlink" title="一、七层负载均衡简介(需补充)"></a>一、七层负载均衡简介(需补充)</h2><h3 id="1-1-nginx代理的局限性"><a href="#1-1-nginx代理的局限性" class="headerlink" title="1.1 nginx代理的局限性"></a>1.1 nginx代理的局限性</h3><p>​	一个location仅能代理后端一台主机</p>
<h3 id="1-2-七层负载均衡"><a href="#1-2-七层负载均衡" class="headerlink" title="1.2 七层负载均衡"></a>1.2 七层负载均衡</h3><p>Nginx负载均衡<br>    负载<br>    负载均衡<br>    调度<br>    load balance<br>    LB<br>公有云<br>    SLB		阿里云负载均衡<br>    QLB		青云负载均衡<br>    CLB		腾讯负载均衡<br>    ULB		ucloud的负载均衡</p>
<h3 id="1-3-四层负载均衡和七层负载均衡的区别"><a href="#1-3-四层负载均衡和七层负载均衡的区别" class="headerlink" title="1.3 四层负载均衡和七层负载均衡的区别"></a>1.3 四层负载均衡和七层负载均衡的区别</h3><p>四层负载均衡数据包在底层就进行了分发，而七层负载均衡数据包则是在最顶层进行分发、由此可以看出，七层负载均衡效率没有四负载均衡高。<br>但七层负载均衡更贴近于服务，如:http协议就是七层协议，我们可以用Nginx可以作会话保持，URL路径规则匹配、head头改写等等，这些是四层负载均衡无法实现的。</p>
<h2 id="二、配置实例"><a href="#二、配置实例" class="headerlink" title="二、配置实例"></a>二、配置实例</h2><h3 id="2-1-测试环境准备"><a href="#2-1-测试环境准备" class="headerlink" title="2.1 测试环境准备"></a>2.1 测试环境准备</h3><table>
<thead>
<tr>
<th>主机名称</th>
<th>应用环境</th>
<th>外网地址</th>
<th>内网地址</th>
</tr>
</thead>
<tbody><tr>
<td>web01</td>
<td>nginx + php（提供网页服务）</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
</tr>
<tr>
<td>web01</td>
<td>nginx + php（提供网页服务）</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
</tr>
<tr>
<td>lb01</td>
<td>nginx（提供代理服务）</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
</tr>
<tr>
<td>db01</td>
<td>mysql</td>
<td>10.0.0.51</td>
<td>172.16.1.51</td>
</tr>
</tbody></table>
<h3 id="2-2-配置步骤"><a href="#2-2-配置步骤" class="headerlink" title="2.2 配置步骤"></a>2.2 配置步骤</h3><p>1、web01&#x2F;02的网页服务搭建</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 ~]# cd &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;
[root@web01 conf.d]# cat node.conf 
server &#123;
    listen 80;
    server_name node.oldboy.com;
    location &#x2F; &#123;
        root &#x2F;node;
        index index.html;
    &#125;
&#125;
[root@web01 conf.d]# mkdir &#x2F;node
[root@web01 conf.d]# echo &quot;Web01...&quot; &gt; &#x2F;node&#x2F;index.html
[root@web01 conf.d]# systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、配置nginx负载均衡</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 ~]# cd &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;
[root@lb01 conf.d]# cat node_proxy.conf 
upstream node &#123;
    server 172.16.1.7:80;
    server 172.16.1.8:80;
&#125;
server &#123;
    listen 80;
    server_name node.oldboy.com;

    location &#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;node;
        include proxy_params;
    &#125;
&#125;
[root@lb01 conf.d]# systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、客户端网页测试访问，F5刷新，可见web01&#x2F;web02在循环</p>
<p><img src="/img/image-20210820132420586.png" alt="image-20210820132420586"></p>
<p><img src="/img/image-20210820132431971.png" alt="image-20210820132431971"></p>
<h3 id="2-3-负载均衡也可以使用代理参数"><a href="#2-3-负载均衡也可以使用代理参数" class="headerlink" title="2.3 负载均衡也可以使用代理参数"></a>2.3 负载均衡也可以使用代理参数</h3><blockquote>
<p>与之前部署的知乎wencenter、博客mywordpress结合</p>
</blockquote>
<p>1、准备Nginx负载均衡调度使用的proxy_params</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@Nginx ~]# vim &#x2F;etc&#x2F;nginx&#x2F;proxy_params
proxy_set_header Host $http_host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

proxy_connect_timeout 30;
proxy_send_timeout 60;
proxy_read_timeout 60;

proxy_buffering on;
proxy_buffer_size 32k;
proxy_buffers 4 128k;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、负载均衡配置：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 conf.d]# vim proxy_oldboy.com.conf
upstream node &#123;
        server 172.16.1.7:80;
        server 172.16.1.8:80;
&#125;
server &#123;
        listen 80;
        server_name blog.oldboy.com;
        location &#x2F; &#123;
                proxy_pass http:&#x2F;&#x2F;node;
                include proxy_params;
        &#125;
&#125;

server &#123;
        listen 80;
        server_name zh.oldboy.com;
        location &#x2F; &#123;
                proxy_pass http:&#x2F;&#x2F;node;
                include proxy_params;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-4-负载均衡测试"><a href="#2-4-负载均衡测试" class="headerlink" title="2.4 负载均衡测试"></a>2.4 负载均衡测试</h3><p>正常情况下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">1、两台web服务器的nginx服务均打开（模拟流量分摊）
	可以负载均衡，轮流访问
2、关掉一台web服务器的nginx服务（模拟容灾）
	网页仍可以正常打开
3、两台web服务器的Nginx服务均关闭
	网页无法打开，502<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>存在一种情况，两个web的nginx服务都没挂，但是其中一台的php-fpm服务挂了，模拟这种场景</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web02 ~]# systemctl stop php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时F5刷新wordpress的页面，将一会502，一会正常，体验不好，可通过添加nginx代理参数解决</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 conf.d]# cat &#x2F;etc&#x2F;nginx&#x2F;proxy_params
proxy_set_header Host $http_host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_next_upstream error timeout http_500 http_502 http_503 http_504; # 解决问题

proxy_connect_timeout 30;
proxy_send_timeout 60;
proxy_read_timeout 60;

proxy_buffering on;
proxy_buffer_size 32k;
proxy_buffers 4 128k;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>PS：问题原因</p>
<p>使用nginx负载均衡时，如何将后端请求超时的服务器流量平滑的切换到另一台上。<br>Nginx是本身是有机制的，如果出现一个节点down掉的时候，Nginx会更据你具体负载均衡的设置，将请求转移到其他的节点上，但是，如果后台服务连接没有down掉，并且返回错误异常码了如：504、502、500，Nginx就会直接返回从后端获取的异常代码。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/14-Nginx(%E5%85%AB)Nginx%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/14-Nginx(%E5%85%AB)Nginx%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" class="post-title-link" itemprop="url">运维之综合架构--07--Nginx(八)四层负载均衡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 11:19:52" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-11 13:55:26" itemprop="dateModified" datetime="2022-07-11T13:55:26+08:00">2022-07-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">（二）综合架构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、Nginx四层负载均衡介绍"><a href="#一、Nginx四层负载均衡介绍" class="headerlink" title="一、Nginx四层负载均衡介绍"></a>一、Nginx四层负载均衡介绍</h2><p>四层负载均衡：（OSI传输层   ip:port）<br>    nginx1.9 版本加入<br>硬件：F5<br>软件：LVS、Haproxy、Nginx</p>
<p>1.四层+七层来作负载均衡，4层可以保证7层的负载均衡的高可用性。如:nginx就无法保证自己的服务高可用，需要依赖lvs或者keepalive来作。</p>
<p>2.如:tcp协议的负载均衡，有些请求是TCP协议的(mysql、ssh)，或者说这些请求只需要使用4层进行端口的转发就可以了，所以使用4层负载均衡。<br>    比如做：mysql读的负载均衡（轮询）<br>    比如做：端口映射、端口转发         tcp&#x2F;udp</p>
<p>四层负载均衡总结<br>1.四层负载均衡仅能转发TCP&#x2F;IP协议、UDP协议，通常用来转发端口，如: tcp&#x2F;3306，tcp&#x2F;22，udp&#x2F;53。<br>2.四层负载均衡可以用来解决七层负载均衡的端口限制问题。（七层负载均衡最大使用65535个端口号）<br>3.可以用来解决七层负载均衡的高可用问题。（多台后端七层负载均衡能同时的使用）<br>4.四层的转发效率比七层的高的多，但仅支持tcp&#x2F;ip协议，不支持http或者https协议</p>
<p><img src="/img/image-20210823230415237.png" alt="image-20210823230415237"></p>
<h2 id="二、四层负载均衡配置"><a href="#二、四层负载均衡配置" class="headerlink" title="二、四层负载均衡配置"></a>二、四层负载均衡配置</h2><h3 id="2-1-环境准备"><a href="#2-1-环境准备" class="headerlink" title="2.1 环境准备"></a>2.1 环境准备</h3><table>
<thead>
<tr>
<th>服务器名</th>
<th>公网IP</th>
<th>内网IP</th>
</tr>
</thead>
<tbody><tr>
<td>lb4-01</td>
<td>10.0.0.3</td>
<td></td>
</tr>
<tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
</tr>
<tr>
<td>lb02</td>
<td>10.0.0.6</td>
<td>172.16.1.6</td>
</tr>
<tr>
<td>web、nfs、mysql服务器若干</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-2-新增lb02负载均衡服务器"><a href="#2-2-新增lb02负载均衡服务器" class="headerlink" title="2.2 新增lb02负载均衡服务器"></a>2.2 新增lb02负载均衡服务器</h3><p>1、准备<code>lb02</code>，安装Nginx服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb02 ~]# cat &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo 
[nginx]
name&#x3D;nginx repo
baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;centos&#x2F;7&#x2F;$basearch&#x2F;
gpgcheck&#x3D;0
enabled&#x3D;1
[root@lb02 ~]#  yum install nginx -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、拷贝<code>lb01</code>的 Nginx配置到<code>lb02</code></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb02 ~]# scp -rp root@172.16.1.5:&#x2F;etc&#x2F;nginx &#x2F;etc&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、启动Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb02 conf.d]# nginx -t
[root@lb02 conf.d]# systemctl start nginx
[root@lb02 conf.d]# systemctl enable nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>报错：</p>
<p>[root@lb02 ~]# nginx -t<br>nginx: [emerg] unknown directive “check” in &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf:4<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed<br>[root@lb02 ~]# vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf<br>[root@lb02 ~]# nginx -t<br>nginx: [emerg] unknown directive “check_status” in &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf:17<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed</p>
<p>解决方法：</p>
<p>因为lb01安装过第三方健康检查工具，而lb02上没有，先将这些报错点注释掉</p>
</blockquote>
<p>4、测试lb02是否正常</p>
<p>将hosts中的10.0.0.5换成10.0.0.6，phpadmin、wordpress网页可以正常访问,<br>但是wecenter异常502 Bad Gateway<br>解决方法: 将web01、02上的的php.ini中的session.auto_start改为0,不然会502</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 php]# vim &#x2F;etc&#x2F;php.ini
session.auto_start &#x3D; 0
[root@web01 php]# systemctl restart php-fpm.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>网上搜索的解释：<br>日常开发中，php.ini配置session.auto_start&#x3D;0默认关闭会话时如果想开启会话需要调用session_start：<br>session.auto_start 开启就自动完成了session_start()<br>区别就在于在用SESSION前是否需要session_start();<br>当session.auto_start &#x3D; on时，执行 session_start() 将产生新的 session_id<br>session.auto_start &#x3D; on 的优点在于，任何时候都不会因忘记执行 session_start() 或 session_start() 在程序里的位置不对，而导致错误<br>缺点在于，如果你使用的是第三方代码，则必须删去其中的全部 session_start() 。否则将不能得到正确的结果</p>
</blockquote>
<h3 id="2-3-配置四层负载均衡"><a href="#2-3-配置四层负载均衡" class="headerlink" title="2.3 配置四层负载均衡"></a>2.3 配置四层负载均衡</h3><p>1、新增<code>lb4-01</code>服务器，安装nginx</p>
<blockquote>
<p>nginx需要带–with-stream模块</p>
</blockquote>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">[root@lb4-01 ~]# cat &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo 
[nginx]
name&#x3D;nginx repo
baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;centos&#x2F;7&#x2F;$basearch&#x2F;
gpgcheck&#x3D;0
enabled&#x3D;1
[root@lb4-01 ~]#  yum install nginx -y	
[root@lb4-01 ~]# vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf
events &#123;
    ....
&#125;

include &#x2F;etc&#x2F;nginx&#x2F;conf.c&#x2F;*.conf;

http &#123;
	.....
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、创建四层负载均衡配置的目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb4-01 conf.c]# rm -f &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf   #删除http的80端口
[root@lb4-01 ~]# mkdir &#x2F;etc&#x2F;nginx&#x2F;conf.c
[root@lb4-01 ~]# cd &#x2F;etc&#x2F;nginx&#x2F;conf.c
[root@lb4-01 conf.c]# cat lb_domain.conf 
stream &#123;
    upstream lb &#123;
        server 172.16.1.5:80 weight&#x3D;5 max_fails&#x3D;3 fail_timeout&#x3D;30s;
        server 172.16.1.6:80 weight&#x3D;5 max_fails&#x3D;3 fail_timeout&#x3D;30s;
    &#125;

    server &#123;
        listen 80;
        proxy_connect_timeout 3s;
        proxy_timeout 3s;
        proxy_pass lb;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、重载服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb4-01 conf.c]# nginx -t
nginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf syntax is ok
nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test is successful
[root@lb4-01 conf.c]# systemctl restart nginx
[root@lb4-01 conf.c]# systemctl enable nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>报错：<br>[root@lb4-01 nginx]# nginx  -t<br>nginx: [emerg] unknown directive “stream” in &#x2F;etc&#x2F;nginx&#x2F;conf.c&#x2F;lb_domain.conf:1<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed<br>解决方法：<br>yum install nginx-mod-stream.x86_64 -y</p>
</blockquote>
<blockquote>
<p>报错：<br>[root@lb4-01 nginx]# systemctl status nginx<br>nginx.service - The nginx HTTP and reverse proxy server<br>Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service; enabled; vendor preset: disabled)<br>Active: failed (Result: exit-code) since Tue 2021-08-24 07:48:42 CST; 13s ago<br>Process: 2969 ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx (code&#x3D;exited, status&#x3D;1&#x2F;FAILURE)<br>Process: 2967 ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -t (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)<br>Process: 2965 ExecStartPre&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm -f &#x2F;run&#x2F;nginx.pid (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)<br>Main PID: 1959 (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</p>
<p>Aug 24 07:48:40 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:40 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:41 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:41 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:42 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:42 lb4-01 nginx[2969]: nginx: [emerg] still could not bind()<br>解决方法：<br>需要将[root@lb4-01 nginx]# vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf<br>中默认的80端口改掉，比如改成81,这样才不冲突（奇怪。。）</p>
</blockquote>
<p>4、访问测试</p>
<p>将Hosts中的对应网站地址的IP改成10.0.0.3，尝试访问，可以正常通过四层负载均衡来调度10.0.0.5和10.0.0.6七层负载均衡</p>
<p><img src="/img/image-20210824001613717.png" alt="image-20210824001613717"></p>
<p><img src="/img/image-20210824001638506.png" alt="image-20210824001638506"></p>
<h2 id="三、四层负载均衡日志"><a href="#三、四层负载均衡日志" class="headerlink" title="三、四层负载均衡日志"></a>三、四层负载均衡日志</h2><h3 id="3-1-配置过程"><a href="#3-1-配置过程" class="headerlink" title="3.1 配置过程"></a>3.1 配置过程</h3><p>在四层负载均衡中配置Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb4-01 ~]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.c&#x2F;lb_domain.conf
stream &#123;
    log_format  proxy &#39;$remote_addr $remote_port - [$time_local] $status $protocol &#39;
                  &#39;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#39; ;
    access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;proxy.log proxy;

    upstream lb &#123;
....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-查看日志"><a href="#3-2-查看日志" class="headerlink" title="3.2 查看日志"></a>3.2 查看日志</h3><p>网页访问后，可见产生的日志</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb4-01 ~]# tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;proxy.log
10.0.0.1 56396 - [25&#x2F;Aug&#x2F;2021:19:25:33 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;15150&quot; &quot;0.000&quot;
10.0.0.1 59800 - [25&#x2F;Aug&#x2F;2021:19:25:34 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;8327&quot; &quot;0.000&quot;
10.0.0.1 63468 - [25&#x2F;Aug&#x2F;2021:19:25:34 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;17882&quot; &quot;0.000&quot;
10.0.0.1 50394 - [25&#x2F;Aug&#x2F;2021:19:25:35 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;24490&quot; &quot;0.000&quot;
10.0.0.1 55549 - [25&#x2F;Aug&#x2F;2021:19:25:35 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;13201&quot; &quot;0.000&quot;
10.0.0.1 64324 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;70995&quot; &quot;0.000&quot;
10.0.0.1 64566 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;72650&quot; &quot;0.000&quot;
10.0.0.1 65216 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;68171&quot; &quot;0.000&quot;
10.0.0.1 49668 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;82071&quot; &quot;0.004&quot;
10.0.0.1 49745 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;63941&quot; &quot;0.001&quot;
10.0.0.1 50574 - [25&#x2F;Aug&#x2F;2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;103581&quot; &quot;0.000&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、使用nginx四层负载均衡实现tcp的转发（跳板）"><a href="#三、使用nginx四层负载均衡实现tcp的转发（跳板）" class="headerlink" title="三、使用nginx四层负载均衡实现tcp的转发（跳板）"></a>三、使用nginx四层负载均衡实现tcp的转发（跳板）</h2><p>实现跳板机的功能，比如：</p>
<pre><code>请求负载均衡 5555    ---&gt;     172.16.1.7:22;
请求负载均衡 6666    ---&gt;     172.16.1.51:3306;
</code></pre>
<h3 id="3-1-配置过程-1"><a href="#3-1-配置过程-1" class="headerlink" title="3.1 配置过程"></a>3.1 配置过程</h3><p>配置Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb4-01 ~]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.c&#x2F;lb_domain.conf 
stream &#123;
log_format  proxy &#39;$remote_addr $remote_port - [$time_local] $status $protocol &#39;
                  &#39;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#39; ;
    access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;proxy.log proxy;

#定义转发ssh的22端口
	upstream ssh_7 &#123;
		server 10.0.0.7:22;
	&#125;
#定义转发mysql的3306端口
	upstream mysql_51 &#123;
		server 10.0.0.51:3306;
	&#125;
    server &#123;
        listen 5555;
        proxy_connect_timeout 3s;
        proxy_timeout 300s;
        proxy_pass ssh_7;
    &#125;

    server &#123;
        listen 6666;
        proxy_connect_timeout 3s;
        proxy_timeout 3s;
        proxy_pass mysql_51;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 连接web01
ssh root@10.0.0.3 -p 5555

# 连接db01
ssh root@10.0.0.3 -p 6666<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>










      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/15-Nginx(%E4%B9%9D)%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%92%8Crewrite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/15-Nginx(%E4%B9%9D)%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%92%8Crewrite/" class="post-title-link" itemprop="url">运维之综合架构--07--Nginx(九)动静分离</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 11:19:52" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-11 13:55:46" itemprop="dateModified" datetime="2022-07-11T13:55:46+08:00">2022-07-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">（二）综合架构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、动静分离介绍"><a href="#一、动静分离介绍" class="headerlink" title="一、动静分离介绍"></a>一、动静分离介绍</h2><p>动静分离，通过中间件将动静分离和静态请求进⾏分离；<br>通过中间件将动态请求和静态请求分离，可以建上不必要的请求消耗，同时能减少请求的延时。<br>通过中间件将动态请求和静态请求分离，逻辑图如下:  </p>
<h2 id="二、单台服务器动静分离配置"><a href="#二、单台服务器动静分离配置" class="headerlink" title="二、单台服务器动静分离配置"></a>二、单台服务器动静分离配置</h2><p>逻辑图如下：</p>
<p><img src="/img/%E5%8D%95%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB.png" alt="单台服务器动静分离"></p>
<p>编辑Nginx配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 conf.d]vim blog.conf
server &#123;
    listen 80;
    server_name blog.linux.com;
    location &#x2F; &#123;
    root &#x2F;code&#x2F;wordpress;
    index index.php;
&#125;

# 如果请求的是以.jpg结尾的静态⽂件 就去&#x2F;code&#x2F;images⽬录下访问
location ~* \.jpg$ &#123;
    root &#x2F;code&#x2F;images;
    &#125;
    location ~* \.php$ &#123;
    root &#x2F;code&#x2F;wordpress;
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    &#125;
&#125; 

# 创建⽬录
[root@web01 conf.d]# mkdir &#x2F;code&#x2F;images&#x2F;

# 实现动静分离
⽅式⼀：把⽂件挪到&#x2F;code&#x2F;images&#x2F;
cp -r &#x2F;code&#x2F;wordpress&#x2F;wp-content &#x2F;code&#x2F;images&#x2F;

⽅式⼆：做软连接
cd &#x2F;code
ln -s wordpress images<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、多台服务器动静分离配置"><a href="#三、多台服务器动静分离配置" class="headerlink" title="三、多台服务器动静分离配置"></a>三、多台服务器动静分离配置</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/backups/p/nginx10.html">https://www.cnblogs.com/backups/p/nginx10.html</a></p>
<h3 id="3-1-原理图"><a href="#3-1-原理图" class="headerlink" title="3.1 原理图"></a>3.1 原理图</h3><p><img src="/img/%E5%A4%9A%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB.png" alt="多台服务器动静分离"></p>
<h3 id="3-2-实验环境准备"><a href="#3-2-实验环境准备" class="headerlink" title="3.2 实验环境准备"></a>3.2 实验环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>外网</th>
<th>内网</th>
<th>作用服务</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
<td>负载均衡 nginx proxy</td>
</tr>
<tr>
<td>web01</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
<td>静态资源 nginx static</td>
</tr>
<tr>
<td>web02</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
<td>动态资源 tomcat server</td>
</tr>
</tbody></table>
<h3 id="3-3-配置web01提供静态资源"><a href="#3-3-配置web01提供静态资源" class="headerlink" title="3.3 配置web01提供静态资源"></a>3.3 配置web01提供静态资源</h3><p>1、配置Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 images]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;jt.conf
# 动静分离，web01提供静态文件服务
server &#123;
        listen 80;
        server_name dongjing.gs.com;
        
        # 提供临时测试的域名
        root &#x2F;code&#x2F;dongjing;
        index index.html;

        location ~* ^.*\.(jpg|png|gif)$ &#123;
                root &#x2F;code&#x2F;dongjing&#x2F;images;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、上传静态资源，测试访问静态页面</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web01 ~]# echo &quot;web01...jingtai&quot; &gt; &#x2F;code&#x2F;index.html
[root@web01 ~]# mkdir &#x2F;code&#x2F;dongjing&#x2F;images&#x2F; &amp;&amp; cd &#x2F;code&#x2F;dongjing&#x2F;images&#x2F;
[root@web01 images]# rz 1.jpg
[root@web01 images]# nginx -t
nginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf syntax is ok
nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test is successful
[root@web01 images]# systemctl reload nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>在客户端配置hosts，10.0.0.7 dongjing.gs.com</code></p>
<p>打开浏览器访问<a target="_blank" rel="noopener" href="http://dongjing.gs.com/">http://dongjing.gs.com</a></p>
<p><img src="/img/image-20210825141423629.png" alt="image-20210825141423629"></p>
<p>打开浏览器访问<a target="_blank" rel="noopener" href="http://dongjing.gs.com/1.png">http://dongjing.gs.com/1.png</a></p>
<p><img src="/img/image-20210825142256349.png" alt="image-20210825142256349"></p>
<h3 id="3-4-配置web02提供动态资源（tomcat-java模拟"><a href="#3-4-配置web02提供动态资源（tomcat-java模拟" class="headerlink" title="3.4 配置web02提供动态资源（tomcat + java模拟)"></a>3.4 配置web02提供动态资源（tomcat + java模拟)</h3><p>1、安装Tomcat并添加jsp文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web02 ~]# yum install -y tomcat
[root@web02 ~]# mkdir &#x2F;usr&#x2F;share&#x2F;tomcat&#x2F;webapps&#x2F;ROOT
[root@web02 ~]# cat &gt;&#x2F;usr&#x2F;share&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;java_test.jsp &lt;&lt;EOF
&lt;%@ page language&#x3D;&quot;java&quot; import&#x3D;&quot;java.util.*&quot; pageEncoding&#x3D;&quot;utf-8&quot;%&gt;
&lt;HTML&gt;
    &lt;HEAD&gt;
        &lt;TITLE&gt;oldboy JSP Page&lt;&#x2F;TITLE&gt;
    &lt;&#x2F;HEAD&gt;
    &lt;BODY&gt;
        &lt;%
            Random rand &#x3D; new Random();
            out.println(&quot;&lt;h1&gt;随机数:&lt;h1&gt;&quot;);
            out.println(rand.nextInt(99)+100);
        %&gt;
    &lt;&#x2F;BODY&gt;
&lt;&#x2F;HTML&gt;
EOF
[root@web02 ~]# systemctl start tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、测试访问</p>
<p>访问<a target="_blank" rel="noopener" href="http://10.0.0.8:8080/java_test.jsp">http://10.0.0.8:8080/java_test.jsp</a></p>
<p><img src="/img/image-20210825162829977.png" alt="image-20210825162829977"></p>
<h3 id="3-4-增加负载均衡，实现动静分离"><a href="#3-4-增加负载均衡，实现动静分离" class="headerlink" title="3.4 增加负载均衡，实现动静分离"></a>3.4 增加负载均衡，实现动静分离</h3><p>1、配置Nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 dongtai]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_dj.conf
upstream jt &#123;
        server 172.16.1.7:80;
&#125;

upstream dt &#123;
        server 172.16.1.8:8080;
&#125;

server &#123;
        listen 80;
        server_name dongjing.gs.com;

        location ~* ^.*\.(jpg|png|gif)$ &#123;
                proxy_pass http:&#x2F;&#x2F;jt;
                proxy_set_header HOST $http_host;
        &#125;

        location ~ \.jsp$ &#123;
                proxy_pass http:&#x2F;&#x2F;dt;
                proxy_set_header HOST $http_host;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、测试访问</p>
<p><code>客户端配置hosts，10.0.0.3 dongjing.gs.com</code></p>
<p>在浏览器访问</p>
<p><a target="_blank" rel="noopener" href="http://dongjing.gs.com/1.png">http://dongjing.gs.com/1.png</a></p>
<p><a target="_blank" rel="noopener" href="http://10.0.0.8:8080/java_test.jsp">http://10.0.0.8:8080/java_test.jsp</a></p>
<p>的效果是一样的，但是访问<a target="_blank" rel="noopener" href="http://dongjing.gs.com显示的是nginx默认的主页,因为lb01中暂时没有对应文件夹的index.html/">http://dongjing.gs.com显示的是Nginx默认的主页，因为lb01中暂时没有对应文件夹的index.html</a></p>
<h3 id="3-5-在负载均衡上创建同时调用动态和静态资源的index-html"><a href="#3-5-在负载均衡上创建同时调用动态和静态资源的index-html" class="headerlink" title="3.5 在负载均衡上创建同时调用动态和静态资源的index.html"></a>3.5 在负载均衡上创建同时调用动态和静态资源的index.html</h3><p>1、修改Nginx配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 dongtai]# cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_dj.conf
upstream jt &#123;
        server 172.16.1.7:80;
&#125;

upstream dt &#123;
        server 172.16.1.8:8080;
&#125;

server &#123;
        listen 80;
        server_name dongjing.gs.com;
		
		# 新增
        location &#x2F; &#123;
                root &#x2F;code&#x2F;dongjing;
                index index.html;
        &#125;

        location ~* ^.*\.(jpg|png|gif)$ &#123;
                proxy_pass http:&#x2F;&#x2F;jt;
                proxy_set_header HOST $http_host;
        &#125;

        location ~ \.jsp$ &#123;
                proxy_pass http:&#x2F;&#x2F;dt;
                proxy_set_header HOST $http_host;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、创建对应的目录和页面</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@lb01 &#x2F;]# mkdir &#x2F;code&#x2F;dongjing
[root@lb01 &#x2F;]# cat &#x2F;code&#x2F;dongjing&#x2F;index.html
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
        &lt;meta charset&#x3D;&quot;UTF-8&quot; &#x2F;&gt;
        &lt;title&gt;测试ajax和跨域访问&lt;&#x2F;title&gt;
        &lt;script src&#x3D;&quot;http:&#x2F;&#x2F;libs.baidu.com&#x2F;jquery&#x2F;2.1.4&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;&#x2F;head&gt;
&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;
$(document).ready(function()&#123;
        $.ajax(&#123;
        type: &quot;GET&quot;,
        url: &quot;http:&#x2F;&#x2F;dongjing.gs.com&#x2F;java_test.jsp&quot;,
        success: function(data)&#123;
                $(&quot;#get_data&quot;).html(data)
        &#125;,
        error: function() &#123;
                alert(&quot;哎呦喂,失败了,回去检查你服务去~&quot;);
        &#125;
        &#125;);
&#125;);
&lt;&#x2F;script&gt;
&lt;body&gt;
        &lt;h1&gt;测试动静分离&lt;&#x2F;h1&gt;
        &lt;div id&#x3D;&quot;get_data&quot;&gt;&lt;&#x2F;div&gt;
        &lt;img src&#x3D;&quot;http:&#x2F;&#x2F;dongjing.gs.com&#x2F;1.png&quot;&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、测试访问</p>
<p>浏览器访问：<a target="_blank" rel="noopener" href="http://dongjing.gs.com/">http://dongjing.gs.com</a></p>
<p><img src="/img/image-20210825143746986.png" alt="image-20210825143746986"></p>
<p>正常负载均衡的现象：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">关掉web02的Tomcat服务，web01服务正常

​	http:&#x2F;&#x2F;dongjing.gs.com可以正常打开，图片正常显示，随机数将显示异常

web02的Tomcat服务正常，关掉web01的nginx服务

​	http:&#x2F;&#x2F;dongjing.gs.com可以正常打开，图片显示异常，随机正常显示<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、综合案例-Nginx资源分离"><a href="#四、综合案例-Nginx资源分离" class="headerlink" title="四、综合案例-Nginx资源分离"></a>四、综合案例-Nginx资源分离</h2><h3 id="4-1-什么是资源分离？"><a href="#4-1-什么是资源分离？" class="headerlink" title="4.1 什么是资源分离？"></a>4.1 什么是资源分离？</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">根据浏览器Agent标识可以访问到不同的页面资源：
比如：
    Android访问到的是Android的页面
    PC访问到的是PC的页面
    iphone访问放到的是iphone的页面<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-实验环境准备"><a href="#4-2-实验环境准备" class="headerlink" title="4.2 实验环境准备"></a>4.2 实验环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>外网</th>
<th>内网</th>
<th>作用服务</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
<td>负载均衡 nginx proxy</td>
</tr>
<tr>
<td>web01</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
<td>提供Android手机页面</td>
</tr>
<tr>
<td>web02</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
<td>提供PC访问页面</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day01-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day01-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--虚拟机安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:08:58" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day01-课堂笔记"><a href="#day01-课堂笔记" class="headerlink" title="day01 : 课堂笔记"></a>day01 : 课堂笔记</h1><h2 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h2><p><strong>1、安装虚拟机</strong></p>
<p><img src="/.%5Cassets%5Cimage-20210302121236930.png" alt="image-20210302121236930"></p>
<p>解压上述软件，创建vmware.exe快捷方式，然后用快捷方式打开。</p>
<p><img src="/.%5Cassets%5Cimage-20210302121408360.png" alt="image-20210302121408360"></p>
<p><strong>2、创建虚拟机</strong></p>
<p><img src="/.%5Cassets%5Cimage-20210302121456338.png" alt="image-20210302121456338"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121550128.png" alt="image-20210302121550128"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121622000.png" alt="image-20210302121622000"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121745568.png" alt="image-20210302121745568"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122035359.png" alt="image-20210302122035359"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122256831.png" alt="image-20210302122256831"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122359568.png" alt="image-20210302122359568"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122603313.png" alt="image-20210302122603313"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122657199.png" alt="image-20210302122657199"></p>
<p><img src="/.%5Cassets%5Cimage-20210302123826623.png" alt="image-20210302123826623"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124229475.png" alt="image-20210302124229475"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124308081.png" alt="image-20210302124308081"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124327456.png" alt="image-20210302124327456"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124404318.png" alt="image-20210302124404318"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124713502.png" alt="image-20210302124713502"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124741038.png" alt="image-20210302124741038"></p>
<p><img src="/.%5Cassets%5Cimage-20210302125049653.png" alt="image-20210302125049653"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day08-%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9/%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day08-%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9/%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--打包与压缩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:13:25" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="打包和压缩"><a href="#打包和压缩" class="headerlink" title="打包和压缩"></a>打包和压缩</h1><blockquote>
<p>将文件或文件夹合并成一个包，然后通过压缩算法进行数据压缩，减小包的体积，方便网络传输。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">windows：
	<span class="token function">zip</span>
	<span class="token function">rar</span>

linux:
	<span class="token function">zip</span>
	<span class="token function">tar</span>
	gz
	bz2
	tar.gz
	tar.bz2

压缩算法：
	<span class="token function">gzip</span>
	<span class="token function">bzip2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><blockquote>
<p>是一个Windows和Linux中常用打包压缩工具，支持的压缩算法是zip。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">zip工具需要安装
	yum <span class="token function">install</span> <span class="token function">zip</span> <span class="token function">unzip</span> -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="zip压缩一个文件"><a href="#zip压缩一个文件" class="headerlink" title="zip压缩一个文件"></a>zip压缩一个文件</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 格式</span>
	<span class="token function">zip</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 压缩包名称  文件路径

<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># zip 123.zip 123.log </span>
  adding: <span class="token number">123</span>.log <span class="token punctuation">(</span>deflated <span class="token number">87</span>%<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4732</span>
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">646165</span> Mar  <span class="token number">9</span> <span class="token number">10</span>:31 <span class="token number">123</span>.log
-rw-r--r--  <span class="token number">1</span> root root   <span class="token number">85296</span> Mar <span class="token number">11</span> <span class="token number">11</span>:58 <span class="token number">123</span>.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="zip压缩文件夹"><a href="#zip压缩文件夹" class="headerlink" title="zip压缩文件夹"></a>zip压缩文件夹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 需要一个-r参数去递归压缩文件夹下的所有内容</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># zip -r dir.zip dir/</span>
  adding: dir/ <span class="token punctuation">(</span>stored <span class="token number">0</span>%<span class="token punctuation">)</span>
  adding: dir/one/ <span class="token punctuation">(</span>stored <span class="token number">0</span>%<span class="token punctuation">)</span>
  adding: dir/123.log <span class="token punctuation">(</span>deflated <span class="token number">87</span>%<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="zip的静默输出"><a href="#zip的静默输出" class="headerlink" title="zip的静默输出"></a>zip的静默输出</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -q：参数就是不输出任何打包信息</span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># zip -r -q etc.zip /etc/</span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">14200</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">13674457</span> Mar <span class="token number">11</span> <span class="token number">12</span>:15 etc.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="zip解压命令（unzip）"><a href="#zip解压命令（unzip）" class="headerlink" title="zip解压命令（unzip）"></a>zip解压命令（unzip）</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 格式</span>
	<span class="token function">unzip</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 压缩包路径

<span class="token comment"># unzip解压命令只能解压由zip打包的压缩文件</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># unzip dir.zip </span>
Archive:  dir.zip
  inflating: dir/123.log             
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 其他压缩包由unzip解压时随即报错。</span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># unzip nginx-.tar.gz</span>
Archive:  nginx-.tar.gz
  End-of-central-directory signature not found.  Either this <span class="token function">file</span> is not
  a zipfile, or it constitutes one disk of a multi-part archive.  In the
  latter <span class="token keyword">case</span> the central directory and zipfile comment will be found on
  the last disk<span class="token punctuation">(</span>s<span class="token punctuation">)</span> of this archive.
unzip:  cannot <span class="token function">find</span> zipfile directory <span class="token keyword">in</span> one of nginx-.tar.gz or
        nginx-.tar.gz.zip, and cannot <span class="token function">find</span> nginx-.tar.gz.ZIP, period.


<span class="token comment"># 查看压缩包中压缩那些内容，不解压？</span>
<span class="token comment"># 只查看压缩包内容不解压需要使用 -l 参数</span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># unzip -l dir.zip </span>
Archive:  dir.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
        <span class="token number">0</span>  03-11-2021 <span class="token number">12</span>:04   dir/
---------                     -------
        <span class="token number">0</span>                     <span class="token number">1</span> <span class="token function">file</span>

<span class="token comment"># 解压到指定目录（-d）</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># unzip -d /root/  etc.zip </span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># cd /root/</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token punctuation">]</span>        anaconda-ks.cfg  dir.zip  index.html           test.pdf.gz  xxxeth0xxx           系统优化.md
<span class="token number">123</span>.log  demo.txt         etc      nginx-0.1.22.tar.gz  test.txt     上传与下载.md
<span class="token number">123</span>.zip  <span class="token function">dir</span>              eth0xxx  <span class="token builtin class-name">test</span>                 xxxeth0      文件管理_<span class="token punctuation">(</span>高级<span class="token punctuation">)</span>.pdf

<span class="token comment"># 静默输出(-q)</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># rm -rf etc</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># unzip -q -d /root/ /opt/etc.zip </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4828</span>
drwxr-xr-x  <span class="token number">91</span> root root    <span class="token number">8192</span> Mar <span class="token number">11</span> <span class="token number">11</span>:16 etc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><blockquote>
<p>tar压缩支持多种压缩算法</p>
<p>tar.gz   gzip (用的最多)</p>
<p>tar.bz2 bzip2</p>
</blockquote>
<h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h3><blockquote>
<p>通过gzip压缩算法，将文件压缩一定体积，有利于传输, 不支持打包</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4828</span>
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">244977</span> Mar <span class="token number">10</span> <span class="token number">12</span>:12 index.html
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># gzip index.html </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4612</span>
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">22652</span> Mar <span class="token number">10</span> <span class="token number">12</span>:12 index.html.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="gzip压缩一个目录"><a href="#gzip压缩一个目录" class="headerlink" title="gzip压缩一个目录"></a>gzip压缩一个目录</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc etc<span class="token punctuation">]</span><span class="token comment"># gzip -r /etc</span>
<span class="token punctuation">[</span>root@abc etc<span class="token punctuation">]</span><span class="token comment"># ls </span>
abrt                        GREP_COLORS.gz               my.cnf.d                 security
adjtime.gz                  groff                        my.cnf.gz                selinux
aliases.db.gz               group-.gz                    NetworkManager           services.gz
aliases.gz                  group.gz                     networks.gz              sestatus.conf.gz
alternatives                grub2.cfg                    nsswitch.conf.bak.gz     sgml
anacrontab.gz               grub.d                       nsswitch.conf.gz         shadow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="gzip解压-d"><a href="#gzip解压-d" class="headerlink" title="gzip解压(-d)"></a>gzip解压(-d)</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
-rw-r--r--   <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span>   <span class="token number">22652</span> Mar <span class="token number">10</span> <span class="token number">12</span>:12 index.html.gz
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># gzip -d index.html.gz </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4828</span>
-rw-r--r--   <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span>  <span class="token number">244977</span> Mar <span class="token number">10</span> <span class="token number">12</span>:12 index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h3><blockquote>
<p>使用bzip2 压缩算法来压缩一定体积的文件。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4828</span>
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">646165</span> Mar  <span class="token number">9</span> <span class="token number">10</span>:31 <span class="token number">123</span>.log     
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># bzip2 123.log </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4240</span>
-rw-r--r--   <span class="token number">1</span> root root       <span class="token number">0</span> Mar <span class="token number">10</span> <span class="token number">12</span>:04 <span class="token punctuation">]</span>
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">42210</span> Mar  <span class="token number">9</span> <span class="token number">10</span>:31 <span class="token number">123</span>.log.bz2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="bzip2解压（-d）"><a href="#bzip2解压（-d）" class="headerlink" title="bzip2解压（-d）"></a>bzip2解压（-d）</h3><blockquote>
<p>bzip2解压是针对于bzip2压缩的压缩包来进行解压。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4240</span>
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">42210</span> Mar  <span class="token number">9</span> <span class="token number">10</span>:31 <span class="token number">123</span>.log.bz2
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># bzip2 -d 123.log.bz2 </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">4828</span>
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">646165</span> Mar  <span class="token number">9</span> <span class="token number">10</span>:31 <span class="token number">123</span>.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="tar-1"><a href="#tar-1" class="headerlink" title="tar"></a>tar</h3><blockquote>
<p>tar其实是一个打包工具，不具备压缩功能，但是可以使用参数调用压缩工具来进行解压。</p>
</blockquote>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>-c : 创建压缩包</p>
</li>
<li><p>-f : 指定压缩包名称</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -c -f test.tar 123.log </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">5468</span>
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">655360</span> Mar <span class="token number">11</span> <span class="token number">15</span>:49 test.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-z ： 指定使用gzip压缩工具进行压缩</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar  -c -z -f test-one.tar 123.log </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l </span>
total <span class="token number">5084</span>
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">85279</span> Mar <span class="token number">11</span> <span class="token number">15</span>:56 test-one.tar

<span class="token comment"># 注：使用-z参数，不会自动添加.gz后缀</span>

<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -c -z -f anaconda.tar.gz  anaconda-ks.cfg </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">5084</span>
-rw-r--r--   <span class="token number">1</span> root root    <span class="token number">1010</span> Mar <span class="token number">11</span> <span class="token number">15</span>:58 anaconda.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-j : 指定使用bzip2压缩工具进行压缩</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -c -j -f 123-bask-one.tar 123.log </span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">5172</span>
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">42328</span> Mar <span class="token number">11</span> <span class="token number">16</span>:00 <span class="token number">123</span>-bak.tar.bz2
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">42328</span> Mar <span class="token number">11</span> <span class="token number">16</span>:01 <span class="token number">123</span>-bask-one.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-J : 指定使用xz压缩工具进行压缩</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># tar -c -J  -f etc.tar.xz /etc/</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">9493376</span> Mar <span class="token number">11</span> <span class="token number">17</span>:00 etc.tar.xz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-t : 查看压缩包内容</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -t -f 123-bak.tar.bz2 </span>
<span class="token number">123</span>.log
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-v ： 显示压缩包压缩过程</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -x -v -f etc.tar -C /opt/</span>
/etc/centos-release
/etc/DIR_COLORS.lightbgcolor
/etc/libaudit.conf
/etc/mail.rc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-P : 允许使用绝对路径进行打包</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -c -P -f 123-three.tar /etc/passwd</span>
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -c -f 123-three.tar /etc/passwd</span>
tar: Removing leading `/' from member names
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-x ： 解压</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># tar解压是按照原来的路径进行解压</span>
<span class="token punctuation">[</span>root@abc test<span class="token punctuation">]</span><span class="token comment"># tar -x -f etc.tar </span>

<span class="token comment"># tar会自动识别压缩功能</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-C ： 指定解压路径</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># tar -x -f etc.tar -C /opt/</span>
tar: Removing leading `/' from member names
<span class="token punctuation">[</span>root@abc ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/</span>
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># ls</span>
abc23  <span class="token function">dir</span>  dir.zip  etc  nginx-0.1.22.tar.gz  nginx-.tar.gz  xxx
<span class="token punctuation">[</span>root@abc opt<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>–exclude : 排除某些文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># tar -c -f abc.tar ./* --exclude=abc7 --exclude=abc5   --exclude=abc1 </span>
<span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># tar -t -f abc.tar </span>
./abc2
./abc3
./abc4
./abc6
./abc8
./abc9
<span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>–exclude-from : 根据某个文件列表排除多个文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># cat list.txt </span>
abc995
abc996
abc997
abc998
abc999
<span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># tar -c -f abc.tar ./* --exclude-from=list.txt </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>-h : 打包软连接</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@abc test-tar<span class="token punctuation">]</span><span class="token comment"># tar -c -h -f bin-h.tar /bin</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tar参数
	-c <span class="token builtin class-name">:</span> 创建压缩
	-f ； 指定压缩包名称
	-z <span class="token builtin class-name">:</span> 使用gzip压缩工具进行压缩
	-j <span class="token builtin class-name">:</span> 使用bzip2压缩工具进行压缩
	-J <span class="token builtin class-name">:</span> 使用xz压缩工具进行压缩
	-t <span class="token builtin class-name">:</span> 显示压缩包内容，不解压
	-v <span class="token builtin class-name">:</span> 显示压缩过程
	-P <span class="token builtin class-name">:</span> 允许使用绝对路径进行压缩
	-x <span class="token builtin class-name">:</span> 解压
	-C <span class="token builtin class-name">:</span> 指定解压路径
	-h <span class="token builtin class-name">:</span> 打包软连接
	--exclude <span class="token builtin class-name">:</span> 排除某些文件
	--exclude-from <span class="token builtin class-name">:</span> 根据文件列表排除多个文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>.linux下常见的压缩包类型有哪些
<span class="token function">zip</span> 
gz 
bz2 
tar.gz 
tar.bz 
<span class="token function">tar</span>

<span class="token number">2</span>.将/etc/hosts文件用tar格式打包。
<span class="token function">tar</span> -c -P -f hosts.tar /etc/hosts

<span class="token number">3</span>.查看打包之后的/etc/hosts的文件内容，在不解压的情况下查看。
<span class="token function">tar</span> -t -f hosts.tar

<span class="token number">4</span>.使用tar打包/var/log/目录。
<span class="token function">tar</span> -c -P -f hosts.tar /var/log/

<span class="token number">5</span>.使用zip打包/etc目录。
<span class="token function">zip</span> -r etc.zip /etc

<span class="token number">6</span>.查看/var/log/abc.zip目录的压缩包中有哪些内容。
<span class="token function">unzip</span> -l /var/log/abc.zip

<span class="token number">7</span>.将/var/log/abc.zip目录解压到/opt目录中。
<span class="token function">unzip</span> -d /opt /var/log/abc.zip

<span class="token number">10</span>.解压/etc/abc.tar.gz目录到/opt目录中。
<span class="token function">tar</span> -xf /etc/abc.tar.gz -C /opt

<span class="token number">11</span>.用zip打包/opt目录，要求不显示打包过程。
<span class="token function">zip</span> -q opt.zip /opt

<span class="token function">zip</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 压缩包名称  压缩文件路径
 
<span class="token number">12</span>.打包/etc/目录，要求是.bz2格式
<span class="token function">tar</span> -c -j -f etc.tar /etc

<span class="token number">13</span>.打包/var/log目录，要求是.xz格式
<span class="token function">tar</span> -c -J -f log.tar.xz /var/log

<span class="token number">14</span>.使用tar命令打包/etc/时，会出现一个删根的操作，怎样打包不会进行删根的操作
<span class="token function">tar</span> -c -P -f etc.tar /etc

<span class="token number">15</span>.打包/etc/目录，要求不打包/etc/hosts这个文件。

<span class="token number">16</span>.打包/etc/目录，要求不打包/etc/hosts和/etc/hostname这两个文件。

<span class="token number">17</span>.打包/etc/目录，但要排除passwd,shadow,group,gshadow,hosts,hostname这些文件。<span class="token punctuation">(</span>你能用两种方法实现吗<span class="token punctuation">)</span>

<span class="token number">18</span>.已知/etc/grub2.cfg文件是个软连接文件，在你不知道的情况下，请问怎么打包该文件的真实文件。

<span class="token number">19</span>.把/var/log/目录中所有.log的文件进行打包成一个压缩包，名称定义为log.tar.gz的压缩包。

<span class="token number">20</span>.已知文件oldboy.gz,请问在不解压的情况下，怎样查看该文件的内容。

<span class="token number">21</span>.打包/etc/目录，当前时间方式的压缩包:比如: <span class="token number">2019</span>-12-24_etc.tar.gz

<span class="token number">22</span>.创建/data/bak目录，然后复制如下文件到/data/bak目录下

<span class="token number">23</span>.接22题，使用tar命令对/data/bak目录下的文件及目录以gzip的格式进行归档压缩到/data目录下（压缩包的名字以自己名字命名）

<span class="token number">24</span>.使用tar命令查看上题/data目录下压缩包内的内容。

<span class="token number">25</span>.把第23题/data目录下的压缩包，解压到/backup目录下

<span class="token number">26</span>.再次使用tar命令把/data/bak目录下的文件及目录以gzip的格式进行归档压缩到/data目录下，但是在进行归档压缩时，排除文件“sudoers”，然后查看该压缩包内容是否存在文件“sudoers”（压缩包名自行拟定）

<span class="token number">27</span>.打包/etc目录下所有普通文件到root用户家目录。

<span class="token number">28</span>.打包/etc/目录到/opt/目录下，名称要求以当前主机名和ip地址命名，例：oldboy_10.0.0.100.tar.gz

<span class="token number">29</span>.如何使用gzip命令对文件进行压缩、解压

<span class="token number">30</span>.如何用zip命令对文件以及目录进行压缩、解压

<span class="token number">32</span>.打包opt整个目录，并命名test_opt.tar.gz

<span class="token number">33</span>.查看打包好的test_opt.tar.gz里的文件

<span class="token number">34</span>.将打包好的test_opt.tar.gz内容指定解压至/tmp目录

<span class="token number">35</span>.打包etc目录下的所有文件，不要目录只要文件

<span class="token number">36</span>.打包etc目录下的所有文件，排除passwd，shadow

<span class="token number">37</span>.打包etc目录下的所有以p开头的文件

<span class="token number">38</span>.打包etc目录下所有大于1M的文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h2 id="习题-1"><a href="#习题-1" class="headerlink" title="习题"></a>习题</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2</span>.权限中的rwx-，每个字符所代表什么意思？对应的数字是什么？

r		可读		<span class="token number">4</span>

w		可写		<span class="token number">2</span>

x		可执行		<span class="token number">1</span>

-		没有权限	<span class="token number">0</span>


<span class="token number">3</span>.-rwxr-xr-x，写出对应数字权限



<span class="token number">4</span>.-rwxr--r--，写出对应数字权限


<span class="token number">5</span>.-r-xr-x--x，写出对应数字权限



<span class="token number">6</span>.-rw-r-xr-x，写出对应数字权限


<span class="token number">7</span>.-r--r--r--，写出对应数字权限



<span class="token number">8</span>.-r-xr-----，写出对应数字权限


<span class="token number">9</span>.---x-w-r--，写出对应数字权限


<span class="token number">10</span>.-rwxr--rw-，写出对应数字权限



<span class="token number">11</span>.-rw-r--r--，写出对应数字权限


<span class="token number">12</span>.---xr--rwx，写出对应数字权限


<span class="token number">13.777</span>，写出对应字母权限


<span class="token number">14.545</span>，写出对应字母权限




<span class="token number">15.744</span>，写出对应字母权限



<span class="token number">16.600</span>，写出对应字母权限



<span class="token number">17.641</span>，写出对应字母权限


<span class="token number">18.711</span>，写出对应字母权限



<span class="token number">19.700</span>，写出对应字母权限



<span class="token number">20.555</span>，写出对应字母权限



<span class="token number">21.733</span>，写出对应字母权限


<span class="token number">22.713</span>，写出对应字母权限



<span class="token number">23</span>.建一个目录/test,查看这个目录的默认权限是?




<span class="token number">24</span>.进入/test目录中,建一个文件abc,查看其默认的权限为？




<span class="token number">25</span>.创建一个文件test.txt,并其将权限改为600.



<span class="token number">26</span>.将test.txt文件的权限改为755.



<span class="token number">27</span>.将test.txt文件的权限改为000.



<span class="token number">28</span>.修改test.txt文件的权限为644.



<span class="token number">29</span>.给test.txt文件的属主加上x权限。




<span class="token number">30</span>.给test.txt文件的其他用户加上x权限。



<span class="token number">31</span>.去除test.txt文件的所有执行权限。



<span class="token number">32</span>.给/test目录及目录下的所有文件或目录的权限统一改为744。

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day10-Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day10-Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--用户权限</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:13:19" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="修改用户信息-usermod"><a href="#修改用户信息-usermod" class="headerlink" title="修改用户信息(usermod)"></a>修改用户信息(usermod)</h1><blockquote>
<p>修改用户信息最主要的命令是usermod命令，其参数跟useradd基本一致。</p>
</blockquote>
<ul>
<li><p>修改UID</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2002:2002::/home/xiaoyu:/bin/bash
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -u 2302 xiaoyu</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2002::/home/xiaoyu:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改基本组及附加组</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 基本组 : 一个用户必须拥有的哪个组</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2002::/home/xiaoyu:/bin/bash
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># id xiaoyu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>xiaoyu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2002</span><span class="token punctuation">(</span>xiaoyu<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2002</span><span class="token punctuation">(</span>xiaoyu<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -g group1 xiaoyu</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># id xiaoyu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>xiaoyu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2003::/home/xiaoyu:/bin/bash
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 附加组 ： 用户加入的其他用户组</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># groupadd group1</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span>,1001<span class="token punctuation">(</span>sssssssssssssssssssssss<span class="token punctuation">)</span>,1002<span class="token punctuation">(</span>test<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -G group1 root</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/group</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
group1:x:2003:root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改家目录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod  -d /home/xiaoyu123 xiaoyu</span>

<span class="token comment"># 注：修改家目录仅仅修改了配置，而原来的家目录文件没有迁移</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改用户描述信息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2003::/home/xiaoyu123:/bin/bash
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -c "这是一个甩锅" xiaoyu</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改用户默认解析器</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># usermod -s /bin/sh xiaoyu</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
xiaoyu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>锁定与解锁</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -L xiaoyu</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -U xiaoyu</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>修改登录名称</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -l dayu xiaoyu</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
dayu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>追加</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -G root dayu</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,0<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -G oldboy dayu</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># usermod -a -G root dayu</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,0<span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="密码（passwd）"><a href="#密码（passwd）" class="headerlink" title="密码（passwd）"></a>密码（passwd）</h1><blockquote>
<p>修改或添加Linux普通用户的密码。直接影响的文件是&#x2F;etc&#x2F;shadow</p>
</blockquote>
<ul>
<li><p>增加或修改密码</p>
<p>当用户密码不存在的时候即为增加密码，当用户密码存在时即为修改密码。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># useradd password</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
password:x:2303:2303::/home/password:/bin/bash
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/shadow</span>
password:<span class="token operator">!</span><span class="token operator">!</span>:18701:0:99999:7:::
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># passwd password</span>
Changing password <span class="token keyword">for</span> user password.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
password:x:2303:2303::/home/password:/bin/bash
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/shadow</span>
password:<span class="token variable">$6</span>$.EmM.4Bl<span class="token variable">$f</span>.LimfvMsxxFZq6yFklfyk08JKQORdQovlk2a2dtrpkP31lAMLQpezFqLheBYOTm4Sur9aAqZlC/6MN6wHFBM1:18701:0:99999:7:::
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>免交互修改密码</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># echo "123" | passwd --stdin dayu</span>
Changing password <span class="token keyword">for</span> user dayu.
passwd: all authentication tokens updated successfully.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h1><blockquote>
<p>就类似于班级，是某个同权限用户的集合。</p>
</blockquote>
<h2 id="创建组"><a href="#创建组" class="headerlink" title="创建组"></a>创建组</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupadd group2</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
group2:x:2304:
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>指定gid</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupadd -g 2204 group3</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
group3:x:2204:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>创建系统组</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupadd -r group4</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
group4:x:996:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="修改组"><a href="#修改组" class="headerlink" title="修改组"></a>修改组</h2><ul>
<li><p>修改名称</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -8 /etc/group</span>
girl:x:2001:
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupmod -n boy girl</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -8 /etc/group</span>
boy:x:2001:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改gid</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupmod -g 2021 boy</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -8 /etc/group</span>
boy:x:2021:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="删除组"><a href="#删除组" class="headerlink" title="删除组"></a>删除组</h2><blockquote>
<p>用户组在系统中删除，如果一个组被用户占用则不能删除。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># groupdel group4</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -8 /etc/group</span>
dajige:x:1003:
abc:x:2000:
xiaoyu:x:2002:
group1:x:2003:root
password:x:2303:
group2:x:2304:
group3:x:2204:
boy:x:2021:
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 注：用户被删除，用户基本组也会被删除</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># useradd test-group-del</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
test-group-del:x:2304:2305::/home/test-group-del:/bin/bash
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
test-group-del:x:2305:
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># userdel -r test-group-del</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/passwd</span>
password:x:2303:2303::/home/password:/bin/bash
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># tail -1 /etc/group</span>
boy:x:2021:
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="组成员管理"><a href="#组成员管理" class="headerlink" title="组成员管理"></a>组成员管理</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 添加一个组到用户</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># useradd gtest</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># vim /etc/group</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id gtest</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2304</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># gpasswd -a gtest group2</span>
Adding user gtest to group group2
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id gtest</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2304</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span>,2304<span class="token punctuation">(</span>group2<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>

<span class="token comment"># 添加多个组到用户</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># gpasswd -M gtest,root,dayu group</span>
gpasswd: group <span class="token string">'group'</span> does not exist <span class="token keyword">in</span> /etc/group
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># gpasswd -M gtest,root,dayu group3</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id root</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,2000<span class="token punctuation">(</span>abc<span class="token punctuation">)</span>,2003<span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,0<span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># id gtest</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2304</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2305</span><span class="token punctuation">(</span>gtest<span class="token punctuation">)</span>,2304<span class="token punctuation">(</span>group2<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>

<span class="token comment"># 为一个组添加组长(组长有权限向组内添加用户，其他用户[除root外]没有权限添加用户到该组)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># gpasswd -A dayu group3</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/gshadow</span>
group3:<span class="token operator">!</span>:dayu:gtest,dayu,oldboy

<span class="token comment"># 组权限</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># id dayu</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">2302</span><span class="token punctuation">(</span>dayu<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">2003</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span>,1000<span class="token punctuation">(</span>oldboy<span class="token punctuation">)</span>,2204<span class="token punctuation">(</span>group3<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># chown .group3 /tmp/12.txt </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls -l /tmp/12.txt</span>
-rw-r--r-- <span class="token number">1</span> root group3 <span class="token number">4</span> Mar <span class="token number">15</span> <span class="token number">11</span>:35 /tmp/12.txt
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># chmod g+w /tmp/12.txt</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls -l /tmp/12.txt</span>
-rw-rw-r-- <span class="token number">1</span> root group3 <span class="token number">4</span> Mar <span class="token number">15</span> <span class="token number">11</span>:35 /tmp/12.txt
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su - dayu</span>
Last login: Mon Mar <span class="token number">15</span> <span class="token number">11</span>:37:05 CST <span class="token number">2021</span> on pts/3
<span class="token punctuation">[</span>dayu@localhost ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"456"</span> <span class="token operator">></span> /tmp/12.txt 
<span class="token punctuation">[</span>dayu@localhost ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /tmp/12.txt
<span class="token number">456</span>
<span class="token punctuation">[</span>dayu@localhost ~<span class="token punctuation">]</span>$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day09-%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day09-%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--用户组管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:13:11" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h2 id="linux中用户介绍"><a href="#linux中用户介绍" class="headerlink" title="linux中用户介绍"></a>linux中用户介绍</h2><p>什么是用户？</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">用户其实就是相当于权限的化身，
处于安全考虑
所以，我们在进入系统之前都需要登录，根据用户给相应权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Linux系统中用户角色</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">uid <span class="token builtin class-name">:</span> Linux系统当中用户ID（相当于身份证号）
gid <span class="token builtin class-name">:</span> ANTA20163307

用户组其实是统一某一类用户权限

需求：
	大项目 ： 
		开发者：a b c d
		运维 ： e f
		测试：g
	共同的权限：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>超级用户</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">linux当中的老大（皇帝）: root
Windows当中的老大：administrator<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="用户与组相关的文件"><a href="#用户与组相关的文件" class="headerlink" title="用户与组相关的文件"></a>用户与组相关的文件</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd</span>
root:x:0:0:root:/root:/bin/bash
用户名称   是否存在密码   uid  gid  组名称/注释信息 家目录  默认解析器 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/facl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/facl/" class="post-title-link" itemprop="url">运维之基础命令--文件ACL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:13:53" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><blockquote>
<p>补充：</p>
<p>​	权限的归属</p>
<p>​		a : 属组、属主以及其他人的权限一起设置。</p>
<p>​		o : 其他人</p>
<p>​		g : 属组</p>
<p>​		u : 属主</p>
</blockquote>
<h2 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h2><blockquote>
<p>就是解决目录及文件的默认权限。</p>
</blockquote>
<ul>
<li>文件的最高权限是多少     777</li>
<li>文件夹的最高权限是多少  777</li>
</ul>
<h2 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h2><blockquote>
<p>ACL是为了解决某种特殊环境下的，用户权限需求。</p>
</blockquote>
<ul>
<li>setfacl ： 设置acl权限</li>
<li>getfacl ：查看ACL权限</li>
</ul>
<h3 id="acl权限归属"><a href="#acl权限归属" class="headerlink" title="acl权限归属"></a>acl权限归属</h3><ul>
<li>u : 指定用户</li>
<li>g : 指定组</li>
<li>o : 修改其他用户权限</li>
<li>m : 指定mask权限</li>
</ul>
<p>注：默认情况下，ACL权限跟普通权限保持一致。</p>
<h2 id="ACL-的流程"><a href="#ACL-的流程" class="headerlink" title="ACL 的流程"></a>ACL 的流程</h2><ul>
<li><p>1、创建文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> o+x /root
<span class="token function">chmod</span> o+x /root/xiaochen
<span class="token builtin class-name">cd</span> xiaochen

<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># touch abc.txt</span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># chmod 000 abc.txt </span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">0</span>
---------- <span class="token number">1</span> root root <span class="token number">0</span> Mar <span class="token number">16</span> <span class="token number">11</span>:39 abc.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>编写文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># echo 111 > abc.txt </span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># cat abc.txt </span>
<span class="token number">111</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>设置ACL权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># useradd xiaozhang</span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># setfacl -m u:xiaozhang:r abc.txt </span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
user:xiaozhang:r--
group::---
mask::r--
other::---

<span class="token comment"># 注：</span>
setfacl -m u:用户名称:权限<span class="token punctuation">(</span>rwx<span class="token punctuation">)</span> 文件名称<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查看文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># su - xiaozhang</span>
<span class="token punctuation">[</span>xiaozhang@localhost ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /root/xiaochen/abc.txt
<span class="token number">111</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>mask :  rw-</p>
<p>xxxx :   -w-</p>
<p>-w-</p>
<h2 id="ACL权限的删除"><a href="#ACL权限的删除" class="headerlink" title="ACL权限的删除"></a>ACL权限的删除</h2><ul>
<li><p>删除某个权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
user:xiaozhang:r--
group::---
group:xiaochen:r-x		<span class="token comment">#effective:r--</span>
mask::rw-
other::r--

<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># setfacl -x u:xiaozhang abc.txt</span>

<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
group::---
group:xiaochen:r-x
mask::r-x
other::r--


<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
group::---
group:xiaochen:r-x
mask::r-x
other::r--

<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># setfacl -x g:xiaochen abc.txt </span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
group::---
mask::---
other::r--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


</li>
<li><p>清空acl权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
user:xiaochen:rw-
user:xiaocao:rw-
group::---
group:xiaochen:rw-
group:xiaocao:rw-
mask::rw-
other::r--

<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># setfacl -b abc.txt </span>
<span class="token punctuation">[</span>root@localhost xiaochen<span class="token punctuation">]</span><span class="token comment"># getfacl abc.txt </span>
<span class="token comment"># file: abc.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::---
group::---
other::r--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="ACL继承"><a href="#ACL继承" class="headerlink" title="ACL继承"></a>ACL继承</h2><blockquote>
<p>默认情况下，ACL是不会继承上层目录的权限的。只有目录设置可继承子集文件才可以继承ACL权限。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost linux12<span class="token punctuation">]</span><span class="token comment"># setfacl -m d:u:xiaochen:w ../linux12</span>
<span class="token punctuation">[</span>root@localhost linux12<span class="token punctuation">]</span><span class="token comment"># touch bcd.txt</span>
<span class="token punctuation">[</span>root@localhost linux12<span class="token punctuation">]</span><span class="token comment"># ls -l</span>
total <span class="token number">0</span>
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">0</span> Mar <span class="token number">16</span> <span class="token number">15</span>:40 abc.txt
-rw-rw-r--+ <span class="token number">1</span> root root <span class="token number">0</span> Mar <span class="token number">16</span> <span class="token number">15</span>:43 bcd.txt
<span class="token punctuation">[</span>root@localhost linux12<span class="token punctuation">]</span><span class="token comment"># getfacl bcd.txt </span>
<span class="token comment"># file: bcd.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::rw-
user:xiaochen:-w-
group::r-x			<span class="token comment">#effective:r--</span>
mask::rw-
other::r--

<span class="token punctuation">[</span>root@localhost linux12<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>














      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day12-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day12-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%8C%85/" class="post-title-link" itemprop="url">运维之基础命令--软件包管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:02" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h1><ul>
<li><p>rpm包来源</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、来源网络下载
<span class="token number">2</span>、来源本地：自己的镜像自带的rpm包<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>




</li>
<li><p>rpm命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装</span>

<span class="token function">rpm</span> -ivh xxx.rpm

<span class="token comment"># http://nginx.org/packages/centos/7/x86_64/RPMS/</span>

-v <span class="token builtin class-name">:</span> 显示安装过程
-i ：显示安装包的详细信息
-h <span class="token builtin class-name">:</span> 安装包哈希标记

<span class="token comment"># 下载Nginx rpm安装包的全名</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm</span>
--2021-03-17 <span class="token number">12</span>:16:47--  http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm
Resolving nginx.org <span class="token punctuation">(</span>nginx.org<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">52.58</span>.199.22, <span class="token number">3.125</span>.197.172, 2a05:d014:edb:5702::6, <span class="token punctuation">..</span>.
Connecting to nginx.org <span class="token punctuation">(</span>nginx.org<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">52.58</span>.199.22<span class="token operator">|</span>:80<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">790284</span> <span class="token punctuation">(</span>772K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/x-redhat-package-manager<span class="token punctuation">]</span>
Saving to: ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span> <span class="token number">790,284</span>      339KB/s   <span class="token keyword">in</span> <span class="token number">2</span>.3s   

<span class="token number">2021</span>-03-17 <span class="token number">12</span>:16:51 <span class="token punctuation">(</span><span class="token number">339</span> KB/s<span class="token punctuation">)</span> - ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’ saved <span class="token punctuation">[</span><span class="token number">790284</span>/790284<span class="token punctuation">]</span>

<span class="token comment"># 安装rpm安装包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Preparing<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
Updating / installing<span class="token punctuation">..</span>.
   <span class="token number">1</span>:nginx-1:1.18.0-1.el7.ngx         <span class="token comment">################################# [100%]</span>
----------------------------------------------------------------------

Thanks <span class="token keyword">for</span> using nginx<span class="token operator">!</span>

Please <span class="token function">find</span> the official documentation <span class="token keyword">for</span> nginx here:
* http://nginx.org/en/docs/

Please subscribe to nginx-announce mailing list to get
the <span class="token function">most</span> important news about nginx:
* http://nginx.org/en/support.html

Commercial subscriptions <span class="token keyword">for</span> nginx are available on:
* http://nginx.com/products/

----------------------------------------------------------------------

<span class="token comment"># 验证nginx是否安装成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.18.0


<span class="token comment"># 卸载</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -e nginx (软件包名称)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
-bash: /usr/sbin/nginx: No such <span class="token function">file</span> or directory
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token comment"># 查看系统当中安装了哪些rpm软件包</span>
<span class="token function">rpm</span> -qa

<span class="token comment"># 查看系统当中是否安装了某个rpm软件包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -q nginx（软件包名）</span>
nginx-1.18.0-1.el7.ngx.x86_64
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -q safsdgsfdgfd</span>
package safsdgsfdgfd is not installed


<span class="token comment"># 显示已经安装过的rpm包详细信息。</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qi nginx</span>
Name        <span class="token builtin class-name">:</span> nginx
Epoch       <span class="token builtin class-name">:</span> <span class="token number">1</span>
Version     <span class="token builtin class-name">:</span> <span class="token number">1.18</span>.0
Release     <span class="token builtin class-name">:</span> <span class="token number">1</span>.el7.ngx
Architecture: x86_64
Install Date: Wed <span class="token number">17</span> Mar <span class="token number">2021</span> 04:18:55 PM CST
Group       <span class="token builtin class-name">:</span> System Environment/Daemons
Size        <span class="token builtin class-name">:</span> <span class="token number">2830028</span>
License     <span class="token builtin class-name">:</span> <span class="token number">2</span>-clause BSD-like license
Signature   <span class="token builtin class-name">:</span> RSA/SHA1, Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:19:18 PM CST, Key ID abf5bd827bd9bf62
Source RPM  <span class="token builtin class-name">:</span> nginx-1.18.0-1.el7.ngx.src.rpm
Build Date  <span class="token builtin class-name">:</span> Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:07:33 PM CST
Build Host  <span class="token builtin class-name">:</span> ip-10-1-17-101.eu-central-1.compute.internal
Relocations <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>not relocatable<span class="token punctuation">)</span>
Vendor      <span class="token builtin class-name">:</span> Nginx, Inc.
URL         <span class="token builtin class-name">:</span> http://nginx.org/
Summary     <span class="token builtin class-name">:</span> High performance web server
Description <span class="token builtin class-name">:</span>
nginx <span class="token punctuation">[</span>engine x<span class="token punctuation">]</span> is an HTTP and reverse proxy server, as well as
a mail proxy server.

<span class="token comment"># 查看安装包的内容</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -ql nginx</span>
/etc/logrotate.d/nginx
/etc/nginx
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/fastcgi_params
/etc/nginx/koi-utf
/etc/nginx/koi-win
/etc/nginx/mime.types
/etc/nginx/modules
/etc/nginx/nginx.conf
/etc/nginx/scgi_params
/etc/nginx/uwsgi_params
/etc/nginx/win-utf
/etc/sysconfig/nginx
/etc/sysconfig/nginx-debug
/usr/lib/systemd/system/nginx-debug.service
/usr/lib/systemd/system/nginx.service
/usr/lib64/nginx
/usr/lib64/nginx/modules
/usr/libexec/initscripts/legacy-actions/nginx
/usr/libexec/initscripts/legacy-actions/nginx/check-reload
/usr/libexec/initscripts/legacy-actions/nginx/upgrade
/usr/sbin/nginx
/usr/sbin/nginx-debug
/usr/share/doc/nginx-1.18.0
/usr/share/doc/nginx-1.18.0/COPYRIGHT
/usr/share/man/man8/nginx.8.gz
/usr/share/nginx
/usr/share/nginx/html
/usr/share/nginx/html/50x.html
/usr/share/nginx/html/index.html
/var/cache/nginx
/var/log/nginx

<span class="token comment"># 查看配置信息</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -qc nginx</span>
/etc/logrotate.d/nginx
/etc/nginx/conf.d/default.conf
/etc/nginx/fastcgi_params
/etc/nginx/koi-utf
/etc/nginx/koi-win
/etc/nginx/mime.types
/etc/nginx/nginx.conf
/etc/nginx/scgi_params
/etc/nginx/uwsgi_params
/etc/nginx/win-utf
/etc/sysconfig/nginx
/etc/sysconfig/nginx-debug

<span class="token comment"># 查看文件帮助信息</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -qd zlib</span>
/usr/share/doc/zlib-1.2.7/ChangeLog
/usr/share/doc/zlib-1.2.7/FAQ
/usr/share/doc/zlib-1.2.7/README

<span class="token comment"># </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qf /usr/sbin/nginx</span>
nginx-1.18.0-1.el7.ngx.x86_64

<span class="token comment"># 用 -p 可以查看未安装软件包的详细信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qip nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Name        <span class="token builtin class-name">:</span> nginx
Epoch       <span class="token builtin class-name">:</span> <span class="token number">1</span>
Version     <span class="token builtin class-name">:</span> <span class="token number">1.18</span>.0
Release     <span class="token builtin class-name">:</span> <span class="token number">1</span>.el7.ngx
Architecture: x86_64
Install Date: <span class="token punctuation">(</span>not installed<span class="token punctuation">)</span>
Group       <span class="token builtin class-name">:</span> System Environment/Daemons
Size        <span class="token builtin class-name">:</span> <span class="token number">2830028</span>
License     <span class="token builtin class-name">:</span> <span class="token number">2</span>-clause BSD-like license
Signature   <span class="token builtin class-name">:</span> RSA/SHA1, Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:19:18 PM CST, Key ID abf5bd827bd9bf62
Source RPM  <span class="token builtin class-name">:</span> nginx-1.18.0-1.el7.ngx.src.rpm
Build Date  <span class="token builtin class-name">:</span> Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:07:33 PM CST
Build Host  <span class="token builtin class-name">:</span> ip-10-1-17-101.eu-central-1.compute.internal
Relocations <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>not relocatable<span class="token punctuation">)</span>
Vendor      <span class="token builtin class-name">:</span> Nginx, Inc.
URL         <span class="token builtin class-name">:</span> http://nginx.org/
Summary     <span class="token builtin class-name">:</span> High performance web server
Description <span class="token builtin class-name">:</span>
nginx <span class="token punctuation">[</span>engine x<span class="token punctuation">]</span> is an HTTP and reverse proxy server, as well as
a mail proxy server.

<span class="token comment"># 升级软件包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Preparing<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
Updating / installing<span class="token punctuation">..</span>.
   <span class="token number">1</span>:nginx-1:1.18.0-1.el7.ngx         <span class="token comment">################################# [ 50%]</span>
Cleaning up / removing<span class="token punctuation">..</span>.
   <span class="token number">2</span>:nginx-1:1.14.0-1.el7_4.ngx       <span class="token comment">################################# [100%]</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.18.0


<span class="token comment"># 强制删除软件包--nodeps</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -e zlib --nodeps</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><blockquote>
<p>yum是CentOS的软件包管理工具，自动为我们解决软件依赖问题。yum包管理工具必须使用yum源指定软件下载地址去下载需要安装的软件包。配置的路径是：&#x2F;etc&#x2F;yum.repos.d</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 清空本机所有的yum源</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<ul>
<li><p>yum源命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看当前系统的yum源列表</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist </span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                   repo name                                           status
base                      <span class="token string">"This is local repo, and 非常屌"</span>                    <span class="token number">10,072</span>
repolist: <span class="token number">10,072</span>

<span class="token comment"># yum清空缓存</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
Loaded plugins: fastestmirror
Cleaning repos: base
Cleaning up list of fastest mirrors
Other repos take up <span class="token number">76</span> M of disk space <span class="token punctuation">(</span>use --verbose <span class="token keyword">for</span> details<span class="token punctuation">)</span>

<span class="token comment"># 建立yum缓存</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum源的执行原理</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、需要在/etc/yum.repos.d目录下配置yum源地址
<span class="token number">2</span>、清空缓存建立新的缓存
<span class="token number">3</span>、安装软件（自动解决依赖关系）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum常用的基础命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装软件包的命令</span>
yum <span class="token function">install</span> 软件包名称
	-y <span class="token builtin class-name">:</span> 免交互安装

<span class="token comment"># 卸载软件（直接将软件的依赖包一起删除）</span>
yum remove 软件包名称
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum remove httpd</span>
	-y <span class="token builtin class-name">:</span> 免交互移除

<span class="token comment"># 查看当前系统需要更新软件</span>
yum check-update

<span class="token comment"># 更新所有的需要更新的软件</span>
yum update 
	-y ： 免交互

<span class="token comment"># 更新某一个软件</span>
yum update <span class="token punctuation">(</span>软件包名称<span class="token punctuation">)</span>

<span class="token comment"># 重装软件</span>
yum reinstall <span class="token punctuation">(</span>软件包名称<span class="token punctuation">)</span>

<span class="token comment"># 搜索软件包</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum search （软件包名称）</span>
-------------------------------------------------------

<span class="token comment"># 查看yum执行历史</span>
yum <span class="token function">history</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum history info (历史ID号)</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum history undo (历史ID号)</span>
<span class="token comment"># 查看当前系统当中可更新的软件包</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum check-update </span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile

postfix.x86_64                                        <span class="token number">2</span>:2.10.1-9.0.1.el7.centos.plus                                      centosplus
python-perf.x86_64                                    <span class="token number">3.10</span>.0-1160.15.2.el7.centos.plus                                    centosplus
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 查看系统中有哪些仓库地址</span>
yum repolist    <span class="token comment"># 正在启用的yum仓库</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                   repo name                                           status
base/7/x86_64             CentOS-7 - Base - repo.huaweicloud.com              <span class="token number">10,072</span>
extras/7/x86_64           CentOS-7 - Extras - repo.huaweicloud.com               <span class="token number">453</span>
updates/7/x86_64          CentOS-7 - Updates - repo.huaweicloud.com            <span class="token number">1,729</span>

yum repolist all <span class="token comment"># 查看系统中所有的yum仓库</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist all</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                                        repo name                                                             status
base/7/x86_64                                  CentOS-7 - Base - repo.huaweicloud.com                                enabled: <span class="token number">10,072</span>
centosplus/7/x86_64                            CentOS-7 - Plus - repo.huaweicloud.com                                disabled
extras/7/x86_64                                CentOS-7 - Extras - repo.huaweicloud.com                              enabled:    <span class="token number">453</span>
updates/7/x86_64                               CentOS-7 - Updates - repo.huaweicloud.com                             enabled:  <span class="token number">1,72</span>


<span class="token comment"># 启用repo仓库</span>
yum <span class="token function">install</span> yum-utils -y

启用一个yum仓库：yum-config-manager --enable <span class="token punctuation">(</span>仓库名称<span class="token punctuation">)</span>
关闭一个yum仓库：yum-config-manager --disable <span class="token punctuation">(</span>仓库名称<span class="token punctuation">)</span>


<span class="token comment"># 查看一个仓库中的软件包列表</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum list</span>

<span class="token comment"># 查看软件包组</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum grouplist</span>

<span class="token comment"># 安装软件包组</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum groupinstall "Development Tools"</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>本地yum源配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、备份/etc/yum.repos.d/下的所文件
	<span class="token function">rm</span> -rf /etc/yum.repos.d/*

<span class="token number">2</span>、编写本地yum源
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat test.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span> <span class="token comment"># yum源名称</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is repo infomation"</span> <span class="token comment">#yum源的简介</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt    <span class="token comment"># 指定yum源地址</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>				<span class="token comment"># 是否启用yum源</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>				<span class="token comment"># 是否检查gpg秘钥</span>

<span class="token number">3</span>、更新缓存
yum makecache

<span class="token number">4</span>、安装软件
yum <span class="token function">install</span> dos2unix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>共享yum源配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、安装ftp
yum <span class="token function">install</span> vsftpd -y

<span class="token number">2</span>、启动vsftpd
systemctl <span class="token builtin class-name">enable</span> --now vsftpd <span class="token comment"># 设置开机自启动并且立即启动</span>

<span class="token number">3</span>、创建yum源共享文件夹
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># mkdir /var/ftp/centos</span>

<span class="token number">4</span>、将映像中的软件复制到/var/ftp/centos
<span class="token function">cp</span> -rp /opt/* /var/ftp/centos

<span class="token number">5</span>、编辑本地yum源，接入ftp
<span class="token punctuation">[</span>root@localhost yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://192.168.15.100/centos
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp repo"</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token number">6</span>、测试安装
yum <span class="token function">install</span> dos2unix -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum的配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># yum仓库的机器上执行</span>
<span class="token number">1</span>、修改/etc/yum.conf
    <span class="token assign-left variable">cachedir</span><span class="token operator">=</span>/var/ftp/centos/Packages   <span class="token comment"># 指定yum缓存目录</span>
    <span class="token assign-left variable">keepcache</span><span class="token operator">=</span><span class="token number">1</span>							<span class="token comment"># 下载的缓存软件不立即删除， 0为立即删除</span>

<span class="token number">2</span>、安装ftp
yum <span class="token function">install</span> vsftpd -y

<span class="token number">3</span>、启动vsftpd
systemctl <span class="token builtin class-name">enable</span> --now vsftpd <span class="token comment"># 设置开机自启动并且立即启动</span>

<span class="token number">4</span>、创建yum源共享文件夹
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># mkdir /var/ftp/centos</span>

<span class="token number">5</span>、更新yum仓库
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">6</span>、建立一个快捷方式
<span class="token builtin class-name">cd</span> /var/ftp/centos/Packages/base
<span class="token function">ln</span> -s packages Packages

<span class="token number">7</span>、安装mariadb
yum <span class="token function">install</span> mariadb -y

<span class="token number">8</span>、建立/var/ftp/centos/Packages/base/repodata
<span class="token function">mkdir</span> /var/ftp/centos/Packages/base/repodata

<span class="token number">9</span>、把/var/ftp/centos/Packages/base下面的自动生成的压缩文件复制到/var/ftp/centos/Packages/base/repodata用做认证。

<span class="token comment"># 使用yum仓库的机器上执行</span>
<span class="token number">1</span>、建立yum配置文件
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.repos.d/local.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://192.168.15.100/centos/Packages/base
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp repo"</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token number">2</span>、更新yum仓库
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">3</span>、测试安装mariadb
yum <span class="token function">install</span> mariadb -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/sudo%20and%20su/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/sudo%20and%20su/" class="post-title-link" itemprop="url">运维之基础命令--sudo和su</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:13:48" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h1><blockquote>
<p>用于普通用提升权限的。</p>
</blockquote>
<ul>
<li><p>相关的文件：<code>/etc/sudoers</code></p>
</li>
<li><p>检查<code>/etc/sudoers</code>是否修改正确：visudo -c</p>
</li>
<li><p>sudoers文件格式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tom       <span class="token assign-left variable">ALL</span><span class="token operator">=</span>           <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>          ALL
用户名称   所有机器可登陆    所有IP或主机名   所有的指令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>指令编写格式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 必须写全路径：which查看命令全路径</span>

<span class="token comment">## 只支持vim命令提权</span>
xianchen <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>  /usr/bin/vim

<span class="token comment">## 支持所有的命令提权</span>
tom <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>  ALL

<span class="token comment">## 不支持某个命令提权</span>
tom <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL, <span class="token operator">!</span>/usr/bin/vim

<span class="token comment">## 不支持某个命令的部分功能</span>
xiaochen <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>   ALL, <span class="token operator">!</span>/usr/bin/vim /root/123.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="su"><a href="#su" class="headerlink" title="su"></a>su</h1><ul>
<li><p>su - xxx  和 su xxx之间区别</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、su - xxx ：相当于切换一个窗口，su xxx 仅仅切换了用户

<span class="token number">2</span>、su - xxx ： 切换用户执行的系统文件要多于 <span class="token function">su</span> xxx

<span class="token number">3</span>、su - xxx 是登录
   <span class="token function">su</span>  xxx  切换用户<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day13-yum%E4%BB%93%E5%BA%93/yum%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day13-yum%E4%BB%93%E5%BA%93/yum%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">运维之基础命令--yum仓库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:09" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="yum仓库"><a href="#yum仓库" class="headerlink" title="yum仓库"></a>yum仓库</h1><p>1、克隆两台主机</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum仓库主机
	外网地址：192.168.15.30
	内网地址：172.16.1.30

yum测试主机
	外网地址：192.168.15.31
	内网地址：172.16.1.31

修改的命令：
	<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-eth0
	<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-eth1
	
	重启网卡：systemctl restart network
	
	修改主机名：
		yum仓库主机：hostnamectl set-hostname warehouse
		yum测试主机：hostnamectl set-hostname yum-test
	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、配置yum仓库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、需要有一个软件包目录，存放软件包的
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># mkdir /backup</span>
	
	<span class="token number">1.1</span>、缓存yum安装下载的软件包
	<span class="token punctuation">[</span>root@warehouse <span class="token number">7</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/yum.conf</span>
	<span class="token punctuation">[</span>main<span class="token punctuation">]</span>
    <span class="token assign-left variable">cachedir</span><span class="token operator">=</span>/var/cache/yum/<span class="token variable">$basearch</span>/<span class="token variable">$releasever</span>
    <span class="token assign-left variable">keepcache</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum install mariadb -y</span>
	
	<span class="token number">1.2</span>、将缓存的软件包复制到yum仓库目录
	<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># cd /var/cache/yum/x86_64/7/base/packages/</span>
	<span class="token punctuation">[</span>root@warehouse packages<span class="token punctuation">]</span><span class="token comment"># cp -rp ./* /backup/</span>
    <span class="token punctuation">[</span>root@warehouse packages<span class="token punctuation">]</span><span class="token comment"># cd /backup/</span>
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">8964</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
	
<span class="token number">2</span>、建立软件包依赖关系
	<span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># yum install createrepo -y</span>
	<span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># createrepo /backup/</span>
    Spawning worker <span class="token number">0</span> with <span class="token number">1</span> pkgs
    Spawning worker <span class="token number">1</span> with <span class="token number">0</span> pkgs
    Workers Finished
    Saving Primary metadata
    Saving <span class="token function">file</span> lists metadata
    Saving other metadata
    Generating sqlite DBs
    Sqlite DBs complete
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">8968</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
    drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">4096</span> Mar <span class="token number">18</span> 08:54 repodata
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll repodata/</span>
    total <span class="token number">28</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1970</span> Mar <span class="token number">18</span> 08:54 5d54624b2aa7a1fe974ff5553a9a78289683189c6a7b60c8c1421ecf011d270f-other.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">3449</span> Mar <span class="token number">18</span> 08:54 5e68ee34f7e8f1a11a039f55c990bcc044f16bceb6af7f4486b55d518ad91346-primary.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root  <span class="token number">539</span> Mar <span class="token number">18</span> 08:54 6e94b0fa1d98955542fb8238348ea171be7a130ba97573eb3ac756e1aadcec50-filelists.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1291</span> Mar <span class="token number">18</span> 08:54 a9afb0b2457f41f5c2d64744a07d5d12599e6c2588c870ae73568cf345a0abca-other.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1333</span> Mar <span class="token number">18</span> 08:54 cf41627875b17ef4bea5f0ea566ac63a5c83adc606d3ca730a74944ceb969028-primary.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1158</span> Mar <span class="token number">18</span> 08:54 f34cbfd9e5608e8402041e98100f853e913f3df04d6946874c73ba31a78969ba-filelists.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">2969</span> Mar <span class="token number">18</span> 08:54 repomd.xml
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、测试连接（本地版本）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、备份系统所有的yum源
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir backup1</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
<span class="token punctuation">[</span>local<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is xxx"</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///backup
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 清理yum缓存</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>

<span class="token comment"># 生成新的yum缓存</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token comment"># 测试连接</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -e mariadb</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -ql mariadb</span>
package mariadb is not installed
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>4、测试连接（远程版本）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#########################  yum仓库机器上执行  ###################################</span>
<span class="token number">1</span>、备份系统所有的yum源
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir local</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo local</span>

<span class="token number">2</span>、安装远程访问软件
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv backup1/*  .</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install vsftpd -y</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now vsftpd </span>
Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.

<span class="token number">3</span>、配置系统yum仓库
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /var/ftp</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># mkdir yum_warehouse</span>

<span class="token number">4</span>、将软件包复制到yum仓库目录
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># cp -rp /backup/* /var/ftp/yum_warehouse/</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># ll yum_warehouse/</span>
total <span class="token number">8968</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">4096</span> Mar <span class="token number">18</span> 08:54 repodata

<span class="token number">5</span>、建立yum软件包依赖关系
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># createrepo /var/ftp/yum_warehouse/</span>


<span class="token comment">#########################  yum测试机器上执行  ###################################</span>
<span class="token number">1</span>、本机测试网络连接
    <span class="token number">1</span>、备份系统所有的yum源
    <span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
    <span class="token punctuation">[</span>local-ftp<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/yum_warehouse
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

    <span class="token comment"># 清理yum缓存</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>

    <span class="token comment"># 生成新的yum缓存</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

    <span class="token comment"># 测试连接</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -e mariadb</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -ql mariadb</span>
    package mariadb is not installed
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span>

<span class="token number">2</span>、yum测试机器执行
	<span class="token number">1</span>、备份yum仓库内容
	<span class="token punctuation">[</span>root@yum-test ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir backup1</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">0</span>
    drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">187</span> Mar  <span class="token number">4</span> 09:55 backup
    drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">220</span> Mar <span class="token number">18</span> 09:20 backup1
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># </span>
    
    <span class="token number">2</span>、编写本地yum源配置文件
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
    <span class="token punctuation">[</span>loacl-ftp-30<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is 30 ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/yum_warehouse
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
    
    <span class="token number">3</span>、清理yum缓存
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>
    
    <span class="token number">4</span>、生成yum缓存
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
    
    <span class="token number">5</span>、测试安装
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>4、同步远程yum仓库内容到本机</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、安装华为云镜像仓库
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-7-reg.repo</span>

<span class="token number">2</span>、生成yum缓存
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">3</span>、同步华为云镜像站软件包到本地yum仓库
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># yum install yum-utils -y</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># reposync -r (仓库名称：yum repolist)</span>

<span class="token number">4</span>、建立依赖关系
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># createrepo base</span>

<span class="token number">5</span>、测试
    <span class="token punctuation">[</span>loacl-ftp-30<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is 30 ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/base
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/.%5Cassets%5Cimage-20210318112338781.png" alt="image-20210318112338781"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GongSheng"
      src="/images/myavatar.png">
  <p class="site-author-name" itemprop="name">GongSheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GongSheng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

  <script async src="/js/cursor/fireworks.js"></script>


</body>
</html>
