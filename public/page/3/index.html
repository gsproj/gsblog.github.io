<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gsproj.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="GongSheng Blog">
<meta property="og:url" content="http://gsproj.github.io/page/3/index.html">
<meta property="og:site_name" content="GongSheng Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="GongSheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://gsproj.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>GongSheng Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">GongSheng Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">山川異域，風月同天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day12-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day12-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%8C%85/" class="post-title-link" itemprop="url">运维之基础命令--软件包管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:02" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h1><ul>
<li><p>rpm包来源</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、来源网络下载
<span class="token number">2</span>、来源本地：自己的镜像自带的rpm包<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>




</li>
<li><p>rpm命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装</span>

<span class="token function">rpm</span> -ivh xxx.rpm

<span class="token comment"># http://nginx.org/packages/centos/7/x86_64/RPMS/</span>

-v <span class="token builtin class-name">:</span> 显示安装过程
-i ：显示安装包的详细信息
-h <span class="token builtin class-name">:</span> 安装包哈希标记

<span class="token comment"># 下载Nginx rpm安装包的全名</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm</span>
--2021-03-17 <span class="token number">12</span>:16:47--  http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm
Resolving nginx.org <span class="token punctuation">(</span>nginx.org<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">52.58</span>.199.22, <span class="token number">3.125</span>.197.172, 2a05:d014:edb:5702::6, <span class="token punctuation">..</span>.
Connecting to nginx.org <span class="token punctuation">(</span>nginx.org<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">52.58</span>.199.22<span class="token operator">|</span>:80<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">790284</span> <span class="token punctuation">(</span>772K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/x-redhat-package-manager<span class="token punctuation">]</span>
Saving to: ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span> <span class="token number">790,284</span>      339KB/s   <span class="token keyword">in</span> <span class="token number">2</span>.3s   

<span class="token number">2021</span>-03-17 <span class="token number">12</span>:16:51 <span class="token punctuation">(</span><span class="token number">339</span> KB/s<span class="token punctuation">)</span> - ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’ saved <span class="token punctuation">[</span><span class="token number">790284</span>/790284<span class="token punctuation">]</span>

<span class="token comment"># 安装rpm安装包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Preparing<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
Updating / installing<span class="token punctuation">..</span>.
   <span class="token number">1</span>:nginx-1:1.18.0-1.el7.ngx         <span class="token comment">################################# [100%]</span>
----------------------------------------------------------------------

Thanks <span class="token keyword">for</span> using nginx<span class="token operator">!</span>

Please <span class="token function">find</span> the official documentation <span class="token keyword">for</span> nginx here:
* http://nginx.org/en/docs/

Please subscribe to nginx-announce mailing list to get
the <span class="token function">most</span> important news about nginx:
* http://nginx.org/en/support.html

Commercial subscriptions <span class="token keyword">for</span> nginx are available on:
* http://nginx.com/products/

----------------------------------------------------------------------

<span class="token comment"># 验证nginx是否安装成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.18.0


<span class="token comment"># 卸载</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -e nginx (软件包名称)</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
-bash: /usr/sbin/nginx: No such <span class="token function">file</span> or directory
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token comment"># 查看系统当中安装了哪些rpm软件包</span>
<span class="token function">rpm</span> -qa

<span class="token comment"># 查看系统当中是否安装了某个rpm软件包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -q nginx（软件包名）</span>
nginx-1.18.0-1.el7.ngx.x86_64
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -q safsdgsfdgfd</span>
package safsdgsfdgfd is not installed


<span class="token comment"># 显示已经安装过的rpm包详细信息。</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qi nginx</span>
Name        <span class="token builtin class-name">:</span> nginx
Epoch       <span class="token builtin class-name">:</span> <span class="token number">1</span>
Version     <span class="token builtin class-name">:</span> <span class="token number">1.18</span>.0
Release     <span class="token builtin class-name">:</span> <span class="token number">1</span>.el7.ngx
Architecture: x86_64
Install Date: Wed <span class="token number">17</span> Mar <span class="token number">2021</span> 04:18:55 PM CST
Group       <span class="token builtin class-name">:</span> System Environment/Daemons
Size        <span class="token builtin class-name">:</span> <span class="token number">2830028</span>
License     <span class="token builtin class-name">:</span> <span class="token number">2</span>-clause BSD-like license
Signature   <span class="token builtin class-name">:</span> RSA/SHA1, Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:19:18 PM CST, Key ID abf5bd827bd9bf62
Source RPM  <span class="token builtin class-name">:</span> nginx-1.18.0-1.el7.ngx.src.rpm
Build Date  <span class="token builtin class-name">:</span> Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:07:33 PM CST
Build Host  <span class="token builtin class-name">:</span> ip-10-1-17-101.eu-central-1.compute.internal
Relocations <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>not relocatable<span class="token punctuation">)</span>
Vendor      <span class="token builtin class-name">:</span> Nginx, Inc.
URL         <span class="token builtin class-name">:</span> http://nginx.org/
Summary     <span class="token builtin class-name">:</span> High performance web server
Description <span class="token builtin class-name">:</span>
nginx <span class="token punctuation">[</span>engine x<span class="token punctuation">]</span> is an HTTP and reverse proxy server, as well as
a mail proxy server.

<span class="token comment"># 查看安装包的内容</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -ql nginx</span>
/etc/logrotate.d/nginx
/etc/nginx
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/fastcgi_params
/etc/nginx/koi-utf
/etc/nginx/koi-win
/etc/nginx/mime.types
/etc/nginx/modules
/etc/nginx/nginx.conf
/etc/nginx/scgi_params
/etc/nginx/uwsgi_params
/etc/nginx/win-utf
/etc/sysconfig/nginx
/etc/sysconfig/nginx-debug
/usr/lib/systemd/system/nginx-debug.service
/usr/lib/systemd/system/nginx.service
/usr/lib64/nginx
/usr/lib64/nginx/modules
/usr/libexec/initscripts/legacy-actions/nginx
/usr/libexec/initscripts/legacy-actions/nginx/check-reload
/usr/libexec/initscripts/legacy-actions/nginx/upgrade
/usr/sbin/nginx
/usr/sbin/nginx-debug
/usr/share/doc/nginx-1.18.0
/usr/share/doc/nginx-1.18.0/COPYRIGHT
/usr/share/man/man8/nginx.8.gz
/usr/share/nginx
/usr/share/nginx/html
/usr/share/nginx/html/50x.html
/usr/share/nginx/html/index.html
/var/cache/nginx
/var/log/nginx

<span class="token comment"># 查看配置信息</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -qc nginx</span>
/etc/logrotate.d/nginx
/etc/nginx/conf.d/default.conf
/etc/nginx/fastcgi_params
/etc/nginx/koi-utf
/etc/nginx/koi-win
/etc/nginx/mime.types
/etc/nginx/nginx.conf
/etc/nginx/scgi_params
/etc/nginx/uwsgi_params
/etc/nginx/win-utf
/etc/sysconfig/nginx
/etc/sysconfig/nginx-debug

<span class="token comment"># 查看文件帮助信息</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># rpm -qd zlib</span>
/usr/share/doc/zlib-1.2.7/ChangeLog
/usr/share/doc/zlib-1.2.7/FAQ
/usr/share/doc/zlib-1.2.7/README

<span class="token comment"># </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qf /usr/sbin/nginx</span>
nginx-1.18.0-1.el7.ngx.x86_64

<span class="token comment"># 用 -p 可以查看未安装软件包的详细信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -qip nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Name        <span class="token builtin class-name">:</span> nginx
Epoch       <span class="token builtin class-name">:</span> <span class="token number">1</span>
Version     <span class="token builtin class-name">:</span> <span class="token number">1.18</span>.0
Release     <span class="token builtin class-name">:</span> <span class="token number">1</span>.el7.ngx
Architecture: x86_64
Install Date: <span class="token punctuation">(</span>not installed<span class="token punctuation">)</span>
Group       <span class="token builtin class-name">:</span> System Environment/Daemons
Size        <span class="token builtin class-name">:</span> <span class="token number">2830028</span>
License     <span class="token builtin class-name">:</span> <span class="token number">2</span>-clause BSD-like license
Signature   <span class="token builtin class-name">:</span> RSA/SHA1, Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:19:18 PM CST, Key ID abf5bd827bd9bf62
Source RPM  <span class="token builtin class-name">:</span> nginx-1.18.0-1.el7.ngx.src.rpm
Build Date  <span class="token builtin class-name">:</span> Tue <span class="token number">21</span> Apr <span class="token number">2020</span> <span class="token number">11</span>:07:33 PM CST
Build Host  <span class="token builtin class-name">:</span> ip-10-1-17-101.eu-central-1.compute.internal
Relocations <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>not relocatable<span class="token punctuation">)</span>
Vendor      <span class="token builtin class-name">:</span> Nginx, Inc.
URL         <span class="token builtin class-name">:</span> http://nginx.org/
Summary     <span class="token builtin class-name">:</span> High performance web server
Description <span class="token builtin class-name">:</span>
nginx <span class="token punctuation">[</span>engine x<span class="token punctuation">]</span> is an HTTP and reverse proxy server, as well as
a mail proxy server.

<span class="token comment"># 升级软件包</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span>
warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Preparing<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
Updating / installing<span class="token punctuation">..</span>.
   <span class="token number">1</span>:nginx-1:1.18.0-1.el7.ngx         <span class="token comment">################################# [ 50%]</span>
Cleaning up / removing<span class="token punctuation">..</span>.
   <span class="token number">2</span>:nginx-1:1.14.0-1.el7_4.ngx       <span class="token comment">################################# [100%]</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.18.0


<span class="token comment"># 强制删除软件包--nodeps</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm -e zlib --nodeps</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><blockquote>
<p>yum是CentOS的软件包管理工具，自动为我们解决软件依赖问题。yum包管理工具必须使用yum源指定软件下载地址去下载需要安装的软件包。配置的路径是：&#x2F;etc&#x2F;yum.repos.d</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 清空本机所有的yum源</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<ul>
<li><p>yum源命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看当前系统的yum源列表</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist </span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                   repo name                                           status
base                      <span class="token string">"This is local repo, and 非常屌"</span>                    <span class="token number">10,072</span>
repolist: <span class="token number">10,072</span>

<span class="token comment"># yum清空缓存</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
Loaded plugins: fastestmirror
Cleaning repos: base
Cleaning up list of fastest mirrors
Other repos take up <span class="token number">76</span> M of disk space <span class="token punctuation">(</span>use --verbose <span class="token keyword">for</span> details<span class="token punctuation">)</span>

<span class="token comment"># 建立yum缓存</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum源的执行原理</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、需要在/etc/yum.repos.d目录下配置yum源地址
<span class="token number">2</span>、清空缓存建立新的缓存
<span class="token number">3</span>、安装软件（自动解决依赖关系）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum常用的基础命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装软件包的命令</span>
yum <span class="token function">install</span> 软件包名称
	-y <span class="token builtin class-name">:</span> 免交互安装

<span class="token comment"># 卸载软件（直接将软件的依赖包一起删除）</span>
yum remove 软件包名称
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum remove httpd</span>
	-y <span class="token builtin class-name">:</span> 免交互移除

<span class="token comment"># 查看当前系统需要更新软件</span>
yum check-update

<span class="token comment"># 更新所有的需要更新的软件</span>
yum update 
	-y ： 免交互

<span class="token comment"># 更新某一个软件</span>
yum update <span class="token punctuation">(</span>软件包名称<span class="token punctuation">)</span>

<span class="token comment"># 重装软件</span>
yum reinstall <span class="token punctuation">(</span>软件包名称<span class="token punctuation">)</span>

<span class="token comment"># 搜索软件包</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum search （软件包名称）</span>
-------------------------------------------------------

<span class="token comment"># 查看yum执行历史</span>
yum <span class="token function">history</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum history info (历史ID号)</span>
<span class="token punctuation">[</span>root@www httpd<span class="token punctuation">]</span><span class="token comment"># yum history undo (历史ID号)</span>
<span class="token comment"># 查看当前系统当中可更新的软件包</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum check-update </span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile

postfix.x86_64                                        <span class="token number">2</span>:2.10.1-9.0.1.el7.centos.plus                                      centosplus
python-perf.x86_64                                    <span class="token number">3.10</span>.0-1160.15.2.el7.centos.plus                                    centosplus
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment"># 查看系统中有哪些仓库地址</span>
yum repolist    <span class="token comment"># 正在启用的yum仓库</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                   repo name                                           status
base/7/x86_64             CentOS-7 - Base - repo.huaweicloud.com              <span class="token number">10,072</span>
extras/7/x86_64           CentOS-7 - Extras - repo.huaweicloud.com               <span class="token number">453</span>
updates/7/x86_64          CentOS-7 - Updates - repo.huaweicloud.com            <span class="token number">1,729</span>

yum repolist all <span class="token comment"># 查看系统中所有的yum仓库</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum repolist all</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                                        repo name                                                             status
base/7/x86_64                                  CentOS-7 - Base - repo.huaweicloud.com                                enabled: <span class="token number">10,072</span>
centosplus/7/x86_64                            CentOS-7 - Plus - repo.huaweicloud.com                                disabled
extras/7/x86_64                                CentOS-7 - Extras - repo.huaweicloud.com                              enabled:    <span class="token number">453</span>
updates/7/x86_64                               CentOS-7 - Updates - repo.huaweicloud.com                             enabled:  <span class="token number">1,72</span>


<span class="token comment"># 启用repo仓库</span>
yum <span class="token function">install</span> yum-utils -y

启用一个yum仓库：yum-config-manager --enable <span class="token punctuation">(</span>仓库名称<span class="token punctuation">)</span>
关闭一个yum仓库：yum-config-manager --disable <span class="token punctuation">(</span>仓库名称<span class="token punctuation">)</span>


<span class="token comment"># 查看一个仓库中的软件包列表</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum list</span>

<span class="token comment"># 查看软件包组</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum grouplist</span>

<span class="token comment"># 安装软件包组</span>
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum groupinstall "Development Tools"</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>本地yum源配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、备份/etc/yum.repos.d/下的所文件
	<span class="token function">rm</span> -rf /etc/yum.repos.d/*

<span class="token number">2</span>、编写本地yum源
<span class="token punctuation">[</span>root@www yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat test.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span> <span class="token comment"># yum源名称</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is repo infomation"</span> <span class="token comment">#yum源的简介</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt    <span class="token comment"># 指定yum源地址</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>				<span class="token comment"># 是否启用yum源</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>				<span class="token comment"># 是否检查gpg秘钥</span>

<span class="token number">3</span>、更新缓存
yum makecache

<span class="token number">4</span>、安装软件
yum <span class="token function">install</span> dos2unix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>共享yum源配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、安装ftp
yum <span class="token function">install</span> vsftpd -y

<span class="token number">2</span>、启动vsftpd
systemctl <span class="token builtin class-name">enable</span> --now vsftpd <span class="token comment"># 设置开机自启动并且立即启动</span>

<span class="token number">3</span>、创建yum源共享文件夹
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># mkdir /var/ftp/centos</span>

<span class="token number">4</span>、将映像中的软件复制到/var/ftp/centos
<span class="token function">cp</span> -rp /opt/* /var/ftp/centos

<span class="token number">5</span>、编辑本地yum源，接入ftp
<span class="token punctuation">[</span>root@localhost yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://192.168.15.100/centos
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp repo"</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token number">6</span>、测试安装
yum <span class="token function">install</span> dos2unix -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>yum的配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># yum仓库的机器上执行</span>
<span class="token number">1</span>、修改/etc/yum.conf
    <span class="token assign-left variable">cachedir</span><span class="token operator">=</span>/var/ftp/centos/Packages   <span class="token comment"># 指定yum缓存目录</span>
    <span class="token assign-left variable">keepcache</span><span class="token operator">=</span><span class="token number">1</span>							<span class="token comment"># 下载的缓存软件不立即删除， 0为立即删除</span>

<span class="token number">2</span>、安装ftp
yum <span class="token function">install</span> vsftpd -y

<span class="token number">3</span>、启动vsftpd
systemctl <span class="token builtin class-name">enable</span> --now vsftpd <span class="token comment"># 设置开机自启动并且立即启动</span>

<span class="token number">4</span>、创建yum源共享文件夹
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># mkdir /var/ftp/centos</span>

<span class="token number">5</span>、更新yum仓库
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">6</span>、建立一个快捷方式
<span class="token builtin class-name">cd</span> /var/ftp/centos/Packages/base
<span class="token function">ln</span> -s packages Packages

<span class="token number">7</span>、安装mariadb
yum <span class="token function">install</span> mariadb -y

<span class="token number">8</span>、建立/var/ftp/centos/Packages/base/repodata
<span class="token function">mkdir</span> /var/ftp/centos/Packages/base/repodata

<span class="token number">9</span>、把/var/ftp/centos/Packages/base下面的自动生成的压缩文件复制到/var/ftp/centos/Packages/base/repodata用做认证。

<span class="token comment"># 使用yum仓库的机器上执行</span>
<span class="token number">1</span>、建立yum配置文件
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.repos.d/local.repo </span>
<span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://192.168.15.100/centos/Packages/base
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp repo"</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token number">2</span>、更新yum仓库
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@www ftp<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">3</span>、测试安装mariadb
yum <span class="token function">install</span> mariadb -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day13-yum%E4%BB%93%E5%BA%93/yum%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day13-yum%E4%BB%93%E5%BA%93/yum%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">运维之基础命令--yum仓库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:09" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="yum仓库"><a href="#yum仓库" class="headerlink" title="yum仓库"></a>yum仓库</h1><p>1、克隆两台主机</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum仓库主机
	外网地址：192.168.15.30
	内网地址：172.16.1.30

yum测试主机
	外网地址：192.168.15.31
	内网地址：172.16.1.31

修改的命令：
	<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-eth0
	<span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-eth1
	
	重启网卡：systemctl restart network
	
	修改主机名：
		yum仓库主机：hostnamectl set-hostname warehouse
		yum测试主机：hostnamectl set-hostname yum-test
	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、配置yum仓库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、需要有一个软件包目录，存放软件包的
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># mkdir /backup</span>
	
	<span class="token number">1.1</span>、缓存yum安装下载的软件包
	<span class="token punctuation">[</span>root@warehouse <span class="token number">7</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/yum.conf</span>
	<span class="token punctuation">[</span>main<span class="token punctuation">]</span>
    <span class="token assign-left variable">cachedir</span><span class="token operator">=</span>/var/cache/yum/<span class="token variable">$basearch</span>/<span class="token variable">$releasever</span>
    <span class="token assign-left variable">keepcache</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum install mariadb -y</span>
	
	<span class="token number">1.2</span>、将缓存的软件包复制到yum仓库目录
	<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># cd /var/cache/yum/x86_64/7/base/packages/</span>
	<span class="token punctuation">[</span>root@warehouse packages<span class="token punctuation">]</span><span class="token comment"># cp -rp ./* /backup/</span>
    <span class="token punctuation">[</span>root@warehouse packages<span class="token punctuation">]</span><span class="token comment"># cd /backup/</span>
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">8964</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
	
<span class="token number">2</span>、建立软件包依赖关系
	<span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># yum install createrepo -y</span>
	<span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># createrepo /backup/</span>
    Spawning worker <span class="token number">0</span> with <span class="token number">1</span> pkgs
    Spawning worker <span class="token number">1</span> with <span class="token number">0</span> pkgs
    Workers Finished
    Saving Primary metadata
    Saving <span class="token function">file</span> lists metadata
    Saving other metadata
    Generating sqlite DBs
    Sqlite DBs complete
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">8968</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
    drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">4096</span> Mar <span class="token number">18</span> 08:54 repodata
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># ll repodata/</span>
    total <span class="token number">28</span>
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1970</span> Mar <span class="token number">18</span> 08:54 5d54624b2aa7a1fe974ff5553a9a78289683189c6a7b60c8c1421ecf011d270f-other.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">3449</span> Mar <span class="token number">18</span> 08:54 5e68ee34f7e8f1a11a039f55c990bcc044f16bceb6af7f4486b55d518ad91346-primary.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root  <span class="token number">539</span> Mar <span class="token number">18</span> 08:54 6e94b0fa1d98955542fb8238348ea171be7a130ba97573eb3ac756e1aadcec50-filelists.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1291</span> Mar <span class="token number">18</span> 08:54 a9afb0b2457f41f5c2d64744a07d5d12599e6c2588c870ae73568cf345a0abca-other.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1333</span> Mar <span class="token number">18</span> 08:54 cf41627875b17ef4bea5f0ea566ac63a5c83adc606d3ca730a74944ceb969028-primary.xml.gz
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">1158</span> Mar <span class="token number">18</span> 08:54 f34cbfd9e5608e8402041e98100f853e913f3df04d6946874c73ba31a78969ba-filelists.sqlite.bz2
    -rw-r--r-- <span class="token number">1</span> root root <span class="token number">2969</span> Mar <span class="token number">18</span> 08:54 repomd.xml
    <span class="token punctuation">[</span>root@warehouse backup<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、测试连接（本地版本）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、备份系统所有的yum源
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir backup1</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
<span class="token punctuation">[</span>local<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is xxx"</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///backup
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 清理yum缓存</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>

<span class="token comment"># 生成新的yum缓存</span>
<span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token comment"># 测试连接</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -e mariadb</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -ql mariadb</span>
package mariadb is not installed
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>4、测试连接（远程版本）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#########################  yum仓库机器上执行  ###################################</span>
<span class="token number">1</span>、备份系统所有的yum源
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir local</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo local</span>

<span class="token number">2</span>、安装远程访问软件
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv backup1/*  .</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install vsftpd -y</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now vsftpd </span>
Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.

<span class="token number">3</span>、配置系统yum仓库
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cd /var/ftp</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># mkdir yum_warehouse</span>

<span class="token number">4</span>、将软件包复制到yum仓库目录
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># cp -rp /backup/* /var/ftp/yum_warehouse/</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># ll yum_warehouse/</span>
total <span class="token number">8968</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">9175948</span> Oct <span class="token number">15</span> 02:55 mariadb-5.5.68-1.el7.x86_64.rpm
drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">4096</span> Mar <span class="token number">18</span> 08:54 repodata

<span class="token number">5</span>、建立yum软件包依赖关系
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># createrepo /var/ftp/yum_warehouse/</span>


<span class="token comment">#########################  yum测试机器上执行  ###################################</span>
<span class="token number">1</span>、本机测试网络连接
    <span class="token number">1</span>、备份系统所有的yum源
    <span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
    <span class="token punctuation">[</span>local-ftp<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/yum_warehouse
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

    <span class="token comment"># 清理yum缓存</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>

    <span class="token comment"># 生成新的yum缓存</span>
    <span class="token punctuation">[</span>root@warehouse ~<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

    <span class="token comment"># 测试连接</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -e mariadb</span>
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rpm -ql mariadb</span>
    package mariadb is not installed
    <span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span>

<span class="token number">2</span>、yum测试机器执行
	<span class="token number">1</span>、备份yum仓库内容
	<span class="token punctuation">[</span>root@yum-test ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/yum.repos.d/</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mkdir backup1</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># mv *.repo backup1</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># ll</span>
    total <span class="token number">0</span>
    drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">187</span> Mar  <span class="token number">4</span> 09:55 backup
    drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">220</span> Mar <span class="token number">18</span> 09:20 backup1
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># </span>
    
    <span class="token number">2</span>、编写本地yum源配置文件
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># vim local.repo</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># cat local.repo </span>
    <span class="token punctuation">[</span>loacl-ftp-30<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is 30 ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/yum_warehouse
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
    
    <span class="token number">3</span>、清理yum缓存
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>
    
    <span class="token number">4</span>、生成yum缓存
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>
    
    <span class="token number">5</span>、测试安装
    <span class="token punctuation">[</span>root@yum-test yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum install mariadb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>4、同步远程yum仓库内容到本机</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、安装华为云镜像仓库
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-7-reg.repo</span>

<span class="token number">2</span>、生成yum缓存
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum clean all</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/cache/yum/x86_64/7/*</span>
<span class="token punctuation">[</span>root@warehouse yum.repos.d<span class="token punctuation">]</span><span class="token comment"># yum makecache</span>

<span class="token number">3</span>、同步华为云镜像站软件包到本地yum仓库
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># yum install yum-utils -y</span>
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># reposync -r (仓库名称：yum repolist)</span>

<span class="token number">4</span>、建立依赖关系
<span class="token punctuation">[</span>root@warehouse ftp<span class="token punctuation">]</span><span class="token comment"># createrepo base</span>

<span class="token number">5</span>、测试
    <span class="token punctuation">[</span>loacl-ftp-30<span class="token punctuation">]</span>
    <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"This is 30 ftp server"</span>
    <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://172.16.1.30/base
    <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/.%5Cassets%5Cimage-20210318112338781.png" alt="image-20210318112338781"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day16-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day16-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--进程管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:15" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><p>程序：安装包</p>
<p>进程：正在运行的实例</p>
<p>CPU：计算</p>
<p>内存：存储CPU计算使用的临时数据</p>
<p>存储：</p>
<p>进程和线程</p>
<p>僵尸进程和孤儿进程</p>
<p>僵尸进程：进程生命周期结束了，但是PID未被回收</p>
<p>孤儿进程：父进程生命周期结束了，但是子进程未结束，子进程被系统进程接收</p>
<p>1、查看进程</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 命令：ps, 默认查看当前进程</span>

<span class="token comment"># 参数</span>
-a <span class="token builtin class-name">:</span> 查询所有进程
-x <span class="token builtin class-name">:</span> 查看后台所有的进程
-u <span class="token builtin class-name">:</span> 查看进程的用户

<span class="token environment constant">USER</span> ： 开启当前进程的用户
PID  ： 当前进程的ID号
%CPU ： CPU的使用率
%MEM ： 内存使用率
VSZ  ： 进程启动时默认向计算机申请的内存
RSS  ： 进程运行时实际使用的内存
TTY  ： 进程运行的终端
	？： 后台运行（没有终端）
	tty：使用系统终端
	pts：使用虚拟终端
STAT ：进程运行状态
	R ： 正在运行中的进程
	+ ： 在前台运行
	S ： 睡眠中状态
	D ： 不可中断睡眠
	T ： 停止状态
	Z <span class="token builtin class-name">:</span>  僵尸状态
	X ： 死掉的进程
	<span class="token operator">&lt;</span> <span class="token builtin class-name">:</span> 优先级较高的进程
	N ：优先级较低的进程
	s <span class="token builtin class-name">:</span> 包含子进程       yum <span class="token function">install</span> psmisc -y 
	l <span class="token builtin class-name">:</span> 已线程的方式运行
	<span class="token operator">|</span> ： 代表管道
START ： 进程的启动时间
TIME  ： 占用CPU的时间
COMMAND ： 进程执行的命令


-e <span class="token builtin class-name">:</span> 显示所有的进程
-f <span class="token builtin class-name">:</span> 格式化输出同时显示<span class="token environment constant">PPID</span>

<span class="token environment constant">PPID</span> ： 父进程ID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、top</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 根据一定频率的去监控系统</span>

up前是系统时间
up后是开启的时间

load average: <span class="token number">0.01</span>, <span class="token number">0.42</span>, <span class="token number">0.73</span>
<span class="token number">0.01</span>  ： 一分钟平均负载
<span class="token number">0.42</span>  ： 五分钟平均负载
<span class="token number">0.73</span>  ： 十五分钟平均负载

平均负载：


<span class="token comment"># CPU加压工具</span>
stress --cpu <span class="token punctuation">[</span>需要加压的系统核心数<span class="token punctuation">]</span> --timeout <span class="token punctuation">[</span>加压的时间<span class="token punctuation">]</span>

<span class="token comment"># CPU 性能加压工具</span>
<span class="token comment">## 添加epel源（epel源主要用来安装红帽系列操作系统附加软件）</span>
yum <span class="token function">install</span> stress -y

<span class="token comment"># CPU 性能分析工具</span>
yum <span class="token function">install</span> sysstat -y

mpstat -P ALL <span class="token number">3</span>   

<span class="token comment"># 进程性能分析⼯具</span>
pidstat -u <span class="token number">1</span> <span class="token number">5</span>  



Tasks
Tasks: <span class="token number">125</span> total,   <span class="token number">1</span> running, <span class="token number">124</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie

total <span class="token builtin class-name">:</span> 当前系统一共运行的是125个进程
running <span class="token builtin class-name">:</span> 正在运行的是1个
sleeping <span class="token builtin class-name">:</span> <span class="token number">124</span>个处于睡眠状态
stopped <span class="token builtin class-name">:</span> 停止运行的进程数
zombie  ：僵尸进程数


%Cpu0  <span class="token builtin class-name">:</span>  <span class="token number">0.0</span> us,  <span class="token number">0.0</span> sy,  <span class="token number">0.0</span> ni,100.0 id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st

us ：在单位时间进程使用CPU所占用的时间百分比
sy <span class="token builtin class-name">:</span> 在单位时间内系统进程占用CPU时间百分比
ni <span class="token builtin class-name">:</span> 在单位时间内优先使用CPU所占时间百分比
<span class="token function">id</span> ：在单位时间内CPU空闲所占时间百分比
wa <span class="token builtin class-name">:</span> 在单位时间内CPU阻塞态所占CPU时间的百分比
hi <span class="token builtin class-name">:</span> 硬件中断
si <span class="token builtin class-name">:</span> 软件中断
st <span class="token builtin class-name">:</span> 其他占用CPU时间百分比

KiB Mem <span class="token builtin class-name">:</span>  <span class="token number">2027892</span> total,  <span class="token number">1234180</span> free,   <span class="token number">176352</span> used,   <span class="token number">617360</span> buff/cache

total ：系统总内存
<span class="token function">free</span>  ：系统空闲内存
used  <span class="token builtin class-name">:</span> 系统使用内存
buff/cache ： 缓存使用内存
avail Mem ：

  PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  
  
PID ： 进程编号
<span class="token environment constant">USER</span> ： 启动进程的用户
PR <span class="token builtin class-name">:</span> 优先级
NI ：nice值
VIRT ： 虚拟内存
RES  ： 使用内存
SHR  ： 共享内存
%CPU ： cpu使用率
%MEM ：内存使用率
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、top快捷键</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">按1 <span class="token builtin class-name">:</span> 展示所有的CPU的详情
按s <span class="token builtin class-name">:</span> 设置top监控频率（默认3秒）
按m <span class="token builtin class-name">:</span> 按照内存排序 
按z <span class="token builtin class-name">:</span> 添加颜色
按p <span class="token builtin class-name">:</span> 按照CPU排序
按l <span class="token builtin class-name">:</span> 展示CPU总负载（默认显示）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、top的参数</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-d ： 设置top的刷新频率
-p <span class="token builtin class-name">:</span>  设置查看的进程PID
	<span class="token function">top</span> -d <span class="token number">1</span> -p <span class="token variable"><span class="token variable">`</span>pgrep nginx <span class="token operator">|</span> <span class="token function">head</span> -1<span class="token variable">`</span></span>

-u <span class="token builtin class-name">:</span>  查询指定用户的经常的进程
	<span class="token function">top</span> -u oldboy

-n <span class="token builtin class-name">:</span> 表示查询n次
	 <span class="token function">top</span> -d <span class="token number">0.1</span> -u oldboy -n <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>epel<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Extra Packages <span class="token keyword">for</span> Enterprise Linux <span class="token number">7</span> - <span class="token variable">$basearch</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.tuna.tsinghua.edu.cn/epel/7/<span class="token variable">$basearch</span>
<span class="token comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;arch=$basearch</span>
<span class="token assign-left variable">failovermethod</span><span class="token operator">=</span>priority
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token punctuation">[</span>epel-debuginfo<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Extra Packages <span class="token keyword">for</span> Enterprise Linux <span class="token number">7</span> - <span class="token variable">$basearch</span> - Debug
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.tuna.tsinghua.edu.cn/epel/7/<span class="token variable">$basearch</span>/debug
<span class="token comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;arch=$basearch</span>
<span class="token assign-left variable">failovermethod</span><span class="token operator">=</span>priority
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token punctuation">[</span>epel-source<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Extra Packages <span class="token keyword">for</span> Enterprise Linux <span class="token number">7</span> - <span class="token variable">$basearch</span> - Source
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.tuna.tsinghua.edu.cn/epel/7/SRPMS
<span class="token comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;arch=$basearch</span>
<span class="token assign-left variable">failovermethod</span><span class="token operator">=</span>priority
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day17-Linux%E4%BF%A1%E5%8F%B7/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day17-Linux%E4%BF%A1%E5%8F%B7/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--linux信号</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:23" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>1、设置进程的nice值</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 设置进程的优先级</span>
<span class="token function">nice</span> -n -11 <span class="token function">bash</span> test.sh

-n ： 设置优先级
	普通用户：（0~19）
	超级用户：（-20~19）
	
<span class="token comment"># 给指定进程设置优先级</span>
<span class="token function">renice</span> <span class="token punctuation">[</span>设置优先级<span class="token punctuation">]</span> pid
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、Linux系统信号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">中断信号
	ctrl + c
	ctrl + z

	INT<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token builtin class-name">:</span> 
		<span class="token function">kill</span> -<span class="token punctuation">[</span>信号名称<span class="token operator">|</span>信号ID<span class="token punctuation">]</span>　pid
		
		<span class="token function">kill</span> -SIGINT  PID
		<span class="token function">kill</span> -INT     PID
		<span class="token function">kill</span> -2       PID 

退出信号:
	ctrl + d

暂停信号：将进程暂停
	SIGTSTP（20）
		<span class="token function">kill</span> -20 PID 
		<span class="token function">kill</span> -SIGTSTP PID 
		<span class="token function">kill</span> -TSTP PID

杀死进程信号
	SIGKILL
		<span class="token function">kill</span> -9 PID 
		<span class="token function">kill</span> -SIGKILL PID
		<span class="token function">kill</span> -KILL PID
注：不能够被捕捉

终止信号
	SIGTREM
		<span class="token function">kill</span> -15 PID 
		<span class="token function">kill</span> -SIGTERM PID
		<span class="token function">kill</span> -<span class="token environment constant">TERM</span> PID

注：优雅终止进程

暂停和恢复信号
	SIGCONT <span class="token builtin class-name">:</span> 恢复
	SIGSTOP ：暂停

重载信号
	SIGHUP（1）


<span class="token number">1</span>、nohup <span class="token punctuation">[</span>执行的命令<span class="token punctuation">]</span> <span class="token operator">&amp;</span>
后台启动，会在当前目录生成一个nohub.out文件，用于执行的命令的输出。
<span class="token number">2</span>、setsid <span class="token builtin class-name">:</span> 实际上开了一个孤儿进程
<span class="token number">3</span>、（执行的命令<span class="token operator">&amp;</span>）
<span class="token number">4</span>、screen  开启一个子窗口<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day18-netstat%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day18-netstat%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--netstat使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:29" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>1、netstat</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">netstat主要用来查询系统端口相关问题

注：要使用netstat，需要安装yum <span class="token function">install</span> -y net-tools

<span class="token comment"># netstat常用参数</span>
-t <span class="token builtin class-name">:</span> 打印tcp链接的进程
-u <span class="token builtin class-name">:</span> 打印UDP链接的进程
-l <span class="token builtin class-name">:</span> 监听
-p <span class="token builtin class-name">:</span> 打印进程的PID
-n <span class="token builtin class-name">:</span> 不反解，不将ip地址解析成域名同时不将端口解析成对应的协议名称

<span class="token function">netstat</span> -nutlp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、分区</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看系统磁盘</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk </span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   18G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   40G  <span class="token number">0</span> disk 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>  <span class="token number">3</span>.9T  <span class="token number">0</span> disk 

<span class="token comment"># 分区</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdb </span>

n <span class="token builtin class-name">:</span> 新建一个分区
p <span class="token builtin class-name">:</span> 查看分区情况
m ：查看帮助
d <span class="token builtin class-name">:</span> 删除分区
w ；保存分区修改内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、使用文件系统的流程</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、装硬盘

<span class="token number">2</span>、查看当前系统硬盘
<span class="token punctuation">[</span>root@localhost a<span class="token punctuation">]</span><span class="token comment"># lsblk </span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   18G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   40G  <span class="token number">0</span> disk 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>  <span class="token number">3</span>.9T  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.3G  <span class="token number">0</span> rom  

<span class="token number">3</span>、分区
	2TB 以下的硬盘，使用MBR分区
	2TB 以上的硬盘，使用GPT分区
	
	<span class="token function">fdisk</span> /dev/sdb

<span class="token number">4</span>、格式化分区（将分区做成文件系统）
	mkfs.xfs /dev/sdb1

<span class="token number">5</span>、挂载分区
	<span class="token function">mount</span> /dev/sdb1  /a

<span class="token number">6</span>、检测
	<span class="token function">df</span>
		-h <span class="token builtin class-name">:</span> 显示硬盘大小单位

<span class="token comment"># 注：挂载哪个硬盘则显示对应硬盘里面的内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/01_%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/01_%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--磁盘分区</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:36" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、磁盘分区方案"><a href="#一、磁盘分区方案" class="headerlink" title="一、磁盘分区方案"></a>一、磁盘分区方案</h2><h3 id="1-1-MBR与GPT介绍"><a href="#1-1-MBR与GPT介绍" class="headerlink" title="1.1 MBR与GPT介绍"></a>1.1 MBR与GPT介绍</h3><p>Linux中磁盘分区有两种方案</p>
<ul>
<li><strong>MBR</strong>（主引导记录）</li>
<li><strong>GPT</strong>（GUID分区表）</li>
</ul>
<p>**<font color='blue'>MBR分区方案</font>**的特点（支持的磁盘容量&lt;&#x3D;2T）：</p>
<ol>
<li>最多支持四个主分区 </li>
<li>在Linux上使用扩展分区和逻辑分区最多可以创建15个分区， </li>
<li>由于分区中的数据以32位存储，使用MBR分区是最大支持2T空间。 </li>
<li>用fdisk管理工具来创建MBR分区</li>
</ol>
<p>**<font color='red'>GPT分区方案</font>**的特点（支持的磁盘容量&gt;2T）：</p>
<ol>
<li>是UEFI标准的一部分，主板必须要支持UEFI标准 </li>
<li>GPT分区列表支持最大128PB(1PB&#x3D;1024TB) </li>
<li>可以定义128个分区 </li>
<li>没有主分区，扩展分区和逻辑分区的概念，所有分区都能格式化 </li>
<li>gdisk和parted管理工具可以创建GPT分区</li>
</ol>
<h3 id="1-2-MBR与GTP的区别"><a href="#1-2-MBR与GTP的区别" class="headerlink" title="1.2 MBR与GTP的区别"></a>1.2 MBR与GTP的区别</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>MBR</th>
<th>GPT</th>
</tr>
</thead>
<tbody><tr>
<td>新旧度</td>
<td>旧</td>
<td>新</td>
</tr>
<tr>
<td>支持的硬盘容量大小</td>
<td>最大2TB</td>
<td>支持2T以上</td>
</tr>
<tr>
<td>分区计数</td>
<td>最多支持4个主分区或3个主分区一个扩展分区</td>
<td>最多支持128个分区,部分主分区、扩展分区</td>
</tr>
<tr>
<td>安全功能</td>
<td>不提供任何安全功能</td>
<td>支持CRC32校验和机制</td>
</tr>
</tbody></table>
<h2 id="二、分区工具使用"><a href="#二、分区工具使用" class="headerlink" title="二、分区工具使用"></a>二、分区工具使用</h2><h3 id="2-1-MBR分区工具fdisk"><a href="#2-1-MBR分区工具fdisk" class="headerlink" title="2.1 MBR分区工具fdisk"></a>2.1 MBR分区工具fdisk</h3><h3 id="2-2-GPT分区工具gdisk"><a href="#2-2-GPT分区工具gdisk" class="headerlink" title="2.2 GPT分区工具gdisk"></a>2.2 GPT分区工具gdisk</h3><h3 id="2-3-GPT分区工具parted"><a href="#2-3-GPT分区工具parted" class="headerlink" title="2.3 GPT分区工具parted"></a>2.3 GPT分区工具parted</h3><p>​	parted用于对磁盘（或RAID磁盘）进行分区及管理，与fdisk分区工具相比，支持2TB以上的磁盘分区，并且允许调整分区的大小，<font color='red'>支持命令行方式或交互式方式</font>，常用命令如下：</p>
<table>
<thead>
<tr>
<th>parted交互命令</th>
<th>说 明</th>
</tr>
</thead>
<tbody><tr>
<td>check NUMBER</td>
<td>做一次简单的文件系统检测</td>
</tr>
<tr>
<td>cp [FROM-DEVICE] FROM-NUMBER TO-NUMBER</td>
<td>复制文件系统到另一个分区</td>
</tr>
<tr>
<td>help [COMMAND]</td>
<td>显示所有的命令帮助</td>
</tr>
<tr>
<td>mklabel,mktable LABEL-TYPE</td>
<td>创建新的磁盘卷标（分区表）</td>
</tr>
<tr>
<td>mkfs NUMBER FS-TYPE</td>
<td>在分区上建立文件系统</td>
</tr>
<tr>
<td>mkpart PART-TYPE [FS-TYPE] START END</td>
<td>创建一个分区</td>
</tr>
<tr>
<td>mkpartfs PART-TYPE FS-TYPE START END</td>
<td>创建分区，并建立文件系统</td>
</tr>
<tr>
<td>move NUMBER START END</td>
<td>移动分区</td>
</tr>
<tr>
<td>name NUMBER NAME</td>
<td>给分区命名</td>
</tr>
<tr>
<td>print [devices|free|list,all|NUMBER]</td>
<td>显示分区表、活动设备、空闲空间、所有分区</td>
</tr>
<tr>
<td>quit</td>
<td>退出</td>
</tr>
<tr>
<td>rescue START END</td>
<td>修复丢失的分区</td>
</tr>
<tr>
<td>resize NUMBER START END</td>
<td>修改分区大小</td>
</tr>
<tr>
<td>rm NUMBER</td>
<td>删除分区</td>
</tr>
<tr>
<td>select DEVICE</td>
<td>选择需要编辑的设备</td>
</tr>
<tr>
<td>set NUMBER FLAG STATE</td>
<td>改变分区标记</td>
</tr>
<tr>
<td>toggle [NUMBER [FLAG]]</td>
<td>切换分区表的状态</td>
</tr>
<tr>
<td>unit UNIT</td>
<td>设置默认的单位</td>
</tr>
<tr>
<td>Version</td>
<td>显示版本</td>
</tr>
</tbody></table>
<blockquote>
<p>关于mkpart与PART-TYPE（FS-TYPE）的解释：</p>
<p>Make a part-type partition for filesystem fs-type (if specified), beginning at start and ending at end (by default in megabytes).  fs-type can  be  one  of  “btrfs”,  “ext2”, “ext3”, “ext4”, “fat16”, “fat32”, “hfs”, “hfs+”, “linux-swap”, “ntfs”, “reiserfs”, or “xfs”.  part-type should be one of “primary”, “logical”, or “extended”.</p>
</blockquote>
<h4 id="2-3-1-使用parted"><a href="#2-3-1-使用parted" class="headerlink" title="2.3.1 使用parted"></a>2.3.1 使用parted</h4><h4 id="2-3-1-1-列出所有块设备分区情况"><a href="#2-3-1-1-列出所有块设备分区情况" class="headerlink" title="2.3.1.1 列出所有块设备分区情况"></a>2.3.1.1 列出所有块设备分区情况</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 查看当前有哪些块设备</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk
├─sda1   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
├─sda2   <span class="token number">8</span>:2    <span class="token number">0</span>    2G  <span class="token number">0</span> part <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
└─sda3   <span class="token number">8</span>:3    <span class="token number">0</span>   47G  <span class="token number">0</span> part /
sdb      <span class="token number">8</span>:16   <span class="token number">0</span>   10G  <span class="token number">0</span> disk
sr0     <span class="token number">11</span>:0    <span class="token number">1</span>  792M  <span class="token number">0</span> rom

<span class="token comment"># 查看分区情况</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted -l</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sda: <span class="token number">53</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system     Flags
 <span class="token number">1</span>      1049kB  1075MB  1074MB  primary  xfs             boot
 <span class="token number">2</span>      1075MB  3223MB  2149MB  primary  linux-swap<span class="token punctuation">(</span>v1<span class="token punctuation">)</span>
 <span class="token number">3</span>      3223MB  <span class="token number">53</span>.7GB  <span class="token number">50</span>.5GB  primary  xfs


Error: /dev/sdb: unrecognised disk label	<span class="token comment"># sdb还没有分区</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: unknown
Disk Flags:

Warning: Unable to <span class="token function">open</span> /dev/sr0 read-write <span class="token punctuation">(</span>Read-only <span class="token function">file</span> system<span class="token punctuation">)</span>.  /dev/sr0
has been opened read-only.
Model: NECVMWar VMware IDE CDR10 <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sr0: 830MB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 2048B/2048B
Partition Table: msdos
Disk Flags:

Number  Start  End     Size    Type     File system  Flags
 <span class="token number">2</span>      885kB  <span class="token number">37</span>.7MB  <span class="token number">36</span>.8MB  primary<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-1-2-创建分区"><a href="#2-3-1-2-创建分区" class="headerlink" title="2.3.1.2 创建分区"></a>2.3.1.2 创建分区</h4><blockquote>
<p>案例：在&#x2F;dev&#x2F;sdb中创建一个1GB的分区</p>
</blockquote>
<p>a、命令行方式，创建一个主分区</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 转换为MBR分区方案msdos, GPT方案为gpt</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mklabel msdos</span>
Information: You may need to update /etc/fstab.

<span class="token comment"># 创建主分区</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mkpart primary ext4 0GB 1GB  # 把1GB换成100%就是分完剩余空间</span>
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk
├─sda1   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
├─sda2   <span class="token number">8</span>:2    <span class="token number">0</span>    2G  <span class="token number">0</span> part <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
└─sda3   <span class="token number">8</span>:3    <span class="token number">0</span>   47G  <span class="token number">0</span> part /
sdb      <span class="token number">8</span>:16   <span class="token number">0</span>   10G  <span class="token number">0</span> disk
└─sdb1   <span class="token number">8</span>:17   <span class="token number">0</span>  953M  <span class="token number">0</span> part
sr0     <span class="token number">11</span>:0    <span class="token number">1</span>  792M  <span class="token number">0</span> rom
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>b、再用交互方式，继续创建一个主分区</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted</span>
GNU Parted <span class="token number">3.1</span>
Using /dev/sda
Welcome to GNU Parted<span class="token operator">!</span> Type <span class="token string">'help'</span> to view a list of commands.
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> <span class="token keyword">select</span> /dev/sdb <span class="token comment"># 选择块设备</span>
Using /dev/sdb
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> mkpart	<span class="token comment"># 新建分区</span>
Partition type?  primary/extended? primary
File system type?  <span class="token punctuation">[</span>ext2<span class="token punctuation">]</span>? ext4
Start? 1GB
End? 2GB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>c、扩展分区与逻辑分区的创建</p>
<blockquote>
<p>扩展分区最多只有一个，再创建会提示选择primary&#x2F;logical</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">(</span>parted<span class="token punctuation">)</span> <span class="token keyword">select</span> /dev/sdb
Using /dev/sdb
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> print
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type      File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary   ext4
 <span class="token number">2</span>      1000MB  4000MB  3000MB  extended               lba

<span class="token comment"># 给扩展分区2创建一个逻辑分区（使用范围只能在扩展分区2的范围内）</span>
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> mkpart logical 1GB 2GB
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> print
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type      File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary   ext4
 <span class="token number">2</span>      1000MB  4000MB  3000MB  extended               lba
 <span class="token number">5</span>      1001MB  2000MB  998MB   logical

<span class="token comment"># 给扩展分区2再创建一个逻辑分区</span>
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> mkpart logical 2GB 3GB
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> print
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type      File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary   ext4
 <span class="token number">2</span>      1000MB  4000MB  3000MB  extended               lba
 <span class="token number">5</span>      1001MB  2000MB  998MB   logical
 <span class="token number">6</span>      2001MB  3000MB  999MB   logical<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-1-3-查看分区"><a href="#2-3-1-3-查看分区" class="headerlink" title="2.3.1.3 查看分区"></a>2.3.1.3 查看分区</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">(</span>parted<span class="token punctuation">)</span> print <span class="token comment"># 打印分区</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size   Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB  primary
 <span class="token number">2</span>      1000MB  2000MB  999MB  primary
 
 <span class="token punctuation">(</span>parted<span class="token punctuation">)</span> print <span class="token function">free</span> <span class="token comment"># 查看剩余空间</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
        <span class="token number">32</span>.3kB  1049kB  1016kB           Free Space
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary
 <span class="token number">2</span>      1000MB  2000MB  999MB   primary
        2000MB  <span class="token number">10</span>.7GB  8738MB           Free Space
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-1-4-调整分区大小"><a href="#2-3-1-4-调整分区大小" class="headerlink" title="2.3.1.4 调整分区大小"></a>2.3.1.4 调整分区大小</h4><blockquote>
<p>将分区2从1GB扩展到2GB</p>
<p>PS：v2.4之后的版本，resize命令已经移除，更新到3.1-32版本有resizepart</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size   Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB  primary
 <span class="token number">2</span>      1000MB  2000MB  999MB  primary

<span class="token comment"># 调整分区2的大小为2GB</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb resizepart 2 3GB	(3GB是指END位置，即使用1GB-3GB的空间，共2GB)</span>
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary
 <span class="token number">2</span>      1000MB  3000MB  2000MB  primary
 
 <span class="token comment"># 如果已经格式化并挂载使用，需要重新调整文件系统大小</span>
 <span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># resize2fs /dev/sdb2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>缩小分区大小会怎样？将提示有数据丢失的风险</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb resizepart 2 2GB</span>
Warning: Shrinking a partition can cause data loss, are you sure you want to continue?
Yes/No?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-1-5-删除分区"><a href="#2-3-1-5-删除分区" class="headerlink" title="2.3.1.5 删除分区"></a>2.3.1.5 删除分区</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB   primary
 <span class="token number">2</span>      1000MB  4000MB  3000MB  primary  ext4

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb rm 2   // 删除2号分区，因为已挂载，会提示要先卸载</span>
Error: Partition /dev/sdb2 is being used. You must unmount it before you modify it with Parted.
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># umount /dev/sdb2</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb rm 2 // 删除成功</span>
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># print</span>
-bash: print: <span class="token builtin class-name">command</span> not found
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size   Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB  primary<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-1-6-设置-x2F-更改分区标志"><a href="#2-3-1-6-设置-x2F-更改分区标志" class="headerlink" title="2.3.1.6 设置&#x2F;更改分区标志"></a>2.3.1.6 设置&#x2F;更改分区标志</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb set 1 lvm on</span>
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size   Type     File system  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB  primary               lvm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看有哪些标志可以设置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted</span>
GNU Parted <span class="token number">3.1</span>
Using /dev/sda
Welcome to GNU Parted<span class="token operator">!</span> Type <span class="token string">'help'</span> to view a list of commands.
<span class="token punctuation">(</span>parted<span class="token punctuation">)</span> <span class="token builtin class-name">help</span> <span class="token builtin class-name">set</span>
  <span class="token builtin class-name">set</span> NUMBER FLAG STATE                    change the FLAG on partition NUMBER

        NUMBER is the partition number used by Linux.  On MS-DOS disk labels, the primary partitions number from <span class="token number">1</span> to <span class="token number">4</span>, logical partitions from <span class="token number">5</span> onwards.
        FLAG is one of: boot, root, swap, hidden, raid, lvm, lba, hp-service, palo, prep, msftres, bios_grub, atvrecv, diag, legacy_boot
        STATE is one of: on, off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-16-GPT分区方案下的NAME标签"><a href="#2-3-16-GPT分区方案下的NAME标签" class="headerlink" title="2.3.16 GPT分区方案下的NAME标签"></a>2.3.16 GPT分区方案下的NAME标签</h4><p>GPT分区的print</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start  End  Size  File system  Name  Flags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>MBR分区的print</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mklabel msdos</span>
Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? Yes
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start  End  Size  Type  File system  Flags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong><font color='red'>可见GPT标志中多了一个Name标签</font></strong></p>
</blockquote>
<p>使用的时候GPT分区方式可以指定分区名，不用指定主分区、扩展分区这些类型</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mkpart BOOT 0GB 1GB</span>
Information: You may need to update /etc/fstab.

<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb print</span>
Model: VMware, VMware Virtual S <span class="token punctuation">(</span>scsi<span class="token punctuation">)</span>
Disk /dev/sdb: <span class="token number">10</span>.7GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size   File system  Name  Flags
 <span class="token number">1</span>      1049kB  1000MB  999MB  xfs          BOOT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是MBR就不能</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mkpart BOOT 0GB 1GB</span>
parted: invalid token: BOOT
Partition type?  primary/extended?
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/sdb mkpart primary BOOT 0GB 1GB</span>
parted: invalid token: BOOT
File system type?  <span class="token punctuation">[</span>ext2<span class="token punctuation">]</span>?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、磁盘挂载"><a href="#三、磁盘挂载" class="headerlink" title="三、磁盘挂载"></a>三、磁盘挂载</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token number">1</span>、开机自动挂载
	开机自动执行：/etc/rc.local
	
	<span class="token function">chmod</span> +x /etc/ec.local
	
	<span class="token builtin class-name">echo</span> <span class="token string">"mount /dev/sdc1 /root/test"</span> <span class="token operator">>></span> /etc/rc.local

<span class="token number">2</span>、修改配置文件 /etc/fstab
/dev/sdc100     /opt    xfs         defaults   <span class="token number">0</span>      <span class="token number">0</span>
设备				挂载点  文件系统类型   挂载类型  是否备份  是否检测
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>1327e665-44b3-4223-a93b-69c36ec602f9   /root/oldboy  xfs   defaults <span class="token number">0</span> <span class="token number">0</span>

 /dev/sdc100  等价于  UUID

<span class="token number">3</span>、查询设备UUID
	<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid </span>
/dev/sdc1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"b5797ad6-9b98-452c-8962-fa12f6590fa6"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"xfs"</span> <span class="token assign-left variable">PARTLABEL</span><span class="token operator">=</span><span class="token string">"Linux filesystem"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、创建SWAP分区"><a href="#四、创建SWAP分区" class="headerlink" title="四、创建SWAP分区"></a>四、创建SWAP分区</h2><pre class="line-numbers language-she" data-language="she"><code class="language-she">1、创建一个硬盘分区

2、制作swap分区
mkswap &#x2F;dev&#x2F;sdb3

3、激活swap
swapon &#x2F;dev&#x2F;sdb3

4、关闭swap
swapoff 

5、自动挂载
	5.1、
        echo &quot;mkswap &#x2F;dev&#x2F;sdb3&quot; &gt;&gt; &#x2F;etc&#x2F;rc.local
        echo &quot;swapon &#x2F;dev&#x2F;sdb3&quot; &gt;&gt; &#x2F;etc&#x2F;rc.local
	5.2、
		echo &quot;&#x2F;dev&#x2F;sdb3  swap  swap  defaults 0  0&quot; &gt;&gt; &#x2F;etc&#x2F;fstab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/02_%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/02_%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">运维之基础命令--逻辑卷管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:41" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、LVM介绍"><a href="#一、LVM介绍" class="headerlink" title="一、LVM介绍"></a>一、LVM介绍</h2><p>​	逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可以创建和管理“逻辑”卷，而不是直接使用物理硬盘。可以让管理员弹性的管理逻辑卷的扩大缩小，操作简单，而不损坏已存储的数据。可以随意将新的硬盘添加到LVM，以直接扩展已经存在的逻辑卷。LVM并不需要重启就可以让内核知道分区的存在。</p>
<p>LVM使用分层结构，如下如所示：</p>
<p><img src="/02_%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86.assets/134408sa12dauefffyszfg.jpg" alt="img"></p>
<p>​	图中顶部，首先是实际的物理磁盘及其划分的分区和其上的物理卷（PV）。一个或多个物理卷可以用来创建卷组（VG）。然后基于卷组可以创建逻辑卷（LV）。只要在卷组中有可用空间，就可以随心所欲的创建逻辑卷。文件系统就是在逻辑卷上创建的，然后可以在操作系统挂载和访问</p>
<h2 id="二、LVM使用"><a href="#二、LVM使用" class="headerlink" title="二、LVM使用"></a>二、LVM使用</h2><h3 id="2-1-磁盘准备"><a href="#2-1-磁盘准备" class="headerlink" title="2.1 磁盘准备"></a>2.1 磁盘准备</h3><p>加装两块硬盘，sdb-10G与sdc-5G</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk
├─sda1   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
├─sda2   <span class="token number">8</span>:2    <span class="token number">0</span>    2G  <span class="token number">0</span> part <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
└─sda3   <span class="token number">8</span>:3    <span class="token number">0</span>   47G  <span class="token number">0</span> part /
sdb      <span class="token number">8</span>:16   <span class="token number">0</span>   10G  <span class="token number">0</span> disk
sdc      <span class="token number">8</span>:32   <span class="token number">0</span>    5G  <span class="token number">0</span> disk
sr0     <span class="token number">11</span>:0    <span class="token number">1</span>  792M  <span class="token number">0</span> rom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>给sbd创建LVM分区</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdb</span>
Welcome to <span class="token function">fdisk</span> <span class="token punctuation">(</span>util-linux <span class="token number">2.23</span>.2<span class="token punctuation">)</span>.

Changes will remain <span class="token keyword">in</span> memory only, <span class="token keyword">until</span> you decide to <span class="token function">write</span> them.
Be careful before using the <span class="token function">write</span> command.


Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: n  <span class="token comment"># 新建分区</span>
Partition type:
   p   primary <span class="token punctuation">(</span><span class="token number">0</span> primary, <span class="token number">0</span> extended, <span class="token number">4</span> <span class="token function">free</span><span class="token punctuation">)</span>
   e   extended
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>:
Using default response p
Partition number <span class="token punctuation">(</span><span class="token number">1</span>-4, default <span class="token number">1</span><span class="token punctuation">)</span>:
First sector <span class="token punctuation">(</span><span class="token number">2048</span>-20971519, default <span class="token number">2048</span><span class="token punctuation">)</span>:
Using default value <span class="token number">2048</span>
Last sector, +sectors or +size<span class="token punctuation">&#123;</span>K,M,G<span class="token punctuation">&#125;</span> <span class="token punctuation">(</span><span class="token number">2048</span>-20971519, default <span class="token number">20971519</span><span class="token punctuation">)</span>: +2G
Partition <span class="token number">1</span> of <span class="token builtin class-name">type</span> Linux and of size <span class="token number">2</span> GiB is <span class="token builtin class-name">set</span>

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: t  <span class="token comment"># 将分区改为LVM分区</span>
Selected partition <span class="token number">1</span>
Hex code <span class="token punctuation">(</span>type L to list all codes<span class="token punctuation">)</span>: L

 <span class="token number">0</span>  Empty           <span class="token number">24</span>  NEC DOS         <span class="token number">81</span>  Minix / old Lin bf  Solaris
 <span class="token number">1</span>  FAT12           <span class="token number">27</span>  Hidden NTFS Win <span class="token number">82</span>  Linux swap / So c1  DRDOS/sec <span class="token punctuation">(</span>FAT-
 <span class="token number">2</span>  XENIX root      <span class="token number">39</span>  Plan <span class="token number">9</span>          <span class="token number">83</span>  Linux           c4  DRDOS/sec <span class="token punctuation">(</span>FAT-
 <span class="token number">3</span>  XENIX usr       3c  PartitionMagic  <span class="token number">84</span>  OS/2 hidden C:  c6  DRDOS/sec <span class="token punctuation">(</span>FAT-
 <span class="token number">4</span>  FAT16 <span class="token operator">&lt;</span>32M      <span class="token number">40</span>  Venix <span class="token number">80286</span>     <span class="token number">85</span>  Linux extended  c7  Syrinx
 <span class="token number">5</span>  Extended        <span class="token number">41</span>  PPC PReP Boot   <span class="token number">86</span>  NTFS volume <span class="token builtin class-name">set</span> da  Non-FS data
 <span class="token number">6</span>  FAT16           <span class="token number">42</span>  SFS             <span class="token number">87</span>  NTFS volume <span class="token builtin class-name">set</span> db  CP/M / CTOS / <span class="token builtin class-name">.</span>
 <span class="token number">7</span>  HPFS/NTFS/exFAT 4d  QNX4.x          <span class="token number">88</span>  Linux plaintext de  Dell Utility
 <span class="token number">8</span>  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       <span class="token function">df</span>  BootIt
 <span class="token number">9</span>  AIX bootable    4f  QNX4.x 3rd part <span class="token number">93</span>  Amoeba          e1  DOS access
 a  OS/2 Boot Manag <span class="token number">50</span>  OnTrack DM      <span class="token number">94</span>  Amoeba BBT      e3  DOS R/O
 b  W95 FAT32       <span class="token number">51</span>  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor
 c  W95 FAT32 <span class="token punctuation">(</span>LBA<span class="token punctuation">)</span> <span class="token number">52</span>  CP/M            a0  IBM Thinkpad hi eb  BeOS fs
 e  W95 FAT16 <span class="token punctuation">(</span>LBA<span class="token punctuation">)</span> <span class="token number">53</span>  OnTrack DM6 Aux a5  FreeBSD         ee  GPT
 f  W95 Ext<span class="token string">'d (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor
14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT
1e  Hidden W95 FAT1 80  Old Minix
Hex code (type L to list all codes): 8e
Changed type of partition '</span>Linux<span class="token string">' to '</span>Linux LVM'

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p

Disk /dev/sdb: <span class="token number">10.7</span> GB, <span class="token number">10737418240</span> bytes, <span class="token number">20971520</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disk label type: dos
Disk identifier: 0x0005122b

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            <span class="token number">2048</span>     <span class="token number">4196351</span>     <span class="token number">2097152</span>   8e  Linux LVM<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重复添加，再加一个3G，一个2G的分区，可见分区表如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># fdisk -l /dev/sdb</span>

Disk /dev/sdb: <span class="token number">10.7</span> GB, <span class="token number">10737418240</span> bytes, <span class="token number">20971520</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disk label type: dos
Disk identifier: 0x0005122b

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            <span class="token number">2048</span>     <span class="token number">4196351</span>     <span class="token number">2097152</span>   8e  Linux LVM
/dev/sdb2         <span class="token number">4196352</span>    <span class="token number">10487807</span>     <span class="token number">3145728</span>   8e  Linux LVM
/dev/sdb3        <span class="token number">10487808</span>    <span class="token number">14682111</span>     <span class="token number">2097152</span>   8e  Linux LVM<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-创建物理卷（PV）"><a href="#2-2-创建物理卷（PV）" class="headerlink" title="2.2 创建物理卷（PV）"></a>2.2 创建物理卷（PV）</h3><p>安装LVM工具</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># yum install lvm2 </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将准备好的LVM分区生成为物理卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sdb1</span>
WARNING: ext4 signature detected on /dev/sdb1 at offset <span class="token number">1080</span>. Wipe it? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Wiping ext4 signature on /dev/sdb1.
  Physical volume <span class="token string">"/dev/sdb1"</span> successfully created.
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sdb2</span>
  Physical volume <span class="token string">"/dev/sdb2"</span> successfully created.
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sdb3</span>
  Physical volume <span class="token string">"/dev/sdb3"</span> successfully created.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看物理卷信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvdisplay</span>
  <span class="token string">"/dev/sdb1"</span> is a new physical volume of <span class="token string">"2.00 GiB"</span>
  --- NEW Physical volume ---
  PV Name               /dev/sdb1
  VG Name
  PV Size               <span class="token number">2.00</span> GiB
  Allocatable           NO
  PE Size               <span class="token number">0</span>
  Total PE              <span class="token number">0</span>
  Free PE               <span class="token number">0</span>
  Allocated PE          <span class="token number">0</span>
  PV UUID               YUHdrd-AH1x-ew0m-Mp9i-3GHp-S4zc-XxlDJM

  <span class="token string">"/dev/sdb2"</span> is a new physical volume of <span class="token string">"3.00 GiB"</span>
  --- NEW Physical volume ---
  PV Name               /dev/sdb2
  VG Name
  PV Size               <span class="token number">3.00</span> GiB
  Allocatable           NO
  PE Size               <span class="token number">0</span>
  Total PE              <span class="token number">0</span>
  Free PE               <span class="token number">0</span>
  Allocated PE          <span class="token number">0</span>
  PV UUID               wGDQvx-7zfs-g018-wqx4-Y8rh-1kWT-PnLuFu

  <span class="token string">"/dev/sdb3"</span> is a new physical volume of <span class="token string">"2.00 GiB"</span>
  --- NEW Physical volume ---
  PV Name               /dev/sdb3
  VG Name
  PV Size               <span class="token number">2.00</span> GiB
  Allocatable           NO
  PE Size               <span class="token number">0</span>
  Total PE              <span class="token number">0</span>
  Free PE               <span class="token number">0</span>
  Allocated PE          <span class="token number">0</span>
  PV UUID               fykcuR-jooY-WKbi-yM8j-7fQ5-mhnH-JCkXC8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>补充：如何删除物理卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvremove /dev/sdb1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-3-创建卷组（VG）"><a href="#2-3-创建卷组（VG）" class="headerlink" title="2.3 创建卷组（VG）"></a>2.3 创建卷组（VG）</h3><p>将&#x2F;dev&#x2F;sdb{1,2,3}合并为卷组vg01</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># vgcreate vg01 /dev/sdb1 /dev/sdb2 /dev/sdb3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看卷组信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay</span>
  --- Volume group ---
  VG Name               vg01
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">3</span>
  Metadata Sequence No  <span class="token number">1</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">0</span>
  Open LV               <span class="token number">0</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">3</span>
  Act PV                <span class="token number">3</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">6.99</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">1789</span>
  Alloc PE / Size       <span class="token number">0</span> / <span class="token number">0</span>
  Free  PE / Size       <span class="token number">1789</span> / <span class="token operator">&lt;</span><span class="token number">6.99</span> GiB
  VG UUID               gzeouH-16qO-n6xv-V6VM-A9ep-eK6E-ODuIwU<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>补充：如何删除卷组</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># vgremove vg01</span>
  Volume group <span class="token string">"vg01"</span> successfully removed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-4-创建逻辑卷（LV）"><a href="#2-4-创建逻辑卷（LV）" class="headerlink" title="2.4 创建逻辑卷（LV）"></a>2.4 创建逻辑卷（LV）</h3><p>创建一个名为lv01，大小为100M的逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvcreate -L 100M -n lv01 vg01</span>
  Logical volume <span class="token string">"lv01"</span> created.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查看逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/vg01/lv01
  LV Name                lv01
  VG Name                vg01
  LV UUID                xFksnb-ENc2-mEo4-5gEb-yaJj-wP2c-oFuBeT
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> lb01, <span class="token number">2021</span>-09-01 <span class="token number">20</span>:39:16 +0800
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">100.00</span> MiB
  Current LE             <span class="token number">25</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>补充：删除逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvremove /dev/vg01/lv02</span>
Do you really want to remove active logical volume vg01/lv02? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">"lv02"</span> successfully removed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="2-5-逻辑卷挂载"><a href="#2-5-逻辑卷挂载" class="headerlink" title="2.5 逻辑卷挂载"></a>2.5 逻辑卷挂载</h3><p>格式化逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># mkfs.ext4 /dev/vg01/lv01</span>
<span class="token function">mke2fs</span> <span class="token number">1.42</span>.9 <span class="token punctuation">(</span><span class="token number">28</span>-Dec-2013<span class="token punctuation">)</span>
Filesystem <span class="token assign-left variable">label</span><span class="token operator">=</span>
OS type: Linux
Block <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token punctuation">(</span>log<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Fragment <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token punctuation">(</span>log<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token assign-left variable">Stride</span><span class="token operator">=</span><span class="token number">0</span> blocks, Stripe <span class="token assign-left variable">width</span><span class="token operator">=</span><span class="token number">0</span> blocks
<span class="token number">25688</span> inodes, <span class="token number">102400</span> blocks
<span class="token number">5120</span> blocks <span class="token punctuation">(</span><span class="token number">5.00</span>%<span class="token punctuation">)</span> reserved <span class="token keyword">for</span> the super user
First data <span class="token assign-left variable">block</span><span class="token operator">=</span><span class="token number">1</span>
Maximum filesystem <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">33685504</span>
<span class="token number">13</span> block <span class="token function">groups</span>
<span class="token number">8192</span> blocks per group, <span class="token number">8192</span> fragments per group
<span class="token number">1976</span> inodes per group
Superblock backups stored on blocks:
        <span class="token number">8193</span>, <span class="token number">24577</span>, <span class="token number">40961</span>, <span class="token number">57345</span>, <span class="token number">73729</span>

Allocating group tables: <span class="token keyword">done</span>
Writing inode tables: <span class="token keyword">done</span>
Creating journal <span class="token punctuation">(</span><span class="token number">4096</span> blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>
Writing superblocks and filesystem accounting information: <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>挂载逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /mnt/test-lv01</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/vg01/lv01 /mnt/test-lv01</span>
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
/dev/sda3               47G  <span class="token number">1</span>.9G   46G   <span class="token number">4</span>% /
devtmpfs               479M     <span class="token number">0</span>  479M   <span class="token number">0</span>% /dev
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /dev/shm
tmpfs                  489M  <span class="token number">6</span>.8M  482M   <span class="token number">2</span>% /run
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /sys/fs/cgroup
/dev/sda1             1014M  119M  896M  <span class="token number">12</span>% /boot
tmpfs                   98M     <span class="token number">0</span>   98M   <span class="token number">0</span>% /run/user/0
/dev/mapper/vg01-lv01   93M  <span class="token number">1</span>.6M   85M   <span class="token number">2</span>% /mnt/test-lv01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-6-扩展逻辑卷"><a href="#2-6-扩展逻辑卷" class="headerlink" title="2.6 扩展逻辑卷"></a>2.6 扩展逻辑卷</h3><p>卸载逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># umount /dev/vg01/lv01</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将逻辑卷lv01调整为200M</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvresize -L 200M /dev/vg01/lv01 </span>
  Size of logical volume vg01/lv01 changed from <span class="token number">100.00</span> MiB <span class="token punctuation">(</span><span class="token number">25</span> extents<span class="token punctuation">)</span> to <span class="token number">200.00</span> MiB <span class="token punctuation">(</span><span class="token number">50</span> extents<span class="token punctuation">)</span>.
  Logical volume vg01/lv01 successfully resized.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>检查磁盘错误</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># e2fsck -f /dev/vg01/lv01</span>
e2fsck <span class="token number">1.42</span>.9 <span class="token punctuation">(</span><span class="token number">28</span>-Dec-2013<span class="token punctuation">)</span>
Pass <span class="token number">1</span>: Checking inodes, blocks, and sizes
Pass <span class="token number">2</span>: Checking directory structure
Pass <span class="token number">3</span>: Checking directory connectivity
Pass <span class="token number">4</span>: Checking reference counts
Pass <span class="token number">5</span>: Checking group summary information
/dev/vg01/lv01: <span class="token number">11</span>/25688 files <span class="token punctuation">(</span><span class="token number">9.1</span>% non-contiguous<span class="token punctuation">)</span>, <span class="token number">8896</span>/102400 blocks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>调整文件系统大小</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># resize2fs /dev/vg01/lv01</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看逻辑卷信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/vg01/lv01
  LV Name                lv01
  VG Name                vg01
  LV UUID                svm5Xk-B8jZ-QhZw-egCm-x6b2-e5Jt-wvMi2F
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> lb01, <span class="token number">2021</span>-09-01 <span class="token number">20</span>:41:53 +0800
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">200.00</span> MiB
  Current LE             <span class="token number">50</span>
  Segments               <span class="token number">2</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:0
  <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重新挂载使用</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># !mount</span>
<span class="token function">mount</span> /dev/vg01/lv01 /mnt/test-lv01
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
/dev/sda3               47G  <span class="token number">1</span>.9G   46G   <span class="token number">4</span>% /
devtmpfs               479M     <span class="token number">0</span>  479M   <span class="token number">0</span>% /dev
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /dev/shm
tmpfs                  489M  <span class="token number">6</span>.8M  482M   <span class="token number">2</span>% /run
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /sys/fs/cgroup
/dev/sda1             1014M  119M  896M  <span class="token number">12</span>% /boot
tmpfs                   98M     <span class="token number">0</span>   98M   <span class="token number">0</span>% /run/user/0
/dev/mapper/vg01-lv01  190M  <span class="token number">1</span>.6M  175M   <span class="token number">1</span>% /mnt/test-lv01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-7-缩减逻辑卷"><a href="#2-7-缩减逻辑卷" class="headerlink" title="2.7 缩减逻辑卷"></a>2.7 缩减逻辑卷</h3><p>卸载逻辑卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># umount /dev/vg01/lv01</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>检查磁盘错误</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># e2fsck -f /dev/vg01/lv01</span>
e2fsck <span class="token number">1.42</span>.9 <span class="token punctuation">(</span><span class="token number">28</span>-Dec-2013<span class="token punctuation">)</span>
Pass <span class="token number">1</span>: Checking inodes, blocks, and sizes
Pass <span class="token number">2</span>: Checking directory structure
Pass <span class="token number">3</span>: Checking directory connectivity
Pass <span class="token number">4</span>: Checking reference counts
Pass <span class="token number">5</span>: Checking group summary information
/dev/vg01/lv01: <span class="token number">11</span>/49400 files <span class="token punctuation">(</span><span class="token number">9.1</span>% non-contiguous<span class="token punctuation">)</span>, <span class="token number">11884</span>/204800 blocks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>缩减文件系统大小，更新ext4信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># resize2fs /dev/vg01/lv01 100M</span>
resize2fs <span class="token number">1.42</span>.9 <span class="token punctuation">(</span><span class="token number">28</span>-Dec-2013<span class="token punctuation">)</span>
Resizing the filesystem on /dev/vg01/lv01 to <span class="token number">102400</span> <span class="token punctuation">(</span>1k<span class="token punctuation">)</span> blocks.
The filesystem on /dev/vg01/lv01 is now <span class="token number">102400</span> blocks long.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>完成后，减小逻辑卷大小</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvresize -L 100M /dev/vg01/lv01</span>
  WARNING: Reducing active logical volume to <span class="token number">100.00</span> MiB.
  THIS MAY DESTROY YOUR DATA <span class="token punctuation">(</span>filesystem etc.<span class="token punctuation">)</span>
Do you really want to reduce vg01/lv01? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Size of logical volume vg01/lv01 changed from <span class="token number">200.00</span> MiB <span class="token punctuation">(</span><span class="token number">50</span> extents<span class="token punctuation">)</span> to <span class="token number">100.00</span> MiB <span class="token punctuation">(</span><span class="token number">25</span> extents<span class="token punctuation">)</span>.
  Logical volume vg01/lv01 successfully resized.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看逻辑卷信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/vg01/lv01
  LV Name                lv01
  VG Name                vg01
  LV UUID                svm5Xk-B8jZ-QhZw-egCm-x6b2-e5Jt-wvMi2F
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> lb01, <span class="token number">2021</span>-09-01 <span class="token number">20</span>:41:53 +0800
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token number">100.00</span> MiB
  Current LE             <span class="token number">25</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:0
  <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>挂载使用</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># !mo</span>
<span class="token function">mount</span> /dev/vg01/lv01 /mnt/test-lv01
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
/dev/sda3               47G  <span class="token number">1</span>.9G   46G   <span class="token number">4</span>% /
devtmpfs               479M     <span class="token number">0</span>  479M   <span class="token number">0</span>% /dev
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /dev/shm
tmpfs                  489M  <span class="token number">6</span>.8M  482M   <span class="token number">2</span>% /run
tmpfs                  489M     <span class="token number">0</span>  489M   <span class="token number">0</span>% /sys/fs/cgroup
/dev/sda1             1014M  119M  896M  <span class="token number">12</span>% /boot
tmpfs                   98M     <span class="token number">0</span>   98M   <span class="token number">0</span>% /run/user/0
/dev/mapper/vg01-lv01   93M  <span class="token number">1</span>.6M   85M   <span class="token number">2</span>% /mnt/test-lv01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-8-VG增加一块磁盘"><a href="#2-8-VG增加一块磁盘" class="headerlink" title="2.8 VG增加一块磁盘"></a>2.8 VG增加一块磁盘</h3><p>新盘创建lvm分区</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdc</span>
Welcome to <span class="token function">fdisk</span> <span class="token punctuation">(</span>util-linux <span class="token number">2.23</span>.2<span class="token punctuation">)</span>.

Changes will remain <span class="token keyword">in</span> memory only, <span class="token keyword">until</span> you decide to <span class="token function">write</span> them.
Be careful before using the <span class="token function">write</span> command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x05ff27fa.

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: n
Partition type:
   p   primary <span class="token punctuation">(</span><span class="token number">0</span> primary, <span class="token number">0</span> extended, <span class="token number">4</span> <span class="token function">free</span><span class="token punctuation">)</span>
   e   extended
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>:
Using default response p
Partition number <span class="token punctuation">(</span><span class="token number">1</span>-4, default <span class="token number">1</span><span class="token punctuation">)</span>:
First sector <span class="token punctuation">(</span><span class="token number">2048</span>-10485759, default <span class="token number">2048</span><span class="token punctuation">)</span>:
Using default value <span class="token number">2048</span>
Last sector, +sectors or +size<span class="token punctuation">&#123;</span>K,M,G<span class="token punctuation">&#125;</span> <span class="token punctuation">(</span><span class="token number">2048</span>-10485759, default <span class="token number">10485759</span><span class="token punctuation">)</span>: +4G
Partition <span class="token number">1</span> of <span class="token builtin class-name">type</span> Linux and of size <span class="token number">4</span> GiB is <span class="token builtin class-name">set</span>

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: t
Selected partition <span class="token number">1</span>
Hex code <span class="token punctuation">(</span>type L to list all codes<span class="token punctuation">)</span>:
Hex code <span class="token punctuation">(</span>type L to list all codes<span class="token punctuation">)</span>: 8e
Changed <span class="token builtin class-name">type</span> of partition <span class="token string">'Linux'</span> to <span class="token string">'Linux LVM'</span>

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p

Disk /dev/sdc: <span class="token number">5368</span> MB, <span class="token number">5368709120</span> bytes, <span class="token number">10485760</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disk label type: dos
Disk identifier: 0x05ff27fa

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            <span class="token number">2048</span>     <span class="token number">8390655</span>     <span class="token number">4194304</span>   8e  Linux LVM<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建物理卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sdc1</span>
  Physical volume <span class="token string">"/dev/sdc1"</span> successfully created.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>扩容VG</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># vgextend vg01 /dev/sdc1</span>
  Volume group <span class="token string">"vg01"</span> successfully extended<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查看VG信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># vgdisplay vg01</span>
  --- Volume group ---
  VG Name               vg01
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">4</span>
  Metadata Sequence No  <span class="token number">10</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">2</span>
  Open LV               <span class="token number">1</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">4</span>
  Act PV                <span class="token number">4</span>
  VG Size               <span class="token number">10.98</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">2812</span>
  Alloc PE / Size       <span class="token number">50</span> / <span class="token number">200.00</span> MiB
  Free  PE / Size       <span class="token number">2762</span> / <span class="token operator">&lt;</span><span class="token number">10.79</span> GiB
  VG UUID               2Tjzna-XmXI-9MQ7-zeyc-AARV-84r5-jyymkf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>PS：尽管我们使用一个单独的磁盘做示范，其实只要是‘8e’类型的磁盘分区都可以用来扩展卷组。</p>
</blockquote>
<p>在VG中创建LV，可以看到磁盘都用上了</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lvcreate -L 10G -n lv03 vg01</span>
  Logical volume <span class="token string">"lv03"</span> created.
<span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk
├─sda1          <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
├─sda2          <span class="token number">8</span>:2    <span class="token number">0</span>    2G  <span class="token number">0</span> part <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
└─sda3          <span class="token number">8</span>:3    <span class="token number">0</span>   47G  <span class="token number">0</span> part /
sdb             <span class="token number">8</span>:16   <span class="token number">0</span>   10G  <span class="token number">0</span> disk
├─sdb1          <span class="token number">8</span>:17   <span class="token number">0</span>    2G  <span class="token number">0</span> part
│ ├─vg01-lv01 <span class="token number">253</span>:0    <span class="token number">0</span>  100M  <span class="token number">0</span> lvm  /mnt/test-lv01
│ ├─vg01-lv02 <span class="token number">253</span>:1    <span class="token number">0</span>  100M  <span class="token number">0</span> lvm
│ └─vg01-lv03 <span class="token number">253</span>:2    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm
├─sdb2          <span class="token number">8</span>:18   <span class="token number">0</span>    3G  <span class="token number">0</span> part
│ └─vg01-lv03 <span class="token number">253</span>:2    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm
└─sdb3          <span class="token number">8</span>:19   <span class="token number">0</span>    2G  <span class="token number">0</span> part
  └─vg01-lv03 <span class="token number">253</span>:2    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm
sdc             <span class="token number">8</span>:32   <span class="token number">0</span>    5G  <span class="token number">0</span> disk
└─sdc1          <span class="token number">8</span>:33   <span class="token number">0</span>    4G  <span class="token number">0</span> part
  └─vg01-lv03 <span class="token number">253</span>:2    <span class="token number">0</span>   10G  <span class="token number">0</span> lvm
sr0            <span class="token number">11</span>:0    <span class="token number">1</span>  792M  <span class="token number">0</span> rom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day21-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day21-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/" class="post-title-link" itemprop="url">运维之基础命令--计划任务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:55" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h1><p>1、Crontab表达式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">*  *  *  * * 
分 时 日 月 周

每天的凌晨2点   02：00     00 02 * * *
每月执行一次    00  00  01  * *
每个月的一号零点零时零分同时这一天时星期六 00  00  01  *  <span class="token number">6</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、系统级别的计划任务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、/etc/crontab

<span class="token number">2</span>、如下的目录
    /etc/cron.hourly/ <span class="token comment"># 系统定时任务每个⼩时运⾏这个⽬录⾥的内容</span>
    /etc/cron.daily/ <span class="token comment"># 系统定时任务每天运⾏这个⽬录⾥的内容</span>
    /etc/cron.weekly/ <span class="token comment"># 系统定时任务每周运⾏这个⽬录⾥的内容</span>
    /etc/cron.monthly/ <span class="token comment"># 系统定时任务每⽉运⾏这个⽬录⾥的内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、用户级别的计划任务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">crontab</span> -e

-e <span class="token builtin class-name">:</span> 编辑计划任务
-l <span class="token builtin class-name">:</span> 查看计划任务

<span class="token comment"># 注：用户级别的计划任务存放在/var/spool/cron/，不同的用户存放的计划任务是以其自己的名字命名的脚本</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、crontab语法</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1 3 5</span>
00 00 <span class="token number">1,3</span>,5 * *

<span class="token comment"># 1到5号</span>
00 00 <span class="token number">1</span>-5

<span class="token comment"># 每几分钟，每几个小数，每几天</span>
<span class="token number">0</span>/2  /2 
00 <span class="token number">0</span>/2    00 /2
00 00 <span class="token number">0</span>/2   00 00 /2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>5、每3分钟同步一下系统时间</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day20-dd%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD/%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day20-dd%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD/%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">运维之基础命令--dd与文件系统备份</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:14:48" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><p>1、dd命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sdb <span class="token assign-left variable">bs</span><span class="token operator">=</span>500M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span> 
 
<span class="token keyword">if</span> <span class="token builtin class-name">:</span> 从哪里读文件
of <span class="token builtin class-name">:</span> 写入到哪里
bs <span class="token builtin class-name">:</span> 写入500M
count <span class="token builtin class-name">:</span> 写一块<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、模拟文件系统出问题</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>、直接向硬盘中写数据，不能测试向分区写数据
<span class="token number">2</span>、卸载之后重新挂载
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sdc1 /root/test</span>
mount: <span class="token function">mount</span> /dev/sdc1 on /root/test failed: Structure needs cleaning

<span class="token number">3</span>、对文件系统进行修复
xfs_repair <span class="token punctuation">[</span>磁盘或分区路径<span class="token punctuation">]</span>

注： xfs_repair修改硬盘之后，硬盘数据丢失，所以对重要的数据要进行数据备份<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、文件系统的备份与恢复</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">备份：另外在保存一份
恢复：将以前保存的数据进行还原

<span class="token function">touch</span> <span class="token number">1</span>.txt
<span class="token builtin class-name">echo</span> aaaa <span class="token operator">></span> <span class="token number">1</span>.txt
<span class="token function">cp</span>  <span class="token number">1</span>.txt   <span class="token number">2</span>.txt

<span class="token function">rm</span> <span class="token number">1</span>.txt

<span class="token function">cp</span> <span class="token number">2</span>.txt <span class="token number">1</span>.txt

<span class="token number">1</span>.log   1T <span class="token operator">=</span> 1024G

全量备份和增量备份
全量备份：将需要备份的文件全部复制一份
增量备份：在原来备份基础上，把新增数据重新备份一份

备份与恢复的命令
xfsdump <span class="token builtin class-name">:</span> 备份的命令
xfsrestore  <span class="token builtin class-name">:</span> 恢复的命令


<span class="token comment"># 备份的步骤</span>
<span class="token number">1</span>、安装备份命令
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span><span class="token comment"># yum install xfsdump -y</span>

<span class="token number">2</span>、备份的等级
<span class="token number">0</span>  全量备份

<span class="token number">1</span> ~ <span class="token number">9</span> 增量备份（等级）

<span class="token number">3</span>、备份的参数
-L ：记录每次备份的地方
-M ：注释，此次备份的注释
-l ：指定备份的等级
-f ：备份的文件名称
-I ：查看备份信息

<span class="token number">4</span>、备份的条件（限制）
	<span class="token number">1</span>、必须使用root权限
	<span class="token number">2</span>、只能备份已经挂载的内容
	<span class="token number">3</span>、只能备份xfs文件系统
	<span class="token number">4</span>、只能够用xfsrestore来恢复

<span class="token number">5</span>、备份的命令格式
xfsdump <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 备份路径
xfsdump -L sdb1_bak -M <span class="token string">"sbd1_from_xxx"</span> -l <span class="token number">0</span> -f sdb1_from_bak_1 /root/oldboy

<span class="token number">6</span>、数据恢复
xfsrestore

<span class="token number">7</span>、恢复数据的参数
-f <span class="token builtin class-name">:</span> 指定备份的文件路径

<span class="token number">8</span>、恢复的格式
xfsrestore <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 恢复的路径
<span class="token punctuation">[</span>root@localhost oldboy<span class="token punctuation">]</span><span class="token comment"># xfsrestore -f /root/sdb1_from_bak_3 /root/oldboy/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、LVM</p>
<pre class="line-numbers language-bsah" data-language="bsah"><code class="language-bsah">1、什么是lvm

你如何保证你的硬盘空间恰好够用？
如果你的硬盘你够用了怎么扩容？

LVM是文件系统管理工具

&#x2F;root&#x2F;oldboy ---&gt;  lv[5G]
&#x2F;root&#x2F;oldboy ---&gt;  lv[3G]

2、LVM的优点
	1、可以动态扩容与缩容
	2、可以将新增加的硬盘添加到VG存储池
	3、可以突破物理存储卷的限制



3、使用lvm
	1、安装lvm软件包
		yum install lvm2 -y
	2、将磁盘交给pv
		pvreate [磁盘|磁盘分区]
	3、查看pv
		pvs
		pvscan
	4、创建vg
		vgcreate [vg名称] [pv路径]
	5、查看vg
	6、创建lvm逻辑卷（lv）
		-L ： 创建逻辑卷的大小
		-n : 逻辑卷的名字
		lvcreate [参数] 逻辑卷名称
	7、制作文件系统
		mkfs.xfs &#x2F;dev&#x2F;vg1&#x2F;xxx
	
	8、挂载文件系统
		mount [lv的路径] [挂载点的路径]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day22-%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8Eiptables/iptables%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day22-%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8Eiptables/iptables%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">运维之基础命令--防火墙与iptables</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:19:52 / 修改时间：15:15:01" itemprop="dateCreated datePublished" datetime="2022-07-06T11:19:52+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">（一）基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="iptables使用手册"><a href="#iptables使用手册" class="headerlink" title="iptables使用手册"></a>iptables使用手册</h1><h2 id="一、简单实践"><a href="#一、简单实践" class="headerlink" title="一、简单实践"></a>一、简单实践</h2><blockquote>
<p>从信息查看、保存规则、清除规则、恢复规则、更改规则五个方面来学习。</p>
</blockquote>
<h3 id="1-1-信息查看"><a href="#1-1-信息查看" class="headerlink" title="1.1 信息查看"></a>1.1 信息查看</h3><p>查看现有规则</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
neutron-linuxbri-INPUT  all  --  anywhere             anywhere
nova-api-INPUT  all  --  anywhere             anywhere

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
neutron-filter-top  all  --  anywhere             anywhere
neutron-linuxbri-FORWARD  all  --  anywhere             anywhere
nova-filter-top  all  --  anywhere             anywhere
nova-api-FORWARD  all  --  anywhere             anywhere
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看现有规则，显示主机ip和端口号，-n</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
neutron-linuxbri-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
nova-api-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
neutron-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
neutron-linuxbri-FORWARD  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
nova-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
nova-api-FORWARD  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>结果显示：</p>
<p>默认显示三条链的规则INPUT、FORWARD、OUTPUT，而且所有的规则都是默认接受的</p>
<p>每条链下面显示的信息是：</p>
<p>动作  协议 参数 源地址 目标地址</p>
</blockquote>
<p>显示详细信息，-v</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">11839</span> packets, 2842K bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
<span class="token number">11839</span> 2842K neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">12985</span> 3090K nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> neutron-linuxbri-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>结果显示：</p>
<p>-v显示的内容比-L -n 显示的内容多了四个字段</p>
<p>pkts  规则匹配到的报文数量的多少</p>
<p>bytes 规则匹配到的报文内容量的大小</p>
<p>in   规则匹配到的流入的接口，*代表任意接口</p>
<p>out   规则匹配到的流出的接口</p>
</blockquote>
<p>显示规则的标号 –line-numbers</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v --line-numbers</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">13663</span> packets, 3221K bytes<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>    <span class="token number">13663</span> 3221K neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>    <span class="token number">14809</span> 3469K nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>        <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>        <span class="token number">0</span>     <span class="token number">0</span> neutron-linuxbri-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">3</span>        <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">4</span>        <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>打印规则命令，将防火墙的编写命令给我们打印出来，可以通过这种方式来学习规则的编写。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -S</span>
-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
-N neutron-filter-top
-N neutron-linuxbri-FORWARD
-N neutron-linuxbri-INPUT
-N neutron-linuxbri-OUTPUT
-N neutron-linuxbri-local
-N neutron-linuxbri-scope
-N neutron-linuxbri-sg-chain
-N neutron-linuxbri-sg-fallback
-N nova-api-FORWARD
-N nova-api-INPUT
-N nova-api-OUTPUT
-N nova-api-local
-N nova-filter-top
-A INPUT -j neutron-linuxbri-INPUT
-A INPUT -j nova-api-INPUT
-A FORWARD -j neutron-filter-top
-A FORWARD -j neutron-linuxbri-FORWARD
-A FORWARD -j nova-filter-top
-A FORWARD -j nova-api-FORWARD
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-保存规则"><a href="#1-2-保存规则" class="headerlink" title="1.2 保存规则"></a>1.2 保存规则</h3><blockquote>
<p>使用 iptables-save命令可以保存规则</p>
</blockquote>
<p>将当前的规则保存到文件中</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables-save > iptables.rules</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat iptables.rules</span>
<span class="token comment"># Generated by iptables-save v1.4.21 on Wed Oct 20 09:22:53 2021</span>
*filter
:INPUT ACCEPT <span class="token punctuation">[</span><span class="token number">16785</span>:3861723<span class="token punctuation">]</span>
:FORWARD ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:OUTPUT ACCEPT <span class="token punctuation">[</span><span class="token number">16549</span>:3883715<span class="token punctuation">]</span>
:neutron-filter-top - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-FORWARD - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-INPUT - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-OUTPUT - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-local - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-scope - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-sg-chain - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:neutron-linuxbri-sg-fallback - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:nova-api-FORWARD - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:nova-api-INPUT - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-清除规则"><a href="#1-3-清除规则" class="headerlink" title="1.3 清除规则"></a>1.3 清除规则</h3><p>清除单个规则</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 先查看</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n --line-numbers</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
num  target     prot opt <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>    neutron-linuxbri-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>    nova-api-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
num  target     prot opt <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>    neutron-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>    neutron-linuxbri-FORWARD  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">3</span>    nova-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">4</span>    nova-api-FORWARD  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 删除FORWARD的第2条规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -D FORWARD 2</span>

<span class="token comment"># 再次查看，删除成功</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n --line-numbers</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
num  target     prot opt <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>    neutron-linuxbri-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>    nova-api-INPUT  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
num  target     prot opt <span class="token builtin class-name">source</span>               destination
<span class="token number">1</span>    neutron-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">2</span>    nova-filter-top  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">3</span>    nova-api-FORWARD  all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 如果不指定删除的序号，会报错</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -D FORWARD</span>
iptables: Bad rule <span class="token punctuation">(</span>does a matching rule exist <span class="token keyword">in</span> that chain?<span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>清除规则计数</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 查看原内容</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">3196</span> packets, 657K bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
<span class="token number">23118</span> 5147K neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">24264</span> 5395K nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 清除规则计数 -Z</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -Z</span>

<span class="token comment"># 查看效果，pkts与bytes减少，即规则匹配到的报文数量与报文内容大小均减少，清除成功</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">58</span> packets, <span class="token number">11344</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
   <span class="token number">58</span> <span class="token number">11344</span> neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
   <span class="token number">58</span> <span class="token number">11344</span> nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>清除所有规则</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 清除默认规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -F</span>

<span class="token comment"># 清除自定义规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -X</span>

<span class="token comment"># 查看效果</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">424</span> packets, <span class="token number">84770</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">398</span> packets, <span class="token number">83826</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-4-恢复规则"><a href="#1-4-恢复规则" class="headerlink" title="1.4 恢复规则"></a>1.4 恢复规则</h3><p>从备份文件恢复规则</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 从文件恢复</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables-restore &lt; iptables.rules</span>

<span class="token comment"># 查看确认已恢复</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">268</span> packets, <span class="token number">46570</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
  <span class="token number">268</span> <span class="token number">46570</span> neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
  <span class="token number">268</span> <span class="token number">46570</span> nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> neutron-linuxbri-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-5-更改规则"><a href="#1-5-更改规则" class="headerlink" title="1.5 更改规则"></a>1.5 更改规则</h3><p>可以从ACCEPT改为DROP</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 查看原规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">342</span> packets, <span class="token number">49890</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">4455</span>  836K neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
 <span class="token number">4455</span>  836K nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> neutron-linuxbri-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># -P 修改</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -P FORWARD DROP</span>

<span class="token comment"># 再次查看，FORWARD链修改DROP成功</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">38</span> packets, <span class="token number">5017</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">4849</span>  905K neutron-linuxbri-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
 <span class="token number">4849</span>  905K nova-api-INPUT  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy DROP <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> neutron-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> neutron-linuxbri-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-filter-top  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> nova-api-FORWARD  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>-P 更改的规则，使用 -F 不能自动还原</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token operator">></span><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -F</span>
<span class="token operator">></span><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
<span class="token operator">></span>Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">36</span> packets, <span class="token number">6554</span> bytes<span class="token punctuation">)</span>
<span class="token operator">></span>pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

<span class="token operator">></span>Chain FORWARD <span class="token punctuation">(</span>policy DROP <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
<span class="token operator">></span>pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
<span class="token operator">></span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>重启iptables服务后，可以使用系统所有默认规则</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 清除所有默认规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -F</span>

<span class="token comment"># 查看，没有默认规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">8</span> packets, <span class="token number">520</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">4</span> packets, <span class="token number">448</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 
<span class="token comment"># 重启iptables服务</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables</span>

<span class="token comment"># 再次查看，新增了系统的默认规则</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L -n -v</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">6</span>   <span class="token number">432</span> ACCEPT     all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state RELATED,ESTABLISHED
    <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     icmp --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     all  --  lo     *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
    <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     tcp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state NEW tcp dpt:22
    <span class="token number">0</span>     <span class="token number">0</span> REJECT     all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
    <span class="token number">0</span>     <span class="token number">0</span> REJECT     all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">4</span> packets, <span class="token number">544</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/04-%E8%99%9A%E6%8B%9F%E5%8C%96/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/04-%E8%99%9A%E6%8B%9F%E5%8C%96/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">OpenStack学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-06 11:07:13 / 修改时间：15:20:29" itemprop="dateCreated datePublished" datetime="2022-07-06T11:07:13+08:00">2022-07-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E5%9B%9B%EF%BC%89%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B9%8BOpenStack/" itemprop="url" rel="index"><span itemprop="name">（四）虚拟化之OpenStack</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="OpenStack笔记"><a href="#OpenStack笔记" class="headerlink" title="OpenStack笔记"></a><strong><font color=green>OpenStack笔记</font></strong></h1><p>​	OpenStack实现的是云计算IAAS</p>
<h2 id="一、服务架构发展"><a href="#一、服务架构发展" class="headerlink" title="一、服务架构发展"></a><font color=blue>一、服务架构发展</font></h2><h3 id="1-1-MVC架构"><a href="#1-1-MVC架构" class="headerlink" title="1.1 MVC架构"></a>1.1 MVC架构</h3><p>​	业务不拆分，一个服务挂，则所有的全挂</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">首页 www.jd.com&#x2F;index.html
秒杀 www.jd.com&#x2F;miaosha&#x2F;index.html
优惠券 www.jd.com&#x2F;juan&#x2F;index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-SOA架构（千万级）"><a href="#1-2-SOA架构（千万级）" class="headerlink" title="1.2 SOA架构（千万级）"></a>1.2 SOA架构（千万级）</h3><p>​	业务拆分，每一个功能都拆分成一个独立的web服务，每个独立的web服务，都至少拥有一个集群</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">首页 www.jd.com&#x2F;index.html
秒杀 miaosha.jd.com&#x2F;index.html
优惠券 juan.jd.com&#x2F;index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-微服务架构（亿级）"><a href="#1-3-微服务架构（亿级）" class="headerlink" title="1.3 微服务架构（亿级）"></a>1.3 微服务架构（亿级）</h3><p>阿里开源dubbo</p>
<p>Spring Boot</p>
<p>自动化代码上线：Jekins + gilab ci</p>
<p>自动化代码质量检查：sonarqube</p>
<h2 id="二、搭建OpenStack"><a href="#二、搭建OpenStack" class="headerlink" title="二、搭建OpenStack"></a><font color=blue>二、搭建OpenStack</font></h2><p>​	本流程为手动安装M版，脚本安装可以参考</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">https:&#x2F;&#x2F;my.oschina.net&#x2F;u&#x2F;4367225&#x2F;blog&#x2F;4255750<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>OpenStack的结构介绍：</p>
<blockquote>
<p>Nova – 提供VM虚拟化支持 8774</p>
<p>Glance – 提供镜像 9292</p>
<p>Clinder – 存储支持 8776</p>
<p>Neutron – 网络支持 9696</p>
<p>Cellometer –  监控计费 </p>
<p>KeyStone – 登录认证</p>
<p>Horizon – 网页UI，dashboard</p>
<p>Heat – 部署编排，批量建虚拟机</p>
<p>Switft – 对象存储（不是传统的文件夹存放，而是用数据库记录已上传的文件信息，当有文件上传，先查询数据库中是否有该文件的md5值，如果有，则不用重新上传，给个链接就是 — 百度云盘）</p>
</blockquote>
<p><img src="C:\Users\fr724\AppData\Roaming\Typora\typora-user-images\image-20210615135957367.png" alt="image-20210615135957367"></p>
<h3 id="2-1-虚拟机准备"><a href="#2-1-虚拟机准备" class="headerlink" title="2.1 虚拟机准备"></a>2.1 虚拟机准备</h3><p>虚拟机规划</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 系统：CentOS7.4
controller: 内存3G, CPU开启虚拟化	10.0.0.11
compute1: 内存1G，CPU开启虚拟化	    10.0.0.31
# 修改主机名，IP地址，host解析，测试ping百度<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>配置本地M版yum源</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 1、资源准备
mount &#x2F;dev&#x2F;cdrom &#x2F;mnt # 追加到&#x2F;etc&#x2F;rc.local,自动挂载
解压openstack_rpm.tar.gz到&#x2F;opt&#x2F;repo

# 2、编辑repo文件
vim &#x2F;etc&#x2F;yum.repo.d&#x2F;local&#x2F;repo

#### 内容
[local]
name&#x3D;local
baseurl&#x3D;file:&#x2F;&#x2F;&#x2F;mnt
gpgcheck&#x3D;0

[openstack]
name&#x3D;openstack
baseurl&#x3D;file:&#x2F;&#x2F;&#x2F;opt&#x2F;repo
gpgcheck&#x3D;0
####

# 3、更新yum源
yum makecache
yum repolist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="2-2-基础服务安装"><a href="#2-2-基础服务安装" class="headerlink" title="2.2 基础服务安装"></a>2.2 基础服务安装</h3><h4 id="2-2-1-NTP时间同步"><a href="#2-2-1-NTP时间同步" class="headerlink" title="2.2.1 NTP时间同步"></a>2.2.1 NTP时间同步</h4><p>controller与阿里NTP服务器同步</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;chrony.conf
server ntp6.aliyun.com # 3行
allow 10.0.0.0&#x2F;24 # 24行
systemctl restart chronyd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>computer与controller同步</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;chrony.conf
server 10.0.0.11 iburst # 3行
systemctl restart chronyd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="2-2-2-扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）"><a href="#2-2-2-扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）" class="headerlink" title="2.2.2 扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）"></a>2.2.2 扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo
yum makecache
yum list | grep openstack
yum install centos-release-openstack-ocata.noarch -y # 安装O版<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-2-3-安装OpenStack客户端openstack-selinux-（所有节点执行）"><a href="#2-2-3-安装OpenStack客户端openstack-selinux-（所有节点执行）" class="headerlink" title="2.2.3 安装OpenStack客户端openstack-selinux （所有节点执行）"></a>2.2.3 安装OpenStack客户端openstack-selinux （所有节点执行）</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install python-openstackclient openstack-selinux -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-2-4-安装和配置mariadb-仅控制节点执行"><a href="#2-2-4-安装和配置mariadb-仅控制节点执行" class="headerlink" title="2.2.4 安装和配置mariadb (仅控制节点执行)"></a>2.2.4 安装和配置mariadb (仅控制节点执行)</h4><p>安装</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install mariadb mariadb-server python2-PyMySQL -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;my.cnf.d&#x2F;openstack.cnf

#----------------
[mysqld]	
bind-address &#x3D; 10.0.0.11	# 监听地址
default-storage-engine &#x3D; innodb # 默认存储引擎
innodb_file_per_table  # 独立表空间文件
max_connections &#x3D; 4096	# 最大连接数
collation-server &#x3D; utf8_general_ci	# 默认字符集utf8
character-set-server &#x3D; utf8
#-----------------

# 启动服务
systemctl start mariadb
systemctl enable mariadb

# 数据库安全初始化,保障数据库安全性，如果不执行，同步数据库表会报错
mysql_secure_installation
回车 n y y y y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-2-5-消息队列配置-仅控制节点执行"><a href="#2-2-5-消息队列配置-仅控制节点执行" class="headerlink" title="2.2.5 消息队列配置(仅控制节点执行)"></a>2.2.5 消息队列配置(仅控制节点执行)</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装rabbitmq
yum install rabbitmq-server -y
# 启动服务
systemctl start rabbitmq-server
systemctl enable rabbitmq-server
# 添加用户
rabbitmqctl add_user openstack RABBIT_PASS
# 设置用户权限（读、写、执行）
rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
rabbitmq-plugins enable rabbitmq_management
# 查看是否开启15672端口
netstat -lntup
# 浏览器登录rabbitmq
http:&#x2F;&#x2F;10.0.0.11:15672
默认用户名和密码：guest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-2-6-缓存系统配置memcache（仅控制节点执行）"><a href="#2-2-6-缓存系统配置memcache（仅控制节点执行）" class="headerlink" title="2.2.6 缓存系统配置memcache（仅控制节点执行）"></a>2.2.6 缓存系统配置memcache（仅控制节点执行）</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装
yum install memcached python-memched -y
# 配置
sed -i &#39;s#127.0.0.1#10.0.0.11#g&#39; &#x2F;etc&#x2F;sysconfig&#x2F;memcached
# 启动服务
systemctl restart memcached
systemctl enable memcached
# 查询端口11211是否已监听，默认使用该端口<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-3-安装keystone认证服务-仅控制节点执行"><a href="#2-3-安装keystone认证服务-仅控制节点执行" class="headerlink" title="2.3 安装keystone认证服务(仅控制节点执行)"></a>2.3 安装keystone认证服务(仅控制节点执行)</h3><h4 id="2-3-1-Keystone功能介绍"><a href="#2-3-1-Keystone功能介绍" class="headerlink" title="2.3.1 Keystone功能介绍"></a>2.3.1 Keystone功能介绍</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">1、认证管理：
	账户密码
2、授权管理
3、服务目录：
	跟电话本一样，keystone上可以查询到glance、nova等服务的地址端口等信息，每一个新加的服务都需要在keystone上注册<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-2-OpenStack服务器安装的通用步骤"><a href="#2-3-2-OpenStack服务器安装的通用步骤" class="headerlink" title="2.3.2 OpenStack服务器安装的通用步骤"></a>2.3.2 OpenStack服务器安装的通用步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">1、创库授权
2、在Keystone创建用户，关联角色
3、在keystone创建服务，注册api
4、安装服务相关的软件包
5、修改配置
	数据库的连接
	keystone认证授权信息
	rabbitmq连接信息
	其他配置
6、同步数据库，创建表
7、启动服务<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-3-3-安装步骤"><a href="#2-3-3-安装步骤" class="headerlink" title="2.3.3 安装步骤"></a>2.3.3 安装步骤</h4><p>1、创库授权</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 登录mysql
$ mysql -u root -p
# 创建keystone数据库
CREATE DATABASE keystone;
# 对&#96;&#96;keystone&#96;&#96;数据库授予恰当的权限
GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;
GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、安装keystone相关软件包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install openstack-keystone httpd mod_wsgi -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、修改配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 备份原配置文件
\cp &#x2F;etc&#x2F;keystone&#x2F;keystone.conf&#123;,.bak&#125;
# 去除配置文件中的空格行和注释行
grep -Ev &#39;^$|#&#39; &#x2F;etc&#x2F;keystone&#x2F;keystone.conf.bak &gt; &#x2F;etc&#x2F;keystone&#x2F;keystone.conf

# 安装自动配置工具
yum install openstack-utils -y
# 使用工具设置（也可以直接修改文件）修改项 参数 &#x3D; 值
openstack-config --set &#x2F;etc&#x2F;keystone&#x2F;keystone.conf DEFAULT admin_token ADMIN_TOKEN
openstack-config --set &#x2F;etc&#x2F;keystone&#x2F;keystone.conf database connection  mysql+pymysql:&#x2F;&#x2F;keystone:KEYSTONE_DBPASS@controller&#x2F;keystone # 注意hostname--controller
openstack-config --set &#x2F;etc&#x2F;keystone&#x2F;keystone.conf token provider fernet
# 校验
md5sum &#x2F;etc&#x2F;keystone&#x2F;keystone.conf
d5acb3db852fe3f247f4f872b051b7a9 

# 同步数据库
su -s &#x2F;bin&#x2F;sh -c &quot;keystone-manage db_sync&quot; keystone
# 查询是否生成表
mysql keystone -e &quot;show tables;&quot;

# 初始化fernet
keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
# 验证
&#x2F;etc&#x2F;keystone&#x2F;fernet-keys已创建

# 配置httpd
echo &quot;ServerName controller&quot; &gt;&gt; &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf

# 创建wsgi配置文件
vim &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;wsgi-keystone.conf
###内容
Listen 5000
Listen 35357

&lt;VirtualHost *:5000&gt;
    WSGIDaemonProcess keystone-public processes&#x3D;5 threads&#x3D;1 user&#x3D;keystone group&#x3D;keystone display-name&#x3D;%&#123;GROUP&#125;
    WSGIProcessGroup keystone-public
    WSGIScriptAlias &#x2F; &#x2F;usr&#x2F;bin&#x2F;keystone-wsgi-public
    WSGIApplicationGroup %&#123;GLOBAL&#125;
    WSGIPassAuthorization On
    ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;
    ErrorLog &#x2F;var&#x2F;log&#x2F;httpd&#x2F;keystone-error.log
    CustomLog &#x2F;var&#x2F;log&#x2F;httpd&#x2F;keystone-access.log combined

    &lt;Directory &#x2F;usr&#x2F;bin&gt;
        Require all granted
    &lt;&#x2F;Directory&gt;
&lt;&#x2F;VirtualHost&gt;

&lt;VirtualHost *:35357&gt;
    WSGIDaemonProcess keystone-admin processes&#x3D;5 threads&#x3D;1 user&#x3D;keystone group&#x3D;keystone display-name&#x3D;%&#123;GROUP&#125;
    WSGIProcessGroup keystone-admin
    WSGIScriptAlias &#x2F; &#x2F;usr&#x2F;bin&#x2F;keystone-wsgi-admin
    WSGIApplicationGroup %&#123;GLOBAL&#125;
    WSGIPassAuthorization On
    ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;
    ErrorLog &#x2F;var&#x2F;log&#x2F;httpd&#x2F;keystone-error.log
    CustomLog &#x2F;var&#x2F;log&#x2F;httpd&#x2F;keystone-access.log combined

    &lt;Directory &#x2F;usr&#x2F;bin&gt;
        Require all granted
    &lt;&#x2F;Directory&gt;
&lt;&#x2F;VirtualHost&gt;
# 校验
md5sum &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;wsgi-keystone.conf
8f051eb53577f67356ed03e4550315c2 

# 启动httpd
systemctl enable httpd
systemctl start httpd

# 创建服务和注册api
export OS_TOKEN&#x3D;ADMIN_TOKEN
export OS_URL&#x3D;http:&#x2F;&#x2F;controller:35357&#x2F;v3
export OS_IDENTITY_API_VERSION&#x3D;3
openstack service create --name keystone --description &quot;OpenStack Identity&quot; identity
openstack endpoint create --region RegionOne identity public http:&#x2F;&#x2F;controller:5000&#x2F;v3
openstack endpoint create --region RegionOne identity internal http:&#x2F;&#x2F;controller:5000&#x2F;v3
openstack endpoint create --region RegionOne identity admin http:&#x2F;&#x2F;controller:35357&#x2F;v3

# 创建域、项目（租户）、用户和角色
openstack domain create --description &quot;Default Domain&quot; default
openstack project create --domain default --description &quot;Admin Project&quot; admin
openstack user create --domain default --password ADMIN_PASS admin
openstack role create admin

# 关联项目，用户，角色
openstack role add --project admin --user admin admin
# 在admin项目上，给admin用户赋予admin角色
openstack project create --domain default --description &quot;Service Project&quot; service

# 创建环境变量脚本
export OS_PROJECT_DOMAIN_NAME&#x3D;default
export OS_USER_DOMAIN_NAME&#x3D;default
export OS_PROJECT_NAME&#x3D;admin
export OS_USERNAME&#x3D;admin
export OS_PASSWORD&#x3D;ADMIN_PASS
export OS_IMAGE_API_VERSION&#x3D;2
export OS_IDENTITY_API_VERSION&#x3D;3
export OS_AUTH_URL&#x3D;http:&#x2F;&#x2F;controller:35357&#x2F;v3

# 作为admin用户请求认证令牌
openstack token issue  

# 如果不设置环境变量可以通过传入参数的方式申请
openstack --os-auth-url http:&#x2F;&#x2F;controller:35357&#x2F;v3   --os-project-domain-name default --os-user-domain-name default   --os-project-name admin --os-username admin --os-password ADMIN_PASS token issue

# 查看用户列表
openstack user list

# 查看endpoint列表
openstack endpoint list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-4-安装glance镜像服务"><a href="#2-4-安装glance镜像服务" class="headerlink" title="2.4 安装glance镜像服务"></a>2.4 安装glance镜像服务</h3><p>​	镜像服务 (glance) 允许用户发现、注册和获取虚拟机镜像。</p>
<h4 id="2-4-1-安装步骤"><a href="#2-4-1-安装步骤" class="headerlink" title="2.4.1 安装步骤"></a>2.4.1 安装步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 数据库创库授权
mysql &gt;&gt;
CREATE DATABASE glance
GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;
GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;
  
 # 在keystone创建glance用户关联角色
 openstack user create --domain default --password GLANCE_PASS glance
 openstack role add --project service --user glance admin
 
 # 在keystone上创建服务和注册api
openstack service create --name glance   --description &quot;OpenStack Image&quot; image
openstack endpoint create --region RegionOne \
  image public http:&#x2F;&#x2F;controller:9292
openstack endpoint create --region RegionOne \
  image internal http:&#x2F;&#x2F;controller:9292
openstack endpoint create --region RegionOne \
  image admin http:&#x2F;&#x2F;controller:9292
  
# 查看已创建的信息
openstack role assignment list
openstack role list
openstack project list
openstack user list （要有glance用户）

# mysql中验证表是否已创建
[root@controller ~]# mysql keystone -e &quot;show tables;&quot; | grep user
federated_user
local_user
user
user_group_membership
[root@controller ~]# mysql keystone -e &quot;show tables;&quot; | grep project
project
project_endpoint
project_endpoint_group

# 安装服务相应软件包
yum install openstack-glance -y

# 修改相应的配置文件--api
cp &#x2F;etc&#x2F;glance&#x2F;glance-api.conf&#123;,.bak&#125;
grep &#39;^[a-Z\[]&#39; &#x2F;etc&#x2F;glance&#x2F;glance-api.conf.bak &gt; &#x2F;etc&#x2F;glance&#x2F;glance-api.conf
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf database connection mysql+pymysql:&#x2F;&#x2F;glance:GLANCE_DBPASS@controller&#x2F;glance
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken username glance
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf keystone_authtoken password GLANCE_PASS
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf paste_deploy flavor keystone
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf glance_store stores file,http
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf glance_store default_store file
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-api.conf glance_store filesystem_store_datadir &#x2F;var&#x2F;lib&#x2F;glance&#x2F;images&#x2F;

# 修改相应的配置文件--registry
cp &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf&#123;,.bak&#125;
grep &#39;^[a-Z\[]&#39; &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf.bak &gt; &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf database connection mysql+pymysql:&#x2F;&#x2F;glance:GLANCE_DBPASS@controller&#x2F;glance
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken username glance
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf keystone_authtoken password GLANCE_PASS
openstack-config --set &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf paste_deploy flavor keystone

# md5值验证
md5sum &#x2F;etc&#x2F;glance&#x2F;glance-api.conf
3e1a4234c133eda11b413788e001cba3  &#x2F;etc&#x2F;glance&#x2F;glance-api.conf
md5sum &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf
46acabd81a65b924256f56fe34d90b8f  &#x2F;etc&#x2F;glance&#x2F;glance-registry.conf

# 写入镜像服务数据库
su -s &#x2F;bin&#x2F;sh -c &quot;glance-manage db_sync&quot; glance # 会有Warning不用在意
# 验证
mysql glance -e &quot;show tables;&quot;

# 启动服务
systemctl enable openstack-glance-api.service   openstack-glance-registry.service
systemctl start openstack-glance-api.service   openstack-glance-registry.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-4-2-上传镜像测试"><a href="#2-4-2-上传镜像测试" class="headerlink" title="2.4.2 上传镜像测试"></a>2.4.2 上传镜像测试</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 错误日志查看
&#x2F;var&#x2F;log&#x2F;glance

# 确保已获取token令牌
openstack token issue

# 下载测试镜像
wget http:&#x2F;&#x2F;download.cirros-cloud.net&#x2F;0.3.4&#x2F;cirros-0.3.4-x86_64-disk.img

# 上传测试镜像
openstack image create &quot;cirros&quot; \
--file cirros-0.3.4-x86_64-disk.img \
--disk-format qcow2 --container-format bare \
--public

# 上传文件确认
ls &#x2F;var&#x2F;lib&#x2F;glance&#x2F;images&#x2F; (在&#x2F;etc&#x2F;glance&#x2F;glance-api.conf中设置)
mysql glance -e &quot;show tables;&quot; | grep image<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-5-安装nova计算服务"><a href="#2-5-安装nova计算服务" class="headerlink" title="2.5 安装nova计算服务"></a>2.5 安装nova计算服务</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nova-api -- 接受并相应所有的计算服务请求，管理云主机生命周期
nova-compute（多个）-- 真正管理虚拟机(nova-compute调用libvirt)
nova-scheduler -- nova 调度器（挑选最合适的nova-compute）
nova-conductor -- 帮助nova-compute连接数据库
nova-network --  早期版本管理虚拟机的网络（已弃用，改用neutron，留着为了方便兼容早期版本）
nova-consoleauth和nova-novncproxy -- web版的vnc来直接操作云主机
novnproxy -- web版vnc客户端
nova-api-metadata -- 接受来自虚拟机发送的元数据请求（配合neutron-metadata-agent实现虚拟机定制化）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-5-1-控制节点–安装步骤"><a href="#2-5-1-控制节点–安装步骤" class="headerlink" title="2.5.1 控制节点–安装步骤"></a>2.5.1 控制节点–安装步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创库授权
mysql &gt;&gt;
CREATE DATABASE nova_api;
CREATE DATABASE nova;
GRANT ALL PRIVILEGES ON nova_api.* TO &#39;nova&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
GRANT ALL PRIVILEGES ON nova_api.* TO &#39;nova&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
GRANT ALL PRIVILEGES ON nova.* TO &#39;nova&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
GRANT ALL PRIVILEGES ON nova.* TO &#39;nova&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;NOVA_DBPASS&#39;;
  
# 在keystone创建用户nova
openstack user create --domain default   --password NOVA_PASS nova
# 给Nova用户添加admin角色
openstack role add --project service --user nova admin

# 在keystone上创建服务和注册api
openstack service create --name nova   --description &quot;OpenStack Compute&quot; compute
openstack endpoint create --region RegionOne   compute public http:&#x2F;&#x2F;controller:8774&#x2F;v2.1&#x2F;%\(tenant_id\)s
openstack endpoint create --region RegionOne   compute internal http:&#x2F;&#x2F;controller:8774&#x2F;v2.1&#x2F;%\(tenant_id\)s
openstack endpoint create --region RegionOne   compute admin http:&#x2F;&#x2F;controller:8774&#x2F;v2.1&#x2F;%\(tenant_id\)s

# 安装相应软件包
yum install -y openstack-nova-api openstack-nova-conductor \
  openstack-nova-console openstack-nova-novncproxy \
  openstack-nova-scheduler
  
# 修改配置文件
cp &#x2F;etc&#x2F;nova&#x2F;nova.conf&#123;,.bak&#125;
grep -Ev &#39;^$|#&#39; &#x2F;etc&#x2F;nova&#x2F;nova.conf.bak &gt; &#x2F;etc&#x2F;nova&#x2F;nova.conf

openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT enabled_apis osapi_compute,metadata
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT rpc_backend rabbit
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT auth_strategy keystone
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT my_ip 10.0.0.11
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT use_neutron True
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf api_database connection mysql+pymysql:&#x2F;&#x2F;nova:NOVA_DBPASS@controller&#x2F;nova_api
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf database connection mysql+pymysql:&#x2F;&#x2F;nova:NOVA_DBPASS@controller&#x2F;nova
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf glance api_servers http:&#x2F;&#x2F;controller:9292
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken username nova
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken password NOVA_PASS
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_concurrency lock_path &#x2F;var&#x2F;lib&#x2F;nova&#x2F;tmp
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_host controller
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc vncserver_listen &#39;$my_ip&#39;
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc vncserver_proxyclient_address &#39;$my_ip&#39;

# 校验
md5sum &#x2F;etc&#x2F;nova&#x2F;nova.conf
47ded61fdd1a79ab91bdb37ce59ef192  &#x2F;etc&#x2F;nova&#x2F;nova.conf

# 同步数据库
su -s &#x2F;bin&#x2F;sh -c &quot;nova-manage api_db sync&quot; nova
su -s &#x2F;bin&#x2F;sh -c &quot;nova-manage db sync&quot; nova

# 验证
mysql nova_api -e &quot;show tables;&quot;
mysql nova -e &quot;show tables;&quot;

# 启动服务
systemctl enable openstack-nova-api.service \
openstack-nova-consoleauth.service openstack-nova-scheduler.service \
openstack-nova-conductor.service openstack-nova-novncproxy.service
systemctl restart openstack-nova-api.service \
openstack-nova-consoleauth.service openstack-nova-scheduler.service \
openstack-nova-conductor.service openstack-nova-novncproxy.service

# 验证
[root@controller ~]# nova service-list
+----+------------------+------------+----------+---------+-------+------------+-----------------+
| Id | Binary           | Host       | Zone     | Status  | State | Updated_at | Disabled Reason |
+----+------------------+------------+----------+---------+-------+------------+-----------------+
| 1  | nova-conductor   | controller | internal | enabled | down  | -          | -               |
| 4  | nova-scheduler   | controller | internal | enabled | down  | -          | -               |
| 5  | nova-consoleauth | controller | internal | enabled | down  | -          | -               |
+----+------------------+------------+----------+---------+-------+------------+-----------------+

# novncproxy 怎么检测起来没有？
[root@controller ~]# netstat -lntup | grep 6080
tcp        0      0 0.0.0.0:6080            0.0.0.0:*               LISTEN      8719&#x2F;python2
[root@controller ~]# ps -ef | grep 8719
nova       8719      1  0 21:53 ?        00:00:01 &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;usr&#x2F;bin&#x2F;nova-novncproxy --web &#x2F;usr&#x2F;share&#x2F;novnc&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-5-1-计算节点–安装步骤"><a href="#2-5-1-计算节点–安装步骤" class="headerlink" title="2.5.1 计算节点–安装步骤"></a>2.5.1 计算节点–安装步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装软件包
yum install -y openstack-nova-compute openstack-utils

# 修改配置文件
cp &#x2F;etc&#x2F;nova&#x2F;nova.conf&#123;,.bak&#125;
grep -Ev &#39;^$|#&#39; &#x2F;etc&#x2F;nova&#x2F;nova.conf.bak &gt; &#x2F;etc&#x2F;nova&#x2F;nova.conf

openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT enabled_apis osapi_compute,metadata
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT rpc_backend rabbit
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT auth_strategy keystone
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT my_ip 10.0.0.31 # 注意ip
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT use_neutron True
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf glance api_servers http:&#x2F;&#x2F;controller:9292
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken username nova
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf keystone_authtoken password NOVA_PASS
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_concurrency lock_path &#x2F;var&#x2F;lib&#x2F;nova&#x2F;tmp
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_host controller
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc enabled  True
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc vncserver_listen 0.0.0.0
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc vncserver_proxyclient_address &#39;$my_ip&#39;
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf vnc novncproxy_base_url http:&#x2F;&#x2F;controller:6080&#x2F;vnc_auto.html

# 校验
md5sum &#x2F;etc&#x2F;nova&#x2F;nova.conf
45cab6030a9ab82761e9f697d6d79e14  &#x2F;etc&#x2F;nova&#x2F;nova.conf

# 启动服务
systemctl enable libvirtd.service openstack-nova-compute.service
systemctl restart libvirtd.service openstack-nova-compute.service

# 服务启动错误排查
参考博客：https:&#x2F;&#x2F;www.codeleading.com&#x2F;article&#x2F;89785382846&#x2F;
cat &#x2F;etc&#x2F;nova&#x2F;nova.conf # compute1日志查看
报错 nova AccessRefused: (0, 0): (403) ACCESS_REFUSED
处理步骤：
在controller
cat &#x2F;var&#x2F;log&#x2F;rabbitmq&#x2F;rabbit@controller.log # 发现报错AMQPLAIN login refused: user &#39;openstack&#39; - invalid credentials 无效凭证
rabbitmqctl list_users # 确认是否还有openstack用户
rabbitmqctl add_user openstack RABBIT_PASS
rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
systemctl restart rabbitmq-server.service # 重新创用户，并重启服务<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-6-安装neutron网络服务"><a href="#2-6-安装neutron网络服务" class="headerlink" title="2.6 安装neutron网络服务"></a>2.6 安装neutron网络服务</h3><p>neutron-server – 端口9696，api接受和响应外部的网络管理请求</p>
<p>neutron-linuxbridge-agent –  负责创建桥接网卡</p>
<p>neutron-dhcp-agent – 负责分配ip</p>
<p>neutron-metadata-agent –  配合nova-metadata-api实现虚拟机的定制化操作</p>
<p>L3-agent – 实现三层网络vxlan（网络层）</p>
<h4 id="2-6-1-控制节点–安装步骤"><a href="#2-6-1-控制节点–安装步骤" class="headerlink" title="2.6.1 控制节点–安装步骤"></a>2.6.1 控制节点–安装步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创库授权
Mysql &gt;&gt;
CREATE DATABASE neutron;
GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;
GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;;
  
# 在keystone创建用户neutron
openstack user create --domain default   --password NEUTRON_PASS neutron
# 给neutron用户添加admin角色
openstack role add --project service --user neutron admin

# 在keystone上创建服务和注册api
openstack service create --name neutron   --description &quot;OpenStack Networking&quot; network
openstack endpoint create --region RegionOne   network public http:&#x2F;&#x2F;controller:9696
openstack endpoint create --region RegionOne   network internal http:&#x2F;&#x2F;controller:9696
openstack endpoint create --region RegionOne   network admin http:&#x2F;&#x2F;controller:9696

# 网络配置--公共网络
cp &#x2F;etc&#x2F;neutron&#x2F;neutron.conf&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;neutron.conf.bak  &gt; &#x2F;etc&#x2F;neutron&#x2F;neutron.conf
&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf database connection mysql+pymysql:&#x2F;&#x2F;neutron:NEUTRON_DBPASS@controller&#x2F;neutron
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT core_plugin ml2
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT service_plugins
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT rpc_backend rabbit
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT auth_strategy keystone
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT notify_nova_on_port_status_changes True
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT notify_nova_on_port_data_changes True
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_host controller
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken username neutron
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken password NEUTRON_PASS
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova auth_type password
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova project_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova user_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova region_name RegionOne
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova project_name service
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova username nova
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf nova password NOVA_PASS
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_concurrency lock_path &#x2F;var&#x2F;lib&#x2F;neutron&#x2F;tmp
&gt;&gt;&gt;&gt;&gt;

cp &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini.bak &gt; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini
&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini ml2 type_drivers flat,vlan
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini ml2 tenant_network_types
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini ml2 mechanism_drivers linuxbridge
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini ml2 extension_drivers port_security
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini ml2_type_flat flat_networks provider
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini securitygroup enable_ipset True
&gt;&gt;&gt;&gt;&gt;

cp &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini.bak &gt; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini
&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33  # 要修改网络接口名
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini vxlan enable_vxlan False
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini securitygroup enable_security_group True
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
&gt;&gt;&gt;&gt;&gt;

cp &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini.bak &gt; &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini
&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini DEFAULT interface_driver neutron.agent.linux.interface.BridgeInterfaceDriver
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini DEFAULT  dhcp_driver neutron.agent.linux.dhcp.Dnsmasq
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini DEFAULT  enable_isolated_metadata True
&gt;&gt;&gt;&gt;&gt;

cp &#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini.bak &gt; &#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini
&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini DEFAULT nova_metadata_ip controller
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini DEFAULT metadata_proxy_shared_secret METADATA_SECRET
&gt;&gt;&gt;&gt;&gt;

# 再次修改nova配置文件，添加neutron服务
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron url http:&#x2F;&#x2F;controller:9696
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron auth_type password
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron project_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron user_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron region_name RegionOne
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron project_name service
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron username neutron
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron password NEUTRON_PASS
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron service_metadata_proxy True
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron metadata_proxy_shared_secret METADATA_SECRET
# 校验文件
[root@controller ~]# md5sum &#x2F;etc&#x2F;nova&#x2F;nova.conf
6334f359655efdbcf083b812ab94efc1  &#x2F;etc&#x2F;nova&#x2F;nova.conf

# 网络服务初始化脚本需要一个超链接
ln -s &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini &#x2F;etc&#x2F;neutron&#x2F;plugin.ini

# 同步数据库
su -s &#x2F;bin&#x2F;sh -c &quot;neutron-db-manage --config-file &#x2F;etc&#x2F;neutron&#x2F;neutron.conf \
  --config-file &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini upgrade head&quot; neutron
  
# 检查数据库
mysql neutron -e &quot;show tables;&quot;

# 重启Nova服务
systemctl restart openstack-nova-api.service

# 启动Neutron服务
systemctl enable neutron-server.service   neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service
systemctl start neutron-server.service   neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service

# 查看服务有没有起来
neutron agent-list
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+
| 0d68dc27-f2b8-4cae-9c30-cddd126076b4 | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-agent |
| 688cc47d-424d-4243-ae2b-b1c4b298a2a8 | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |
| c4c5e360-ee02-4b9b-a1a5-59a0d0d088b0 | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |
+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-6-2-计算节点–安装步骤"><a href="#2-6-2-计算节点–安装步骤" class="headerlink" title="2.6.2 计算节点–安装步骤"></a>2.6.2 计算节点–安装步骤</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装组件
yum install -y openstack-neutron-linuxbridge ebtables ipset

# 网络配置--公共网络
cp &#x2F;etc&#x2F;neutron&#x2F;neutron.conf&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;neutron.conf.bak  &gt; &#x2F;etc&#x2F;neutron&#x2F;neutron.conf
&gt;&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT rpc_backend rabbit
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf DEFAULT auth_strategy keystone
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_host controller
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_uri http:&#x2F;&#x2F;controller:5000
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken memcached_servers controller:11211
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken auth_type password
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken project_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken user_domain_name default
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken project_name service
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken username neutron
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf keystone_authtoken password NEUTRON_PASS
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;neutron.conf oslo_concurrency lock_path &#x2F;var&#x2F;lib&#x2F;neutron&#x2F;tmp
&gt;&gt;&gt;&gt;&gt;&gt;
# md5校验
md5sum &#x2F;etc&#x2F;nova&#x2F;nova.conf
328cd5f0745e26a420e828b0dfc2934e  &#x2F;etc&#x2F;nova&#x2F;nova.conf

cp &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini&#123;,.bak&#125;
grep -Ev &quot;^$|#&quot; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini.bak &gt; &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini
&gt;&gt;&gt;&gt;&gt;&gt;
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33  # 要修改网络接口名
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini vxlan enable_vxlan False
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini securitygroup enable_security_group True
openstack-config --set &#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
&gt;&gt;&gt;&gt;&gt;&gt;

# 再次修改nova配置文件，添加neutron配置
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron url http:&#x2F;&#x2F;controller:9696
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron auth_url http:&#x2F;&#x2F;controller:35357
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron auth_type password
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron project_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron user_domain_name default
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron region_name RegionOne
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron project_name service
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron username neutron
openstack-config --set &#x2F;etc&#x2F;nova&#x2F;nova.conf neutron password NEUTRON_PASS

# 重启nova服务
systemctl restart openstack-nova-compute.service

# 启动linuxbridge代理服务
systemctl enable neutron-linuxbridge-agent.service
systemctl restart neutron-linuxbridge-agent.service

# 查看是否配置成功
controller执行 &gt;&gt; neutron agent-list
配置正确会多出来一个
Linux bridge agent | compute1   |                   | :-)   | True 

# 查看计算资源
openstack compute service list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-7-安装horizon-（Dashboard）web界面"><a href="#2-7-安装horizon-（Dashboard）web界面" class="headerlink" title="2.7 安装horizon （Dashboard）web界面"></a>2.7 安装horizon （Dashboard）web界面</h3><h4 id="2-7-1-安装步骤（控制节点"><a href="#2-7-1-安装步骤（控制节点" class="headerlink" title="2.7.1 安装步骤（控制节点)"></a>2.7.1 安装步骤（控制节点)</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装组件包
yum install -y openstack-dashboard

# 修改配置文件
vim &#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings
&gt;&gt;&gt;&gt;
OPENSTACK_HOST &#x3D; &quot;controller&quot;
ALLOWED_HOSTS &#x3D; [&#39;*&#39;, ]
SESSION_ENGINE &#x3D; &#39;django.contrib.sessions.backends.cache&#39;
CACHES &#x3D; &#123;
    &#39;default&#39;: &#123;
         &#39;BACKEND&#39;: &#39;django.core.cache.backends.memcached.MemcachedCache&#39;,
         &#39;LOCATION&#39;: &#39;controller:11211&#39;,
    &#125;
&#125;
OPENSTACK_KEYSTONE_URL &#x3D; &quot;http:&#x2F;&#x2F;%s:5000&#x2F;v3&quot; % OPENSTACK_HOST
OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT &#x3D; True
OPENSTACK_API_VERSIONS &#x3D; &#123;
    &quot;identity&quot;: 3,
    &quot;image&quot;: 2,
    &quot;volume&quot;: 2,
&#125;
OPENSTACK_KEYSTONE_DEFAULT_DOMAIN &#x3D; &quot;default&quot;
OPENSTACK_KEYSTONE_DEFAULT_ROLE &#x3D; &quot;user&quot;
OPENSTACK_NEUTRON_NETWORK &#x3D; &#123;
    ...
    &#39;enable_router&#39;: False,
    &#39;enable_quotas&#39;: False,
    &#39;enable_distributed_router&#39;: False,
    &#39;enable_ha_router&#39;: False,
    &#39;enable_lb&#39;: False,
    &#39;enable_firewall&#39;: False,
    &#39;enable_vpn&#39;: False,
    &#39;enable_fip_topology_check&#39;: False,
&#125;
TIME_ZONE &#x3D; &quot;Asia&#x2F;Shanghai&quot;
&gt;&gt;&gt;&gt;

# 解决不能进入页面的BUG
vim &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;openstack-dashboard.conf
添加一行 &gt;&gt; WSGIAppicationGroup %&#123;GLOBAL&#125;

# 重启服务
systemctl restart httpd.service memcached.service

# 登录界面
https:&#x2F;&#x2F;10.0.0.11&#x2F;dashboard
域:default
用户名:admin
密码:ADMIN_PASS

# 扩展：查看文件输入那个rpm包
rpm -qf &#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-7-2-Dashboard报错解决"><a href="#2-7-2-Dashboard报错解决" class="headerlink" title="2.7.2 Dashboard报错解决"></a>2.7.2 Dashboard报错解决</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 问题1--Invalid service catalog service: image
发生原因：
	openstack service list 存在两个 glance
解决方法：
    openstack service delete c12c125edc2041e3aaf2f250442162c6
    openstack service delete 6a11431b95bc44d1bd1e9371c0faa16b # 两个glance都删掉
    重复2.4.1在keystone上创建glance服务和注册api
    再重启服务systemctl restart httpd.service memcached.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-8-启动一个云主机"><a href="#2-8-启动一个云主机" class="headerlink" title="2.8 启动一个云主机"></a>2.8 启动一个云主机</h3><h3 id="2-8-1-创建步骤"><a href="#2-8-1-创建步骤" class="headerlink" title="2.8.1 创建步骤"></a>2.8.1 创建步骤</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创建网络
neutron net-create --shared --provider:physical_network provider \
  --provider:network_type flat gs
  
# 在网络中创建一个子网
neutron subnet-create --name gs2 \
  --allocation-pool start&#x3D;10.0.0.101,end&#x3D;10.0.0.250 \
  --dns-nameserver 223.5.5.5 --gateway 10.0.0.2 \
  gs 10.0.0.0&#x2F;24
  
# 创建云主机硬件配置方案（规格）
openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano

# 创建密钥键值对
ssh-keygen -q -N &quot;&quot; -f ~&#x2F;.ssh&#x2F;id_rsa
openstack keypair create --public-key ~&#x2F;.ssh&#x2F;id_rsa.pub mykey
# 验证公钥的添加
openstack keypair list

# 添加安全组规则
openstack security group rule create --proto icmp default
openstack security group rule create --proto tcp --dst-port 22 default

# 在公有网络启动一个实例
openstack flavor list # 查看可用的配置规格
openstack image list # 查看可用镜像
openstack network list # 查看可用网络
openstack security group list # 查看已设置的安全组

openstack server create --flavor 规格名&#x2F;ID --image 镜像名&#x2F;ID \
  --nic net-id&#x3D;网络ID --security-group default \
  --key-name mykey 实例名称
示例：
openstack server create --flavor m1.tiny --image cirros \
--nic net-id&#x3D;cb032582-893b-414d-b78d-c89c6548612d --security-group default \
--key-name mykey my-instance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-8-2-创建云主机问题解决"><a href="#2-8-2-创建云主机问题解决" class="headerlink" title="2.8.2 创建云主机问题解决"></a>2.8.2 创建云主机问题解决</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 1、启动云主机时，No valid host was found
【计算节点中】
查看云主机创建日志：&#x2F;var&#x2F;log&#x2F;nova&#x2F;nova-compute.log，里面有记录问题原因是CPU feature spec-ctrl not found
修改&#x2F;usr&#x2F;share&#x2F;libvirt&#x2F;cpu_map.xml，将和spec-ctrl相关的特性删除
然后重启服务
systemctl restart libvirtd openstack-nova-compute
参考博客：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;laolieren&#x2F;p&#x2F;solve_openstack_create_instance_error.html

# 2、云主机控制台seabios -- Booting from Hard Disk错误
【计算节点中】
vim &#x2F;etc&#x2F;nova&#x2F;nova.conf
&gt;&gt;&gt;&gt;
[libvirt]
virt_type &#x3D; qemu
cpu_mode &#x3D; none
&gt;&gt;&gt;&gt;
systemctl restart libvirtd openstack-nova-compute
重启云主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>








      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2022/07/06/01_%E8%BF%90%E7%BB%B4/05-%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E8%AE%B0%E5%BD%95/SVN%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/01_%E8%BF%90%E7%BB%B4/05-%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E8%AE%B0%E5%BD%95/SVN%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 11:07:12" itemprop="dateCreated datePublished" datetime="2022-07-06T11:07:12+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-07 10:51:44" itemprop="dateModified" datetime="2022-06-07T10:51:44+08:00">2022-06-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="KylinV10-桌面版SVN搭建"><a href="#KylinV10-桌面版SVN搭建" class="headerlink" title="KylinV10 桌面版SVN搭建"></a>KylinV10 桌面版SVN搭建</h1><h2 id="一、服务端配置"><a href="#一、服务端配置" class="headerlink" title="一、服务端配置"></a>一、服务端配置</h2><h3 id="1-1-安装SVN"><a href="#1-1-安装SVN" class="headerlink" title="1.1 安装SVN"></a>1.1 安装SVN</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo apt-get install subversion<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="1-2-新建仓库文件夹"><a href="#1-2-新建仓库文件夹" class="headerlink" title="1.2 新建仓库文件夹"></a>1.2 新建仓库文件夹</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创建项目仓库文件夹
mkdir &#x2F;data&#x2F;svn&#x2F;project

# 修改文件夹权限
chmod -R 777 &#x2F;data&#x2F;svn&#x2F;project<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-创建版本库"><a href="#1-3-创建版本库" class="headerlink" title="1.3 创建版本库"></a>1.3 创建版本库</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">svnadmin create &#x2F;data&#x2F;svn&#x2F;project<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>完成后会在文件夹中生成一系列文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">greatwall@greatwall-GW-001M1A-FTF:&#x2F;data&#x2F;svn&#x2F;project$ ls
conf  db  format  hooks  locks  README.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改db权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">chmod -R 777 db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="1-4-设置访问权限"><a href="#1-4-设置访问权限" class="headerlink" title="1.4 设置访问权限"></a>1.4 设置访问权限</h3><pre class="line-numbers language-she" data-language="she"><code class="language-she">vim &#x2F;data&#x2F;svn&#x2F;project&#x2F;conf&#x2F;svnserve.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>做如下修改</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">greatwall@greatwall-GW-001M1A-FTF:&#x2F;data&#x2F;svn&#x2F;project&#x2F;conf$ cat svnserve.conf
### This file controls the configuration of the svnserve daemon, if you
### use it to allow access to this repository.  (If you only allow
### access through http: and&#x2F;or file: URLs, then this file is
### irrelevant.)

### Visit http:&#x2F;&#x2F;subversion.apache.org&#x2F; for more information.

[general]
### The anon-access and auth-access options control access to the
### repository for unauthenticated (a.k.a. anonymous) users and
### authenticated users, respectively.
### Valid values are &quot;write&quot;, &quot;read&quot;, and &quot;none&quot;.
### Setting the value to &quot;none&quot; prohibits both reading and writing;
### &quot;read&quot; allows read-only access, and &quot;write&quot; allows complete
### read&#x2F;write access to the repository.
### The sample settings below are the defaults and specify that anonymous
### users have read-only access to the repository, while authenticated
### users have read and write access to the repository.
anon-access &#x3D; none	# 非认证用户不让写
auth-access &#x3D; write
### The password-db option controls the location of the password
### database file.  Unless you specify a path starting with a &#x2F;,
### the file&#39;s location is relative to the directory containing
### this configuration file.
### If SASL is enabled (see below), this file will NOT be used.
### Uncomment the line below to use the default password file.
password-db &#x3D; passwd
### The authz-db option controls the location of the authorization
### rules for path-based access control.  Unless you specify a path
### starting with a &#x2F;, the file&#39;s location is relative to the
### directory containing this file.  The specified path may be a
### repository relative URL (^&#x2F;) or an absolute file:&#x2F;&#x2F; URL to a text
### file in a Subversion repository.  If you don&#39;t specify an authz-db,
### no path-based access control is done.
### Uncomment the line below to use the default authorization file.
authz-db &#x3D; authz
### The groups-db option controls the location of the groups file.
### Unless you specify a path starting with a &#x2F;, the file&#39;s location is
### relative to the directory containing this file.  The specified path
### may be a repository relative URL (^&#x2F;) or an absolute file:&#x2F;&#x2F; URL to a
### text file in a Subversion repository.
# groups-db &#x3D; groups
### This option specifies the authentication realm of the repository.
### If two repositories have the same authentication realm, they should
### have the same password database, and vice versa.  The default realm
### is repository&#39;s uuid.
realm &#x3D; My First Repository
### The force-username-case option causes svnserve to case-normalize
### usernames before comparing them against the authorization rules in the
### authz-db file configured above.  Valid values are &quot;upper&quot; (to upper-
### case the usernames), &quot;lower&quot; (to lowercase the usernames), and
### &quot;none&quot; (to compare usernames as-is without case conversion, which
### is the default behavior).
# force-username-case &#x3D; none
### The hooks-env options specifies a path to the hook script environment
### configuration file. This option overrides the per-repository default
### and can be used to configure the hook script environment for multiple
### repositories in a single file, if an absolute path is specified.
### Unless you specify an absolute path, the file&#39;s location is relative
### to the directory containing this file.
# hooks-env &#x3D; hooks-env

[sasl]
### This option specifies whether you want to use the Cyrus SASL
### library for authentication. Default is false.
### This section will be ignored if svnserve is not built with Cyrus
### SASL support; to check, run &#39;svnserve --version&#39; and look for a line
### reading &#39;Cyrus SASL authentication is available.&#39;
# use-sasl &#x3D; true
### These options specify the desired strength of the security layer
### that you want SASL to provide. 0 means no encryption, 1 means
### integrity-checking only, values larger than 1 are correlated
### to the effective key length for encryption (e.g. 128 means 128-bit
### encryption). The values below are the defaults.
# min-encryption &#x3D; 0
# max-encryption &#x3D; 256<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-5-添加访问用户"><a href="#1-5-添加访问用户" class="headerlink" title="1.5 添加访问用户"></a>1.5 添加访问用户</h3><p>修改passwd文件，添加访问用户</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">greatwall@greatwall-GW-001M1A-FTF:&#x2F;data&#x2F;svn&#x2F;project&#x2F;conf$ cat passwd
### This file is an example password file for svnserve.
### Its format is similar to that of svnserve.conf. As shown in the
### example below it contains one section labelled [users].
### The name and password for each user follow, one account per line.

[users]
# harry &#x3D; harryssecret
# sally &#x3D; sallyssecret
admin&#x3D;mysecret
gs&#x3D;mysecret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-6-设置用户权限"><a href="#1-6-设置用户权限" class="headerlink" title="1.6 设置用户权限"></a>1.6 设置用户权限</h3><p>修改authz文件，设置用户权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">greatwall@greatwall-GW-001M1A-FTF:&#x2F;data&#x2F;svn&#x2F;project&#x2F;conf$ cat authz
### This file is an example authorization file for svnserve.
### Its format is identical to that of mod_authz_svn authorization
### files.
### As shown below each section defines authorizations for the path and
### (optional) repository specified by the section name.
### The authorizations follow. An authorization line can refer to:
###  - a single user,
###  - a group of users defined in a special [groups] section,
###  - an alias defined in a special [aliases] section,
###  - all authenticated users, using the &#39;$authenticated&#39; token,
###  - only anonymous users, using the &#39;$anonymous&#39; token,
###  - anyone, using the &#39;*&#39; wildcard.
###
### A match can be inverted by prefixing the rule with &#39;~&#39;. Rules can
### grant read (&#39;r&#39;) access, read-write (&#39;rw&#39;) access, or no access
### (&#39;&#39;).

[aliases]
# joe &#x3D; &#x2F;C&#x3D;XZ&#x2F;ST&#x3D;Dessert&#x2F;L&#x3D;Snake City&#x2F;O&#x3D;Snake Oil, Ltd.&#x2F;OU&#x3D;Research Institute&#x2F;CN&#x3D;Joe Average

[groups]
# harry_and_sally &#x3D; harry,sally
# harry_sally_and_joe &#x3D; harry,sally,&amp;joe

# [&#x2F;foo&#x2F;bar]
# harry &#x3D; rw
# &amp;joe &#x3D; r
# * &#x3D;

# [repository:&#x2F;baz&#x2F;fuz]
# @harry_and_sally &#x3D; rw
# * &#x3D; r

team1&#x3D;admin,gs	# 创建用户组

[&#x2F;]
@team1 &#x3D; rw # 用户组权限设置为读写
* &#x3D; r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-7-启动服务"><a href="#1-7-启动服务" class="headerlink" title="1.7 启动服务"></a>1.7 启动服务</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">svnserve -d -r &#x2F;data&#x2F;svn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看服务是否在运行</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ps aux | grep svnserve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>干掉服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">killall svnserve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="二、客户端连接"><a href="#二、客户端连接" class="headerlink" title="二、客户端连接"></a>二、客户端连接</h2><p>svn:&#x2F;&#x2F;10.47.76.90&#x2F;project</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GongSheng"
      src="/images/myavatar.png">
  <p class="site-author-name" itemprop="name">GongSheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GongSheng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
