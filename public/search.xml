<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hexo博客维护</title>
    <url>/2022/07/07/00_%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/hexo%E7%BB%B4%E6%8A%A4/</url>
    <content><![CDATA[<h2 id="1-Hexo博客维护"><a href="#1-Hexo博客维护" class="headerlink" title="1 Hexo博客维护"></a>1 Hexo博客维护</h2><p>版本：<code>Next 8.12.2</code></p>
<p>1、下载安装nodejs</p>
<p><a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>2、切换npm为阿里源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>3、使用npm安装hexo</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<blockquote>
<p>否则会报错:</p>
<p>$ hexo clean<br>ERROR Cannot find module ‘hexo’ from ‘C:\Users\fr724\Desktop\新建文件夹\gsproj.github.io’<br>ERROR Local hexo loading failed in ~\Desktop\新建文件夹\gsproj.github.io<br>ERROR Try running: ‘rm -rf node_modules &amp;&amp; npm install –force’</p>
</blockquote>
<p>4、使用npm安装搜索功能依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">npm install hexo-excerpt --save</span><br></pre></td></tr></table></figure>

<p>5、内容上线</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d # 上线到githubio</span><br><span class="line">hexo s # 本地试运行</span><br></pre></td></tr></table></figure>



<h2 id="2-功能添加"><a href="#2-功能添加" class="headerlink" title="2 功能添加"></a>2 功能添加</h2><h3 id="2-1-搜索功能"><a href="#2-1-搜索功能" class="headerlink" title="2.1 搜索功能"></a>2.1 搜索功能</h3><p>安装依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>修改主题设置文件<code>themes/next/_config.yml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local Search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/next-theme/hexo-generator-searchdb</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>	<span class="comment"># 此处改为true</span></span><br><span class="line">  <span class="comment"># If auto, trigger search by changing input.</span></span><br><span class="line">  <span class="comment"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Preload the search data when the page loads.</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-菜单显示归档-x2F-书签"><a href="#2-2-菜单显示归档-x2F-书签" class="headerlink" title="2.2 菜单显示归档&#x2F;书签"></a>2.2 菜单显示归档&#x2F;书签</h3><p>修改主题设置文件next&#x2F;_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="comment">#home: / || fa fa-home</span></span><br><span class="line">  <span class="comment">#about: /about/ || fa fa-user</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-tags</span>	<span class="comment"># 取消注释</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-th</span>	<span class="comment"># 取消注释</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span>	<span class="comment"># 取消注释</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || fa fa-heartbeat</span></span><br></pre></td></tr></table></figure>

<p>效果如下图：</p>
<p><img src="/../../img/image-20220719101836015.png" alt="image-20220719101836015"></p>
<h3 id="2-3-鼠标点击烟花效果"><a href="#2-3-鼠标点击烟花效果" class="headerlink" title="2.3 鼠标点击烟花效果"></a>2.3 鼠标点击烟花效果</h3><p>下载<a href="https://aliyun-oss-pic-bucket.oss-cn-beijing.aliyuncs.com/file/fireworks.js">fireworks.js</a>文件放到<code>themes/next/source\js\cursor</code>中</p>
<p>创建<code>themes/next/layout/_custom</code>文件夹，并在其中创建<code>custom.swig</code>文件，内容如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="comment"># 鼠标点击烟花特效 #&#125;</span></span><br><span class="line">&#123;% <span class="keyword">if</span> theme.cursor_effect == <span class="string">&quot;fireworks&quot;</span> %&#125;</span><br><span class="line">  &lt;script <span class="keyword">async</span> src=<span class="string">&quot;/js/cursor/fireworks.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&#123;% elseif theme.cursor_effect == <span class="string">&quot;explosion&quot;</span> %&#125;</span><br><span class="line">  &lt;canvas <span class="class"><span class="keyword">class</span>=&quot;<span class="title">fireworks</span>&quot; <span class="title">style</span>=&quot;<span class="title">position</span>:</span> fixed;left: <span class="number">0</span>;top: <span class="number">0</span>;z-index: <span class="number">1</span>; pointer-events: none;<span class="string">&quot; &gt;&lt;/canvas&gt;</span></span><br><span class="line"><span class="string">  &lt;script src=&quot;</span>//cdn.bootcss.com/animejs/<span class="number">2.2</span><span class="number">.0</span>/anime.<span class="built_in">min</span>.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;script async src=&quot;</span>/js/cursor/explosion.<span class="built_in">min</span>.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#123;% elseif theme.cursor_effect == &quot;</span>love<span class="string">&quot; %&#125;</span></span><br><span class="line"><span class="string">  &lt;script async src=&quot;</span>/js/cursor/love.<span class="built_in">min</span>.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#123;% elseif theme.cursor_effect == &quot;</span>text<span class="string">&quot; %&#125;</span></span><br><span class="line"><span class="string">  &lt;script async src=&quot;</span>/js/cursor/text.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#123;% endif %&#125;</span></span><br></pre></td></tr></table></figure>

<p>编辑&#96;themes&#x2F;next&#x2F;layout&#x2F;_layout.njk文件，在尾行导入swig文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  &#123;&#123; partial(&#x27;_scripts/index.njk&#x27;, &#123;&#125;, &#123;cache: theme.cache.enable&#125;) &#125;&#125;</span><br><span class="line">  &#123;&#123; partial(&#x27;_third-party/index.njk&#x27;, &#123;&#125;, &#123;cache: theme.cache.enable&#125;) &#125;&#125;</span><br><span class="line">  &#123;&#123; partial(&#x27;_third-party/statistics/index.njk&#x27;, &#123;&#125;, &#123;cache: theme.cache.enable&#125;) &#125;&#125;</span><br><span class="line"></span><br><span class="line">  &#123;%- include &#x27;_third-party/math/index.njk&#x27; -%&#125;</span><br><span class="line">  &#123;%- include &#x27;_third-party/quicklink.njk&#x27; -%&#125;</span><br><span class="line"></span><br><span class="line">  &#123;&#123;- next_inject(&#x27;bodyEnd&#x27;) &#125;&#125;</span><br><span class="line">  &#123;% include &#x27;_custom/custom.swig&#x27; %&#125;	# 导入swig文件</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>编辑<code>themes/next/_config.yml</code>文件，添加</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 鼠标点击烟花特效</span></span><br><span class="line"><span class="attr">cursor_effect:</span> <span class="string">fireworks</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>PS:一个小修改，防止烟花残留</strong></p>
<p>参考：<a href="https://yfx2012.top/2022/01/17/hexo/mouse-click-fireworks/">https://yfx2012.top/2022/01/17/hexo/mouse-click-fireworks/</a></p>
<p>修改firewaors.js文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handlePageHide</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.booms = []</span><br><span class="line">  <span class="built_in">this</span>.running = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 简单修改，清理停留不动的烟火特效</span></span><br><span class="line">  <span class="built_in">this</span>.computerContext.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">this</span>.globalWidth, <span class="built_in">this</span>.globalHeight)</span><br><span class="line">  <span class="built_in">this</span>.renderContext.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">this</span>.globalWidth, <span class="built_in">this</span>.globalHeight)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-4-关闭文章目录的自动章节号"><a href="#2-4-关闭文章目录的自动章节号" class="headerlink" title="2.4 关闭文章目录的自动章节号"></a>2.4 关闭文章目录的自动章节号</h3><p>未修改前，自动排了序号，看上去很乱：</p>
<p><img src="/../../img/image-20220719104324299.png" alt="image-20220719104324299"></p>
<p>修改主题配置文件<code>/themes/next/_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Automatically add list number to toc.</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">false</span>	<span class="comment"># 改为false关闭</span></span><br><span class="line">  <span class="comment"># If true, all words will placed on next lines if header width longer then sidebar width.</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># If true, all level of TOC in a post will be displayed, rather than the activated part of it.</span></span><br><span class="line">  <span class="attr">expand_all:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Maximum heading depth of generated toc.</span></span><br><span class="line">  <span class="attr">max_depth:</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>修改后，清爽了很多：</p>
<p><img src="/../../img/image-20220719104519550.png" alt="image-20220719104519550"></p>
<h3 id="2-5-添加头像"><a href="#2-5-添加头像" class="headerlink" title="2.5 添加头像"></a>2.5 添加头像</h3><p>将头像文件放到<code>themes/next/source/images</code>中</p>
<p>修改主题配置文件<code>/themes/next/_config.yml</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Sidebar Avatar</span></span><br><span class="line">avatar:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Replace the default image and <span class="built_in">set</span> the url here.</span></span><br><span class="line">  url: /images/myavatar.png</span><br></pre></td></tr></table></figure>

<h3 id="2-6-修改背景图片"><a href="#2-6-修改背景图片" class="headerlink" title="2.6 修改背景图片"></a>2.6 修改背景图片</h3><blockquote>
<p>白花花的有点单调</p>
</blockquote>
<p>将背景图片放到<code>themes\next\source\images</code></p>
<p>新建<code>source\_data</code>文件夹（是hexo目录下的source,不是主题的source）</p>
<p>在<code>_data</code>中新建<code>styles.styl</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">body</span> &#123;</span><br><span class="line">    <span class="string">background:url(/images/xhc.jpg);</span></span><br><span class="line">    <span class="attr">background-repeat:</span> <span class="literal">no</span><span class="string">-repeat;</span></span><br><span class="line">    <span class="string">background-attachment:fixed;</span></span><br><span class="line">    <span class="string">background-position:50%</span> <span class="number">50</span><span class="string">%;</span></span><br><span class="line">    <span class="string">//</span> <span class="attr">background-size:</span> <span class="number">100</span><span class="string">%</span> <span class="number">100</span><span class="string">%;</span></span><br><span class="line">    <span class="attr">background-size:</span> <span class="string">cover;</span></span><br><span class="line">    <span class="string">-webkit-background-size:</span> <span class="string">cover;</span></span><br><span class="line">    <span class="string">-o-background-size:</span> <span class="string">cover;</span></span><br><span class="line">    <span class="string">-moz-background-size:</span> <span class="string">cover;</span></span><br><span class="line">    <span class="string">-ms-background-size:</span> <span class="string">cover;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后将<code>themes/next/_config.yml</code>配置文件中<code>custom_file_path:</code>下的<code>#style: source/_data/styles.styl</code>#号去掉，如下</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="comment">#head: source/_data/head.njk</span></span><br><span class="line">  <span class="comment">#header: source/_data/header.njk</span></span><br><span class="line">  <span class="comment">#sidebar: source/_data/sidebar.njk</span></span><br><span class="line">  <span class="comment">#postMeta: source/_data/post-meta.njk</span></span><br><span class="line">  <span class="comment">#postBodyEnd: source/_data/post-body-end.njk</span></span><br><span class="line">  <span class="comment">#footer: source/_data/footer.njk</span></span><br><span class="line">  <span class="comment">#bodyEnd: source/_data/body-end.njk</span></span><br><span class="line">  <span class="comment">#variable: source/_data/variables.styl</span></span><br><span class="line">  <span class="comment">#mixin: source/_data/mixins.styl</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-修改为圆角"><a href="#2-7-修改为圆角" class="headerlink" title="2.7 修改为圆角"></a>2.7 修改为圆角</h3><p>创建<code>source/_data/variables.styl</code>文件</p>
<p>在里面添加：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// 圆角设置</span><br><span class="line">$<span class="attribute">border-radius</span>-inner     = <span class="number">20px</span>;</span><br><span class="line">$<span class="attribute">border-radius</span>           = <span class="number">20px</span>;</span><br></pre></td></tr></table></figure>

<p>然后将<code>themes/next/_config.yml</code>配置文件中<code>custom_file_path:</code>下的<code>#style: source/_data/variables.styl</code>#号去掉，如下</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="comment">#head: source/_data/head.njk</span></span><br><span class="line">  <span class="comment">#header: source/_data/header.njk</span></span><br><span class="line">  <span class="comment">#sidebar: source/_data/sidebar.njk</span></span><br><span class="line">  <span class="comment">#postMeta: source/_data/post-meta.njk</span></span><br><span class="line">  <span class="comment">#postBodyEnd: source/_data/post-body-end.njk</span></span><br><span class="line">  <span class="comment">#footer: source/_data/footer.njk</span></span><br><span class="line">  <span class="comment">#bodyEnd: source/_data/body-end.njk</span></span><br><span class="line">  <span class="attr">variable:</span> <span class="string">source/_data/variables.styl</span></span><br><span class="line">  <span class="comment">#mixin: source/_data/mixins.styl</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>

<p>部分微调:</p>
<p>1）侧边栏部分没有圆角</p>
<p>编辑2.6创建的<code>styles.styl</code>文件，添加</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">.site-brand-container</span> &#123;</span><br><span class="line">    <span class="attr">border-radius-inner:</span> <span class="string">20px</span> <span class="string">20px</span> <span class="number">0</span> <span class="number">0</span><span class="string">;</span></span><br><span class="line">    <span class="attr">border-radius:</span> <span class="string">20px</span> <span class="string">20px</span> <span class="number">0</span> <span class="number">0</span><span class="string">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）返回顶部按钮显示为方形</p>
<p>编辑<code>themes\next\source\css\_variables\Gemini.styl</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">$body-bg-color</span>           <span class="string">=</span> <span class="comment">#eee;	# 注释</span></span><br><span class="line"><span class="string">$body-bg-color</span>           <span class="string">=</span> <span class="string">transparent;</span>	<span class="comment"># 新增</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-加载动画速度调整"><a href="#2-8-加载动画速度调整" class="headerlink" title="2.8 加载动画速度调整"></a>2.8 加载动画速度调整</h3><p>页面加载会有段动画，默认比较慢，可以调整</p>
<p>编辑文件<code>themes\next\source\js\motion.js</code>，调整<code>duration</code>的值，默认200，越大越慢，可以调小一些</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">bootstrap: <span class="built_in">function</span>() &#123;</span><br><span class="line">    if (!CONFIG.motion.async) this.queue = [this.queue];</span><br><span class="line">    this<span class="selector-class">.queue</span><span class="selector-class">.forEach</span>(sequence =&gt; &#123;</span><br><span class="line">        const timeline = window<span class="selector-class">.anime</span><span class="selector-class">.timeline</span>(&#123;</span><br><span class="line">            duration: <span class="number">100</span>,	# 调整为<span class="number">100</span></span><br><span class="line">                easing  : <span class="string">&#x27;linear&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        sequence<span class="selector-class">.forEach</span>(item =&gt; &#123;</span><br><span class="line">            if (item<span class="selector-class">.deltaT</span>) timeline<span class="selector-class">.add</span>(item, item<span class="selector-class">.deltaT</span>);</span><br><span class="line">            else timeline<span class="selector-class">.add</span>(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-9-图片点击放大"><a href="#2-9-图片点击放大" class="headerlink" title="2.9 图片点击放大"></a>2.9 图片点击放大</h3><p>修改<code>themes/next/_config.yml</code>配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FancyBox is a tool that offers a nice and elegant way to add zooming functionality for images.</span></span><br><span class="line"><span class="comment"># For more information: https://fancyapps.com/fancybox/</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="2-10-界面透明"><a href="#2-10-界面透明" class="headerlink" title="2.10 界面透明"></a>2.10 界面透明</h3><p>修改<code>source\_data\styles.styl</code>文件，添加</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// 界面透明</span><br><span class="line"><span class="selector-class">.main-inner</span>&#123;</span><br><span class="line">	<span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header-inner</span>&#123;</span><br><span class="line">	<span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">	<span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<h3 id="2-11-mac代码块"><a href="#2-11-mac代码块" class="headerlink" title="2.11 mac代码块"></a>2.11 mac代码块</h3><p>修改hexo的<code>_config.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>	<span class="comment"># 开启highlight渲染引擎</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_detect:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hljs:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">prismjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span>	<span class="comment"># 关闭prismjs渲染引擎</span></span><br><span class="line">  <span class="attr">preprocess:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>修改<code>themes/next/_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="comment"># Code Highlight theme</span></span><br><span class="line">  <span class="comment"># All available themes: https://theme-next.js.org/highlight/</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">a11y-dark</span>	<span class="comment"># 选用highlight引擎，并启用a11y-dark风格</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">stackoverflow-dark</span></span><br><span class="line">  <span class="attr">prism:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">docco</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">prism-dark</span></span><br><span class="line">  <span class="comment"># Add copy button on codeblock</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Available values: default | flat | mac</span></span><br><span class="line">    <span class="attr">style:</span> <span class="string">mac</span>	<span class="comment"># 启用mac风格</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/../../img/image-20220720150943450.png" alt="image-20220720150943450"></p>
<h3 id="2-12-添加回到顶部按钮-小猫"><a href="#2-12-添加回到顶部按钮-小猫" class="headerlink" title="2.12 添加回到顶部按钮-小猫"></a>2.12 添加回到顶部按钮-小猫</h3><p>将小猫图片放到<code>themes/next/source/images</code>中</p>
<p>编辑2.6创建的<code>styles.styl</code>文件，添加</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//自定义回到顶部样式</span><br><span class="line"><span class="selector-class">.back-to-top</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70px</span>;  //图片素材宽度</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">900px</span>;  //图片素材高度</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">900px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: unset;</span><br><span class="line">  <span class="attribute">transition</span>: all .<span class="number">5s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;/images/scroll.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">  //隐藏箭头图标</span><br><span class="line">  &gt; <span class="selector-tag">i</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.back-to-top-on</span> &#123;</span><br><span class="line">    <span class="attribute">bottom</span>: unset;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100vh</span> &lt; (<span class="number">900px</span> + <span class="number">200px</span>) ? <span class="built_in">calc</span>( <span class="number">100vh</span> - <span class="number">900px</span> - <span class="number">200px</span> ) : <span class="number">0px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编辑<code>themes/next/_config.yml</code>文件，打开返回顶部按钮开关</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">back2top:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>	<span class="comment"># 改为true打开</span></span><br><span class="line">  <span class="comment"># Back to top in sidebar.</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Scroll percent label in b2t button.</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>博客维护</category>
      </categories>
  </entry>
  <entry>
    <title></title>
    <url>/2022/07/18/04_%E6%9D%82%E8%AE%B0/Githubio%E5%A6%82%E4%BD%95%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</url>
    <content><![CDATA[<h2 id="1-获取原地址IP"><a href="#1-获取原地址IP" class="headerlink" title="1 获取原地址IP"></a>1 获取原地址IP</h2><p>通过ping获取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@3yserver ~]# ping gsproj.github.io</span><br><span class="line">PING gsproj.github.io (185.199.110.153) 56(84) bytes of data.</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=1 ttl=54 time=36.1 ms</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=2 ttl=54 time=36.0 ms</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=3 ttl=54 time=35.9 ms</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=4 ttl=54 time=35.9 ms</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=5 ttl=54 time=38.3 ms</span><br><span class="line">64 bytes from cdn-185-199-110-153.github.com (185.199.110.153): icmp_seq=6 ttl=54 time=36.1 ms</span><br></pre></td></tr></table></figure>

<h2 id="2-在CDN将IP地址和域名绑定"><a href="#2-在CDN将IP地址和域名绑定" class="headerlink" title="2 在CDN将IP地址和域名绑定"></a>2 在CDN将IP地址和域名绑定</h2><p><img src="/../../img/image-20220718111616313.png" alt="image-20220718111616313"></p>
<h2 id="3-域名申请网站填写DNS解析地址"><a href="#3-域名申请网站填写DNS解析地址" class="headerlink" title="3 域名申请网站填写DNS解析地址"></a>3 域名申请网站填写DNS解析地址</h2><p><img src="/../../img/image-20220718112050165.png" alt="image-20220718112050165"></p>
<h2 id="3-确保新域名能ping通，解析正常"><a href="#3-确保新域名能ping通，解析正常" class="headerlink" title="3 确保新域名能ping通，解析正常"></a>3 确保新域名能ping通，解析正常</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@3yserver ~]# ping codefish.cf</span><br><span class="line">PING codefish.cf (104.21.96.42) 56(84) bytes of data.</span><br><span class="line">64 bytes from 104.21.96.42 (104.21.96.42): icmp_seq=1 ttl=59 time=2.63 ms</span><br><span class="line">64 bytes from 104.21.96.42 (104.21.96.42): icmp_seq=2 ttl=59 time=2.64 ms</span><br><span class="line">64 bytes from 104.21.96.42 (104.21.96.42): icmp_seq=3 ttl=59 time=2.73 ms</span><br><span class="line">64 bytes from 104.21.96.42 (104.21.96.42): icmp_seq=4 ttl=59 time=2.71 ms</span><br><span class="line">64 bytes from 104.21.96.42 (104.21.96.42): icmp_seq=5 ttl=59 time=2.62 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS: 此处IP不是185开头的IP，是因为cloudflare做了代理，不影响使用，可以通就可以</p>
</blockquote>
<h2 id="4-在Github添加域名"><a href="#4-在Github添加域名" class="headerlink" title="4 在Github添加域名"></a>4 在Github添加域名</h2><p><img src="/../../img/image-20220718111923212.png" alt="image-20220718111923212"></p>
]]></content>
  </entry>
  <entry>
    <title>KylinV10 桌面版SVN搭建</title>
    <url>/2022/07/11/04_%E6%9D%82%E8%AE%B0/SVN%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="一、服务端配置"><a href="#一、服务端配置" class="headerlink" title="一、服务端配置"></a>一、服务端配置</h2><h3 id="1-1-安装SVN"><a href="#1-1-安装SVN" class="headerlink" title="1.1 安装SVN"></a>1.1 安装SVN</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install subversion</span><br></pre></td></tr></table></figure>

<h3 id="1-2-新建仓库文件夹"><a href="#1-2-新建仓库文件夹" class="headerlink" title="1.2 新建仓库文件夹"></a>1.2 新建仓库文件夹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建项目仓库文件夹</span></span><br><span class="line">mkdir /data/svn/project</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改文件夹权限</span></span><br><span class="line">chmod -R 777 /data/svn/project</span><br></pre></td></tr></table></figure>

<h3 id="1-3-创建版本库"><a href="#1-3-创建版本库" class="headerlink" title="1.3 创建版本库"></a>1.3 创建版本库</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">svnadmin create /data/svn/project</span><br></pre></td></tr></table></figure>

<p>完成后会在文件夹中生成一系列文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">greatwall@greatwall-GW-001M1A-FTF:/data/svn/project$ ls</span><br><span class="line">conf  db  format  hooks  locks  README.txt</span><br></pre></td></tr></table></figure>

<p>修改db权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod -R 777 db</span><br></pre></td></tr></table></figure>

<h3 id="1-4-设置访问权限"><a href="#1-4-设置访问权限" class="headerlink" title="1.4 设置访问权限"></a>1.4 设置访问权限</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /data/svn/project/conf/svnserve.conf</span><br></pre></td></tr></table></figure>

<p>做如下修改</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">greatwall@greatwall-GW-001M1A-FTF:/data/svn/project/conf$ cat svnserve.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This file controls the configuration of the svnserve daemon, if you</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## use it to allow access to this repository.  (If you only allow</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## access through http: and/or file: URLs, then this file is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## irrelevant.)</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Visit http://subversion.apache.org/ for more information.</span></span></span><br><span class="line"></span><br><span class="line">[general]</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The anon-access and auth-access options control access to the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## repository for unauthenticated (a.k.a. anonymous) users and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## authenticated users, respectively.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Valid values are &quot;write&quot;, &quot;read&quot;, and &quot;none&quot;.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Setting the value to &quot;none&quot; prohibits both reading and writing;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## &quot;read&quot; allows read-only access, and &quot;write&quot; allows complete</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## read/write access to the repository.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The sample settings below are the defaults and specify that anonymous</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## users have read-only access to the repository, while authenticated</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## users have read and write access to the repository.</span></span></span><br><span class="line">anon-access = none	# 非认证用户不让写</span><br><span class="line">auth-access = write</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The password-db option controls the location of the password</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## database file.  Unless you specify a path starting with a /,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## the file&#x27;s location is relative to the directory containing</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## this configuration file.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## If SASL is enabled (see below), this file will NOT be used.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Uncomment the line below to use the default password file.</span></span></span><br><span class="line">password-db = passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The authz-db option controls the location of the authorization</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## rules for path-based access control.  Unless you specify a path</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## starting with a /, the file&#x27;s location is relative to the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## directory containing this file.  The specified path may be a</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## repository relative URL (^/) or an absolute file:// URL to a text</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## file in a Subversion repository.  If you don&#x27;t specify an authz-db,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## no path-based access control is done.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Uncomment the line below to use the default authorization file.</span></span></span><br><span class="line">authz-db = authz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The groups-db option controls the location of the groups file.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Unless you specify a path starting with a /, the file&#x27;s location is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## relative to the directory containing this file.  The specified path</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## may be a repository relative URL (^/) or an absolute file:// URL to a</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## text file in a Subversion repository.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> groups-db = groups</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This option specifies the authentication realm of the repository.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## If two repositories have the same authentication realm, they should</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## have the same password database, and vice versa.  The default realm</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## is repository&#x27;s uuid.</span></span></span><br><span class="line">realm = My First Repository</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The force-username-case option causes svnserve to case-normalize</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## usernames before comparing them against the authorization rules in the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## authz-db file configured above.  Valid values are &quot;upper&quot; (to upper-</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## case the usernames), &quot;lower&quot; (to lowercase the usernames), and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## &quot;none&quot; (to compare usernames as-is without case conversion, which</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## is the default behavior).</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> force-username-case = none</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The hooks-env options specifies a path to the hook script environment</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## configuration file. This option overrides the per-repository default</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## and can be used to configure the hook script environment for multiple</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## repositories in a single file, if an absolute path is specified.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Unless you specify an absolute path, the file&#x27;s location is relative</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## to the directory containing this file.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hooks-env = hooks-env</span></span><br><span class="line"></span><br><span class="line">[sasl]</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This option specifies whether you want to use the Cyrus SASL</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## library for authentication. Default is false.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This section will be ignored if svnserve is not built with Cyrus</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## SASL support; to check, run &#x27;svnserve --version&#x27; and look for a line</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## reading &#x27;Cyrus SASL authentication is available.&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use-sasl = <span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## These options specify the desired strength of the security layer</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## that you want SASL to provide. 0 means no encryption, 1 means</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## integrity-checking only, values larger than 1 are correlated</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## to the effective key length for encryption (e.g. 128 means 128-bit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## encryption). The values below are the defaults.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-encryption = 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> max-encryption = 256</span></span><br></pre></td></tr></table></figure>

<h3 id="1-5-添加访问用户"><a href="#1-5-添加访问用户" class="headerlink" title="1.5 添加访问用户"></a>1.5 添加访问用户</h3><p>修改passwd文件，添加访问用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">greatwall@greatwall-GW-001M1A-FTF:/data/svn/project/conf$ cat passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This file is an example password file for svnserve.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Its format is similar to that of svnserve.conf. As shown in the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## example below it contains one section labelled [users].</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The name and password for each user follow, one account per line.</span></span></span><br><span class="line"></span><br><span class="line">[users]</span><br><span class="line"><span class="meta">#</span><span class="bash"> harry = harryssecret</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sally = sallyssecret</span></span><br><span class="line">admin=mysecret</span><br><span class="line">gs=mysecret</span><br></pre></td></tr></table></figure>

<h3 id="1-6-设置用户权限"><a href="#1-6-设置用户权限" class="headerlink" title="1.6 设置用户权限"></a>1.6 设置用户权限</h3><p>修改authz文件，设置用户权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">greatwall@greatwall-GW-001M1A-FTF:/data/svn/project/conf$ cat authz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## This file is an example authorization file for svnserve.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Its format is identical to that of mod_authz_svn authorization</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## files.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## As shown below each section defines authorizations for the path and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## (optional) repository specified by the section name.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## The authorizations follow. An authorization line can refer to:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - a single user,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - a group of users defined in a special [groups] section,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - an alias defined in a special [aliases] section,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - all authenticated users, using the &#x27;$authenticated&#x27; token,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - only anonymous users, using the &#x27;$anonymous&#x27; token,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  - anyone, using the &#x27;*&#x27; wildcard.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## A match can be inverted by prefixing the rule with &#x27;~&#x27;. Rules can</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## grant read (&#x27;r&#x27;) access, read-write (&#x27;rw&#x27;) access, or no access</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## (&#x27;&#x27;).</span></span></span><br><span class="line"></span><br><span class="line">[aliases]</span><br><span class="line"><span class="meta">#</span><span class="bash"> joe = /C=XZ/ST=Dessert/L=Snake City/O=Snake Oil, Ltd./OU=Research Institute/CN=Joe Average</span></span><br><span class="line"></span><br><span class="line">[groups]</span><br><span class="line"><span class="meta">#</span><span class="bash"> harry_and_sally = harry,sally</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> harry_sally_and_joe = harry,sally,&amp;joe</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> [/foo/bar]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> harry = rw</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> &amp;joe = r</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * =</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> [repository:/baz/fuz]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> @harry_and_sally = rw</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * = r</span></span><br><span class="line"></span><br><span class="line">team1=admin,gs	# 创建用户组</span><br><span class="line"></span><br><span class="line">[/]</span><br><span class="line">@team1 = rw # 用户组权限设置为读写</span><br><span class="line">* = r</span><br></pre></td></tr></table></figure>

<h3 id="1-7-启动服务"><a href="#1-7-启动服务" class="headerlink" title="1.7 启动服务"></a>1.7 启动服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">svnserve -d -r /data/svn</span><br></pre></td></tr></table></figure>

<p>查看服务是否在运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps aux | grep svnserve</span><br></pre></td></tr></table></figure>

<p>干掉服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">killall svnserve</span><br></pre></td></tr></table></figure>

<h2 id="二、客户端连接"><a href="#二、客户端连接" class="headerlink" title="二、客户端连接"></a>二、客户端连接</h2><p>svn:&#x2F;&#x2F;10.47.76.90&#x2F;project</p>
]]></content>
      <categories>
        <category>杂记</category>
      </categories>
  </entry>
  <entry>
    <title>Oracle VPS部署V2Ray</title>
    <url>/2022/07/15/04_%E6%9D%82%E8%AE%B0/%E7%94%B2%E9%AA%A8%E6%96%87VPS%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90/</url>
    <content><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h2><p>​	本文介绍如何使用甲骨文（Oracle）的免费VPS部署V2Ray</p>
<p>甲骨文服务器申请地址：</p>
<p><a href="https://www.oracle.com/cloud/free/">https://www.oracle.com/cloud/free/</a></p>
<blockquote>
<p>c7 &#x2F; 7q &#x2F; F+</p>
</blockquote>
<h2 id="2-域名申请"><a href="#2-域名申请" class="headerlink" title="2 域名申请"></a>2 域名申请</h2><p><font color='red'><strong>！！本节使用Firefox浏览器操作！！</strong></font></p>
<h3 id="2-1-Firefox浏览器Gooreplacer插件设置"><a href="#2-1-Firefox浏览器Gooreplacer插件设置" class="headerlink" title="2.1 Firefox浏览器Gooreplacer插件设置"></a>2.1 Firefox浏览器Gooreplacer插件设置</h3><blockquote>
<p>防止freenom在订单提交阶段失败</p>
</blockquote>
<p>安装完插件后，点击“配置规则”</p>
<p><img src="/../../img/image-20220715144835831.png" alt="image-20220715144835831"></p>
<p>规则配置</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">重定向填写：</span><br><span class="line">https://www.google.com/recaptcha</span><br><span class="line">目标地址填写：</span><br><span class="line">https://www.recaptcha.net/recaptcha</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/image-20220715145007138.png" alt="image-20220715145007138"></p>
<h3 id="2-2-freenom域名申请"><a href="#2-2-freenom域名申请" class="headerlink" title="2.2 freenom域名申请"></a>2.2 freenom域名申请</h3><blockquote>
<p>freenom可以申请免费的域名，申请地址：</p>
<p><a href="https://www.freenom.com/en/index.html">https://www.freenom.com/en/index.html</a></p>
</blockquote>
<ul>
<li><p>登录，选择”注册一个新域名”<img src="/../../img/image-20220715145353695.png" alt="image-20220715145353695"></p>
</li>
<li><p>输入需要注册的域名名</p>
</li>
</ul>
<p><img src="/../../img/image-20220715145306545.png" alt="image-20220715145306545"></p>
<ul>
<li>选择免费域名，加入购物车</li>
</ul>
<p><img src="/../../img/image-20220715145556778.png" alt="image-20220715145556778"></p>
<ul>
<li>期限修改为12个月</li>
</ul>
<p><img src="/../../img/image-20220715145640940.png" alt="image-20220715145640940"></p>
<ul>
<li>勾选允许协议，点击完成</li>
</ul>
<p><img src="/../../img/image-20220715145722733.png" alt="image-20220715145722733"></p>
<ul>
<li>看到此界面，说明申请成功，如果申请失败，回到2.1检查Gooreplacer插件是否配置正常</li>
</ul>
<p><img src="/../../img/image-20220715145825655.png" alt="image-20220715145825655"></p>
<ul>
<li>查看我的域名</li>
</ul>
<p><img src="/../../img/image-20220715150619814.png" alt="image-20220715150619814"></p>
<ul>
<li><p>设置域名</p>
<p><img src="/../../img/image-20220715150723654.png" alt="image-20220715150723654"></p>
</li>
<li><p>添加域名解析</p>
</li>
</ul>
<p><img src="/../../img/image-20220715150801833.png" alt="image-20220715150801833"></p>
<ul>
<li><p>填写域名解析服务器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PAITYN.NS.CLOUDFLARE.COM</span><br><span class="line">SYEEF.NS.CLOUDFLARE.COM</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/../../img/image-20220715150832903.png" alt="image-20220715150832903"></p>
<h2 id="3-域名解析配置（CDN）"><a href="#3-域名解析配置（CDN）" class="headerlink" title="3 域名解析配置（CDN）"></a>3 域名解析配置（CDN）</h2><blockquote>
<p>这里使用cloudflare</p>
</blockquote>
<p>添加站点</p>
<p><img src="/../../img/image-20220715151303012.png" alt="image-20220715151303012"></p>
<p>选择免费的方案</p>
<p><img src="/../../img/image-20220715151454194.png" alt="image-20220715151454194"></p>
<p>添加VPS服务器地址</p>
<p><img src="/../../img/image-20220715151735023.png" alt="image-20220715151735023"></p>
<p>校验服务器是否生效：</p>
<blockquote>
<p>解析的IP不一致，是因为勾选了”代理“，不影响正常使用</p>
</blockquote>
<p><img src="/../../img/image-20220715151954505.png" alt="image-20220715151954505"></p>
<h2 id="4-VPS部署V2Ray"><a href="#4-VPS部署V2Ray" class="headerlink" title="4 VPS部署V2Ray"></a>4 VPS部署V2Ray</h2><blockquote>
<p>参考：<a href="https://www.ioiox.com/archives/99.html">https://www.ioiox.com/archives/99.html</a></p>
</blockquote>
<h3 id="4-1-系统设置"><a href="#4-1-系统设置" class="headerlink" title="4.1 系统设置"></a>4.1 系统设置</h3><h4 id="SSH服务"><a href="#SSH服务" class="headerlink" title="SSH服务"></a>SSH服务</h4><p>切换至root创建密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换至 root 账号</span></span><br><span class="line">passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改密码</span></span><br></pre></td></tr></table></figure>

<p>修改ssh配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑 sshd_config</span></span><br><span class="line"></span><br><span class="line">添加或修改Port 22222以确保SSH端口安全.</span><br><span class="line">查找到#PermitRootLogin yes,去掉#注释符号.</span><br><span class="line">查找到#PasswordAuthentication yes,去掉#注释符号.</span><br><span class="line">查找到#ClientAliveInterval 0,去掉#注释符号,0改为30.</span><br><span class="line">查找到#MaxSessions 10,去掉#注释符号.</span><br></pre></td></tr></table></figure>

<p>重启ssh服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart sshd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启 sshd 生效</span></span><br></pre></td></tr></table></figure>

<h4 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h4><p>关闭防火墙</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><blockquote>
<p>甲骨文云的<code>CentOS 7</code>在使用<code>hostnamectl set-hostname</code>命令修改主机名时,重启服务器后依旧会恢复为 Web 端创建实例时所设置的名字.网上查找了各种方法都无效,最终找到了解决方案.</p>
</blockquote>
<p>编辑修改<code>oci-hostname.conf</code>文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/oci-hostname.conf</span><br></pre></td></tr></table></figure>

<p>将<code>PRESERVE_HOSTINFO=0</code>中的的值<code>0</code>修改为<code>1</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This configuration file controls the hostname persistence behavior <span class="keyword">for</span> Oracle Linux</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> compute instance on Oracle Cloud Infrastructure (formerly Baremetal Cloud Services)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set PRESERVE_HOSTINFO to one of the following values</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   0 -- default behavior to update hostname, /etc/hosts and /etc/resolv.conf to</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">        reflect the hostname <span class="built_in">set</span> during instance creation from the metadata service</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   1 -- preserve user configured hostname across reboots; update /etc/hosts and</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">           /etc/resolv.conf from the metadata service</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash">   2 -- preserve user configured hostname across instance reboots; no custom</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash">        changes to /etc/hosts and /etc/resolv.conf from the metadata service,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        but dhclient will still overwrite /etc/resolv.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   3 -- preserve hostname and /etc/hosts entries across instance reboots;</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">        update /etc/resolv.conf from instance metadata service</span></span><br><span class="line">PRESERVE_HOSTINFO=0</span><br></pre></td></tr></table></figure>

<p>使用<code>hostnamectl set-hostname</code>命令修改主机名即可.重启也不会失效.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hostnamectl set-hostname xxxxxx</span><br></pre></td></tr></table></figure>

<h4 id="卸载相关程序"><a href="#卸载相关程序" class="headerlink" title="卸载相关程序"></a>卸载相关程序</h4><h5 id="rpcbind"><a href="#rpcbind" class="headerlink" title="rpcbind"></a>rpcbind</h5><p>使用<code>netstat -ntlp</code>命令发现<code>rpcbind</code>监听了<code>111</code>端口,如担心安全可执行以下命令卸载禁用:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop rpcbind</span><br><span class="line">systemctl stop rpcbind.socket</span><br><span class="line">systemctl disable rpcbind</span><br><span class="line">systemctl disable rpcbind.socket </span><br></pre></td></tr></table></figure>

<h5 id="oracle-cloud-agent"><a href="#oracle-cloud-agent" class="headerlink" title="oracle-cloud-agent"></a>oracle-cloud-agent</h5><p>卸载甲骨文云官方后台监控程序</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop oracle-cloud-agent</span><br><span class="line">systemctl disable oracle-cloud-agent</span><br><span class="line">systemctl stop oracle-cloud-agent-updater</span><br><span class="line">systemctl disable oracle-cloud-agent-updater</span><br></pre></td></tr></table></figure>



<h3 id="4-2-安装BBRPlus"><a href="#4-2-安装BBRPlus" class="headerlink" title="4.2 安装BBRPlus"></a>4.2 安装BBRPlus</h3><blockquote>
<p>参考：<a href="https://www.ioiox.com/archives/63.html">https://www.ioiox.com/archives/63.html</a></p>
<p>Oracle VPS部署BBR，按普通的方式安装，将导致BBR安装并重启机器后，服务器失联，需要安装特定的内核，并作一些列设置</p>
</blockquote>
<h4 id="升级内核"><a href="#升级内核" class="headerlink" title="升级内核"></a>升级内核</h4><p>更新 yum</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure>

<p>查看内核</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -r</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内核版本 3.10.0-1062.12.1.el7.x86_64</span></span><br></pre></td></tr></table></figure>

<p>手动下载<code>秋水 BBRPlus</code>版内核</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/bbrplus/centos/7/kernel-4.14.129-bbrplus.rpm</span><br></pre></td></tr></table></figure>

<p>手动安装内核</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install kernel-4.14.129-bbrplus.rpm</span><br></pre></td></tr></table></figure>

<p>更新引导</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line">grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span><br></pre></td></tr></table></figure>

<p>列出系统开机启动项</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo awk -F\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#x27; /boot/efi/EFI/centos/grub.cfg</span><br></pre></td></tr></table></figure>

<p>设置新版内核默认启动项</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grub2-set-default 0</span><br></pre></td></tr></table></figure>

<p>重启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h4 id="开启-BBRPlus-及优化"><a href="#开启-BBRPlus-及优化" class="headerlink" title="开启 BBRPlus 及优化"></a>开启 BBRPlus 及优化</h4><p>秋水一键脚本,选择<code>7</code>开启<code>BBRPlus</code>加速.<br>再次<code>./tcp.sh</code>运行脚本,选择<code>10</code>优化并重启完成.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -N --no-check-certificate &quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot; &amp;&amp; chmod +x tcp.sh &amp;&amp; ./tc</span><br></pre></td></tr></table></figure>



<h3 id="4-3-安装V2Ray"><a href="#4-3-安装V2Ray" class="headerlink" title="4.3 安装V2Ray"></a>4.3 安装V2Ray</h3><p>在梯子服务器，执行一键搭建脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash &lt;(curl -sL https://gist.githubusercontent.com/JodenHe/815dd91277b722d36a860d39c2296083/raw/7f2b5ac0f8137b245d44741fc4a9f40cffa36755/v2Ray-install.sh)</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/image-20220715155109519.png" alt="image-20220715155109519"></p>
<p>BBR已经安装过，这里选n （笔者第一次在这选y直接安装BBR，结果服务器重启后失联，没法登录，后采用4.2小节的方式，先安装BBRPlus）</p>
<p><img src="/../../img/image-20220715155122886.png" alt="image-20220715155122886"></p>
<p>安装成功，可以使用链接配置V2RayN</p>
<p><img src="/../../img/image-20220715155230097.png" alt="image-20220715155230097"></p>
<h2 id="5-v2Ray-客户端"><a href="#5-v2Ray-客户端" class="headerlink" title="5 v2Ray 客户端"></a>5 v2Ray 客户端</h2><p>参考：<a href="https://tlanyan.pp.ua/v2ray-clients-download/">https://tlanyan.pp.ua/v2ray-clients-download/</a></p>
<p>笔者使用的windows客户端为：<code>V2rayN</code>, 安卓客户端为：<code>V2rayNG</code></p>
<h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6 参考"></a>6 参考</h2><p><a href="https://toutyrater.github.io/">https://toutyrater.github.io/</a></p>
<p><a href="https://tlanyan.pp.ua/v2ray-clients-download/">https://tlanyan.pp.ua/v2ray-clients-download/</a></p>
<p><a href="https://baijiahao.baidu.com/s?id=1689185764130254565&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1689185764130254565&amp;wfr=spider&amp;for=pc</a></p>
<p><a href="https://www.ioiox.com/archives/99.html">https://www.ioiox.com/archives/99.html</a></p>
<p><a href="https://blog.joden123.top/2022/02/20/proxy/v2ray-install/">https://blog.joden123.top/2022/02/20/proxy/v2ray-install/</a></p>
]]></content>
      <categories>
        <category>杂记</category>
      </categories>
  </entry>
  <entry>
    <title>长城TD120A2安装OpenEuler</title>
    <url>/2022/07/11/04_%E6%9D%82%E8%AE%B0/%E9%95%BF%E5%9F%8ETD120A2%E5%AE%89%E8%A3%85OpenEuler/</url>
    <content><![CDATA[<blockquote>
<p>记录安装过程</p>
</blockquote>
<h3 id="一、环境"><a href="#一、环境" class="headerlink" title="一、环境"></a>一、环境</h3><table>
<thead>
<tr>
<th></th>
<th>型号</th>
</tr>
</thead>
<tbody><tr>
<td>CPU</td>
<td>飞腾D2000&#x2F;8核</td>
</tr>
<tr>
<td>内存</td>
<td>紫光DDR4 3200</td>
</tr>
<tr>
<td>显卡</td>
<td>AMD RX520</td>
</tr>
<tr>
<td>安装系统</td>
<td>OpenEuler 20.09</td>
</tr>
</tbody></table>
<h3 id="二、OpenEuler安装"><a href="#二、OpenEuler安装" class="headerlink" title="二、OpenEuler安装"></a>二、OpenEuler安装</h3><p>1、镜像准备：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openEuler-20.09-aarch64-dvd.iso</span><br></pre></td></tr></table></figure>

<p>2、制作启动盘</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">使用win32diskimager制作U盘启动器</span><br></pre></td></tr></table></figure>

<p>3、安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">进入安装界面：</span><br><span class="line">Install openEuler 20.09...</span><br><span class="line">Test this media &amp; install openEuler 20.09...</span><br><span class="line">Troubleshooting</span><br><span class="line"></span><br><span class="line">选择到Install openEuler 20.09...行</span><br><span class="line">Ctrl + e 进入编辑界面</span><br><span class="line">删除&quot;video=efifb:off&quot;</span><br><span class="line">Ctrl + x 保存并退出，进入图形化安装界面</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么要删除此grub参数？ —直接安装将卡在此界面</p>
<p>EFI stub: Booting Linux Kernel…</p>
<p>EFI stub: EFI_RNG_PROTOCOL unavaliable, no randomness supplied</p>
<p>EFI stub: Using DTB from configuration table</p>
<p>EFT stub: Exiting boot services and installing virtual address map…</p>
</blockquote>
<p>4、启动系统</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">进入系统后，修改/boot/efi/EFI/openEuler/grub.cfg文件</span><br><span class="line">同样，将&quot;video=efifb:off&quot;注释或者删除</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;防止重启卡在引导界面</span></span><br></pre></td></tr></table></figure>

<p>5、无线网卡连接wifi</p>
<blockquote>
<p>TD120A2安装OpenEuler后,有线网卡无法识别，需要安装USB无线网卡，并安装配套的驱动，无线网卡识别后可以连接wifi</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmcli dev wifi # 查询wifi</span><br><span class="line">nmcli dev wifi connet 网络名 password 密码</span><br></pre></td></tr></table></figure>

<p>6、图形化界面安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo dnf makecache</span><br><span class="line">sudo dnf groupinstall ukui</span><br><span class="line">systemctl set-default graphical</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>杂记</category>
      </categories>
  </entry>
  <entry>
    <title>国产化POC测试工具使用指南</title>
    <url>/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="一、性能测试"><a href="#一、性能测试" class="headerlink" title="一、性能测试"></a>一、性能测试</h1><blockquote>
<p>测试台式机&#x2F;笔记本的软硬件性能</p>
</blockquote>
<h2 id="1-开机时间"><a href="#1-开机时间" class="headerlink" title="1 开机时间"></a>1 开机时间</h2><blockquote>
<p>测试整机启动的时间（从按下电源开始计时，到出现登录界面计时结束）</p>
</blockquote>
<p>测试步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">手机计时</span><br><span class="line">从按下电源的一刻到进入系统的时间</span><br></pre></td></tr></table></figure>



<h2 id="2-CPU性能测试（整型-x2F-浮点型）"><a href="#2-CPU性能测试（整型-x2F-浮点型）" class="headerlink" title="2 CPU性能测试（整型&#x2F;浮点型）"></a>2 CPU性能测试（整型&#x2F;浮点型）</h2><blockquote>
<p>测试CPU整型计算性能，包括单线程基准值、满线程基准值</p>
<p>测试CPU浮点计算性能，包括单线程基准值、满线程基准值</p>
</blockquote>
<h3 id="2-1-CPU2006"><a href="#2-1-CPU2006" class="headerlink" title="2.1 CPU2006"></a>2.1 CPU2006</h3><blockquote>
<p>测试环境:</p>
<p>​	CPU：飞腾D2000</p>
<p>​	内存：16G</p>
<p>​	系统：麒麟V10-SP1-2107 桌面操作系统</p>
</blockquote>
<p>1、准备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">测试工具包：</span><br><span class="line">d2000-spec2006test.tar.gz</span><br></pre></td></tr></table></figure>

<p>2、测试步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、把下载好的d2000-spec2006test.tar.gz测试包放到根目录下（建议整机内存≥16GB，否则会影响测试跑分）</span><br><span class="line"><span class="meta">#</span><span class="bash">如果不知道如何放到根目录下，可以先把d2000-spec2006test.tar.gz这个包放到桌面，然后点击鼠标右键打开终端，sudo su ，然后输入密码进入root权限，然后输入cp -r d2000-spec2006test.tar.gz /  ，这样就复制到了根目录下。</span> </span><br><span class="line">2、cd / ，进入根目录，sudo su ，然后输入密码，进入root权限。</span><br><span class="line">3、解压，tar -xvf d2000-spec2006test.tar.gz</span><br><span class="line">4、更改权限，chmod -R 777 cpu2006-1.2</span><br><span class="line">5、进入spec2006目录，cd cpu2006-1.2</span><br><span class="line">6、执行脚本，bash run.sh   #配置依赖环境，！！需要联网，会自动下载部分依赖！！</span><br><span class="line">7、source /etc/profile  #更新profile文件,此处一定要更新</span><br><span class="line">8、source ./shrc    #配置环境变量	</span><br><span class="line">9、ulimit -s unlimited #内存分配无限制，大于或者等于16G内存的机器可以加此命令，如果是8G内存的机器不要运行此命令，会因内存不够用影响整型测试的429测试项</span><br><span class="line">10、echo 3 &gt; /proc/sys/vm/drop_caches   #执行测试前，建议清一下缓存</span><br><span class="line">11、gcc -v   #测试前查看一下gcc的版本是否为GCC931,若不是GCC931，输入source /etc/profile， 再gcc -v查看版本，是GCC931即可执行第12步启动测试</span><br><span class="line">12、bash d2000-test.sh  #执行8核、单核的整形和浮点测试</span><br></pre></td></tr></table></figure>

<p>3、结果查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PDF测试结果存放在results文件夹</span><br></pre></td></tr></table></figure>

<p>4、编译问题处理（如遇到编译问题，可参考）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 450报错：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mpsinput.cc: In member <span class="keyword">function</span> <span class="string">&#x27;bool soplex::MPSInput::readLine()&#x27;</span>: mpsinput.cc:75:52: error: no match <span class="keyword">for</span> <span class="string">&#x27;operator==&#x27;</span> (operand types are <span class="string">&#x27;std::basic_istream&lt;char&gt;::__istream_type&#x27;</span> &#123;aka <span class="string">&#x27;std::basic_istream&lt;char&gt;&#x27;</span>&#125; and <span class="string">&#x27;int&#x27;</span>)</span></span><br><span class="line">g++ -std=c++03</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lto1 fatal error bytecode stream generated with lto version</span> </span><br><span class="line">编译选项添加: fno-lto</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决zfnlm问题:</span></span><br><span class="line">actual argument contains too few elements for dummy argument &#x27;zfnlm&#x27;</span><br><span class="line">cfg文件编译选项设置： -std=legacy</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> undefined reference to <span class="string">&#x27;__gcov_exit&#x27;</span></span></span><br><span class="line">-lgcov --coverage</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> glob.c:(.text+0x53c): undefined reference to `__alloca<span class="string">&#x27;</span></span></span><br><span class="line">编辑glob.c文件</span><br><span class="line">修改第54行&quot;==&quot;改为&quot;&gt;=&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> if _GNU_GLOB_INTERFACE_VERSION &gt;= GLOB_INTERFACE_VERSION</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> 2006的题483在v10-sp1-2107跑起来，我干了什么？ 否则老是报错483.xalancbmk  non-zero return code (rc=254, signal=0) XML等</span></span></span><br><span class="line">1、安装统信UOS的GCC8.3.0</span><br><span class="line">2、SPEC2006的工具集重新编译，再安装</span><br><span class="line">3、清除题下面的run/build/exe</span><br><span class="line">4、执行了一次apt-get install gcc?? 不知道有没有影响</span><br><span class="line">5、放到没有中文的路径/home/gretwall/cpu2006</span><br><span class="line">6、使用普通用户greatwall执行</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> 416报错</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、测试项说明</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source shrc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 多核测试（8）</span></span><br><span class="line">runspec -c greatwall.cfg -r 8 -n 1 -i ref -T base -I all</span><br><span class="line">选项解析：</span><br><span class="line">	-c # 指定config/中的配置文件</span><br><span class="line">	-r # --rate的缩写，跑rate测试，指定测试的副本数（Copies）</span><br><span class="line">	--speed # 指定跑speed测试，和测试副本数（Copies）（默认跑speed测试）</span><br><span class="line">	-n # 指定测试的次数	</span><br><span class="line">	-i（-size） # 指定测试的规模，由小到大为test/train/ref,其中test最快，适合用来验证CPU的完整性，跑分要用ref</span><br><span class="line">	--reportable / --noreportable # 表示检测/不检测生成的二进制文件是否修改过</span><br><span class="line">	--action=build	# 只编译，不测试</span><br><span class="line">	--rebuild	# 重新编译选题的二进制文件</span><br><span class="line">	--tune（-T） # 可选peak / base / all，默认跑all</span><br><span class="line">	最后的参数	# int-(int选题) / fp-(fp选题) / all-(所有选题) / 单个选题-（如483） </span><br></pre></td></tr></table></figure>

<p>5、去除PDF报告的Invalid标记</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp CINT2006.559.ref.rsf CINT2006.559.ref.rsf.retry</span><br><span class="line">rawformat --flagsurl myfixedflags.xml --output_format pdf,raw CINT2006.559.ref.rsf.retry</span><br></pre></td></tr></table></figure>



<h3 id="2-2-CPU2017"><a href="#2-2-CPU2017" class="headerlink" title="2.2 CPU2017"></a>2.2 CPU2017</h3><h2 id="3-lmbench测试（用时3小时）"><a href="#3-lmbench测试（用时3小时）" class="headerlink" title="3 lmbench测试（用时3小时）"></a>3 lmbench测试（用时3小时）</h2><blockquote>
<p>测试简单的系统调用时间、shell命令启动时间、系统信号处理时间、统计2p&#x2F;16K的上下文切换性能、16p&#x2F;64K的上下文切换性能、0K&#x2F;10K文件创建时间、0K&#x2F;10K文件删除时间</p>
</blockquote>
<p>源码包准备：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://www.bitmover.com/lmbench/lmbench3.tar.gz</span><br></pre></td></tr></table></figure>

<p>编译前的准备：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xvf lmbench3.tar.gz</span><br><span class="line">cd lmbench3</span><br><span class="line">mkdir SCCS</span><br><span class="line">touch  SCCS/s.ChangeSet</span><br></pre></td></tr></table></figure>

<p>编译并测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make results OS=arch-linux</span><br></pre></td></tr></table></figure>

<p>读取测试结果</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make see</span><br></pre></td></tr></table></figure>

<p>错误：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">报错: undefined reference to &#x27;llseek&#x27;</span><br><span class="line">解决方法:</span><br><span class="line">修改src/disk.c文件</span><br><span class="line">将llseek改为lseek64</span><br></pre></td></tr></table></figure>

<h2 id="4-文件读写测试"><a href="#4-文件读写测试" class="headerlink" title="4 文件读写测试"></a>4 文件读写测试</h2><blockquote>
<p>测试硬盘内文件（10G）拷贝性能，记录时间</p>
</blockquote>
<p>测试步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建10G的大文件</span></span><br><span class="line">dd if=/dev/zero of=big_file count=10 bs=1G</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试拷贝时间</span></span><br><span class="line">time cp big_file  big_file_bak</span><br></pre></td></tr></table></figure>



<h2 id="5-USB存储设备读写性能"><a href="#5-USB存储设备读写性能" class="headerlink" title="5 USB存储设备读写性能"></a>5 USB存储设备读写性能</h2><blockquote>
<p>测试USB存储设备读写性能（Mb&#x2F;s），平均读写速度等</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 可选准备</span></span><br><span class="line">1.将U盘（USB3.0）插入被测试机器,假定识别设备为sdc</span><br><span class="line">2.创建vfat文件系统分区</span><br><span class="line">/dev/sdb1分区容量大于30GB</span><br><span class="line">umount /dev/sdc1</span><br><span class="line">mkfs -t vfat /dev/sdc1</span><br><span class="line">mkdir /upan</span><br><span class="line">mount -t vfat /dev/sdc1 /upan</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试写性能</span></span><br><span class="line">cd /upan</span><br><span class="line">dd if=/dev/zero of=./largefile bs=64k count=10000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试读性能</span></span><br><span class="line">sync &amp;&amp; echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">dd if=./largefile of=/dev/null bs=64k</span><br></pre></td></tr></table></figure>



<h2 id="6-硬盘读写测试-IOZONE-x2F"><a href="#6-硬盘读写测试-IOZONE-x2F" class="headerlink" title="6 硬盘读写测试-IOZONE&#x2F;"></a>6 硬盘读写测试-IOZONE&#x2F;</h2><p>安装步骤：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载源码包</span></span><br><span class="line">wget http://www.iozone.org/src/current/iozone3_487.tar</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压</span></span><br><span class="line">tar -vxf iozone3_487.tar &amp;&amp; cd iozone3_489/src/current</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译</span></span><br><span class="line">make linux</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iozone</span><br><span class="line">    -a 全面测试，比如块大小它会自动加</span><br><span class="line">    -i N 用来选择测试项, 比如Read/Write/Random 比较常用的是0 1 2,可以指定成-i 0 -i 1 -i2.这些别的详细内容请查man</span><br><span class="line">        0=write/rewrite</span><br><span class="line">        1=read/re-read</span><br><span class="line">        2=random-read/write</span><br><span class="line">        3=Read-backwards</span><br><span class="line">        4=Re-write-record</span><br><span class="line">        5=stride-read</span><br><span class="line">        6=fwrite/re-fwrite</span><br><span class="line">        7=fread/Re-fread</span><br><span class="line">        8=random mix</span><br><span class="line">        9=pwrite/Re-pwrite</span><br><span class="line">        10=pread/Re-pread</span><br><span class="line">        11=pwritev/Re-pwritev</span><br><span class="line">    	12=preadv/Re-preadv</span><br><span class="line">    -r block size 指定一次写入/读出的块大小</span><br><span class="line">    -s file size 指定测试文件的大小</span><br><span class="line">    -f filename 指定测试文件的名字,完成后会自动删除(这个文件必须指定你要测试的那个硬盘中)</span><br><span class="line">    -F file1 file2… 指定多线程下测试的文件名</span><br><span class="line">    </span><br><span class="line">    批量测试项:</span><br><span class="line">    -g -n 指定测试文件大小范围,最大测试文件为4G,可以这样写 -g 4G</span><br><span class="line">    -y -q 指定测试块的大小范围</span><br><span class="line">    </span><br><span class="line">    输出:</span><br><span class="line">    下面是几个日志记录的参数.好像要输出成图象进行分析，需要指定-a的测试才能输出</span><br><span class="line">    -R 产生Excel到标准输出</span><br><span class="line">    -b 指定输出到指定文件上. 比如 -Rb ttt.xls</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1、测试硬盘读写性能（Mb&#x2F;s），包括随机和顺序读写平均读写速度（IOzone设置块大小16M，文件大小为物理内存2倍、1倍、1&#x2F;2倍三组数据）</p>
</blockquote>
<p>测试步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要root权限</span></span><br><span class="line">sudo su</span><br><span class="line"><span class="meta">#</span><span class="bash"> 块大小16M，文件大小为物理内存2倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 16g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_16G_0.xls</span><br><span class="line"><span class="meta">#</span><span class="bash"> 块大小16M，文件大小为物理内存1倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 8g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_8G_0.xls</span><br><span class="line"><span class="meta">#</span><span class="bash"> 块大小16M，文件大小为物理内存0.5倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 4g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_4G_0.xls</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、测试数据盘（裸设备）的在块大小为512B、1MB下的读写性能（包括IOPS、带宽和响应时间）</p>
</blockquote>
<h2 id="7-内存读写性能测试-Stream"><a href="#7-内存读写性能测试-Stream" class="headerlink" title="7 内存读写性能测试-Stream"></a>7 内存读写性能测试-Stream</h2><blockquote>
<p>测试单线和并发读写性能（Mb&#x2F;s）</p>
</blockquote>
<p>测试步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装gfortran</span></span><br><span class="line">sudo apt-get install gfortran</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译stream</span></span><br><span class="line">make</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">stream_c 200000000   # 参数为Array大小</span><br></pre></td></tr></table></figure>

<p>多线程测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 单线程编译</span><br><span class="line">gcc -O3 stream.c -o stream</span><br><span class="line"># 多线程编译</span><br><span class="line">gcc -O3 -fopenmp stream.c -o stream.omp</span><br></pre></td></tr></table></figure>

<h2 id="10-操作系统综合性能测试-unixbench（用时1小时）"><a href="#10-操作系统综合性能测试-unixbench（用时1小时）" class="headerlink" title="10 操作系统综合性能测试-unixbench（用时1小时）"></a>10 操作系统综合性能测试-unixbench（用时1小时）</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解压UnixBench工具包：</span></span><br><span class="line">unzip Unixbench-Kylin.zip</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入Unixbench解压后的目录下</span></span><br><span class="line">cd UnixBench</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改Makefile文件74行</span></span><br><span class="line">OPTON = -O3 -fomit-frame-pointer -fforce-addr -ffast-math -Wall -static -flto</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译：</span></span><br><span class="line">sudo make clean &amp;&amp; make</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除缓存：</span></span><br><span class="line">sudo su</span><br><span class="line">sync</span><br><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试单线程和多线程性能，执行命令：</span></span><br><span class="line">sudo ./Run -c 1 -c N</span><br><span class="line">// 其中N代表cpu核数</span><br></pre></td></tr></table></figure>



<h2 id="11-显卡性能测试-unixbench（用时约半小时）"><a href="#11-显卡性能测试-unixbench（用时约半小时）" class="headerlink" title="11 显卡性能测试-unixbench（用时约半小时）"></a>11 显卡性能测试-unixbench（用时约半小时）</h2><blockquote>
<p>1、测试2D显示处理性能，主要包括画点、画线、画三角形、画平行四边形、画正方形、画多边形等性能测试</p>
<p>2、测试3D显示处理性能，主要包括3D的显示、色彩填充、渲染、旋转等性能测试</p>
</blockquote>
<p>编译Unibench</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖</span></span><br><span class="line">apt-get install libgl1-mesa-dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改Makefile文件,防止编译报错</span></span><br><span class="line">vim UnixBench/Makefile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第47行取消注释</span></span><br><span class="line">GRAPHIC_TESTS = defined</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第50行加上-lm</span></span><br><span class="line">GL_LIBS = -lGL -lXext -lX11 -lm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第74行修改</span></span><br><span class="line">OPTON = -O2 -fomit-frame-pointer -fforce-addr -ffast-math -Wall</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改Run文件</span></span><br><span class="line">vim UnixBench/Run</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第109-112行，修改可支持的最大核数，当前是8</span></span><br><span class="line">&#x27;system&#x27;    =&gt; &#123; &#x27;name&#x27; =&gt; &quot;System Benchmarks&quot;, &#x27;maxCopies&#x27; =&gt; 8 &#125;,</span><br><span class="line">&#x27;2d&#x27;        =&gt; &#123; &#x27;name&#x27; =&gt; &quot;2D Graphics Benchmarks&quot;, &#x27;maxCopies&#x27; =&gt; 8 &#125;,</span><br><span class="line">&#x27;3d&#x27;        =&gt; &#123; &#x27;name&#x27; =&gt; &quot;3D Graphics Benchmarks&quot;, &#x27;maxCopies&#x27; =&gt; 8 &#125;,</span><br><span class="line">&#x27;misc&#x27;      =&gt; &#123; &#x27;name&#x27; =&gt; &quot;Non-Index Benchmarks&quot;, &#x27;maxCopies&#x27; =&gt; 8 &#125;,</span><br></pre></td></tr></table></figure>

<p>编译运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make clean &amp;&amp; make -j 8</span><br><span class="line">./Run graphics</span><br></pre></td></tr></table></figure>

<p>3D测试优化</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建文件10-vsync.conf</span></span><br><span class="line">&lt;driconf&gt;</span><br><span class="line">    &lt;option name=&quot;vblank_mode&quot; value=&quot;0&quot; /&gt;</span><br><span class="line">&lt;/driconf&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝文件到指定路径</span></span><br><span class="line">sudo cp 10-vsync.conf  ~/.drirc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行测试</span></span><br><span class="line">vblank_mode=0 ./Run ubgears</span><br></pre></td></tr></table></figure>

<h2 id="11-显卡测试-Glmark2"><a href="#11-显卡测试-Glmark2" class="headerlink" title="11 显卡测试-Glmark2"></a>11 显卡测试-Glmark2</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ./waf configure --with-flavors=x11-gl</span><br><span class="line">sudo ./waf build -j 4</span><br><span class="line">sudo ./waf install</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">glmark2</span><br></pre></td></tr></table></figure>

<h2 id="12-显卡测试-Glxgears"><a href="#12-显卡测试-Glxgears" class="headerlink" title="12 显卡测试-Glxgears"></a>12 显卡测试-Glxgears</h2><p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install mesa-utils</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 终端执行</span></span><br><span class="line">glxgears</span><br></pre></td></tr></table></figure>

<h2 id="12-网络性能测试-Netperf"><a href="#12-网络性能测试-Netperf" class="headerlink" title="12 网络性能测试-Netperf"></a>12 网络性能测试-Netperf</h2><blockquote>
<p>测试网络传输速率、网络吞吐率、网络响应时间等，包括TCP、UDP流吞吐速率等</p>
</blockquote>
]]></content>
      <categories>
        <category>测试</category>
        <category>信创POC测试</category>
      </categories>
      <tags>
        <tag>工作</tag>
      </tags>
  </entry>
  <entry>
    <title>运维之综合架构--01-整体架构规划</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/01-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%A7%84%E5%88%92/</url>
    <content><![CDATA[<h2 id="一-、综合架构规划"><a href="#一-、综合架构规划" class="headerlink" title="一 、综合架构规划"></a>一 、综合架构规划</h2><blockquote>
<p>项目中涵盖了架构，架构中又涵盖了不同的角色（高可用、负载均衡、web集群）<br>五层架构模型–&gt; 负载均衡 web服务 存储服务 缓存服务 数据库服务（通过tcp连接）</p>
</blockquote>
<p><img src="/img/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="综合架构图"></p>
<h3 id="1-架构访问流程"><a href="#1-架构访问流程" class="headerlink" title="1 架构访问流程"></a>1 架构访问流程</h3><h4 id="1-1-用户视角"><a href="#1-1-用户视角" class="headerlink" title="1.1 用户视角"></a>1.1 用户视角</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.用户通过浏览器输入oldboyedu.com-&gt;回车</span><br><span class="line">2.浏览器会发生一次跳转，分析URL-&gt;然后进行DNS解析-&gt;获取真实的公网IP地址</span><br><span class="line">3.用户通过tcp的三次握手发起连接-&gt;真实的公网IP</span><br><span class="line">4.连接会通过公网-&gt;路由器-&gt;交换机-&gt;抵达前端的硬件防火墙</span><br><span class="line">5.防火墙根据自身访问规则，进行匹配-&gt;如果恶意的连接则拒绝-&gt;如果是正常的连接则放行</span><br><span class="line">6.防火墙会将连接转发给负载均衡器-&gt;查看用户请求的内容-&gt;根据内容进行任务下发-&gt;下发给web服务器</span><br><span class="line">7.web服务接收请求后会根据请求进行判断</span><br><span class="line">如果是请求图片或者附件-&gt;查找存储服务器存储的静态资源</span><br><span class="line">如果请求的网站上的内容-&gt;缓存服务器-&gt;如果缓存服务器没有-&gt;数据库</span><br><span class="line">数据库查询完数据之后会返回数据给web服务器-&gt;同时也会返回一份给缓存服务器</span><br><span class="line">8.数据库返回内容-&gt;web服务器-&gt;负载均衡-&gt;用户</span><br></pre></td></tr></table></figure>

<h4 id="1-2-运维视角"><a href="#1-2-运维视角" class="headerlink" title="1.2 运维视角"></a>1.2 运维视角</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.用户通过公网连接（隧道）VPN服务器，这样方便管理内部主机，</span><br><span class="line">2.自动化配置管理，节省人力成本，便于后期维护。统一环境，标准化</span><br><span class="line">3.自动化监控服务，监控系统的运行状态，事前预警，事后追溯。</span><br></pre></td></tr></table></figure>

<h3 id="2-架构环境规划"><a href="#2-架构环境规划" class="headerlink" title="2 架构环境规划"></a>2 架构环境规划</h3><h4 id="2-1-IP分配"><a href="#2-1-IP分配" class="headerlink" title="2.1 IP分配"></a>2.1 IP分配</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> wanip         lanip       hostname</span><br><span class="line">10.0.0.5     172.16.1.5     lb01</span><br><span class="line">10.0.0.6     172.16.1.6     lb02</span><br><span class="line">10.0.0.7     172.16.1.7     web01</span><br><span class="line">10.0.0.8     172.16.1.8     web02</span><br><span class="line">10.0.0.9     172.16.1.9     web03</span><br><span class="line">10.0.0.31    172.16.1.31    nfs</span><br><span class="line">10.0.0.41    172.16.1.41    backup</span><br><span class="line">10.0.0.51    172.16.1.51    db01</span><br><span class="line">10.0.0.61    172.16.1.61    m01</span><br><span class="line">10.0.0.71    172.16.1.71    zabbix</span><br></pre></td></tr></table></figure>

<h4 id="2-2-基础环境准备"><a href="#2-2-基础环境准备" class="headerlink" title="2.2 基础环境准备"></a>2.2 基础环境准备</h4><h5 id="2-2-1-虚拟机系统和网卡准备"><a href="#2-2-1-虚拟机系统和网卡准备" class="headerlink" title="2.2.1 虚拟机系统和网卡准备"></a>2.2.1 虚拟机系统和网卡准备</h5><blockquote>
<p>安装全新Centos7系统，配置网卡为eth0及eth1命名模式<br>1.第一块网卡为NAT模式[公网环境]，配置的网段为10.0.0.0网段<br>2.第二块网卡为LAN模式[私网环境]，配置的网段为172.16.1.0网段<br>3.优化安装好的Centos7虚拟机，安装常用软件、关闭防火墙等等</p>
</blockquote>
<p>优化步骤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.配置yum仓库</span></span><br><span class="line">rm -f /etc/yum.repos.d/*</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.安装基础软件包</span></span><br><span class="line">yum install net-tools vim tree htop iftop \</span><br><span class="line">iotop lrzsz sl wget unzip telnet nmap nc psmisc \</span><br><span class="line">dos2unix bash-completion bash-completion-extra sysstat \</span><br><span class="line">rsync nfs-utils httpd-tools -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.关闭防火墙firewalld</span></span><br><span class="line">systemctl disable firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.关闭selinux</span></span><br><span class="line">sed -i &#x27;/^SELINUX=/c SELINUX=disabled&#x27; /etc/selinux/config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.调整单个进程最大能打开文件的数量</span></span><br><span class="line">echo &#x27;* - nofile 65535&#x27; &gt;&gt; /etc/security/limits.conf</span><br></pre></td></tr></table></figure>

<p>基于优化后的虚拟机进行克隆</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.连接克隆（需要依赖于母体）</span><br><span class="line">2.完整克隆（完完全全的复制一份，占用磁盘空间）</span><br></pre></td></tr></table></figure>

<p>对新克隆的主机进行如下操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.修改主机名</span>  </span><br><span class="line">hostnamectl set-hostname backup</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.修改IP地址</span>  </span><br><span class="line">sed -i &#x27;s#200#41#g&#x27; /etc/sysconfig/network-scripts/ifcfg-eth[01]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.重启服务器</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>测试工具使用说明-完善中</title>
    <url>/2022/07/06/02_%E6%B5%8B%E8%AF%95/02_%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E-%E5%AE%8C%E5%96%84%E4%B8%AD/</url>
    <content><![CDATA[<h1 id="测试工具使用说明-汇总"><a href="#测试工具使用说明-汇总" class="headerlink" title="测试工具使用说明-汇总"></a>测试工具使用说明-汇总</h1><h1 id="一、SPEC-CPU-2017-测试"><a href="#一、SPEC-CPU-2017-测试" class="headerlink" title="一、SPEC CPU 2017 测试"></a>一、SPEC CPU 2017 测试</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>​	标准性能评测机构（SPEC）开发的用于评测CPU性能的基准程序测试组，是一套CPU子系统测试工具。处理器、内存和编译都会影响最终的测试结果，目前SPEC CPU是业界首选的CPU评测工具。 </p>
<h2 id="1-2-工具安装"><a href="#1-2-工具安装" class="headerlink" title="1.2 工具安装"></a>1.2 工具安装</h2><p>获取镜像包：</p>
<p>​	cpu2017-1_0_5.iso</p>
<p>挂载IOS</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount -o loop -t iso9660 cpu2017-1_0_5.iso /xxx/cpu2017CD</span><br></pre></td></tr></table></figure>

<p>安装工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /xxx/cpu2017CD</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<h2 id="1-3-测试步骤"><a href="#1-3-测试步骤" class="headerlink" title="1.3 测试步骤"></a>1.3 测试步骤</h2><p>spec2017主要分为四项测试：</p>
<ul>
<li>​	intrate</li>
<li>​	fprate</li>
<li>​	intspeed</li>
<li>​	fpspeed</li>
</ul>
<p>​	根据需要测试的cpu型号，可以到官网下载相应的cfg文件，修改icc、Jemalloc库、qkmalloc库的路径，放入config文件夹中。</p>
<p>测试命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source shrc</span><br><span class="line">ulimit -s unlimited</span><br><span class="line"><span class="meta">#</span><span class="bash"> speed 测试</span></span><br><span class="line">runcpu --config=icc-speed-official.cfg --threads=48 --define cores=48 -n 3 -i ref fpspeed intspeed</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rate 测试</span></span><br><span class="line">runcpu --config=icc-rate-official.cfg -copies=48 -n 3 -i ref intrate fprate</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 仅编译不跑测试</span></span><br><span class="line">--action=build</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新编译</span></span><br><span class="line">--rebuild</span><br><span class="line"><span class="meta">#</span><span class="bash"> 绑核跑</span></span><br><span class="line">taskset -c </span><br></pre></td></tr></table></figure>

<h2 id="1-4-测试优化"><a href="#1-4-测试优化" class="headerlink" title="1.4 测试优化"></a>1.4 测试优化</h2><blockquote>
<p>Bios设置：</p>
<p>​	开启超线程</p>
<p>​	 尝试开启LLC-PREFETCH</p>
</blockquote>
<h2 id="1-5-其他事项："><a href="#1-5-其他事项：" class="headerlink" title="1.5 其他事项："></a>1.5 其他事项：</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cfg文件中的submit可以设置绑核选项</span><br></pre></td></tr></table></figure>

<h1 id="二、SPEC-CPU-2006-测试"><a href="#二、SPEC-CPU-2006-测试" class="headerlink" title="二、SPEC CPU 2006 测试"></a>二、SPEC CPU 2006 测试</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><p>​	作用同Spec CPU 2017, 近年来逐渐被淘汰</p>
<h2 id="2-2-测试步骤"><a href="#2-2-测试步骤" class="headerlink" title="2.2 测试步骤"></a>2.2 测试步骤</h2><p>1、spec2006.tgz 解压，使用install.sh安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SPEC CPU2006 Installation</span><br><span class="line">Top of the CPU2006 tree is &#x27;/vol8/tarball/cpu2006&#x27;</span><br><span class="line">These appear to be valid toolsets:</span><br><span class="line">ft-spec2006-tool</span><br><span class="line">aarch64-linux</span><br><span class="line">Enter the architecture you are using:</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; aarch64-linux</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source shrc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单核测试</span></span><br><span class="line">runspec -c linux64-arm64-gcc52.cfg -i ref -n 3 -I all </span><br><span class="line"><span class="meta">#</span><span class="bash"> 多核测试（16）</span></span><br><span class="line">runspec -c linux64-arm64-gcc52.cfg -r 16 -n 3 -i ref -I all</span><br></pre></td></tr></table></figure>

<h1 id="三、-SPEC-OMP-2012-测试"><a href="#三、-SPEC-OMP-2012-测试" class="headerlink" title="三、 SPEC OMP 2012 测试"></a>三、 SPEC OMP 2012 测试</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><p>​	基于SPEC测试套件的OpenMP评测工具，其中包含15个基于OpenMP的并行程序。</p>
<h2 id="3-2-工具安装"><a href="#3-2-工具安装" class="headerlink" title="3.2 工具安装"></a>3.2 工具安装</h2><p>​	获取源包：</p>
<p>​		omp2012-1.1.zip</p>
<p>​	解压后使用install.sh安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">./install.sh -d /home/xx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 仅编译</span></span><br><span class="line">runspec --action=build --config=gcc.cfg -i ref -I all</span><br></pre></td></tr></table></figure>

<h2 id="3-3-测试步骤"><a href="#3-3-测试步骤" class="headerlink" title="3.3 测试步骤"></a>3.3 测试步骤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source shrc</span><br><span class="line">ulimit -s unlimited</span><br><span class="line">export OMP_NUM_THREADS=48</span><br><span class="line">runspec --config=gcc.cfg --threads 48 -n 3 -i ref -I all</span><br></pre></td></tr></table></figure>

<h1 id="四、NPB-测试"><a href="#四、NPB-测试" class="headerlink" title="四、NPB 测试"></a>四、NPB 测试</h1><h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h2><p>​	NAS并行基准测试程序（NPB），是由美国航空航天局开发的一套代表流体动力学计算的应用程序集，它已经成为公认的用于测评大规模并行机和超级计算机的标准测试程序。NPB可用于常用的编程模型，如MPI和OpenMP。</p>
<h2 id="4-2-工具安装"><a href="#4-2-工具安装" class="headerlink" title="4.2 工具安装"></a>4.2 工具安装</h2><p>源包获取：</p>
<p>​	NPB3.4.tar.gz         OpenMP || MPICH</p>
<p>​	NPB3.4-MZ.tar.gz  OpenMP &amp;&amp; MPICH</p>
<p>解压即可。</p>
<h2 id="4-3-测试步骤"><a href="#4-3-测试步骤" class="headerlink" title="4.3 测试步骤"></a>4.3 测试步骤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make suite</span><br><span class="line">cd bin</span><br><span class="line">mpirun -np 4 ./xxx</span><br></pre></td></tr></table></figure>

<h1 id="五、Stream-测试"><a href="#五、Stream-测试" class="headerlink" title="五、Stream 测试"></a>五、Stream 测试</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><p>​	STREAM是一套综合性能测试程序集，通过fortran和C两种高级且高效的语言编写完成，由于这两种语言在数学计算方面的高效率， 使得 STREAM 测试例程可以充分发挥出内存的能力。Stream测试是内存测试中业界公认的内存带宽性能测试基准工具。</p>
<h2 id="5-2-工具安装"><a href="#5-2-工具安装" class="headerlink" title="5.2 工具安装"></a>5.2 工具安装</h2><p>源包获取：</p>
<p>​	stream.tgz  刘新娃修改过</p>
<p>​	<font color='red'>Intel平台请用ICC</font></p>
<p>解压后编译stream.c, 生成可执行文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">icc -O3 -fopenmp -DNTIMES=10 -mcmodel=large -o stream_c stream.c</span><br></pre></td></tr></table></figure>

<p>没有修改过的怎么编译呢？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">icc -mtune=native -march=native -O3 -mcmodel=large -fopenmp -DSTREAM_ARRAY_SIZE=100000000 -DNTIMES=30 -DOFFSET=512 stream.c -o stream-gs</span><br></pre></td></tr></table></figure>

<h2 id="5-3-测试步骤"><a href="#5-3-测试步骤" class="headerlink" title="5.3 测试步骤"></a>5.3 测试步骤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export OMP_NUM_THREADS=48/32/16/8/4  # 设置每个进程的线程数</span><br><span class="line">./stream_c 200000 # 使用200G内存</span><br></pre></td></tr></table></figure>

<h2 id="5-4-其他事项"><a href="#5-4-其他事项" class="headerlink" title="5.4 其他事项"></a>5.4 其他事项</h2><blockquote>
<p><code>STREAM_ARRAY_SIZE</code>即<code>N</code>指定计算中a[],b[],c[]三个数组的大小，且数组的值采用了双精度（8个字节）。数组的维数 N定义时需要注意以下几点：</p>
<p>一、要充分考虑内存容量的需求，粗略估计是 N× 8（双精度浮点类型） × 3 （三个数组）&lt;&#x3D; 0.6*M；M 是用户的可用内存。</p>
<p>二、要保证测试过程中，使用到的内存容量要大于处理器内的缓存，只有这样才会有内存的操作，而不仅仅是对处理器内缓存的操作。</p>
<p>三、为了保证测试可以持续一段时间，测试过程中内存带宽可以达到一定的最大值， 从而避免得不到实际最大峰值的情况，如果四项测试中有完成时间小于20微秒的情况，就需要适当的增大测试数组的维度 N。</p>
</blockquote>
<h1 id="六、Linpack-测试"><a href="#六、Linpack-测试" class="headerlink" title="六、Linpack 测试"></a>六、Linpack 测试</h1><h2 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h2><p>​	Linpack是国际上使用最广泛的测试高性能计算机系统浮点性能的基准测试。通过对高性能计算机采用高斯消元法求解一元 N次稠密线性代数方程组的测试，评价高性能计算机的浮点计算性能。Linpack的结果按每秒浮点运算次数（flops）表示。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">N ^ 2 * 8 = 总内存</span><br></pre></td></tr></table></figure>

<h2 id="6-2-工具安装"><a href="#6-2-工具安装" class="headerlink" title="6.2 工具安装"></a>6.2 工具安装</h2><p>源包获取：</p>
<p>​	linpack.tgz</p>
<p>解压即可。</p>
<h2 id="6-3-测试步骤"><a href="#6-3-测试步骤" class="headerlink" title="6.3 测试步骤"></a>6.3 测试步骤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1进48线100G内存</span></span><br><span class="line">./xhpl -n 1 -b 384 -p 1 -q 1 -m 100000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1进48线200G内存</span></span><br><span class="line">./xhpl -n 1 -b 384 -p 1 -q 1 -m 200000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2进24线共100G内存</span></span><br><span class="line">mpirun -n 2 ./xhpl -b 384 -p 1 -q 2 -m 50000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2进24线共200G内存</span></span><br><span class="line">mpirun -n 2 ./xhpl -b 384 -p 1 -q 2 -m 100000</span><br></pre></td></tr></table></figure>

<p>用mpirun提交xhplrun.sh效果更好</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PRO_SIZE=$&#123;PMI_SIZE&#125;</span><br><span class="line">threads=`echo $&#123;Cores&#125;/$&#123;PMI_SIZE&#125; | bc`</span><br><span class="line">PMI_RANK_my=$&#123;PMI_RANK&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-4-测试优化（重点）"><a href="#6-4-测试优化（重点）" class="headerlink" title="6.4 测试优化（重点）"></a>6.4 测试优化（重点）</h2><blockquote>
<p>一、计算理论内存总带宽</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">计算方法：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">查看内存带宽：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">dmidecode | grep -A 16 <span class="string">&quot;Memory Device&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">例如内存信息为：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">三星 DDR4</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">16G 每根</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">2666 MT/s（Mhz）</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">查看cpu支持的通道数，例如intel 6252N支持6通道，两个CPU支持12通道</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">理论带宽计算DDR4：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">单条内存带宽 = 内存核心频率 x 内存总线位数 x 倍增系数</span></span><br><span class="line"> = 2666 * 64 / 8 = 21328 MB/s = 21.3G/s</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">12通道总内存带宽 = 21328 * 12 = 255936 = 250G/s</span></span><br></pre></td></tr></table></figure>

<p>二、使用stream测试实际内存总带宽</p>
<p>​	如果可以达到90%或以上，说明内存带宽正常, 继续Linpack测试</p>
<p>三、计算CPU理论峰值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">计算方法：</span></span><br><span class="line">Mhz * 每个时钟周期执行浮点运算的次数 * CPU数目</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">=</span></span><br><span class="line">2.3 x ( 8 x 2 x 2 ) x 48 = 3532.8 Gflops</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">说明：</span></span><br><span class="line">峰值计算分为单精度和双精度浮点运算</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">单精度：</span></span><br><span class="line">32bit的指令长度的运算，对应32位操作系统</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">双精度：</span></span><br><span class="line">64bit的指令长度的运算，对应64位操作系统</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">查找CPU可以处理什么样的指令集：</span></span><br><span class="line">例如Intel官网查到Intel Xeon 6252N</span><br><span class="line">支持AVX-512，</span><br><span class="line"><span class="meta">#</span><span class="bash"> of AVX-512 FMA Units = 2</span></span><br><span class="line">(Fused Multiply Add instructions) 融合了 乘法 和 加法</span><br><span class="line">即可以单个周期同时执行2条512bit的加法和2条512bit的乘法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">理解上述两个概念，可以开始计算（CPU单周期浮点计算能力）</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">Intel 6252N (支持avx512，有512位)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">单精度：</span></span><br><span class="line">2.3 x 512/32 x 2 x 2 = 147.2Gflops </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">双精度</span></span><br><span class="line">2.3 x 512/64 x 2 x 2 = 73.6Gflops</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">双精度共48核</span></span><br><span class="line">74.6 x 48 = 3580</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">FT2000+ 和 FT1500A (只有128位)，FT3000加入sve指令集(128-256位)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">单精度：</span> </span><br><span class="line">2.2 x 128/32 * 2 = 4.4</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">双精度:</span></span><br><span class="line">2.2 x 128/64 * 2 = 8.8</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">双精度共64核</span></span><br><span class="line">8.8 x 64 = 563.2</span><br></pre></td></tr></table></figure>

<p>四、使用Linapack测试CPU实际峰值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">如果性能达到理论峰值的70%说明正常，如果未达到尝试以下优化</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">1、使用mpirun运行xhpl, 按`lscpu` 中的NUMA分组绑定,`比如48核，分为两个Numa Node`, 则用mpirun`跑两个xhpl进程`，每个进程使用 OMP_NUM_THREADS=24, 跑24线程，这样可以将核用满。</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">在`Intel`平台，两个进程分别使用 HPL_HOST_CORE=<span class="string">&#x27;0-23&#x27;</span> 以及 HPL_HOST_CORE=<span class="string">&#x27;24-47&#x27;</span> 绑定核</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">在`Arm64`平台，则使用 GOMP_CPU_AFFINITY=<span class="string">&#x27;0-23&#x27;</span> 以及 GOMP_CPU_AFFINITY=<span class="string">&#x27;24-47&#x27;</span> 绑定</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">2、内存不用分配太大，根据stream测试结果分配，从小开始测</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">3、Intel平台编译器使用ICC，测试linpack使用icc自带的linpack，mpi使用icc自带的</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">4、Bios中关闭超线程，开启超频(turbo/P-state)</span></span><br></pre></td></tr></table></figure>

<p><strong><font color="blue">先测stream,判断带宽是否正常，再测linpack，然后再测Spec Cpu</font></strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Intel平台可以使用的控制频率的命令</span></span><br><span class="line">cpupower -c all frequency-set -g performance</span><br><span class="line">cpupower -c 0-95 frequency-set -g userspace</span><br><span class="line">cpupower -c 0-95 frequency-set -f 2700000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前频率控制是否为perfomance？</span></span><br><span class="line">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 跑xhpl之前设置指令集，或许有用</span></span><br><span class="line">export MKL_ENABLE_INSTRUCTIONS=AVX512</span><br></pre></td></tr></table></figure>

<p><img src="G:\工作\2020年3月\CN9性能测试\测试组合.png" alt="image-20200415171716940"></p>
<h2 id="6-5-HPL-dat修改"><a href="#6-5-HPL-dat修改" class="headerlink" title="6.5 HPL.dat修改"></a>6.5 HPL.dat修改</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第1-2行，注释说明行</span></span><br><span class="line">HPLinpack benchmark input file   </span><br><span class="line">Innovative Computing Laboratory, University of Tennessee  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第 3-4 行，输出结果文件的形式</span></span><br><span class="line">HPL.out      output file name (if any)  </span><br><span class="line">6            device out (6=stdout,7=stderr,file) </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5-6行，求解矩阵的大小</span></span><br><span class="line">1            # of problems sizes (N)  </span><br><span class="line">1000         Ns   </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 7-8行 求解矩阵分块的大小</span></span><br><span class="line">1            # of NBs</span><br><span class="line">192 256      NBs</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9行 处理器阵列的排列方式，行还是列</span></span><br><span class="line">0：适用于节点较少，单个节点CPU较多的胖系统</span><br><span class="line">1：适用于节点较多，单个节点CPU较少的瘦系统（机群上远好于按行排列）</span><br><span class="line">1            PMAP process mapping (0=Row-,1=Column-major) </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 10-12行 定义二维处理网格P/Q</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> P X Q = 进程数，P尽量小于Q</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> P=2^n,P最好选择2的幂</span></span><br><span class="line">1            # of process grids (P x Q) </span><br><span class="line">1 2          Ps</span><br><span class="line">1 2          Qs</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 13行 设置阀值，不用修改</span></span><br><span class="line">16.0         threshold</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 14-21行 设置L的分解方式</span></span><br><span class="line">1            # of panel fact</span><br><span class="line">2 1 0        PFACTs (0=left, 1=Crout, 2=Right) # 对性能影响不大</span><br><span class="line">1            # of recursive stopping criterium</span><br><span class="line">4 8          NBMINs (&gt;= 1)   # 4或8都不错</span><br><span class="line">1            # of panels in recursion</span><br><span class="line">2            NDIVs  # 选2比较理想</span><br><span class="line">1            # of recursive panel fact.</span><br><span class="line">1 0 2        RFACTs (0=left, 1=Crout, 2=Right) # 对性能影响不大</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 22-23行 设置L的横向广播方式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 前四种，适用于快速网络，后两种适用于速度较慢的网络</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 小规模系统，选择0/1，大规模系统选择3</span></span><br><span class="line">1            # of broadcast</span><br><span class="line">0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 24-25行 设置横向通信的通信深度</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 小规模系统选择1/2，大规模系统2-5之间</span></span><br><span class="line">1            # of lookahead depth</span><br><span class="line">1            DEPTHs (&gt;=0)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 26-27 设置U的广播算法</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 小规模系统，使用缺省值即可</span></span><br><span class="line">0            SWAP (0=bin-exch,1=long,2=mix)</span><br><span class="line">1            swapping threshold</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 28-29行 L和U的数据存放格式</span></span><br><span class="line">0：按列存放</span><br><span class="line">1：按行存放</span><br><span class="line">0            L1 in (0=transposed,1=no-transposed) form</span><br><span class="line">0            U  in (0=transposed,1=no-transposed) form</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 30-31 缺省值即可</span></span><br><span class="line">0            Equilibration (0=no,1=yes)</span><br><span class="line">8            memory alignment in double (&gt; 0)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-6-测试脚本编写"><a href="#6-6-测试脚本编写" class="headerlink" title="6.6 测试脚本编写"></a>6.6 测试脚本编写</h2><h3 id="6-6-1-本地mpirun测试脚本（Intel版本）"><a href="#6-6-1-本地mpirun测试脚本（Intel版本）" class="headerlink" title="6.6.1 本地mpirun测试脚本（Intel版本）"></a>6.6.1 本地mpirun测试脚本（Intel版本）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 本地单节点测试，需要根据`lscpu`中numa分区情况(node)的使用mpirun测试xhpl</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> eg:在未开超线程的情况下，分为两个node，每个node中有12个核，则最佳测试方法为mpirun -np 2 ./myrun.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以下为myrun.sh的具体实现</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">ulimit -s unlimited</span><br><span class="line">Cores=48</span><br><span class="line">ThreadsNum=`echo &quot;$&#123;Cores&#125;/$&#123;PMI_SIZE&#125;&quot; | bc` # 计算每个进程跑的线程数</span><br><span class="line">case $&#123;PMI_SIZE&#125; in</span><br><span class="line">2)</span><br><span class="line">        case $&#123;PMI_RANK&#125; in</span><br><span class="line">        0)</span><br><span class="line">        export OMP_NUM_THREADS=$&#123;ThreadsNum&#125;</span><br><span class="line">        export HPL_HOST_CORE=&#x27;0-23&#x27;</span><br><span class="line">        ./xhpl -n 1 -b 384 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">        export OMP_NUM_THREADS=$&#123;ThreadsNum&#125;</span><br><span class="line">        export HPL_HOST_CORE=&#x27;24-47&#x27;</span><br><span class="line">        ./xhpl -n 1 -b 384 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">        ;;</span><br><span class="line">        esac</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-6-2-Slurm-srun测试脚本-FT版本"><a href="#6-6-2-Slurm-srun测试脚本-FT版本" class="headerlink" title="6.6.2 Slurm srun测试脚本(FT版本)"></a>6.6.2 Slurm srun测试脚本(FT版本)</h2><p>xhplrun.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">ulimit -s unlimited</span><br><span class="line">Cores=48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==================================================================</span><br><span class="line">PMI_SIZE=$SLURM_NPROCS</span><br><span class="line">PMI_RANK=$SLURM_PROCID</span><br><span class="line">MPI_NUM_NODE=$SLURM_NNODES</span><br><span class="line">MPI_PER_NODE=$((PMI_SIZE / MPI_NUM_NODES))</span><br><span class="line">MPI_RANK_FOR_NODE=$((PMI_RANK % MPI_PER_NODE))</span><br><span class="line"></span><br><span class="line">PRO_SIZE=$&#123;MPI_PER_NODE&#125;</span><br><span class="line">PMI_RANK_my=$&#123;MPI_RANK_FOR_NODE&#125;</span><br><span class="line">==================================================================</span><br><span class="line"></span><br><span class="line">echo $&#123;PRO_SIZE&#125; $&#123;PMI_RANK_my&#125; $&#123;threads&#125; $&#123;PMI_SIZE&#125; $&#123;PMI_RANK&#125; $&#123;MPI_NUM_NODES&#125; $&#123;MPI_PER_NODE&#125; $&#123;MPI_RANK_FOR_NODE&#125;</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">case $&#123;PRO_SIZE&#125; in</span><br><span class="line">1)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-1 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0,4 -N 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-63&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -m 3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-31&#x27;</span><br><span class="line">numactl -i 4-7 -N 0-3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -m 7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-63&#x27;</span><br><span class="line">numactl -i 0-3 -N 4-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta">#</span><span class="bash">mpirun -n 1 numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span> : -n 1 numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>yhrun 提交作业 runpro.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">duqi</span></span><br><span class="line"></span><br><span class="line">if [ $# -ne 5 ]</span><br><span class="line">then</span><br><span class="line">        echo Usage: ./runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</span><br><span class="line">        exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line"></span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/mpi3/lib:$LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">nodes=$&#123;1&#125;</span><br><span class="line">nnodes=$&#123;2&#125;</span><br><span class="line">nprocs=$&#123;3&#125;</span><br><span class="line">nmem=$&#123;4&#125;</span><br><span class="line">logdir=$&#123;5&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p $&#123;logdir&#125;</span><br><span class="line"></span><br><span class="line">tnprocs=$(($&#123;nnodes&#125;*$&#123;nprocs&#125;))</span><br><span class="line">P=1</span><br><span class="line">Q=1</span><br><span class="line">for i in `seq 1 $&#123;tnprocs&#125;`</span><br><span class="line">do</span><br><span class="line">        for j in `seq 1 $&#123;tnprocs&#125;`</span><br><span class="line">        do</span><br><span class="line">                PQ=$(($&#123;i&#125;*$&#123;j&#125;))</span><br><span class="line">                if [ $&#123;PQ&#125; -eq $&#123;tnprocs&#125; ] &amp;&amp; [ $&#123;i&#125; -le $&#123;j&#125; ]</span><br><span class="line">                then</span><br><span class="line">                        P=$&#123;i&#125;</span><br><span class="line">                        Q=$&#123;j&#125;</span><br><span class="line">                fi</span><br><span class="line">        done</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname $&#123;nodes&#125;`</span><br><span class="line">do</span><br><span class="line">        scp HPL.dat $i:/root/linpack &amp;</span><br><span class="line">done</span><br><span class="line">wait</span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">runnodes=&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname $&#123;nodes&#125;`</span><br><span class="line">do</span><br><span class="line">        runnodes+=$&#123;i&#125;,</span><br><span class="line">        let j++</span><br><span class="line">        if [ $&#123;j&#125; -eq $&#123;nnodes&#125; ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;yhrun -p all -N $&#123;nnodes&#125; -n $&#123;tnprocs&#125; -w $&#123;runnodes&#125; -D /root/linpack /root/linpack/xhplrun.sh $&#123;P&#125; $&#123;Q&#125; $&#123;nmem&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log &amp;&quot;</span><br><span class="line">                echo $&#123;runnodes&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log</span><br><span class="line">                yhrun -p all -N $&#123;nnodes&#125; -n $&#123;tnprocs&#125; -w $&#123;runnodes&#125; -D /root/linpack /root/linpack/xhplrun.sh $&#123;P&#125; $&#123;Q&#125; $&#123;nmem&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log &amp;</span><br><span class="line">                j=0</span><br><span class="line">                runnodes=&#x27;&#x27;</span><br><span class="line">        fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="6-7-Bios设置"><a href="#6-7-Bios设置" class="headerlink" title="6.7 Bios设置"></a>6.7 Bios设置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">琦哥的：</span><br><span class="line">    UPI Configuration</span><br><span class="line">        Link Lop -&gt; disable</span><br><span class="line">        Link L1  -&gt; disable </span><br><span class="line">        IO Directory Cache -&gt; enable</span><br><span class="line">        Isoc Mode -&gt; enable</span><br><span class="line"></span><br><span class="line">    Memory Configuration</span><br><span class="line">        Eufsrce POR -&gt; enable</span><br><span class="line">        PPR Type -&gt; Soft PPR</span><br><span class="line">        Memory Frequency -&gt; 2666</span><br><span class="line">        Data Scrambling for NVMDIMM -&gt; enable</span><br><span class="line">        Data Scrambling for DDR4 -&gt; enable</span><br><span class="line">        Enable AOR -&gt; enable</span><br><span class="line">        Refresh Option -&gt; enable</span><br><span class="line">        Memory RAS</span><br><span class="line">            Memory Rank Sparing -&gt; enable</span><br><span class="line"></span><br><span class="line">    IIO Configuration</span><br><span class="line">        PCI-E Port Max Payload Size -&gt; 256B</span><br><span class="line"></span><br><span class="line">    CPU P-State</span><br><span class="line">        SpeedStep -&gt; disable/enable?</span><br><span class="line">        PBF </span><br><span class="line">        Hardware P-State -&gt; enable</span><br><span class="line">        Package c state -&gt; No limit </span><br><span class="line">	</span><br><span class="line">网上找的系统Bios设置优化</span><br><span class="line">    关闭超线程</span><br><span class="line">    打开EIST</span><br><span class="line">    打开Turbo Mode</span><br><span class="line">    Boot Performance mode设置为max performance</span><br><span class="line">    Energy Performance BIAS设置为Performance</span><br><span class="line">    打开Monitor/Mwait</span><br><span class="line">    Package C stat limit设置为C0/C1 state</span><br><span class="line">    关闭CPU C3 report</span><br><span class="line">    关闭CPU C6 report</span><br><span class="line">    关闭Enhanced Halt State</span><br><span class="line">    关闭Intel VT for Directed I/O</span><br><span class="line">    Linux OS下CPU Power Management设置为max performance</span><br><span class="line">    QPI及Memory Frequency保持为Max Frequency</span><br><span class="line">    关闭NUMA功能 </span><br></pre></td></tr></table></figure>

<h2 id="6-8-结果反馈"><a href="#6-8-结果反馈" class="headerlink" title="6.8 结果反馈"></a>6.8 <span id="jump">结果反馈</span></h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">linpack测试以我们为主导</span></span><br><span class="line"></span><br><span class="line">1、grep FAILED 关键字,查看是否有节点计算错误</span><br><span class="line">2、grep WR 查看节点性能是否正常</span><br><span class="line">3、统计跑死的点</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如何反馈？</span></span><br><span class="line">一轮Linpack40分钟测试完成</span><br><span class="line">	一、6个点本是drain*状态</span><br><span class="line">	二、3个点跑死，cn[1,2,3]</span><br><span class="line">	三、5个点Linpack计算FAILED</span><br><span class="line">	四、其他点linpakc性能正常</span><br><span class="line">可以考虑更换下一批</span><br></pre></td></tr></table></figure>

<h2 id="6-9-风冷系统linpack测试全过程记录"><a href="#6-9-风冷系统linpack测试全过程记录" class="headerlink" title="6.9 风冷系统linpack测试全过程记录"></a>6.9 风冷系统linpack测试全过程记录</h2><blockquote>
<h5 id="1、了解风冷系统的架构"><a href="#1、了解风冷系统的架构" class="headerlink" title="1、了解风冷系统的架构"></a>1、了解风冷系统的架构</h5><p>按批次测试，测完一批换下一批</p>
<p>一批为192个节点，每个框32个节点，共6个框</p>
<p>每个节点128G内存，芯片为FT2000+, 通过mhz获取频率为2000（降频），64物理核</p>
<p>系统版本： 4.19.46-cn+</p>
<h5 id="2、计算每个节点的理论峰值"><a href="#2、计算每个节点的理论峰值" class="headerlink" title="2、计算每个节点的理论峰值"></a>2、计算每个节点的理论峰值</h5><p>2000 * 128 &#x2F; 64 * 2 * 64&#x3D; 512000</p>
<h5 id="3、开始测试"><a href="#3、开始测试" class="headerlink" title="3、开始测试"></a>3、开始测试</h5><p>runpro.sh脚本参数说明:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./runpro.sh NodeList NodeBind ProcessesPerNode MemSize</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">NodeList 节点列表,例如cn[0-8]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">NodeBind 几个节点绑定运行，例如2，则计算效率时，需要将结果得到的效率/2/512</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">ProcessesPerNode 每给节点运行几个xhpl进程，根据numa node来，FT一般是8</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">MemSize 每个节点中，每个进程分配的内存，一般使用到约总内存的80%，例如单节点128G，填写12000（单位为Mb），则总使用96G内存</span></span><br></pre></td></tr></table></figure>

<p>单节点测试：</p>
<p>​	不需要互联测试网络联通性，仅对单节点进行压力测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./runpro.sh cn0 1 8 12000 logdir</span></span><br></pre></td></tr></table></figure>

<p>多节点测试：</p>
<p>​	需要互联测试网络联通性， 2，4， 8， 16， 32， 64， 128，如果要求测多节点稳定性，测试的8点8进8线，结果按<a href="#jump">章节6.8</a>反馈</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./runpro.sh cn0 1 8 12000 logdir</span></span><br></pre></td></tr></table></figure>

<p>问题解决一：</p>
<p>​	测试到128节点，性能异常，效率仅有43%</p>
<p>互联那边回应：</p>
<p>​	节点数超过64，通信就跨框</p>
<p>琦哥建议的做法：</p>
<p>​	把128个节点分到4个框，测试一下，看是不是带宽的原因</p>
<p>最后的解决方法：</p>
<p>​	网络拓扑更换，矩阵值不能相等，使用原本32 x 32，改为16 x 64，但是换成160节点后还是有问题</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">./runpro.sh cn[xx-xx] 128 8 12000 dir</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">其中执行的xhplrun.sh的参数为</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">xhplrun.sh 32 32 12000</span></span><br></pre></td></tr></table></figure>


</blockquote>
<h1 id="七、Lmbench-测试"><a href="#七、Lmbench-测试" class="headerlink" title="七、Lmbench 测试"></a>七、Lmbench 测试</h1><h2 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h2><p>​	Lmbench是一套简易，可移植的，符合ANSI&#x2F;C标准为UNIX&#x2F;POSIX而制定的微型测评工具。一般来说，它衡量两个关键特征：反应时间和带宽。LmBench旨在使系统开发者深入了解关键操作的基础成本。</p>
<h2 id="7-2-工具安装"><a href="#7-2-工具安装" class="headerlink" title="7.2 工具安装"></a>7.2 工具安装</h2><p>获取源包：</p>
<p>​	lmbench3.tar.gz</p>
<p>gcc编译安装</p>
<h2 id="7-3-测试步骤"><a href="#7-3-测试步骤" class="headerlink" title="7.3 测试步骤"></a>7.3 测试步骤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd src</span><br><span class="line">make results</span><br><span class="line">make see</span><br><span class="line">内存10G。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">错误处理：</span><br><span class="line">[root@cn9 lmbench3]# cd src/</span><br><span class="line">[root@cn9 src]# make results</span><br><span class="line">gmake[1]: Entering directory `/home/testcpu/test652/tools/lmbench3/src&#x27;</span><br><span class="line">gmake[1]: *** No rule to make target `../SCCS/s.ChangeSet&#x27;, needed by `bk.ver&#x27;.  Stop.</span><br><span class="line">gmake[1]: Leaving directory `/home/testcpu/test652/tools/lmbench3/src&#x27;</span><br><span class="line">解决方法：</span><br><span class="line">	vim Makefile</span><br><span class="line">	231行修改：</span><br><span class="line"><span class="meta">	$</span><span class="bash">O/lmbench : ../scripts/lmbench bk.ver</span></span><br><span class="line">	改为</span><br><span class="line"><span class="meta">	$</span><span class="bash">O/lmbench : ../scripts/lmbench</span></span><br></pre></td></tr></table></figure>

<h1 id="八、IOR-测试（暂无）"><a href="#八、IOR-测试（暂无）" class="headerlink" title="八、IOR 测试（暂无）"></a>八、IOR 测试（暂无）</h1><h1 id="九、alltoall测试"><a href="#九、alltoall测试" class="headerlink" title="九、alltoall测试"></a>九、alltoall测试</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yhrun -n 128 -N 8 -w cn34,cn35,cn36,cn37,cn38,cn39,cn40,cn41, /root/xm_alltoall 102400 1000</span><br></pre></td></tr></table></figure>

<h1 id="附录：常用工具链编译方法"><a href="#附录：常用工具链编译方法" class="headerlink" title="附录：常用工具链编译方法"></a>附录：常用工具链编译方法</h1><h2 id="一、GCC编译"><a href="#一、GCC编译" class="headerlink" title="一、GCC编译"></a>一、GCC编译</h2><p>需要依次编译依赖软件，然后在编译gcc中使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置isl的库路径</span></span><br><span class="line">export LD_LIBRARY_PATH=/home/testcpu/test652/tools/gcc830/lib:$LD_LIBRARY_PATH</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译GCC</span></span><br><span class="line">../configure --prefix=/home/testcpu/test652/tools/gcc830 --enable-lto --disable-bootstrap --enable-languages=c,c++,fortran --with-gmp=/home/testcpu/test652/tools/gcc830 --with-mpfr=/home/testcpu/test652/tools/gcc830 --with-mpc=/home/testcpu/test652/tools/gcc830 --with-isl=/home/testcpu/test652/tools/gcc830</span><br></pre></td></tr></table></figure>

<h3 id="1-1-依赖软件编译"><a href="#1-1-依赖软件编译" class="headerlink" title="1.1 依赖软件编译"></a>1.1 依赖软件编译</h3><h4 id="1-1-2-编译安装gmp"><a href="#1-1-2-编译安装gmp" class="headerlink" title="1.1.2 编译安装gmp"></a>1.1.2 编译安装gmp</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/home/testcpu/test652/tools/gcc830</span><br><span class="line">make </span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">./configure --with-gmp=/home/testcpu/test652/tools/gcc83 --with-mpfr=/home/testcpu/test652/tools/gcc83  --prefix=/home/testcpu/test652/tools/gcc83</span><br></pre></td></tr></table></figure>

<h4 id="1-1-3-编译安装mpfr"><a href="#1-1-3-编译安装mpfr" class="headerlink" title="1.1.3 编译安装mpfr"></a>1.1.3 编译安装mpfr</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/home/testcpu/test652/tools/gcc830 --with-gmp=/home/testcpu/test652/tools/gcc830</span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="1-1-4-编译安装mpc"><a href="#1-1-4-编译安装mpc" class="headerlink" title="1.1.4 编译安装mpc"></a>1.1.4 编译安装mpc</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/home/testcpu/test652/tools/gcc830 --with-gmp=/home/testcpu/test652/tools/gcc830 --with-mpfr=/home/testcpu/test652/tools/gcc830</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="1-1-5-编译安装isl"><a href="#1-1-5-编译安装isl" class="headerlink" title="1.1.5 编译安装isl"></a>1.1.5 编译安装isl</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/home/testcpu/test652/tools/gcc830 --with-gmp-prefix=/home/testcpu/test652/tools/gcc830</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> yum install gcc-* gtk2 gtk3 x11 libX11.x86_64 libX11-devel.x86_64 libXorg libXss libXScrnSaver.x86_64 xorg-x11-server-Xorg.x86_64 xulrunner.x86_64 xulrunner.i686 libstdc++.i686 libstdc++-devel.i686</span><br><span class="line">glibc.i686 glibc-devel.i686 libgcc* xulrunner.x86_64 xulrunner.i686 glibc-devel.x86_64 glibc.x86_64 autoconf-archive.noarch gtk2 gtk3 pango libXScrnSaver libX11.x86_64 libX11-devel.x86_64 libX11-common.noarch libxkbcommon-x11.x86_64 xorg-x11-server-common.x86_64 libstdc++* -y</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">mount -o loop -t iso9660 /home/testcpu/test652/images/rhel-server-7.6-x86_64-dvd.iso /home/testcpu/test652/mnt/CDROM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install gcc-* gtk2 gtk3 glibc-devel.i686 x11 libX11.x86_64 libX11-devel.x86_64 libXorg libXss libXScrnSaver.x86_64 xorg-x11-server-Xorg.x86_64 xulrunner.x86_64 xulrunner.i686 libstdc++.i686 libstdc++-devel.i686 glibc* libgcc* xulrunner* autoconf-archive.noarch gtk2 gtk3 pango libXScrnSaver libX11.x86_64 libX11-devel.x86_64 libX11-common.noarch libxkbcommon-x11.x86_64 xorg-x11-server-common.x86_64 libstdc++* -y</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="二、MPICH3编译"><a href="#二、MPICH3编译" class="headerlink" title="二、MPICH3编译"></a>二、MPICH3编译</h2><p>设置gcc830的环境变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=/home/testcpu/test652/tools/gcc830/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/testcpu/test652/tools/gcc830/lib:$LD_LIBRARY_PATH</span><br><span class="line">export LD_INCLUDE_PATH=/home/testcpu/test652/tools/gcc830/include:$LD_INCLUDE_PATH</span><br><span class="line">export CPATH=/home/testcpu/test652/tools/gcc830/include:$CPATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/testcpu/test652/tools/gcc830/lib64:$LD_LIBRARY_PATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/testcpu/test652/tools/gcc830/libexec:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>

<p>再编译</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/home/testcpu/test652/tools/mpi3-gcc830 --enable-fast --enable-shared=yes --enable-threads=runtime --with-ch3-rank-bits=32 --enable-romio --with-file-system=ufs+nfs --with-mpe</span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>设置环境变量使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=/home/testcpu/test652/tools/mpi3-gcc830/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/testcpu/test652/tools/mpi3-gcc830/lib:$LD_LIBRARY_PATH</span><br><span class="line">export LD_INCLUDE_PATH=/home/testcpu/test652/tools/mpi3-gcc830/include:$LD_INCLUDE_PATH</span><br></pre></td></tr></table></figure>



<h3 id="三、Redhat设置本地镜像源"><a href="#三、Redhat设置本地镜像源" class="headerlink" title="三、Redhat设置本地镜像源"></a>三、Redhat设置本地镜像源</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount -o loop -t iso9660 /home/IOSYS/test652/images/rhel-server-7.6-x86_64-dvd.iso /home/IOSYS/test652/mnt/CDROM</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/yum.repos.d/redhat.repo</span><br><span class="line"></span><br><span class="line">[rhel7.6]</span><br><span class="line">name=rhel7.6</span><br><span class="line">baseurl=file:///home/testcpu/test652/mnt/CDROM</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=1</span><br><span class="line"></span><br><span class="line">yum clean</span><br><span class="line">yum update</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>

<h2 id="四、找不到so库的解决方法"><a href="#四、找不到so库的解决方法" class="headerlink" title="四、找不到so库的解决方法"></a>四、找不到so库的解决方法</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 方法一：</span></span><br><span class="line">	设置LD_LIBRARY_PATH</span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法二：</span></span><br><span class="line"> 	vim /etc/ld.so.conf</span><br><span class="line"> 	----------------------------------------------------</span><br><span class="line"> 	include ld.so.conf.d/*.conf</span><br><span class="line">	/opt/intel/compilers_and_libraries/linux/lib/intel64</span><br><span class="line">	ldconfig 更新</span><br></pre></td></tr></table></figure>

<h2 id="五、复制以及查看端口占用"><a href="#五、复制以及查看端口占用" class="headerlink" title="五、复制以及查看端口占用"></a>五、复制以及查看端口占用</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看端口占用</span></span><br><span class="line">netstat -nultp | grep 8080</span><br><span class="line">netstat -anp  | grep 80</span><br><span class="line">netstat -ano | grep 18130</span><br><span class="line">lsof -i:18130</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制</span></span><br><span class="line">rsync -chavP /var/opt/gitlab/postgresql .</span><br><span class="line">rsync -avzP 复制显示进度</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看Bios版本</span></span><br><span class="line">dmidecode</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mpiicc -DAdd__ -DF77_INTEGER=int -DStringSunStyle -DHPL_DETAILED_TIMING -DHPL_PROGRESS_REPORT -I/root/hpl/include -I/root/hpl/include/Linux_Intel64 -I/opt/intel/compilers_and_libraries_2019.4.243/linux/mkl/mkl/include  -O3 -w -ansi-alias -i-static -z noexecstack -z relro -z now -nocompchk -Wall -qopenmp -mt_mpi -o /root/hpl/bin/Linux_Intel64/xhpl HPL_pddriver.o         HPL_pdinfo.o           HPL_pdtest.o /root/hpl/lib/Linux_Intel64/libhpl.a  -L/opt/intel/compilers_and_libraries_2019.4.243/linux/mkl/mkl/lib/intel64 -Wl,--start-group /opt/intel/compilers_and_libraries_2019.4.243/linux/mkl/lib/intel64/libmkl_intel_lp64.a /opt/intel/compilers_and_libraries_2019.4.243/linux/mkl/lib/intel64/libmkl_intel_thread.a /opt/intel/compilers_and_libraries_2019.4.243/linux/mkl/lib/intel64/libmkl_core.a -Wl,--end-group -lpthread -ldl</span><br></pre></td></tr></table></figure>

<h2 id="六、查看cpu主频率-和-内存信息"><a href="#六、查看cpu主频率-和-内存信息" class="headerlink" title="六、查看cpu主频率 和 内存信息"></a>六、查看cpu主频率 和 内存信息</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看CPU信息</span></span><br><span class="line">lscpu 其中 sockets个数代表物理核个数</span><br><span class="line">cat /proc/cpuinfo</span><br><span class="line">lmbench的mhz</span><br><span class="line">/usr/bin/turbostat</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看内存信息</span></span><br><span class="line">cat /proc/meminfo</span><br><span class="line">dmidecode | grep -A 16 &quot;Memory Device&quot;、</span><br></pre></td></tr></table></figure>

<h2 id="七、GLSL-1-50-is-not-supported"><a href="#七、GLSL-1-50-is-not-supported" class="headerlink" title="七、GLSL 1.50 is not supported"></a>七、GLSL 1.50 is not supported</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 报错：</span></span><br><span class="line">ERROR: In /home/gs/src/VTK8.2/VTK-8.2.0/Rendering/OpenGL2/vtkShaderProgram.cxx, line 447</span><br><span class="line">vtkShaderProgram (0x2b87270): 0:1(10): error: GLSL 1.50 is not supported. Supported versions are: 1.10, 1.20, 1.30, 1.00 ES, and 3.00 ES</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决方法</span></span><br><span class="line">export MESA_GL_VERSION_OVERRIDE=3.2</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cn[16-19,24-27,144-147,152-155]</span><br></pre></td></tr></table></figure>

<h2 id="八、附录"><a href="#八、附录" class="headerlink" title="八、附录"></a>八、附录</h2><h3 id="8-1-Linpack脚本"><a href="#8-1-Linpack脚本" class="headerlink" title="8.1 Linpack脚本"></a>8.1 Linpack脚本</h3><blockquote>
<p>runpro.sh</p>
<p>.&#x2F;runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</p>
<p>node_list 节点列表</p>
<p>nodes_num 几个点连在一起跑，单点 双点 多点</p>
<p> proc_per_node 每个节点跑几个进程，看node分为几个，FT一般是8</p>
<p> mem 12000 每个进程分配的内存，*8 大概&#x3D; 总内存的80%</p>
<p> logdir 日志文件</p>
<p> 单点8进程，一轮≈35分钟</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">! /bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">duqi</span></span><br><span class="line"></span><br><span class="line">if [ $# -ne 5 ]</span><br><span class="line">then</span><br><span class="line">        echo Usage: ./runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</span><br><span class="line">        exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/mpi3/lib:LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">nodes=$&#123;1&#125;</span><br><span class="line">nnodes=$&#123;2&#125;</span><br><span class="line">nprocs=$&#123;3&#125;</span><br><span class="line">nmem=$&#123;4&#125;</span><br><span class="line">logdir=$&#123;5&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p $&#123;logdir&#125;</span><br><span class="line"></span><br><span class="line">tnprocs=$(($&#123;nnodes&#125;*$&#123;nprocs&#125;))</span><br><span class="line">P=1</span><br><span class="line">Q=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_max=1</span><br><span class="line">for i in `seq 1 $&#123;tnprocs&#125;`</span><br><span class="line">do</span><br><span class="line">        j=$(($&#123;i&#125;*$&#123;i&#125;))</span><br><span class="line">        if [ $&#123;tnprocs&#125; -le $&#123;j&#125; ]; then</span><br><span class="line">                num_max=$&#123;i&#125;</span><br><span class="line">                break</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line">for i in `seq 1 $&#123;num_max&#125;`</span><br><span class="line">do</span><br><span class="line">        for j in `seq $&#123;num_max&#125; $&#123;tnprocs&#125;`</span><br><span class="line">        do</span><br><span class="line">                PQ=$(($&#123;i&#125;*$&#123;j&#125;))</span><br><span class="line">                if [ $&#123;PQ&#125; -eq $&#123;tnprocs&#125; ]</span><br><span class="line">                then</span><br><span class="line">                        P=$&#123;i&#125;</span><br><span class="line">                        Q=$&#123;j&#125;</span><br><span class="line">                fi</span><br><span class="line">        done</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname $&#123;nodes&#125;`</span><br><span class="line">do</span><br><span class="line">        scp HPL.dat $i:/root/linpack &amp;</span><br><span class="line">done</span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">runnodes=&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname $&#123;nodes&#125;`</span><br><span class="line">do</span><br><span class="line">        runnodes+=$&#123;i&#125;,</span><br><span class="line">        let j++</span><br><span class="line">        if [ $&#123;j&#125; -eq $&#123;nnodes&#125; ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;yhrun -p All -N $&#123;nnodes&#125; -n $&#123;tnprocs&#125; -w $&#123;runnodes&#125; -D /root/linpack /root/linpack/xhplrun.sh $&#123;P&#125; $&#123;Q&#125; $&#123;nmem&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log &amp;&quot;</span><br><span class="line">                echo $&#123;runnodes&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log &amp;</span><br><span class="line">                echo &quot;yhrun -p All -N $&#123;nnodes&#125; -n $&#123;tnprocs&#125; -w $&#123;runnodes&#125; -D /root/linpack /root/linpack/xhplrun.sh $&#123;P&#125; $&#123;Q&#125; $&#123;nmem&#125;&quot; &amp;&gt;&gt; $&#123;logdir&#125;/list.log</span><br><span class="line">                yhrun -p All -N $&#123;nnodes&#125; -n $&#123;tnprocs&#125; -w $&#123;runnodes&#125; -D /root/linpack /root/linpack/xhplrun.sh $&#123;P&#125; $&#123;Q&#125; $&#123;nmem&#125; &amp;&gt;&gt; $&#123;logdir&#125;/$&#123;i&#125;.log &amp;</span><br><span class="line">                j=0</span><br><span class="line">                runnodes=&#x27;&#x27;</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>xhplrun.sh</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">! /bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">duqi</span></span><br><span class="line"></span><br><span class="line">ulimit -s unlimited</span><br><span class="line"></span><br><span class="line">Cores=64</span><br><span class="line"><span class="meta">#</span><span class="bash">==========================================================</span></span><br><span class="line">PMI_SIZE=$SLURM_NPROCS</span><br><span class="line"></span><br><span class="line">PMI_RANK=$SLURM_PROCID</span><br><span class="line"></span><br><span class="line">MPI_NUM_NODES=$SLURM_NNODES</span><br><span class="line"></span><br><span class="line">MPI_PER_NODE=$((PMI_SIZE / MPI_NUM_NODES))</span><br><span class="line"></span><br><span class="line">MPI_RANK_FOR_NODE=$((PMI_RANK % MPI_PER_NODE))</span><br><span class="line"><span class="meta">#</span><span class="bash">==========================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads=`echo $&#123;Cores&#125;*$&#123;SLURM_NNODES&#125;/$&#123;PMI_SIZE&#125; | bc`</span><br><span class="line"></span><br><span class="line">PRO_SIZE=$&#123;MPI_PER_NODE&#125;</span><br><span class="line">PMI_RANK_my=$&#123;MPI_RANK_FOR_NODE&#125;</span><br><span class="line"></span><br><span class="line">echo $&#123;PRO_SIZE&#125; $&#123;PMI_RANK_my&#125; $&#123;threads&#125; $&#123;PMI_SIZE&#125; $&#123;PMI_RANK&#125; $&#123;MPI_NUM_NODES&#125; $&#123;MPI_PER_NODE&#125; $&#123;MPI_RANK_FOR_NODE&#125;</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">case $&#123;PRO_SIZE&#125; in</span><br><span class="line">1)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-1 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0,4 -N 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-63&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -m 3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-31&#x27;</span><br><span class="line">numactl -i 4-7 -N 0-3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -m 7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-63&#x27;</span><br><span class="line">numactl -i 0-3 -N 4-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta">#</span><span class="bash">mpirun -n 1 numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span> : -n 1 numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-15&#x27;</span><br><span class="line">numactl -i 0-7 -N 0-1 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 2-3 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;16-31&#x27;</span><br><span class="line">numactl -i 0-7 -N 2-3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 4-5 -N 2-3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-47&#x27;</span><br><span class="line">numactl -i 0-7 -N 4-5 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 6-7 -N 4-5 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;48-63&#x27;</span><br><span class="line">numactl -i 0-7 -N 6-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-1 -N 6-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-7&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 4 -N 0 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;8-15&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 2 -N 1 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;16-23&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 6 -N 2 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;24-31&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 1 -N 3 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-39&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0 -N 4 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;40-47&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 7 -N 5 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;48-55&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 5 -N 6 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;56-63&#x27;</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 3 -N 7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-3&#x27;</span><br><span class="line">numactl -i 0-7 -C 0-3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;4-7&#x27;</span><br><span class="line">numactl -i 0-7 -C 4-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;8-11&#x27;</span><br><span class="line">numactl -i 0-7 -C 8-11 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;12-15&#x27;</span><br><span class="line">numactl -i 0-7 -C 12-15 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;16-19&#x27;</span><br><span class="line">numactl -i 0-7 -C 16-19 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;20-23&#x27;</span><br><span class="line">numactl -i 0-7 -C 20-23 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;24-27&#x27;</span><br><span class="line">numactl -i 0-7 -C 24-27 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;28-31&#x27;</span><br><span class="line">numactl -i 0-7 -C 28-31 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-35&#x27;</span><br><span class="line">numactl -i 0-7 -C 32-35 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;36-39&#x27;</span><br><span class="line">numactl -i 0-7 -C 36-39 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;40-43&#x27;</span><br><span class="line">numactl -i 0-7 -C 40-43 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;44-47&#x27;</span><br><span class="line">numactl -i 0-7 -C 44-47 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;48-51&#x27;</span><br><span class="line">numactl -i 0-7 -C 48-51 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;52-55&#x27;</span><br><span class="line">numactl -i 0-7 -C 52-55 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;56-59&#x27;</span><br><span class="line">numactl -i 0-7 -C 56-59 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;60-63&#x27;</span><br><span class="line">numactl -i 0-7 -C 60-63 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">32)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> OMP_NUM_THREADS=<span class="variable">$&#123;threads&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">;;</span></span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0-1&#x27;</span><br><span class="line">numactl -i 0-7 -C 0-1 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;2-3&#x27;</span><br><span class="line">numactl -i 0-7 -C 2-3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;4-5&#x27;</span><br><span class="line">numactl -i 0-7 -C 4-5 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;6-7&#x27;</span><br><span class="line">numactl -i 0-7 -C 6-7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;8-9&#x27;</span><br><span class="line">numactl -i 0-7 -C 8-9 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;10-11&#x27;</span><br><span class="line">numactl -i 0-7 -C 10-11 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;12-13&#x27;</span><br><span class="line">numactl -i 0-7 -C 12-13 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;14-15&#x27;</span><br><span class="line">numactl -i 0-7 -C 14-15 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;16-17&#x27;</span><br><span class="line">numactl -i 0-7 -C 16-17 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;18-19&#x27;</span><br><span class="line">numactl -i 0-7 -C 18-19 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;20-21&#x27;</span><br><span class="line">numactl -i 0-7 -C 20-21 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;22-23&#x27;</span><br><span class="line">numactl -i 0-7 -C 22-23 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;24-25&#x27;</span><br><span class="line">numactl -i 0-7 -C 24-25 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;26-27&#x27;</span><br><span class="line">numactl -i 0-7 -C 26-27 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;28-29&#x27;</span><br><span class="line">numactl -i 0-7 -C 28-29 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;30-31&#x27;</span><br><span class="line">numactl -i 0-7 -C 30-31 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32-33&#x27;</span><br><span class="line">numactl -i 0-7 -C 32-33 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">17)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;34-35&#x27;</span><br><span class="line">numactl -i 0-7 -C 34-35 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">18)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;36-37&#x27;</span><br><span class="line">numactl -i 0-7 -C 36-37 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">19)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;38-39&#x27;</span><br><span class="line">numactl -i 0-7 -C 38-39 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">20)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;40-41&#x27;</span><br><span class="line">numactl -i 0-7 -C 40-41 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">21)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;42-43&#x27;</span><br><span class="line">numactl -i 0-7 -C 42-43 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">22)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;44-45&#x27;</span><br><span class="line">numactl -i 0-7 -C 44-45 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">23)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;46-47&#x27;</span><br><span class="line">numactl -i 0-7 -C 46-47 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">24)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;48-49&#x27;</span><br><span class="line">numactl -i 0-7 -C 48-49 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">25)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;50-51&#x27;</span><br><span class="line">numactl -i 0-7 -C 50-51 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">26)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;52-53&#x27;</span><br><span class="line">numactl -i 0-7 -C 52-53 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">27)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;54-55&#x27;</span><br><span class="line">numactl -i 0-7 -C 54-55 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">28)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;56-57&#x27;</span><br><span class="line">numactl -i 0-7 -C 56-57 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">29)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;58-59&#x27;</span><br><span class="line">numactl -i 0-7 -C 58-59 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">30)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;60-61&#x27;</span><br><span class="line">numactl -i 0-7 -C 60-61 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">31)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;62-63&#x27;</span><br><span class="line">numactl -i 0-7 -C 62-63 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">64)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> GOMP_CPU_AFFINITY=<span class="string">&#x27;0-63&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">$&#123;1&#125;</span> -q <span class="variable">$&#123;2&#125;</span> -m <span class="variable">$&#123;3&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">;;</span></span><br><span class="line">case $&#123;PMI_RANK_my&#125; in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;0&#x27;</span><br><span class="line">numactl -i 0-7 -C 0 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;1&#x27;</span><br><span class="line">numactl -i 0-7 -C 1 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;2&#x27;</span><br><span class="line">numactl -i 0-7 -C 2 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;3&#x27;</span><br><span class="line">numactl -i 0-7 -C 3 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;4&#x27;</span><br><span class="line">numactl -i 0-7 -C 4 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;5&#x27;</span><br><span class="line">numactl -i 0-7 -C 5 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;6&#x27;</span><br><span class="line">numactl -i 0-7 -C 6 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;7&#x27;</span><br><span class="line">numactl -i 0-7 -C 7 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;8&#x27;</span><br><span class="line">numactl -i 0-7 -C 8 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;9&#x27;</span><br><span class="line">numactl -i 0-7 -C 9 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;10&#x27;</span><br><span class="line">numactl -i 0-7 -C 10 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;11&#x27;</span><br><span class="line">numactl -i 0-7 -C 11 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;12&#x27;</span><br><span class="line">numactl -i 0-7 -C 12 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;13&#x27;</span><br><span class="line">numactl -i 0-7 -C 13 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;14&#x27;</span><br><span class="line">numactl -i 0-7 -C 14 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;15&#x27;</span><br><span class="line">numactl -i 0-7 -C 15 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;16&#x27;</span><br><span class="line">numactl -i 0-7 -C 16 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">17)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;17&#x27;</span><br><span class="line">numactl -i 0-7 -C 17 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">18)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;18&#x27;</span><br><span class="line">numactl -i 0-7 -C 18 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">19)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;19&#x27;</span><br><span class="line">numactl -i 0-7 -C 19 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">20)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;20&#x27;</span><br><span class="line">numactl -i 0-7 -C 20 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">21)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;21&#x27;</span><br><span class="line">numactl -i 0-7 -C 21 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">22)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;22&#x27;</span><br><span class="line">numactl -i 0-7 -C 22 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">23)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;23&#x27;</span><br><span class="line">numactl -i 0-7 -C 23 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">24)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;24&#x27;</span><br><span class="line">numactl -i 0-7 -C 24 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">25)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;25&#x27;</span><br><span class="line">numactl -i 0-7 -C 25 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">26)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;26&#x27;</span><br><span class="line">numactl -i 0-7 -C 26 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">27)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;27&#x27;</span><br><span class="line">numactl -i 0-7 -C 27 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">28)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;28&#x27;</span><br><span class="line">numactl -i 0-7 -C 28 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">29)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;29&#x27;</span><br><span class="line">numactl -i 0-7 -C 29 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">30)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;30&#x27;</span><br><span class="line">numactl -i 0-7 -C 30 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">31)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;31&#x27;</span><br><span class="line">numactl -i 0-7 -C 31 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">32)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;32&#x27;</span><br><span class="line">numactl -i 0-7 -C 32 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">33)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;33&#x27;</span><br><span class="line">numactl -i 0-7 -C 33 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">34)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;34&#x27;</span><br><span class="line">numactl -i 0-7 -C 34 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">35)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;35&#x27;</span><br><span class="line">numactl -i 0-7 -C 35 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">36)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;36&#x27;</span><br><span class="line">numactl -i 0-7 -C 36 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">37)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;37&#x27;</span><br><span class="line">numactl -i 0-7 -C 37 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">38)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;38&#x27;</span><br><span class="line">numactl -i 0-7 -C 38 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">39)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;39&#x27;</span><br><span class="line">numactl -i 0-7 -C 39 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">40)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;40&#x27;</span><br><span class="line">numactl -i 0-7 -C 40 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">41)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;41&#x27;</span><br><span class="line">numactl -i 0-7 -C 41 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">42)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;42&#x27;</span><br><span class="line">numactl -i 0-7 -C 42 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">43)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;43&#x27;</span><br><span class="line">numactl -i 0-7 -C 43 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">44)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;44&#x27;</span><br><span class="line">numactl -i 0-7 -C 44 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">45)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;45&#x27;</span><br><span class="line">numactl -i 0-7 -C 45 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">46)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;46&#x27;</span><br><span class="line">numactl -i 0-7 -C 46 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">47)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;47&#x27;</span><br><span class="line">numactl -i 0-7 -C 47 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">48)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;48&#x27;</span><br><span class="line">numactl -i 0-7 -C 48 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">49)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;49&#x27;</span><br><span class="line">numactl -i 0-7 -C 49 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">50)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;50&#x27;</span><br><span class="line">numactl -i 0-7 -C 50 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">51)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;51&#x27;</span><br><span class="line">numactl -i 0-7 -C 51 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">52)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;52&#x27;</span><br><span class="line">numactl -i 0-7 -C 52 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">53)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;53&#x27;</span><br><span class="line">numactl -i 0-7 -C 53 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">54)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;54&#x27;</span><br><span class="line">numactl -i 0-7 -C 54 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">55)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;55&#x27;</span><br><span class="line">numactl -i 0-7 -C 55 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">56)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;56&#x27;</span><br><span class="line">numactl -i 0-7 -C 56 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">57)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;57&#x27;</span><br><span class="line">numactl -i 0-7 -C 57 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">58)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;58&#x27;</span><br><span class="line">numactl -i 0-7 -C 58 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">59)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;59&#x27;</span><br><span class="line">numactl -i 0-7 -C 59 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">60)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;60&#x27;</span><br><span class="line">numactl -i 0-7 -C 60 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">61)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;61&#x27;</span><br><span class="line">numactl -i 0-7 -C 61 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">62)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;62&#x27;</span><br><span class="line">numactl -i 0-7 -C 62 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">63)</span><br><span class="line">export OMP_NUM_THREADS=$&#123;threads&#125;</span><br><span class="line">export GOMP_CPU_AFFINITY=&#x27;63&#x27;</span><br><span class="line">numactl -i 0-7 -C 63 ./xhpl -n 1 -b 192 -p $&#123;1&#125; -q $&#123;2&#125; -m $&#123;3&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="8-2-编译问题"><a href="#8-2-编译问题" class="headerlink" title="8.2 编译问题"></a>8.2 编译问题</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-lc </span><br><span class="line">	解决找不到memcpy问题 </span><br><span class="line">-lstdc++</span><br><span class="line">	解决vtable for xxxx 问题</span><br><span class="line">-lgcc_s</span><br><span class="line">	undefined reference to `_Unwind_Resume&#x27;</span><br><span class="line">	undefined reference to `__popcountdi2&#x27;</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/types.h&gt;</span></span><br><span class="line">	 implicit declaration of function ‘fstat’</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/sysmacros.h&gt;</span></span><br><span class="line">	implicit declaration of function ‘major’</span><br></pre></td></tr></table></figure>

<h1 id="十、Linux操作"><a href="#十、Linux操作" class="headerlink" title="十、Linux操作"></a>十、Linux操作</h1><h2 id="10-1-ncat端口转发"><a href="#10-1-ncat端口转发" class="headerlink" title="10.1 ncat端口转发"></a>10.1 ncat端口转发</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ncat --sh-exec &quot;ncat 25.8.27.6 15929&quot; -l 15929 --keep-open</span><br></pre></td></tr></table></figure>

<h1 id="十一、DDT安装"><a href="#十一、DDT安装" class="headerlink" title="十一、DDT安装"></a>十一、DDT安装</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cp Licence /home/gs/tools/arm/forge/licences/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp Licence.14713 /home/gs/tools/arm/licenceserver/licences/</span></span><br><span class="line"></span><br><span class="line">export PATH=/opt/mpi3.3/bin:/home/gs/tools/arm/forge/bin:/home/gs/tools/arm/licenceserver/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=/opt/mpi3.3/lib:$LD_LIBRARY_PATH</span><br><span class="line">ifconfig eth3 hw ether 00:1b:21:14:15:60</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">glex高速网版本的MPI改为本地调试用</span></span><br><span class="line">export MPICH_NO_LOCAL=0 //？不一定需要</span><br><span class="line">export MPICH_NEMESIS_NETMOD=tcp</span><br><span class="line">export PATH=/usr/local/mpi3/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/mpi3/lib:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>



<h1 id="十二、SPEC使用"><a href="#十二、SPEC使用" class="headerlink" title="十二、SPEC使用"></a>十二、SPEC使用</h1><h2 id="12-1-SPEC使用系统工具"><a href="#12-1-SPEC使用系统工具" class="headerlink" title="12.1 SPEC使用系统工具"></a>12.1 SPEC使用系统工具</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> SEPC设置使用系统的工具</span></span><br><span class="line">vim /home/gs/tools/spack-v5/etc/spack/defaults/packages.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 参考：</span></span><br><span class="line">../../../lib/spack/docs/build_settings.rst</span><br></pre></td></tr></table></figure>

<h1 id="十三、mi协议"><a href="#十三、mi协议" class="headerlink" title="十三、mi协议"></a>十三、mi协议</h1><h2 id="13-1-使用mi启动调试"><a href="#13-1-使用mi启动调试" class="headerlink" title="13.1 使用mi启动调试"></a>13.1 使用mi启动调试</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gs@ft-svr:~/matrix$ gdb --interpreter mi test</span><br><span class="line">=thread-group-added,id=&quot;i1&quot;</span><br><span class="line">~&quot;GNU gdb (Ubuntu 8.2.91.20190405-0ubuntu3) 8.2.91.20190405-git\n&quot;</span><br><span class="line">~&quot;Copyright (C) 2019 Free Software Foundation, Inc.\n&quot;</span><br><span class="line">~&quot;License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.&quot;</span><br><span class="line">~&quot;\nType \&quot;show copying\&quot; and \&quot;show warranty\&quot; for details.\n&quot;</span><br><span class="line">~&quot;This GDB was configured as \&quot;aarch64-linux-gnu\&quot;.\n&quot;</span><br><span class="line">~&quot;Type \&quot;show configuration\&quot; for configuration details.\n&quot;</span><br><span class="line">~&quot;For bug reporting instructions, please see:\n&quot;</span><br><span class="line">~&quot;&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\n&quot;</span><br><span class="line">~&quot;Find the GDB manual and other documentation resources online at:\n    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.&quot;</span><br><span class="line">~&quot;\n\n&quot;</span><br><span class="line">~&quot;For help, type \&quot;help\&quot;.\n&quot;</span><br><span class="line">~&quot;Type \&quot;apropos word\&quot; to search for commands related to \&quot;word\&quot;...\n&quot;</span><br><span class="line">~&quot;Reading symbols from test...\n&quot;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<h2 id="13-2-断点命令（BreakPoint）"><a href="#13-2-断点命令（BreakPoint）" class="headerlink" title="13.2 断点命令（BreakPoint）"></a>13.2 断点命令（BreakPoint）</h2><h3 id="13-2-1-break-after"><a href="#13-2-1-break-after" class="headerlink" title="13.2.1 -break-after"></a>13.2.1 -break-after</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-after number count</span><br><span class="line">第number个断点在执行count次后有效</span><br></pre></td></tr></table></figure>

<h3 id="13-2-2-break-condition"><a href="#13-2-2-break-condition" class="headerlink" title="13.2.2 -break-condition"></a>13.2.2 -break-condition</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-condition number expr</span><br><span class="line">第number个断点在表达式expr为true时有效</span><br></pre></td></tr></table></figure>

<h3 id="13-2-3-break-delete"><a href="#13-2-3-break-delete" class="headerlink" title="13.2.3 -break-delete"></a>13.2.3 -break-delete</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-delete(breakpoint number)+</span><br><span class="line">删除指定number的多个断点</span><br></pre></td></tr></table></figure>

<h3 id="13-2-4-break-disable"><a href="#13-2-4-break-disable" class="headerlink" title="13.2.4 -break-disable"></a>13.2.4 -break-disable</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-disable(breakpoint number)+</span><br><span class="line">使用指定Number的多个断点失效</span><br></pre></td></tr></table></figure>

<h3 id="13-2-5-break-enable"><a href="#13-2-5-break-enable" class="headerlink" title="13.2.5 -break-enable"></a>13.2.5 -break-enable</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-enable(breakpoint number)+</span><br><span class="line">使用指定Number的多个断点生效</span><br></pre></td></tr></table></figure>

<h3 id="13-2-6-break-info"><a href="#13-2-6-break-info" class="headerlink" title="13.2.6 -break-info"></a>13.2.6 -break-info</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-info breakpoint</span><br><span class="line">得到指定断点的信息</span><br></pre></td></tr></table></figure>

<h3 id="13-2-7-break-insert"><a href="#13-2-7-break-insert" class="headerlink" title="13.2.7 -break-insert"></a>13.2.7 -break-insert</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-insert</span><br><span class="line">	-t				插入临时断点</span><br><span class="line">	-h				插入硬件断点</span><br><span class="line">	-r				插入正则断点，当函数名匹配正则表达式时生效</span><br><span class="line">	-c condition    插入条件断点</span><br><span class="line">	-i ignore-count 插入一个指定无效次数的断点</span><br><span class="line">	-p thread  		</span><br><span class="line">	line | addr(func) </span><br></pre></td></tr></table></figure>

<h3 id="13-2-8-break-list"><a href="#13-2-8-break-list" class="headerlink" title="13.2.8. -break-list"></a>13.2.8. -break-list</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-list</span><br><span class="line">显示已插入的断点列表</span><br></pre></td></tr></table></figure>

<h3 id="13-2-9-break-watch"><a href="#13-2-9-break-watch" class="headerlink" title="13.2.9 -break-watch"></a>13.2.9 -break-watch</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-break-watch [-a|-r] variable</span><br><span class="line">创建一个观察点，-a标识对variable读写时有效，-r标识只读时有效</span><br></pre></td></tr></table></figure>

<h2 id="13-3-程序环境命令-Program-Context"><a href="#13-3-程序环境命令-Program-Context" class="headerlink" title="13.3 程序环境命令(Program Context)"></a>13.3 程序环境命令(Program Context)</h2><h2 id="13-4-线程-thread"><a href="#13-4-线程-thread" class="headerlink" title="13.4 线程(thread)"></a>13.4 线程(thread)</h2><h2 id="13-5-程序执行-Program-Execution"><a href="#13-5-程序执行-Program-Execution" class="headerlink" title="13.5 程序执行(Program Execution)"></a>13.5 程序执行(Program Execution)</h2><h2 id="13-6-栈-Stack"><a href="#13-6-栈-Stack" class="headerlink" title="13.6 栈(Stack)"></a>13.6 栈(Stack)</h2><h2 id="13-7-变量-Variable"><a href="#13-7-变量-Variable" class="headerlink" title="13.7 变量(Variable)"></a>13.7 变量(Variable)</h2><h2 id="13-8-数据-Data"><a href="#13-8-数据-Data" class="headerlink" title="13.8 数据(Data)"></a>13.8 数据(Data)</h2><h2 id="13-9-跟踪点-TracePoint"><a href="#13-9-跟踪点-TracePoint" class="headerlink" title="13.9 跟踪点(TracePoint)"></a>13.9 跟踪点(TracePoint)</h2><h2 id="13-10-符号-Symbol"><a href="#13-10-符号-Symbol" class="headerlink" title="13.10 符号(Symbol)"></a>13.10 符号(Symbol)</h2><h2 id="13-11-文件-File"><a href="#13-11-文件-File" class="headerlink" title="13.11 文件(File)"></a>13.11 文件(File)</h2><h2 id="13-12-目标数据-Target-Manipulation"><a href="#13-12-目标数据-Target-Manipulation" class="headerlink" title="13.12 目标数据(Target Manipulation)"></a>13.12 目标数据(Target Manipulation)</h2><h2 id="13-13-其他"><a href="#13-13-其他" class="headerlink" title="13.13 其他"></a>13.13 其他</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-enable-pretty-printing</span><br><span class="line">-var-create - * map</span><br><span class="line">-var-list-children --all-values var1 0 10</span><br><span class="line"></span><br><span class="line">-data-evaluate-expression map</span><br><span class="line">^done,value=&quot;std::map with 140737353945088 elements&lt;error reading variable: Cannot access memory at address 0x1f0fc35f415e51&gt;&quot;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//    // 设置标记类型与颜色</span><br><span class="line">//    this-&gt;markerDefine(QsciScintilla::Circle, 0);</span><br><span class="line">//    this-&gt;setMarkerBackgroundColor(QColor(&quot;#ee6666&quot;), 0);</span><br><span class="line">//    this-&gt;markerDefine(QsciScintilla::Circle, 1);</span><br><span class="line">//    this-&gt;setMarkerBackgroundColor(QColor(&quot;#aaaaaa&quot;), 1);</span><br><span class="line">//    this-&gt;markerDefine(QsciScintilla::RightArrow, 2);</span><br><span class="line">//    this-&gt;setMarkerBackgroundColor(QColor(&quot;#eaf593&quot;), 2);</span><br></pre></td></tr></table></figure>

<h1 id="十四、Git改密码"><a href="#十四、Git改密码" class="headerlink" title="十四、Git改密码"></a>十四、Git改密码</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gitlab-rails console production</span><br><span class="line"></span><br><span class="line">irb(main):002:0&gt; user=User.where(email:&#x27;cuiyingbomail@163.com&#x27;).first</span><br><span class="line">=&gt; #&lt;User id:30 @cyb&gt;</span><br><span class="line">irb(main):003:0&gt; user.password=12345678</span><br><span class="line">=&gt; 12345678</span><br><span class="line">irb(main):004:0&gt; user.password_confirmation=12345678</span><br><span class="line">=&gt; 12345678</span><br><span class="line">irb(main):005:0&gt; user.save!</span><br><span class="line">Enqueued ActionMailer::DeliveryJob (Job ID: 540244db-c6ec-44f9-880e-72338b955aa5) to Sidekiq(mailers) with arguments: &quot;DeviseMailer&quot;, &quot;password_change&quot;, &quot;deliver_now&quot;, #&lt;GlobalID:0x00007f57f5da3208 @uri=#&lt;URI::GID gid://gitlab/User/30&gt;&gt;</span><br><span class="line">=&gt; true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="十五、YHPDE（eclipse）FT部署"><a href="#十五、YHPDE（eclipse）FT部署" class="headerlink" title="十五、YHPDE（eclipse）FT部署"></a>十五、YHPDE（eclipse）FT部署</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、安装eclipse:</span><br><span class="line">	gitlab</span><br><span class="line">2、插件安装，参考手册</span><br><span class="line">2、新版SLURM需要</span><br><span class="line">vim org.eclipse.ptp.rm.slurm.proxy_4.0.7.201104291906/src/ptp_slurm_proxy.c</span><br><span class="line">1625行：slurm_allocation_lookup_lite -&gt; slurm_allocation_lookup</span><br><span class="line">2942行: primary = 1; -&gt;  primary = 0;</span><br><span class="line">2943行：secondary = 2; -&gt; secondary = 1;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>测试</category>
        <category>信创POC测试</category>
      </categories>
      <tags>
        <tag>工作</tag>
      </tags>
  </entry>
  <entry>
    <title>运维之综合架构--02--Rsync服务器搭建</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/02-Rsync%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="二、Rsync与数据备份"><a href="#二、Rsync与数据备份" class="headerlink" title="二、Rsync与数据备份"></a>二、Rsync与数据备份</h2><h3 id="2-1-备份概念"><a href="#2-1-备份概念" class="headerlink" title="2.1  备份概念"></a>2.1  备份概念</h3><p>为什么要做备份？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">数据非常的重要</span><br><span class="line">保证数据不丢失</span><br><span class="line">便于快速的恢复</span><br></pre></td></tr></table></figure>

<p>备份方式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">完全备份，每次都进行全部备份 (效率低下, 占用空间)</span><br><span class="line">增量备份，仅备份客户端与服务端差异的部分 (提高备份效率,节省空间, 适合异地备份 )</span><br></pre></td></tr></table></figure>

<p>用什么工具做备份？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp  	网络之间的拷贝，全量拷贝的方式  （ssh协议）</span><br><span class="line">rsync	远程同步（增量）</span><br></pre></td></tr></table></figure>

<h3 id="2-2-rsync的基本概念"><a href="#2-2-rsync的基本概念" class="headerlink" title="2.2 rsync的基本概念"></a>2.2 rsync的基本概念</h3><blockquote>
<p>rsync是一款开源的备份工具，<br>可以在不同主机之间进行同步（windows和Linux之间   Mac和Linux   Linux和Linux）<br>可实现全量备份与增量备份<br>因此非常适合用于架构集中式备份或异地备份等应用</p>
</blockquote>
<p>rsync数据的同步模式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">推送： 本地将数据上传至备份服务器上	 （上传）</span><br><span class="line">拉取： 备份服务器获取本地服务器的数据  （下载）</span><br></pre></td></tr></table></figure>

<p>rsync的数据传输方式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">本地传输（类似于使用cp命令）</span><br><span class="line">远程传输（通过网络传输  a--&gt;b）</span><br><span class="line">守护进程（运行一个服务一直在后台）</span><br></pre></td></tr></table></figure>

<p>rsync选项详解</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync参数:</span><br><span class="line">-a           #归档模式传输, 等于-tropgDl *</span><br><span class="line">-v           #详细模式输出, 打印速率, 文件数量等 *</span><br><span class="line">-z           #传输时进行压缩以提高效率 *</span><br><span class="line">-r           #递归传输目录及子目录，即目录下得所有目录都同样传输。</span><br><span class="line">-t           #保持文件时间信息</span><br><span class="line">-o           #保持文件属主信息</span><br><span class="line">-p           #保持文件权限</span><br><span class="line">-g           #保持文件属组信息</span><br><span class="line">-l           #保留软连接</span><br><span class="line">-P           #显示同步的过程及传输时的进度等信息</span><br><span class="line">-D           #保持设备文件信息</span><br><span class="line">-L           #保留软连接指向的目标文件</span><br><span class="line">-e           #使用的信道协议,指定替代rsh的shell程序  ssh</span><br><span class="line">--exclude=PATTERN   #指定排除不需要传输的文件模式</span><br><span class="line">--exclude-from=file #文件名所在的目录文件</span><br><span class="line">--bwlimit=100       #限速传输 *</span><br><span class="line">--partial           #断点续传</span><br><span class="line">--delete            #让目标目录和源目录数据保持一致 *</span><br></pre></td></tr></table></figure>

<h3 id="2-3-本地传输"><a href="#2-3-本地传输" class="headerlink" title="2.3 本地传输"></a>2.3 本地传输</h3><p>将&#x2F;boot文件夹拷贝到&#x2F;tmp中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync -avz /boot /tmp/</span><br></pre></td></tr></table></figure>

<p>将boot文件夹中的内容拷贝到&#x2F;tmp中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync -avz /boot/ /tmp/</span><br></pre></td></tr></table></figure>

<h3 id="2-3-远程传输"><a href="#2-3-远程传输" class="headerlink" title="2.3 远程传输"></a>2.3 远程传输</h3><p>虚拟机准备</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>nfs</td>
<td>172.16.1.31&#x2F;24 和 10.0.0.31&#x2F;24</td>
</tr>
<tr>
<td>backup</td>
<td>172.16.1.41&#x2F;24 和 10.0.0.41&#x2F;24</td>
</tr>
</tbody></table>
<p>backup从nfs拉取&#x2F;boo目录到本地&#x2F;tmp文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz root@10.0.0.31:/boot /tmp</span><br></pre></td></tr></table></figure>

<p>backup上传&#x2F;root&#x2F;test.txt到nfs主机的&#x2F;tmp文件夹中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync /root/test.txt root@10.0.0.31:/tmp</span><br></pre></td></tr></table></figure>

<h3 id="2-4-守护进程传输（服务搭建）"><a href="#2-4-守护进程传输（服务搭建）" class="headerlink" title="2.4 守护进程传输（服务搭建）"></a>2.4 守护进程传输（服务搭建）</h3><blockquote>
<p>为什么需要使用rsync守护进程传输？</p>
<p>Rsync借助SSH协议同步数据存在的缺陷（临时发送数据）<br>    1.使用系统用户（不安全）<br>    2.使用普通用户（会导致权限不足情况）</p>
</blockquote>
<p>backup充当rsync服务端，nfs充当客户端，配置步骤：</p>
<h4 id="2-4-1-服务端配置"><a href="#2-4-1-服务端配置" class="headerlink" title="2.4.1 服务端配置"></a>2.4.1 服务端配置</h4><p>获取配置文件路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rpm -qc rsync</span><br><span class="line">	/etc/rsyncd.conf			# 主配置文件</span><br><span class="line">	/etc/sysconfig/rsyncd		# 选项</span><br></pre></td></tr></table></figure>

<p>编辑配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/rsyncd.conf</span><br><span class="line">---------------------</span><br><span class="line">uid = rsync</span><br><span class="line">gid = rsync</span><br><span class="line">port = 873</span><br><span class="line">fake super = yes</span><br><span class="line">use chroot = no</span><br><span class="line">max connections = 200</span><br><span class="line">timeout = 600</span><br><span class="line">ignore errors</span><br><span class="line">read only = false</span><br><span class="line">list = false</span><br><span class="line">auth users = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line">[backup]</span><br><span class="line">comment = welcome to oldboyedu backup!</span><br><span class="line">path = /backup</span><br></pre></td></tr></table></figure>

<p>配置详细解析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uid = rsync                      # 运行进程的用户</span><br><span class="line">gid = rsync                      # 运行进程的用户组</span><br><span class="line">port = 873                       # 监听端口</span><br><span class="line">fake super = yes                 # 无需让rsync以root身份运行，允许接收文件的完整属性</span><br><span class="line">use chroot = no                  # 禁锢推送的数据至某个目录, 不允许跳出该目录</span><br><span class="line">max connections = 200            # 最大连接数</span><br><span class="line">timeout = 600                    # 超时时间</span><br><span class="line">ignore errors                    # 忽略错误信息</span><br><span class="line">read only = false                # 对备份数据可读写</span><br><span class="line">list = false                     # 不允许查看模块信息</span><br><span class="line">auth users = rsync_backup        # 定义虚拟用户，作为连接认证用户</span><br><span class="line">secrets file = /etc/rsync.passwd # 定义rsync服务用户连接认证密码文件路径</span><br><span class="line">log file = /var/log/rsyncd.log   # 日志文件</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line">[backup]                # 定义模块信息</span><br><span class="line">comment = commit        # 模块注释信息</span><br><span class="line">path = /backup          # 定义接收备份数据目录</span><br></pre></td></tr></table></figure>

<p>创建rsync进程启动时需要使用的用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# useradd rsync -M -s /sbin/nologin </span><br><span class="line">[root@backup ~]# id rsync</span><br><span class="line">uid=1000(rsync) gid=1000(rsync) groups=1000(rsync)</span><br></pre></td></tr></table></figure>

<p>创建密码文件，在密码文件中写入对应的虚拟用户以及虚拟用户的密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/rsync.passwd---》rsync虚拟用户以及rsync虚拟用户的密码</span><br><span class="line">[root@backup ~]# echo &quot;rsync_backup:123456&quot; &gt; /etc/rsync.passwd</span><br><span class="line">[root@backup ~]# chmod 600 /etc/rsync.passwd </span><br></pre></td></tr></table></figure>

<p>创建存储备份数据的目录，并进行授权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# mkdir /backup</span><br><span class="line">[root@backup ~]# chown -R rsync.rsync /backup/</span><br></pre></td></tr></table></figure>

<p>启动rsync服务并加入开机自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# systemctl start rsyncd.service </span><br><span class="line">[root@backup ~]# systemctl enable rsyncd</span><br></pre></td></tr></table></figure>

<p>检查rsync的873端口是否存在</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# netstat -lntup</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp6       0      0 :::873                  :::*                    LISTEN      1269/rsync</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-客户端测试"><a href="#2-4-2-客户端测试" class="headerlink" title="2.4.2 客户端测试"></a>2.4.2 客户端测试</h4><p>推送&#x2F;etc文件夹到服务端&#x2F;backup</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync -avz /etc/ rsync_backup@172.16.1.41::backup</span><br><span class="line">需要输入密码</span><br></pre></td></tr></table></figure>

<p>从服务端&#x2F;backup拉取文件到&#x2F;tmp</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync -avz rsync_backup@172.16.1.41::backup /tmp</span><br><span class="line">需要输入密码</span><br></pre></td></tr></table></figure>

<h3 id="2-5-rsync补充"><a href="#2-5-rsync补充" class="headerlink" title="2.5 rsync补充"></a>2.5 rsync补充</h3><h4 id="2-5-1-无差异同步-慎用"><a href="#2-5-1-无差异同步-慎用" class="headerlink" title="2.5.1 无差异同步(慎用)"></a>2.5.1 无差异同步(慎用)</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">推送方式实现无差异，以客户端为准，客户端有什么服务端就有什么</span></span><br><span class="line">[root@nfs ~]# rsync -avz --delete /root rsync_backup@172.16.1.41::backup		</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">拉取方式实现无差异，以服务端为准，服务端有什么客户端就有什么</span></span><br><span class="line">[root@nfs ~]# rsync -avz --delete rsync_backup@172.16.1.41::backup /opt/</span><br></pre></td></tr></table></figure>

<h4 id="2-5-2-传输限速"><a href="#2-5-2-传输限速" class="headerlink" title="2.5.2 传输限速"></a>2.5.2 传输限速</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成大文件</span></span><br><span class="line">[root@nfs ~]# dd if=/dev/zero of=./size.disk bs=1M count=500  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 限制传输的速率为1MB</span> </span><br><span class="line">[root@nfs ~]# rsync -avzP --bwlimit=1 ./size.disk rsync_backup@172.16.1.41::backup</span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">size.disk</span><br><span class="line">    118,358,016  22%    1.01MB/s    0:06:33</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-取消每次传输需要输密码"><a href="#2-5-3-取消每次传输需要输密码" class="headerlink" title="2.5.3 取消每次传输需要输密码"></a>2.5.3 取消每次传输需要输密码</h4><p>在客户端配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">方式一：</span><br><span class="line">[root@nfs ~]# echo &quot;123456&quot; &gt; /etc/rsync.pass</span><br><span class="line">[root@nfs ~]# chmod 600 /etc/rsync.pass #上该文件找123456</span><br><span class="line">[root@nfs ~]# rsync -avzP --bwlimit=1 ./size.disk rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.pass</span><br><span class="line"></span><br><span class="line">方式二：写Shell脚本</span><br><span class="line">[root@nfs ~]# export RSYNC_PASSWORD=123456</span><br><span class="line">[root@nfs ~]# rsync -avzP ./size.disk rsync_backup@172.16.1.41::backup</span><br></pre></td></tr></table></figure>

<h2 id="三、Rsync备份案例"><a href="#三、Rsync备份案例" class="headerlink" title="三、Rsync备份案例"></a>三、Rsync备份案例</h2><blockquote>
<p>客户端需求<br>1.客户端提前准备存放的备份的目录，目录规则如下:&#x2F;backup&#x2F;nfs_172.16.1.31_2018-09-02<br>2.客户端在本地打包备份(系统配置文件、应用配置等)拷贝至&#x2F;backup&#x2F;nfs_172.16.1.31_2018-09-02<br>3.客户端最后将备份的数据进行推送至备份服务器<br>4.客户端每天凌晨1点定时执行该脚本<br>5.客户端本地保留最近7天的数据, 避免浪费磁盘空间</p>
<p>服务端需求<br>1.服务端部署rsync，用于接收客户端推送过来的备份数据<br>2.服务端需要每天校验客户端推送过来的数据是否完整<br>3.服务端需要每天校验的结果通知给管理员<br>4.服务端仅保留6个月的备份数据,其余的全部删除</p>
<p>注意：所有服务器的备份目录必须都为&#x2F;backup</p>
<p>1.客户端将需要备份的文件放入指定的目录中   &#x2F;backup&#x2F;nfs_172.16.1.31_2018-09-02<br>2.客户端每天凌晨1点使用rsync命令推送一次nfs_172.16.1.31_2018-09-0<br>3.客户端保留最近7天的数据即可</p>
</blockquote>
<h3 id="3-1-需求分析"><a href="#3-1-需求分析" class="headerlink" title="3.1 需求分析"></a>3.1 需求分析</h3><blockquote>
<p>1.我要备份什么？<br>&#x2F;etc&#x2F;fstab &#x2F;var&#x2F;spool&#x2F;cron&#x2F;USERNAME   &#x2F;server&#x2F;scripts</p>
<p>2.我要怎么备份？<br>&#x2F;backup&#x2F;主机名_ip地址_时间  命名的目录中</p>
<p>3.我要备份到哪？<br>rsync备份服务器   172.16.1.41</p>
</blockquote>
<h4 id="3-1-1-服务端配置"><a href="#3-1-1-服务端配置" class="headerlink" title="3.1.1 服务端配置"></a>3.1.1 服务端配置</h4><p>配置邮件服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# yum install mailx -y</span><br><span class="line">[root@backup ~]# vim /etc/mail.rc</span><br><span class="line">set from=12345@qq.com</span><br><span class="line">set smtp=smtps://smtp.qq.com:465</span><br><span class="line">set smtp-auth-user=12345@qq.com</span><br><span class="line">set smtp-auth-password=xxxxxx # 授权码</span><br><span class="line">set smtp-auth=login</span><br><span class="line">set ssl-verify=ignore</span><br><span class="line">set nss-config-dir=/etc/pki/nssdb/</span><br></pre></td></tr></table></figure>

<p>脚本编写</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# mkdir /server/scripts -p</span><br><span class="line">[root@backup ~]# cat /server/scripts/check_client_data.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1.定义变量</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">SRC=/backup</span><br><span class="line">DATE=$(date +%F)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">1.使用md5进行校验，并保存校验的结果</span></span><br><span class="line">md5sum -c $SRC/*_$DATE/flag_$DATE &gt; $SRC/result_$DATE</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">2.将保存的结果文件发送给管理员</span></span><br><span class="line">mail -s &quot;Rsync Backup $DATE&quot; 572891887@qq.com &lt;$SRC/result_$DATE</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">3.保留最近180天的数据</span></span><br><span class="line">find $SRC/ -type d -mtime +180|xargs rm -rf </span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-客户端配置"><a href="#3-1-2-客户端配置" class="headerlink" title="3.1.2 客户端配置"></a>3.1.2 客户端配置</h4><p>创建目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /backup</span><br><span class="line">mkdir -p /server/scripts/</span><br></pre></td></tr></table></figure>

<p>编写备份脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# cat /server/scripts/client_push_data.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1.定义变量</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">SRC=/backup</span><br><span class="line">HOST=$(hostname)</span><br><span class="line">ADDR=$(ifconfig eth1|awk &#x27;NR==2 &#123;print $2&#125;&#x27;)</span><br><span class="line">DATE=$(date +%F)</span><br><span class="line">DEST=$&#123;HOST&#125;_$&#123;ADDR&#125;_$&#123;DATE&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">2.创建目录</span></span><br><span class="line">[ -d $SRC/$DEST ] || mkdir -p $SRC/$DEST</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">3.备份文件</span></span><br><span class="line">cd / &amp;&amp; \</span><br><span class="line">[ -f $SRC/$DEST/sys.tar.gz ] || tar czf $SRC/$DEST/sys.tar.gz etc/fstab etc/passwd &amp;&amp; \</span><br><span class="line">[ -f $SRC/$DEST/other.tar.gz ] || tar czf $SRC/$DEST/other.tar.gz var/spool/cron/ server/scripts &amp;&amp; \</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">4.使用md5打标记</span></span><br><span class="line">[ -f $SRC/$DEST/flag_$DATE ] || md5sum $SRC/$DEST/*.tar.gz  &gt; $SRC/$DEST/flag_$DATE </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">4.本地推送到备份服务器</span></span><br><span class="line">export RSYNC_PASSWORD=123456</span><br><span class="line">rsync -avz $SRC/$DEST rsync_backup@172.16.1.41::backup</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">5.保留本地最近7天的数据</span></span><br><span class="line">find $SRC/ -type d -mtime +7|xargs rm -rf </span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-整体测试-设置定时任务"><a href="#3-1-3-整体测试-设置定时任务" class="headerlink" title="3.1.3 整体测试:设置定时任务"></a>3.1.3 整体测试:设置定时任务</h4><p>客户端每两分钟备份推送一次</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs backup]# crontab -e</span><br><span class="line">*/2 * * * * sh /server/scripts/client_push_data.sh</span><br></pre></td></tr></table></figure>

<p>服务端每3分钟校验一次，并发送确认邮件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup scripts]# crontab -e</span><br><span class="line">*/3 * * * * sh /server/scripts/check_client_data.sh</span><br></pre></td></tr></table></figure>

<h4 id="3-1-5-增加客户端数量"><a href="#3-1-5-增加客户端数量" class="headerlink" title="3.1.5 增加客户端数量"></a>3.1.5 增加客户端数量</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">多创建几台客户端服务器，测试</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--03-NFS服务器搭建</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/03-NFS%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<ul>
<li>学习笔记</li>
</ul>
<hr>
<h2 id="一、NFS简介"><a href="#一、NFS简介" class="headerlink" title="一、NFS简介"></a>一、NFS简介</h2><blockquote>
<p>NFS是Network File System的缩写及网络文件系统。NFS主要功能是通过局域网络让不同的主机系统之间可以共享文件或目录。<br>NFS系统和Windows网络共享、网络驱动器类似, 只不过windows用于局域网, NFS用于企业集群架构中<br>如果是大型网站, 会用到更复杂的分布式文件系统FastDFS（音频、小说、视频）,glusterfs（iso镜像）,HDFS<br>NFS（图片、）解决共享前端web共享</p>
</blockquote>
<h3 id="1-1-NFS有什么用？"><a href="#1-1-NFS有什么用？" class="headerlink" title="1.1 NFS有什么用？"></a>1.1 NFS有什么用？</h3><p>解决前端web静态资源的共享<br>解决前端web静态资源一致性<br>解决前端web磁盘空间的浪费</p>
<h3 id="1-2-NFS的文件操作方式"><a href="#1-2-NFS的文件操作方式" class="headerlink" title="1.2 NFS的文件操作方式"></a>1.2 NFS的文件操作方式</h3><p>1.当用户执行mkdir命令, 该命令会调用shell解释器翻译给内核。<br>2.内核解析完成后会驱动对应的硬件设备，完成相应的操作。</p>
<h3 id="1-3-NFS的实现原理"><a href="#1-3-NFS的实现原理" class="headerlink" title="1.3 NFS的实现原理"></a>1.3 NFS的实现原理</h3><p>1.用户进程访问NFS客户端，使用不同的函数对数据进行处理<br>2.NFS客户端通过TCP&#x2F;IP的方式传递给NFS服务端。<br>3.NFS服务端接收到请求后，会先调用portmap进程进行端口映射。<br>4.nfsd进程用于判断NFS客户端是否拥有权限连接NFS服务端。<br>5.Rpc.mount进程判断客户端是否有对应的权限进行验证。<br>6.idmap进程实现用户映射和压缩<br>7.最后NFS服务端会将对应请求的函数转换为本地能识别的命令，传递至内核，由内核驱动硬件。<br>注意: rpc是一个远程过程调用，那么使用nfs必须有rpc服务</p>
<h3 id="1-4-NFS的优缺点"><a href="#1-4-NFS的优缺点" class="headerlink" title="1.4 NFS的优缺点"></a>1.4 NFS的优缺点</h3><p>优点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.NFS文件系统简单易用、方便部署、数据可靠、服务稳定、满足中小企业需求。</span><br><span class="line">2.NFS文件系统内存放的数据都在文件系统之上，所有数据都是能看得见。</span><br></pre></td></tr></table></figure>

<p>缺点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.存在单点故障, 如果构建高可用维护麻烦</span><br><span class="line"><span class="meta">web-&gt;</span><span class="bash">nfs(sersync)-&gt;backup</span></span><br><span class="line">2.NFS数据明文, 并不对数据做任何校验。</span><br><span class="line">3.客户端挂载NFS服务没有密码验证, 安全性一般(内网使用)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3.NFS应用建议<br>1.生产场景应将静态数据尽可能往前端推, 减少后端存储压力<br>2.必须将存储里的静态资源通过CDN缓存jpg\png\mp4\avi\css\js<br>3.如果没有缓存或架构本身历史遗留问题太大, 在多存储也无用</p>
</blockquote>
<h2 id="二、NFS部署"><a href="#二、NFS部署" class="headerlink" title="二、NFS部署"></a>二、NFS部署</h2><h3 id="2-1-服务端"><a href="#2-1-服务端" class="headerlink" title="2.1 服务端"></a>2.1 服务端</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# yum install nfs-utils -y</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# cat /etc/exports</span><br><span class="line">/data 172.16.1.0/24(rw,sync,all_squash)</span><br></pre></td></tr></table></figure>

<p>授权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# mkdir /data</span><br><span class="line">[root@nfs ~]# chown -R nfsnobody.nfsnobody /data/</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# systemctl start nfs-server</span><br><span class="line">[root@nfs ~]# systemctl enable nfs-server</span><br></pre></td></tr></table></figure>

<p>检查</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# cat /var/lib/nfs/etab </span><br><span class="line">/data	172.16.1.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,all_squash)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-客户端"><a href="#2-2-客户端" class="headerlink" title="2.2 客户端"></a>2.2 客户端</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# yum install nfs-utils -y</span><br></pre></td></tr></table></figure>

<p>检查nfs是否有共享内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# showmount -e 172.16.1.31</span><br><span class="line">Export list for 172.16.1.31:	</span><br><span class="line">/data 172.16.1.0/24</span><br></pre></td></tr></table></figure>

<p>挂载nfs目录（临时）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# mount -t nfs 172.16.1.31:/data /opt</span><br><span class="line">[root@web01 ~]# df -h</span><br><span class="line">Filesystem         Size  Used Avail Use% Mounted on</span><br><span class="line">172.16.1.31:/data   99G  1.8G   98G   2% /opt</span><br></pre></td></tr></table></figure>

<p>挂载nfs目录（永久）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# vim /etc/fstab </span><br><span class="line">172.16.1.31:/data  /opt  nfs  defaults  0  0</span><br><span class="line">[root@web01 ~]# mount -a   #验证fstab开机启动是否填写错误。</span><br></pre></td></tr></table></figure>

<h3 id="2-3-NFS配置参数说明"><a href="#2-3-NFS配置参数说明" class="headerlink" title="2.3 NFS配置参数说明"></a>2.3 NFS配置参数说明</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ro				只读权限</span><br><span class="line">root_squash		当NFS客户端以root管理员访问时，映射为NFS服务器的匿名用户(不常用)</span><br><span class="line">no_root_squash	当NFS客户端以root管理员访问时，映射为NFS服务器的root管理员(不常用)</span><br><span class="line">no_all_squash	无论NFS客户端使用什么账户访问，都不进行压缩</span><br><span class="line">async			优先将数据保存到内存，然后再写入硬盘；这样效率更高，但可能会丢失数据</span><br><span class="line"></span><br><span class="line">rw*				读写权限</span><br><span class="line">sync*			同时将数据写入到内存与硬盘中，保证不丢失数据</span><br><span class="line">all_squash*		无论NFS客户端使用什么账户访问，均映射为NFS服务器的匿名用户(常用)</span><br><span class="line">anonuid*		配置all_squash使用,指定NFS的用户UID,必须存在系统</span><br><span class="line">anongid*		配置all_squash使用,指定NFS的用户UID,必须存在系统</span><br></pre></td></tr></table></figure>

<h3 id="2-4-验证ro权限"><a href="#2-4-验证ro权限" class="headerlink" title="2.4 验证ro权限"></a>2.4 验证ro权限</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# cat /etc/exports</span><br><span class="line">/data 172.16.1.0/24(ro,sync,all_squash)</span><br><span class="line">[root@nfs ~]# systemctl restart nfs-server</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# touch /opt/ttt</span><br><span class="line">touch: cannot touch ‘/opt/ttt’: Read-only file system		#通常这样的错误都是设定的ro权限导致</span><br></pre></td></tr></table></figure>

<h3 id="2-5-验证all-squash、anonuid、anongid权限"><a href="#2-5-验证all-squash、anonuid、anongid权限" class="headerlink" title="2.5 验证all_squash、anonuid、anongid权限"></a>2.5 验证all_squash、anonuid、anongid权限</h3><p>服务端</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nfs ~]# cat /etc/exports</span><br><span class="line">/data 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line">创建用户</span><br><span class="line">[root@nfs ~]# groupadd -g 666 www</span><br><span class="line">[root@nfs ~]# useradd -u666 -g666 www</span><br><span class="line">[root@nfs ~]# id www</span><br><span class="line">uid=666(www) gid=666(www) groups=666(www)</span><br><span class="line">授权</span><br><span class="line">[root@nfs ~]# chown -R www.www /data/</span><br><span class="line">重启</span><br><span class="line">[root@nfs ~]# systemctl restart nfs-server</span><br></pre></td></tr></table></figure>

<p>客户端重新挂载验证</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 opt]# touch file</span><br><span class="line">[root@web01 opt]# touch test</span><br><span class="line">[root@web01 opt]# ll</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 666 666 0 Jan  7 11:29 file</span><br><span class="line">-rw-r--r-- 1 666 666 0 Jan  7 11:29 test</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS:由于客户端没有创建id为666的www用户，因此看到的属组和属主都是666</p>
</blockquote>
<p>客户端如果觉得666不好看，建议在客户端上创建同名的用户以及uid</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# groupadd -g 666 www</span><br><span class="line">[root@web01 ~]# useradd -u 666 -g 666 www</span><br><span class="line">[root@web01 ~]# id www</span><br><span class="line">uid=666(www) gid=666(www) groups=666(www)</span><br><span class="line">[root@web01 ~]# ll /opt/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 www www 0 Jan  7 11:29 file</span><br><span class="line">-rw-r--r-- 1 www www 0 Jan  7 11:29 test</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--05--SSH服务器搭建</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/05-ssh%E6%9C%8D%E5%8A%A1%E8%B7%B3%E6%9D%BF%E6%9C%BA%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="一、SSH服务器介绍"><a href="#一、SSH服务器介绍" class="headerlink" title="一、SSH服务器介绍"></a>一、SSH服务器介绍</h2><blockquote>
<p>SSH是一个安全协议，在进行数据传输时，会对数据包进行加密处理，加密后在进行数据传输。确保了数据传输安全。</p>
</blockquote>
<p><img src="/img/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95.png" alt="ssh免密登录"></p>
<h3 id="1-ssh的功能"><a href="#1-ssh的功能" class="headerlink" title="1 ssh的功能"></a>1 ssh的功能</h3><ol>
<li>提供远程连接服务器的服务</li>
<li>对传输的数据进行加密</li>
</ol>
<h3 id="2-常用服务的端口"><a href="#2-常用服务的端口" class="headerlink" title="2 常用服务的端口"></a>2 常用服务的端口</h3><ul>
<li>ftp – tcp&#x2F;20  tcp&#x2F;21</li>
<li>dns – tcp&#x2F;53  udp&#x2F;53</li>
<li>ssh  –  tcp&#x2F;22</li>
<li>telnet – tcp&#x2F;23 </li>
<li>mysql – tcp&#x2F;3306</li>
<li>http – tcp&#x2F;80</li>
<li>https – tcp&#x2F;443</li>
</ul>
<h3 id="3-telnet服务搭建"><a href="#3-telnet服务搭建" class="headerlink" title="3 telnet服务搭建"></a>3 telnet服务搭建</h3><p>安装并启动telnet服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# yum install telnet-server -y</span><br><span class="line">[root@backup ~]# systemctl start telnet.socket </span><br><span class="line">[root@backup ~]# useradd gs</span><br><span class="line">[root@backup ~]# echo &quot;1&quot; | passwd --stdin gs</span><br></pre></td></tr></table></figure>

<p>使用终端软件通过telnet使用gs用户登录连接</p>
<h3 id="4-telnet与ssh的对比"><a href="#4-telnet与ssh的对比" class="headerlink" title="4 telnet与ssh的对比"></a>4 telnet与ssh的对比</h3><table>
<thead>
<tr>
<th>服务连接方式</th>
<th>服务数据传输</th>
<th>服务监听端口</th>
<th>服务登陆用户</th>
</tr>
</thead>
<tbody><tr>
<td>ssh</td>
<td>加密</td>
<td>tcp&#x2F;22</td>
<td>默认支持root登录</td>
</tr>
<tr>
<td>telnet</td>
<td>明文</td>
<td>tcp&#x2F;23</td>
<td>不支持root登录</td>
</tr>
</tbody></table>
<h2 id="二、ssh与scp的使用"><a href="#二、ssh与scp的使用" class="headerlink" title="二、ssh与scp的使用"></a>二、ssh与scp的使用</h2><h3 id="1-使用ssh"><a href="#1-使用ssh" class="headerlink" title="1 使用ssh"></a>1 使用ssh</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh命令</span><br><span class="line">	ssh 172.16.1.31					#取决当前执行此命令的用户</span><br><span class="line">	ssh root@172.16.1.31			#标准的写法</span><br><span class="line">	ssh -p22 root@172.16.1.31		#带端口</span><br></pre></td></tr></table></figure>

<h3 id="2-使用scp"><a href="#2-使用scp" class="headerlink" title="2 使用scp"></a>2 使用scp</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp </span><br><span class="line"><span class="meta">#</span><span class="bash"> -P 指定端口，默认22端口可不写</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -r 表示递归拷贝目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 表示在拷贝文件前后保持文件或目录属性不变</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -l 限制传输使用带宽(默认kb) /8 -&gt;KB  /1024  -&gt;MB</span> </span><br></pre></td></tr></table></figure>

<h2 id="三、使用ssh密钥登录"><a href="#三、使用ssh密钥登录" class="headerlink" title="三、使用ssh密钥登录"></a>三、使用ssh密钥登录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.生成密钥对    公钥  私钥</span><br><span class="line">[root@m01 ~]# ssh-keygen -C 7242xxxxx@qq.com</span><br><span class="line">	</span><br><span class="line">2.将公钥推送到你需要连接的主机，第一次需要输入对端主机的密码</span><br><span class="line">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.31</span><br><span class="line">root@172.16.1.31&#x27;s password:</span><br><span class="line">	</span><br><span class="line">3.通过ssh命令测试连接是否需要密码</span><br><span class="line">[root@m01 ~]# ssh 172.16.1.31</span><br><span class="line">Last login: Wed Jan  9 10:39:16 2019 from 172.16.1.61</span><br></pre></td></tr></table></figure>

<h2 id="四、ssh安全"><a href="#四、ssh安全" class="headerlink" title="四、ssh安全"></a>四、ssh安全</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@jumpserver ~]# vim /etc/ssh/sshd_config</span><br><span class="line">[root@jumpserver ~]# systemctl restart sshd</span><br></pre></td></tr></table></figure>

<p>SSH作为远程连接服务，通常我们需要考虑到该服务的安全，所以需要对该服务进行安全方面的配置。<br>1.更改远程连接登陆的端口		6666<br>2.禁止ROOT管理员直接登录		<br>3.密码认证方式改为密钥认证<br>4.重要服务不使用公网IP地址<br>5.使用防火墙限制来源IP地址</p>
<p>Port 6666                       # 变更SSH服务远程连接端口√<br>PermitRootLogin         no      # 禁止root用户直接远程登录√<br>PasswordAuthentication  no      # 禁止使用密码直接远程登录√<br>UseDNS                  no      # 禁止ssh进行dns反向解析，影响ssh连接效率参数√<br>GSSAPIAuthentication    no      # 禁止GSS认证，减少连接时产生的延迟√</p>
<h2 id="五、防ssh暴力破解工具fail2ban"><a href="#五、防ssh暴力破解工具fail2ban" class="headerlink" title="五、防ssh暴力破解工具fail2ban"></a>五、防ssh暴力破解工具fail2ban</h2><blockquote>
<p>fail2ban可以监控系统日志，并且根据一定规则匹配异常IP后使用Firewalld将其屏蔽，尤其是针对一些爆破&#x2F;扫描等非常有效。</p>
</blockquote>
<p>部署流程</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.开启Firewalld防火墙</span><br><span class="line">[root@bgx ~]# systemctl start firewalld</span><br><span class="line">[root@bgx ~]# systemctl enable firewalld</span><br><span class="line">[root@bgx ~]# firewall-cmd --state</span><br><span class="line">running</span><br><span class="line"></span><br><span class="line">2.修改firewalld规则，启用Firewalld后会禁止一些服务的传输，但默认会放行常用的22端口, 如果想添加更多，以下是放行SSH端口（22）示例，供参考：</span><br><span class="line"><span class="meta">#</span><span class="bash">放行SSHD服务端口</span></span><br><span class="line">[root@bgx ~]# firewall-cmd --permanent --add-service=ssh --add-service=http </span><br><span class="line"><span class="meta">#</span><span class="bash">重载配</span></span><br><span class="line">[root@bgx ~]# firewall-cmd --reload</span><br><span class="line"><span class="meta">#</span><span class="bash">查看已放行端口</span></span><br><span class="line">[root@bgx ~]# firewall-cmd  --list-service</span><br><span class="line"></span><br><span class="line">3.安装fail2ban,需要有epel</span><br><span class="line">[root@bgx ~]# yum install fail2ban fail2ban-firewalld mailx -y</span><br><span class="line"></span><br><span class="line">4.配置fail2ban规则.local会覆盖.conf文件</span><br><span class="line">[root@bgx fail2ban]# cat /etc/fail2ban/jail.local</span><br><span class="line">[DEFAULT]</span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line">bantime  = 86400</span><br><span class="line">findtime = 600</span><br><span class="line">maxretry = 5</span><br><span class="line">banaction = firewallcmd-ipset</span><br><span class="line">action = %(action_mwl)s</span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">enabled = true</span><br><span class="line">filter  = sshd</span><br><span class="line">port    = 22</span><br><span class="line">action = %(action_mwl)s</span><br><span class="line">logpath = /var/log/secure</span><br><span class="line"></span><br><span class="line">5.启动服务，并检查状态</span><br><span class="line">[root@bgx ~]# systemctl start fail2ban.service</span><br><span class="line">[root@bgx ~]# fail2ban-client status sshd</span><br><span class="line"></span><br><span class="line">6.清除被封掉的IP地址</span><br><span class="line">[root@bgx ~]# fail2ban-client set sshd unbanip 10.0.0.1</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--04--Sersync实时备份</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/04-sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%A4%87%E4%BB%BD/</url>
    <content><![CDATA[<h2 id="一、Sersync服务介绍"><a href="#一、Sersync服务介绍" class="headerlink" title="一、Sersync服务介绍"></a>一、Sersync服务介绍</h2><blockquote>
</blockquote>
<h3 id="1-为什么要用sersync"><a href="#1-为什么要用sersync" class="headerlink" title="1 为什么要用sersync"></a>1 为什么要用sersync</h3><ul>
<li>sersync是基于inotify开发的，类似于inotify-tools的工具</li>
<li>sersync可以记录下被监听目录中发生变化的（包括增加、删除、修改）具体某一个文件或者某一个目录的名字，然后使用rsync同步的时候，只同步发生变化的文件或者目录</li>
<li>因为服务异常导致的同步失败有记录，便于恢复，确保高可用！</li>
</ul>
<h3 id="2-rsync-inotify-tools与rsync-sersync架构的区别？"><a href="#2-rsync-inotify-tools与rsync-sersync架构的区别？" class="headerlink" title="2 rsync+inotify-tools与rsync+sersync架构的区别？"></a>2 rsync+inotify-tools与rsync+sersync架构的区别？</h3><ul>
<li><p>rsync+inotify-tools</p>
<p>a、inotify只能记录下被监听的目录发生了变化（增，删，改）并没有把具体是哪个文件或者哪个目录发生了变化记录下来；</p>
<p>b、rsync在同步的时候，并不知道具体是哪个文件或目录发生了变化，每次都是对整个目录进行同步，当数据量很大时，整个目录同步非常耗时（rsync要对整个目录遍历查找对比文件），因此效率很低</p>
</li>
<li><p>rsync+sersync</p>
<p>a、sersync可以记录被监听目录中发生变化的（增，删，改）具体某个文件或目录的名字；</p>
<p>b、rsync在同步时，只同步发生变化的文件或目录（每次发生变化的数据相对整个同步目录数据来说很小，rsync在遍历查找对比文件时，速度很快），因此效率很高。</p>
</li>
</ul>
<h2 id="二、同步过程和原理"><a href="#二、同步过程和原理" class="headerlink" title="二、同步过程和原理"></a>二、同步过程和原理</h2><h3 id="1-同步过程"><a href="#1-同步过程" class="headerlink" title="1 同步过程"></a>1 同步过程</h3><ol>
<li>在同步服务器上开启sersync服务，sersync负责监控配置路径中的文件系统事件变化</li>
<li>调用rsync命令把更新的文件同步到目标服务器；</li>
<li>需要在主服务器配置sersync，在同步目标服务器配置rsync server（注意：是rsync服务</li>
</ol>
<h3 id="2-同步原理"><a href="#2-同步原理" class="headerlink" title="2 同步原理"></a>2 同步原理</h3><ol>
<li>用户实时的往sersync服务器上写入更新文件数据；</li>
<li>此时需要在同步主服务器上配置sersync服务；</li>
<li>在另一台服务器开启rsync守护进程服务，以同步拉取来自sersync服务器上的数据；</li>
</ol>
<blockquote>
<p>通过rsync的守护进程服务后可以发现，实际上sersync就是监控本地的数据写入或更新事件；然后，再调用rsync客户端的命令，将写入或更新事件对应的文件通过rsync推送到目标服务器。</p>
</blockquote>
<h2 id="三、案例"><a href="#三、案例" class="headerlink" title="三、案例"></a>三、案例</h2><blockquote>
<p>案例: 实现web上传视频文件，实则是写入NFS至存储，当NFS存在新的数据则会实时的复制到备份服务器</p>
</blockquote>
<table>
<thead>
<tr>
<th>角色</th>
<th>内网IP(LAN)</th>
<th>外网IP(NAT)</th>
<th>安装工具</th>
</tr>
</thead>
<tbody><tr>
<td>web01</td>
<td>eth1:172.16.1.7</td>
<td>eth0:10.0.0.7</td>
<td>httpd php</td>
</tr>
<tr>
<td>nfs-server</td>
<td>eth1:172.16.1.31</td>
<td>eth0:10.0.0.31</td>
<td>nfsServer、rsync+inotify+sersync</td>
</tr>
<tr>
<td>backup</td>
<td>eth1:172.16.1.41</td>
<td>eth0:10.0.0.41</td>
<td>rsync-server</td>
</tr>
</tbody></table>
<p><img src="/img/sersync%E6%B5%81%E7%A8%8B-1628145534424.png" alt="sersync流程"></p>
<h3 id="1-web上传视频至nfs存储"><a href="#1-web上传视频至nfs存储" class="headerlink" title="1 web上传视频至nfs存储"></a>1 web上传视频至nfs存储</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nfs存储服务  172.16.1.31</span><br><span class="line">	1.安装</span><br><span class="line">		[root@nfs ~]# yum install nfs-utils -y</span><br><span class="line">	2.配置</span><br><span class="line">		[root@nfs ~]# cat /etc/exports</span><br><span class="line">		/data 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line">		</span><br><span class="line">		[root@nfs ~]# groupadd -g666 www</span><br><span class="line">		[root@nfs ~]# useradd -u666 -g666 www</span><br><span class="line">		</span><br><span class="line">		[root@nfs ~]# mkdir /data</span><br><span class="line">		[root@nfs ~]# chown -R www.www /data</span><br><span class="line">		</span><br><span class="line">	3.启动</span><br><span class="line">		[root@nfs ~]# systemctl restart nfs-server</span><br><span class="line">		[root@nfs ~]# sysytemctl enable nfs-server</span><br><span class="line">		</span><br><span class="line">web服务器操作：172.16.1.7</span><br><span class="line">	1.安装</span><br><span class="line">		[root@web01 ~]# yum install httpd php -y</span><br><span class="line">	2.配置</span><br><span class="line">		进程运行的身份（最好是和nfs的匿名用户保持一致）</span><br><span class="line"><span class="meta">			#</span><span class="bash"> sed c 匹配到User开头的字段，替换为User www</span></span><br><span class="line">			[root@web01 html]# sed -i &#x27;/^User/c User www&#x27; /etc/httpd/conf/httpd.conf 	</span><br><span class="line">			[root@web01 html]# sed -i &#x27;/^Group/c Group www&#x27; /etc/httpd/conf/httpd.conf</span><br><span class="line">		挂载</span><br><span class="line">			[root@web01 ~]# mount -t nfs 172.16.1.31:/data /var/www/html		#核心</span><br><span class="line">		上传代码</span><br><span class="line">			[root@web01 ~]# cd /var/www/html/</span><br><span class="line">			[root@web01 html]# rz kaoshi.zip</span><br><span class="line">			[root@web01 html]# unzip kaoshi.zip</span><br><span class="line">	3.启动</span><br><span class="line">		[root@web01 ~]# systemctl start httpd</span><br><span class="line"></span><br><span class="line">	4.修改上传大小</span><br><span class="line">		[root@web01 ~]# vim /etc/php.ini中设置：</span><br><span class="line">		upload_max_filesize = 200M;</span><br><span class="line">		post_max_size = 200M;</span><br><span class="line">	</span><br><span class="line">	5.注意: 修改完配置记得重启服务</span><br><span class="line">	[root@web01 ~]#  systemctl restart httpd</span><br></pre></td></tr></table></figure>

<h3 id="2-web和nfs的数据都备份在备份服务器的-x2F-backup"><a href="#2-web和nfs的数据都备份在备份服务器的-x2F-backup" class="headerlink" title="2 web和nfs的数据都备份在备份服务器的&#x2F;backup"></a>2 web和nfs的数据都备份在备份服务器的&#x2F;backup</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">备份服务器操作如下：172.16.1.41</span><br><span class="line">	1.安装</span><br><span class="line">		[root@backup ~]# yum install rsync -y</span><br><span class="line">	2.配置</span><br><span class="line">		[root@backup ~]# cat /etc/rsyncd.conf</span><br><span class="line">		uid = www</span><br><span class="line">		gid = www</span><br><span class="line">		port = 873</span><br><span class="line">		fake super = yes</span><br><span class="line">		use chroot = no</span><br><span class="line">		max connections = 200</span><br><span class="line">		timeout = 600</span><br><span class="line">		ignore errors</span><br><span class="line">		read only = false</span><br><span class="line">		list = true</span><br><span class="line">		auth users = rsync_backup</span><br><span class="line">		secrets file = /etc/rsync.passwd</span><br><span class="line">		log file = /var/log/rsyncd.log</span><br><span class="line"><span class="meta">		#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line">		[backup]</span><br><span class="line">		path = /backup</span><br><span class="line">		</span><br><span class="line">		[data]</span><br><span class="line">		path = /data</span><br><span class="line">		</span><br><span class="line">		创建用户</span><br><span class="line">			[root@backup ~]# groupadd -g666 www</span><br><span class="line">			[root@backup ~]# useradd -u666 -g666 www</span><br><span class="line">		</span><br><span class="line">		准备虚拟连接用户账号和密码</span><br><span class="line">		[root@backup ~]# cat /etc/rsync.passwd </span><br><span class="line">		rsync_backup:123456</span><br><span class="line">		[root@backup ~]# chmod 600 /etc/rsync.passwd</span><br><span class="line">		</span><br><span class="line">		创建数据存放的目录</span><br><span class="line">		[root@backup ~]# mkdir -p /data /backup</span><br><span class="line">		[root@backup ~]# chown -R www.www /data/ /backup/</span><br><span class="line"></span><br><span class="line">	3.启动</span><br><span class="line">		[root@backup ~]# systemctl restart rsyncd</span><br><span class="line"></span><br><span class="line">	4.客户端执行脚本。测试rsync的备份是否ok   （客户端的数据都写入到/backup目录中） 172.16.1.7 172.16.1.31</span><br><span class="line">	[root@web01 ~]# sh /server/scripts/client_push_data.sh </span><br><span class="line">	sending incremental file list</span><br><span class="line">	web01_172.16.1.7_2019-01-08/</span><br><span class="line">	web01_172.16.1.7_2019-01-08/flag_2019-01-08</span><br><span class="line">	web01_172.16.1.7_2019-01-08/other.tar.gz</span><br><span class="line">	web01_172.16.1.7_2019-01-08/sys.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="3-如何将nfs的数据实时的同步到备份服务器的-x2F-data目录"><a href="#3-如何将nfs的数据实时的同步到备份服务器的-x2F-data目录" class="headerlink" title="3 如何将nfs的数据实时的同步到备份服务器的&#x2F;data目录"></a>3 如何将nfs的数据实时的同步到备份服务器的&#x2F;data目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">监控nfs服务器上面的/data目录，如果发生变化则触发动作，动作可以是执行一次同步。</span><br><span class="line">1.安装</span><br><span class="line">	[root@nfs ~]# yum install inotify-tools		监控工具</span><br><span class="line">	</span><br><span class="line">	[root@nfs ~]# rz -E sersync2.5.4_64bit_binary_stable_final.tar.gz	</span><br><span class="line">	[root@nfs ~]# tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">	[root@nfs ~]# mv GNU-Linux-x86/ /usr/local/sersync</span><br><span class="line">2.配置</span><br><span class="line">	[root@nfs sersync]# diff confxml.xml confxml.xml.bak</span><br><span class="line">       5c5</span><br><span class="line">       &lt;     &lt;fileSystem xfs=&quot;true&quot;/&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;     &lt;fileSystem xfs=&quot;false&quot;/&gt;</span><br><span class="line">       15c15</span><br><span class="line">       &lt;       &lt;createFile start=&quot;true&quot;/&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;       &lt;createFile start=&quot;false&quot;/&gt;</span><br><span class="line">       19,20c19,20</span><br><span class="line">       &lt;       &lt;attrib start=&quot;true&quot;/&gt;</span><br><span class="line">       &lt;       &lt;modify start=&quot;true&quot;/&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;       &lt;attrib start=&quot;false&quot;/&gt;</span><br><span class="line">       &gt;       &lt;modify start=&quot;false&quot;/&gt;</span><br><span class="line">       24,25c24,25</span><br><span class="line">       &lt;       &lt;localpath watch=&quot;/data&quot;&gt;</span><br><span class="line">       &lt;           &lt;remote ip=&quot;172.16.1.41&quot; name=&quot;data&quot;/&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;       &lt;localpath watch=&quot;/opt/tongbu&quot;&gt;</span><br><span class="line">       &gt;           &lt;remote ip=&quot;127.0.0.1&quot; name=&quot;tongbu1&quot;/&gt;</span><br><span class="line">       30,31c30,31</span><br><span class="line">       &lt;           &lt;commonParams params=&quot;-az&quot;/&gt;</span><br><span class="line">       &lt;           &lt;auth start=&quot;true&quot; users=&quot;rsync_backup&quot; passwordfile=&quot;/etc/rsync.pass&quot;/&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;           &lt;commonParams params=&quot;-artuz&quot;/&gt;</span><br><span class="line">       &gt;           &lt;auth start=&quot;false&quot; users=&quot;root&quot; passwordfile=&quot;/etc/rsync.pas&quot;/&gt;</span><br><span class="line">       33c33</span><br><span class="line">       &lt;           &lt;timeout start=&quot;true&quot; time=&quot;100&quot;/&gt;&lt;!-- timeout=100 --&gt;</span><br><span class="line">       ---</span><br><span class="line">       &gt;           &lt;timeout start=&quot;false&quot; time=&quot;100&quot;/&gt;&lt;!-- timeout=100 --&gt;</span><br><span class="line"></span><br><span class="line">	创建客户端密码文件</span><br><span class="line">	[root@nfs ~]# cat /etc/rsync.pass</span><br><span class="line">	123456</span><br><span class="line">	[root@nfs ~]# chmod 600 /etc/rsync.pass</span><br><span class="line"></span><br><span class="line">3.启动</span><br><span class="line">[root@nfs ~]# /usr/local/sersync/sersync2  -h</span><br><span class="line">set the system param</span><br><span class="line">execute：echo 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：echo 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the command param</span><br><span class="line">_______________________________________________________</span><br><span class="line">参数-d:启用守护进程模式</span><br><span class="line">参数-r:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">参数-n: 指定开启守护线程的数量，默认为10个</span><br><span class="line">参数-o:指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数-m:单独启用其他模块，使用 -m refreshCDN 开启刷新CDN模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m socket 开启socket模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m http 开启http模块</span><br><span class="line">不加-m参数，则默认执行同步程序</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">[root@nfs ~]#  /usr/local/sersync/sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动sersync后一定要提取同步的命令，手动运行一次，检查是否存在错误</span></span><br><span class="line">[root@nfs ~]#  cd /data &amp;&amp; rsync -az -R --delete ./  --timeout=100 rsync_backup@172.16.1.41::data --password-file=/etc/rsync.pass</span><br><span class="line"></span><br><span class="line">停止</span><br><span class="line">[root@nfs data]# pkill sersync</span><br></pre></td></tr></table></figure>

<h3 id="4-如何平滑的迁移nfs数据到backup服务器。并且让后续的上传都是上传至backup-（不能出现业务中断）"><a href="#4-如何平滑的迁移nfs数据到backup服务器。并且让后续的上传都是上传至backup-（不能出现业务中断）" class="headerlink" title="4 如何平滑的迁移nfs数据到backup服务器。并且让后续的上传都是上传至backup   （不能出现业务中断）"></a>4 如何平滑的迁移nfs数据到backup服务器。并且让后续的上传都是上传至backup   （不能出现业务中断）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.backup服务器上需要运行和nfs服务器上一样的业务环境 </span><br><span class="line">	创建用户</span><br><span class="line">	[root@backup ~]# groupadd -g 666 www</span><br><span class="line">	[root@backup ~]# useradd -u666 -g666 www</span><br><span class="line">	配置</span><br><span class="line">	[root@backup ~]# yum install -y nfs-utils -y</span><br><span class="line">	[root@backup ~]# cat /etc/exports</span><br><span class="line">	/data 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line">	启动</span><br><span class="line">	[root@backup ~]# systemctl restart nfs-server</span><br><span class="line">	</span><br><span class="line">2.先实现实时的同步 √</span><br><span class="line"></span><br><span class="line">3.在web上实现切换，卸载nfs的/data目录，重新挂载backup服务的/data目录</span><br><span class="line">	[root@web01 ~]# umount -lf /var/www/html/ &amp;&amp; mount -t nfs 172.16.1.41:/data /var/www/html/</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--06--HTTP协议介绍</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/06-HTTP%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h2 id="一、HTTP的发展历程"><a href="#一、HTTP的发展历程" class="headerlink" title="一、HTTP的发展历程"></a>一、HTTP的发展历程</h2><p>HTTP协议始于三十年前蒂姆·伯纳斯 - 李的一篇论文</p>
<p>HTTP&#x2F;0.9 (是个简单的文本协议，只能获取文本资源；)</p>
<p>HTTP&#x2F;1.0 - 1996年 （确立了大部分现在使用的技术，参考文档，不具备实际约束力）</p>
<p>HTTP&#x2F;1.1 - 1999年 （正式标准严格遵守，功能也非常完善，互联网爆发式增长，目前互联网上使用最广泛的协议） </p>
<p>HTTP&#x2F;2 - 2015年 （基于 Google 的 SPDY 协议，注重性能改善，但还未普及）</p>
<p>HTTP&#x2F;3 - 2018年 （基于 Google 的 QUIC 协议，是将来的发展方向）</p>
<hr>
<p>课下作业</p>
<ol>
<li>你认为推动 HTTP 发展的原动力是什么？</li>
<li>你是怎么理解 HTTP（超文本传输协议）的？</li>
</ol>
<h2 id="二、HTTP简介"><a href="#二、HTTP简介" class="headerlink" title="二、HTTP简介"></a>二、HTTP简介</h2><p>HyperText transfer protocol （超文本传输协议）</p>
<ul>
<li>HTTP 是一个用在计算机世界里的协议，它确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。</li>
<li>HTTP 专门用来在两点之间传输数据，不能用于广播、寻址或路由。</li>
<li>HTTP 传输的是文字、图片、音频、视频等超文本数据。</li>
<li>HTTP 是构建互联网的重要基础技术，它没有实体，依赖许多其他的技术来实现，但同时许多技术也都依赖于它。</li>
</ul>
<hr>
<p>课下作业：</p>
<ol>
<li>有一种流行的说法：“HTTP 是用于从互联网服务器传输超文本到本地浏览器的协议”，你认为这种说法对吗？对在哪里，又错在哪里？</li>
<li>你能再说出几个“HTTP 不是什么”吗？</li>
</ol>
<p><img src="/img/http%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png" alt="http思维导图"></p>
<h3 id="三、HTTP的应用领域"><a href="#三、HTTP的应用领域" class="headerlink" title="三、HTTP的应用领域"></a>三、HTTP的应用领域</h3><ol>
<li>互联网上绝大部分资源都使用 HTTP 协议传输；</li>
<li>浏览器是 HTTP 协议里的请求方，即 User Agent；</li>
<li>服务器是 HTTP 协议里的应答方，常用的有 Apache 和 Nginx；</li>
<li>CDN 位于浏览器和服务器之间，主要起到缓存加速的作用；</li>
<li>爬虫是另一类 User Agent，是自动访问网络资源的程序。</li>
</ol>
<hr>
<p>课后作业：</p>
<ol>
<li>你觉得 CDN 在对待浏览器和爬虫时会有差异吗？为什么？</li>
<li>你怎么理解 WebService 与 Web Server 这两个非常相似的词？</li>
</ol>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(一)安装与配置</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/07-Nginx(%E4%B8%80)%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="一、Nginx简介"><a href="#一、Nginx简介" class="headerlink" title="一、Nginx简介"></a>一、Nginx简介</h2><p>参考网站：<a href="https://zhuanlan.zhihu.com/p/266153320">https://zhuanlan.zhihu.com/p/266153320</a></p>
<h2 id="二、Nginx安装"><a href="#二、Nginx安装" class="headerlink" title="二、Nginx安装"></a>二、Nginx安装</h2><p>​	nginx有两种安装方式，yum安装和源码编译安装</p>
<h3 id="2-1-yum安装（epel源）"><a href="#2-1-yum安装（epel源）" class="headerlink" title="2.1 yum安装（epel源）"></a>2.1 yum安装（epel源）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>

<h3 id="2-2-编译安装"><a href="#2-2-编译安装" class="headerlink" title="2.2 编译安装"></a>2.2 编译安装</h3><p>查看yum安装的nginx的编译参数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# nginx -V</span><br><span class="line">nginx version: nginx/1.20.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">built with OpenSSL 1.1.1g FIPS  21 Apr 2020</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic&#x27; --with-ld-opt=&#x27;-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E&#x27;</span><br></pre></td></tr></table></figure>

<p>源码获取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# wget http://nginx.org/download/nginx-1.20.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>构建与编译</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解压源码文件并进入文件夹内</span></span><br><span class="line">tar -vxf nginx-1.20.1.tar.gz &amp;&amp; cd nginx-1.20.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configure构建</span></span><br><span class="line">./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic&#x27; --with-ld-opt=&#x27;-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译并安装</span></span><br><span class="line">make -j 4 &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>错误解决</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 错误1：</span></span><br><span class="line">./configure: error: the invalid value in --with-ld-opt=&quot;-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E&quot;</span><br><span class="line">解决方法：</span><br><span class="line">yum -y install redhat-rpm-config.noarch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误2：</span></span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either disable the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span><br><span class="line">解决方法：</span><br><span class="line">yum install pcre-devel -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误3：</span></span><br><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either do not enable the modules, or install the OpenSSL library</span><br><span class="line">into the system, or build the OpenSSL library statically from the source</span><br><span class="line">with nginx by using --with-openssl=&lt;path&gt; option.</span><br><span class="line">解决方法：</span><br><span class="line">yum install openssl openssl-devel -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误4：</span></span><br><span class="line">./configure: error: the HTTP XSLT module requires the libxml2/libxslt</span><br><span class="line">libraries. You can either do not enable the module or install the libraries.</span><br><span class="line">解决方法：</span><br><span class="line">yum install libxml2 libxml2-devel libxslt  libxslt-devel -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误5：</span></span><br><span class="line">./configure: error: the HTTP image filter module requires the GD library.</span><br><span class="line">You can either do not enable the module or install the libraries.</span><br><span class="line">解决方法：</span><br><span class="line">yum -y install gd-devel</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误6：</span></span><br><span class="line">./configure: error: perl module ExtUtils::Embed is required</span><br><span class="line"></span><br><span class="line">解决方法： </span><br><span class="line">yum -y install perl-devel perl-ExtUtils-Embed</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 错误7：</span></span><br><span class="line">./configure: error: the Google perftools module requires the Google perftools library</span><br><span class="line">解决方法：</span><br><span class="line">yum install gperftools-devel.x86_64 gperftools-libs.x86_64 gperftools.x86_64 -y</span><br></pre></td></tr></table></figure>

<h3 id="2-3-启动和停止服务"><a href="#2-3-启动和停止服务" class="headerlink" title="2.3 启动和停止服务"></a>2.3 启动和停止服务</h3><p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 先关闭httpd服务，防止冲突</span></span><br><span class="line">[root@web01 ~]# systemctl stop httpd</span><br><span class="line">[root@web01 ~]# systemctl disable httpd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再启动nginx服务</span></span><br><span class="line">[root@web01 ~]# systemctl enable nginx</span><br><span class="line">[root@web01 html]# systemctl start nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 另一种启动方式</span></span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>

<p>停止服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop nginx </span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">nginx -s stop </span><br></pre></td></tr></table></figure>

<p>重启&#x2F;重载服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart/reload nginx</span><br><span class="line">nginx -s restart/reload </span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：重载reload和重启restart的差别</p>
<p>reload将会等服务进程执行完再重启，而restart则是强制重启</p>
</blockquote>
<h2 id="三、Nginx目录结构说明"><a href="#三、Nginx目录结构说明" class="headerlink" title="三、Nginx目录结构说明"></a>三、Nginx目录结构说明</h2><p>查看nginx的目录结构</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 html]# rpm -ql nginx</span><br></pre></td></tr></table></figure>

<p>参考链接：</p>
<p><a href="https://zhuanlan.zhihu.com/p/137262519">https://zhuanlan.zhihu.com/p/137262519</a></p>
<h2 id="四、Nginx配置文件说明"><a href="#四、Nginx配置文件说明" class="headerlink" title="四、Nginx配置文件说明"></a>四、Nginx配置文件说明</h2><blockquote>
<p>http server location扩展了解项<br>http{}层下允许有多个Server{}层，一个Server{}层下又允许有多个Location<br>http{} 标签主要用来解决用户的请求与响应。<br>server{} 标签主要用来响应具体的某一个网站。<br>location{} 标签主要用于匹配网站具体URL路径。</p>
</blockquote>
<p>主配置文件说明</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 html]# cat /etc/nginx/nginx.conf</span><br><span class="line">---核心模块---</span><br><span class="line">user nginx;	#nginx进程运行的用户</span><br><span class="line">worker_processes auto;	#nginx工作的进程数量</span><br><span class="line">error_log /var/log/nginx/error.log;	#nginx的错误日志【警告及其警告以上的都记录】</span><br><span class="line">pid /run/nginx.pid;	#nginx进程运行后的进程id</span><br><span class="line">---核心模块---</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">---事件模块---</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024; # 一个work进程的最大连接数</span><br><span class="line">    use epool;				 #使用epool网络模型</span><br><span class="line">&#125;</span><br><span class="line">---事件模块---</span><br><span class="line"></span><br><span class="line">---http核心层模块---</span><br><span class="line">http &#123;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 日志格式定义</span></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;	# 访问日志</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;	# 长连接超时时间</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line">    #gzip on;			#是否开启压缩功能			</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;	# 包含哪个目录下面的*.conf文件，用于写server</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;	# 监听端口</span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;		# 域名</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		#</span><span class="bash">charset koi8-r;			<span class="comment">#字符集</span></span></span><br><span class="line"></span><br><span class="line">		location / &#123;	 			#位置</span><br><span class="line">			root   /usr/share/nginx/html;	#代码的主文件位置</span><br><span class="line">			index  index.html index.htm;	#服务端默认返回给用户的文件</span><br><span class="line">		&#125;</span><br><span class="line">		location /test &#123;	 			#位置</span><br><span class="line">			root   /code/test/123/;	#代码的主文件位置</span><br><span class="line">			index  index.html index.htm;	#服务端默认返回给用户的文件</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">---http核心层模块---</span><br></pre></td></tr></table></figure>

<h2 id="五、案例：搭建web网站"><a href="#五、案例：搭建web网站" class="headerlink" title="五、案例：搭建web网站"></a>五、案例：搭建web网站</h2><p>准备配置文件ds</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# cat /etc/nginx/conf.d/game.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name game.oldboy.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                root /code;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照配置文件创建文件夹并放入html项目文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /code</span><br><span class="line">cp html5.zip /code</span><br><span class="line">cd /code</span><br><span class="line">unzip html5.zip</span><br><span class="line"></span><br><span class="line">[root@web01 code]# ls</span><br><span class="line">ceshi  game  html5.zip  img  index.html  __MACOSX  readme.txt</span><br></pre></td></tr></table></figure>

<p>重启nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart nginx</span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>通过物理机浏览器浏览</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改hosts文件</span></span><br><span class="line">10.0.0.7 game.oldboy.com</span><br><span class="line"><span class="meta">#</span><span class="bash"> 网页访问</span></span><br><span class="line">game.oldboy.com</span><br></pre></td></tr></table></figure>

<h2 id="六、Nginx虚拟主机"><a href="#六、Nginx虚拟主机" class="headerlink" title="六、Nginx虚拟主机"></a>六、Nginx虚拟主机</h2><p>Nginx配置虚拟主机有如下三种方式：</p>
<ul>
<li>单主机多IP</li>
<li>单主机多端口</li>
<li>单主机多域名</li>
</ul>
<h3 id="6-1-基于主机多IP方式-不常用"><a href="#6-1-基于主机多IP方式-不常用" class="headerlink" title="6.1 基于主机多IP方式(不常用)"></a>6.1 基于主机多IP方式(不常用)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat ip.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 10.0.0.7:80;</span><br><span class="line">	server_name _;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /code_ip_eth0;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 172.16.1.7:80;</span><br><span class="line">	server_name _;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /code_ip_eth1;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.根据配置创建目录</span><br><span class="line">[root@web01 conf.d]# mkdir /code_ip_eth0</span><br><span class="line">[root@web01 conf.d]# echo &quot;Eth0&quot; &gt; /code_ip_eth0/index.html</span><br><span class="line"></span><br><span class="line">[root@web01 conf.d]# mkdir /code_ip_eth1</span><br><span class="line">[root@web01 conf.d]# echo &quot;Eth1&quot; &gt; /code_ip_eth1/index.html</span><br><span class="line"></span><br><span class="line">3.重启nginx服务</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line">4.使用curl命令测试</span><br><span class="line">[root@web01 ~]# curl 172.16.1.7</span><br><span class="line">Eth1</span><br><span class="line">[root@web01 ~]# curl 10.0.0.7</span><br><span class="line">Eth0</span><br></pre></td></tr></table></figure>

<h3 id="6-2-基于主机多端口方式（多用于内部测试）"><a href="#6-2-基于主机多端口方式（多用于内部测试）" class="headerlink" title="6.2 基于主机多端口方式（多用于内部测试）"></a>6.2 基于主机多端口方式（多用于内部测试）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.配置多端口的虚拟主机</span><br><span class="line">[root@web01 conf.d]# vim port.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 81;</span><br><span class="line">        </span><br><span class="line">        location / &#123; </span><br><span class="line">                root /code_81;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 82;</span><br><span class="line">        </span><br><span class="line">        location / &#123; </span><br><span class="line">                root /code_82;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;		</span><br><span class="line"></span><br><span class="line">2.根据配置文件创建所需的目录</span><br><span class="line">[root@web01 conf.d]# mkdir /code_8&#123;1..2&#125;</span><br><span class="line">[root@web01 conf.d]# echo &quot;81&quot; &gt; /code_81/index.html</span><br><span class="line">[root@web01 conf.d]# echo &quot;82&quot; &gt; /code_82/index.html</span><br><span class="line"></span><br><span class="line">3.检查语法并重启服务</span><br><span class="line">[root@web01 conf.d]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.如何去访问</span><br><span class="line">	http://10.0.0.7:82/</span><br></pre></td></tr></table></figure>

<h3 id="6-3-基于主机多域名方式（常用）"><a href="#6-3-基于主机多域名方式（常用）" class="headerlink" title="6.3 基于主机多域名方式（常用）"></a>6.3 基于主机多域名方式（常用）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.准备多虚拟主机配置文件</span><br><span class="line">[root@web01 conf.d]# cat test1.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name test1.oldboy.com;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /code/test1;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@web01 conf.d]# cat test2.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name test2.oldboy.com;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /code/test2;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.根据配置文件创建对应的目录</span><br><span class="line">[root@web01 conf.d]# mkdir /code/test&#123;1..2&#125; -p</span><br><span class="line">[root@web01 conf.d]# echo &quot;test1_server&quot; &gt; /code/test1/index.html</span><br><span class="line">[root@web01 conf.d]# echo &quot;test2_server&quot; &gt; /code/test2/index.html</span><br><span class="line">[root@web01 conf.d]# nginx -t</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line">3.配置域名解析</span><br><span class="line">10.0.0.7      test1.oldboy.com</span><br><span class="line">10.0.0.7      test2.oldboy.com</span><br><span class="line"></span><br><span class="line">4.通过浏览器访问该网站</span><br></pre></td></tr></table></figure>

<h2 id="七、日志与错误排查"><a href="#七、日志与错误排查" class="headerlink" title="七、日志与错误排查"></a>七、日志与错误排查</h2><h3 id="7-1-nginx配置文件自查"><a href="#7-1-nginx配置文件自查" class="headerlink" title="7.1 nginx配置文件自查"></a>7.1 nginx配置文件自查</h3><p>1.修改完配置记得检查语法</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -t</span></span><br></pre></td></tr></table></figure>

<p>2.如果没有检查语法，直接重载导致报错，可查看错误信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status nginx -l </span><br></pre></td></tr></table></figure>

<h3 id="7-2-访问日志"><a href="#7-2-访问日志" class="headerlink" title="7.2 访问日志"></a>7.2 访问日志</h3><p>可以为server和location单独设置访问日志（<em><strong>涉及日志作用域</strong></em>）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name code.oldboy.com;</span><br><span class="line">    </span><br><span class="line">    # 将当前的server网站的访问日志记录至对应的目录，使用main格式</span><br><span class="line">    access_log /var/log/nginx/code.oldboy.com.log main;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /code;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    # 当有人请求改favicon.ico时，不记录日志</span><br><span class="line">    location /favicon.ico &#123;</span><br><span class="line">        access_log off;  # off 关闭</span><br><span class="line">        return 200;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问日志参数详解</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>变量名称</strong></th>
<th><strong>变量描述</strong></th>
<th><strong>举例说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>113.140.15.90</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>–</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18&#x2F;Jul&#x2F;2012:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET &#x2F;pa&#x2F;img&#x2F;home&#x2F;logo-alipay-t.png HTTP&#x2F;1.1″</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td>img.alipay.com10.253.70.103</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>跳转来源</td>
<td>“<a href="https://cashier.alip/">https://cashier.alip</a>ay.com…&#x2F;”</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端代理</td>
<td>“Mozilla&#x2F;4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.228.35.247:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.205</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<h3 id="7-3-错误日志"><a href="#7-3-错误日志" class="headerlink" title="7.3 错误日志"></a>7.3 错误日志</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -f /var/log/nginx/error.log</span><br></pre></td></tr></table></figure>

<h3 id="7-4-日志切割logrotate"><a href="#7-4-日志切割logrotate" class="headerlink" title="7.4 日志切割logrotate"></a>7.4 日志切割logrotate</h3><p>配置文件，一般不需要修改，默认就行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 logrotate.d]# cat /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">    create 0640 nginx root	 	</span><br><span class="line">    daily	# 每天切割日志</span><br><span class="line">    rotate 10</span><br><span class="line">    missingok	# 日志丢失忽略</span><br><span class="line">    notifempty</span><br><span class="line">    compress	# 日志文件压缩</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -USR1 `cat /run/nginx.pid 2&gt;/dev/null` 2&gt;/dev/null || true</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(二)常用官方模块</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/08-Nginx(%E4%BA%8C)%E5%B8%B8%E7%94%A8%E5%AE%98%E6%96%B9%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>本篇主要介绍Nginx的常用官方模块</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h2 id="一、目录索引-autoindex"><a href="#一、目录索引-autoindex" class="headerlink" title="一、目录索引-autoindex"></a>一、目录索引-autoindex</h2><h3 id="1-1-使用方法1"><a href="#1-1-使用方法1" class="headerlink" title="1.1 使用方法1"></a>1.1 使用方法1</h3><p>按此方法设置后，访问网页<a href="http://module.test.com将显示文件目录/">http://module.test.com将显示文件目录</a></p>
<p>实际目录位于: &#x2F;module</p>
<p>a.准备配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 module]# cat /etc/nginx/conf.d/autoindex.conf</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name module.test.com;</span><br><span class="line">	charset utf-8,gbk; # 解决中文乱码</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /module;</span><br><span class="line">		autoindex on;	# 开启目录索引</span><br><span class="line">		autoindex_exact_size off;	# 显示文件大小，默认为on显示字节，off显示大概单位</span><br><span class="line">		autoindex_localtime on;	# 默认off显示UTC时间，on显示本地时间</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b.准备对应的目录，并往目录中添加文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /module/&#123;centos,ubuntu,redhat&#125;/ -p</span><br></pre></td></tr></table></figure>

<p>c.检查语法并重新加载nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -t </span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h3 id="1-2-使用方法2（推荐）"><a href="#1-2-使用方法2（推荐）" class="headerlink" title="1.2 使用方法2（推荐）"></a>1.2 使用方法2（推荐）</h3><p>按此方法设置后，访问网页<a href="http://www.module.test.com/download%E5%B0%86%E6%98%BE%E7%A4%BA%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95,%E4%B8%BB%E9%A1%B5%E5%8F%AF%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE">http://www.module.test.com/download将显示文件目录,主页可正常访问</a></p>
<p>实际目录位于：&#x2F;module&#x2F;download</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 module]# cat /etc/nginx/conf.d/autoindex.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name module.oldboy.com;</span><br><span class="line">	charset utf-8,gbk;</span><br><span class="line"></span><br><span class="line">	location / &#123;	# 主页可以正常访问</span><br><span class="line">		root /code;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location /download &#123;	# 当访问http://xxxx/download则访问/module/download文件夹，显示目录索引</span><br><span class="line">		root /module; # 此时，访问的文件夹是/module/download</span><br><span class="line">		autoindex on;</span><br><span class="line">		autoindex_exact_size off;</span><br><span class="line">		autoindex_localtime on;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、-状态监控页面-stub-status"><a href="#二、-状态监控页面-stub-status" class="headerlink" title="二、 状态监控页面-stub_status"></a>二、 状态监控页面-stub_status</h2><blockquote>
<p>需要nginx附带–with-http_stub_status_module模块才能使用</p>
</blockquote>
<h3 id="2-1-使用方法"><a href="#2-1-使用方法" class="headerlink" title="2.1 使用方法"></a>2.1 使用方法</h3><p>a.设置配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">在/etc/nginx/conf.d/autoindex.conf里面附加内容</span><br><span class="line">location /nginx_status &#123;</span><br><span class="line">	stub_status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b.重启Nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">重启nginx服务</span><br><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>c.网页访问测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">访问:</span><br><span class="line">http://module.test.com/nginx_status</span><br><span class="line">网页显示：</span><br><span class="line">Active connections: 2 </span><br><span class="line">server accepts handled requests</span><br><span class="line">		3 			3 	33 </span><br><span class="line">Reading: 0 Writing: 1 Waiting: 1 </span><br></pre></td></tr></table></figure>

<p>d.通过选项关闭长连接</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 注意, 一次TCP的连接，可以发起多次http的请求, 如下参数可配置进行验证</span></span><br><span class="line">keepalive_timeout  0;   # 类似于关闭长连接</span><br><span class="line">keepalive_timeout  65;  # 65s没有活动则断开连接</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">在/etc/nginx/conf.d/autoindex.conf里面的附加内容修改为</span><br><span class="line">location /nginx_status &#123;</span><br><span class="line">	stub_status;</span><br><span class="line">	keepalive_timeout  0; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>e.再次测试网页访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">关闭长连接后的显示：</span><br><span class="line">Active connections: 2 </span><br><span class="line">server accepts handled requests</span><br><span class="line"> 21 21 20 </span><br><span class="line">Reading: 0 Writing: 1 Waiting: 1 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 可见每次HTTP请求都要重新发起TCP连接</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-监控页面内容解释"><a href="#2-2-监控页面内容解释" class="headerlink" title="2.2 监控页面内容解释"></a>2.2 监控页面内容解释</h3><table>
<thead>
<tr>
<th>参数项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Active connections</td>
<td>当前活动客户端连接数，包括Waiting等待连接数</td>
</tr>
<tr>
<td>accepts</td>
<td>已接受总的TCP连接数</td>
</tr>
<tr>
<td>handled</td>
<td>已处理总的TCP连接数</td>
</tr>
<tr>
<td>requests</td>
<td>客户端总的http请求数</td>
</tr>
<tr>
<td>Reading</td>
<td>当前nginx读取请求头的连接数</td>
</tr>
<tr>
<td>Writing</td>
<td>当前nginx将响应写回客户端的连接数</td>
</tr>
<tr>
<td>Waiting</td>
<td>当前等待请求的空闲客户端连接数</td>
</tr>
</tbody></table>
<h2 id="三、基于IP的访问控制"><a href="#三、基于IP的访问控制" class="headerlink" title="三、基于IP的访问控制"></a>三、基于IP的访问控制</h2><blockquote>
<p>某网页内的数据比较重要，怎么控制那些人可以访问，那些人不能访问呢？</p>
</blockquote>
<p>可以来源的IP地址做限制，常用的三种控制方法：</p>
<ul>
<li><p>拒绝10.0.0.1来源IP访问，其他人允许</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location /nginx_status &#123;</span><br><span class="line">    stub_status;</span><br><span class="line">    deny 10.0.0.1/32;</span><br><span class="line">    allow all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许10.0.0.1来源IP访问，其他人全部拒绝</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location /nginx_status &#123;</span><br><span class="line">    stub_status;</span><br><span class="line">    allow 10.0.0.1/32;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实际配置监控Nginx状态时，仅允许该服务器的回环地址访问127.0.0.1</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 最安全</span></span><br><span class="line">location /nginx_status &#123;</span><br><span class="line">    stub_status;</span><br><span class="line">    allow 127.0.0.1;</span><br><span class="line">    deny all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="四、基于密码的身份验证"><a href="#四、基于密码的身份验证" class="headerlink" title="四、基于密码的身份验证"></a>四、基于密码的身份验证</h2><blockquote>
<p>重要数据网站，要实现需要用户名密码认证，怎么做呢？</p>
</blockquote>
<ol>
<li><p>生成一个密码文件，密码文件的格式  name:password(加密)  （建议使用htpasswd）  openssl password</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# yum install httpd-tools -y</span><br><span class="line">[root@web01 conf.d]# htpasswd -c -b /etc/nginx/auth_conf oldboy oldboy</span><br><span class="line">[root@web01 conf.d]# cat /etc/nginx/auth_conf</span><br><span class="line">oldboy:$apr1$Kp87VSae$658Nt5bm4iiblQkUvP7u61</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Nginx，限制对应的资源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location /download &#123;</span><br><span class="line">	root /module;</span><br><span class="line">	autoindex on;</span><br><span class="line">	autoindex_exact_size off;</span><br><span class="line">	autoindex_localtime on;</span><br><span class="line">	</span><br><span class="line">	auth_basic &quot;Please Password!!!&quot;;</span><br><span class="line">	auth_basic_user_file /etc/nginx/auth_conf; </span><br><span class="line"><span class="meta">	#</span><span class="bash"> 注意认证文件路径，否则网页认证后会403，可是为什么放其他目录就不行？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="五、Nginx连接限制"><a href="#五、Nginx连接限制" class="headerlink" title="五、Nginx连接限制"></a>五、Nginx连接限制</h2><blockquote>
<p>网站请求数太多，不堪重负了，怎么保障部分用户能够正常访问</p>
</blockquote>
<h3 id="5-1-限制连接数"><a href="#5-1-限制连接数" class="headerlink" title="5.1 限制连接数"></a>5.1 限制连接数</h3><p><code>设置共享内存区域和给定键值的最大允许连接数。超过此限制时，服务器将返回错误以回复请求</code></p>
<ul>
<li><p>编辑配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http标签段定义连接限制</span></span><br><span class="line">http&#123;</span><br><span class="line">    limit_conn_zone $binary_remote_addr zone=conn_zone:10m;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    # 同一时刻只允许一个客户端连接</span><br><span class="line">    limit_conn conn_zone 1; </span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /code;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用ab工具进行压力测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用ab工具进行压力测试</span></span><br><span class="line">[root@xuliangwei ~]# yum install -y httpd-tools</span><br><span class="line">[root@xuliangwei ~]# ab -n 500 -c 2  http://127.0.0.1/index.html</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可见500次中有失败的请求</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看拦截日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -f /var/log/nginx/error.log</span><br><span class="line">类似于</span><br><span class="line">2019/01/14 11:11:22 [error] 29962#29962: *19 limiting connections by zone &quot;conn_zone&quot;, client: 47.110.176.164, server: www.xuliangwei.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;www.xuliangwei.com&quot;</span><br><span class="line">2019/01/14 11:11:23 [error] 29962#29962: *19 limiting connections by zone &quot;conn_zone&quot;, client: 47.110.176.164, server: www.xuliangwei.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;www.xuliangwei.com&quot;</span><br><span class="line">2019/01/14 11:11:25 [error] 29962#29962: *19 limiting connections by zone &quot;conn_zone&quot;, client: 47.110.176.164, server: www.xuliangwei.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;www.xuliangwei.com&quot;</span><br><span class="line">2019/01/14 11:11:25 [error] 29962#29962: *19 limiting connections by zone &quot;conn_zone&quot;, client: 47.110.176.164, server: www.xuliangwei.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;www.xuliangwei.com&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-2-限制请求数（更精准）"><a href="#5-2-限制请求数（更精准）" class="headerlink" title="5.2 限制请求数（更精准）"></a>5.2 限制请求数（更精准）</h3><p><code>设置共享内存区域和请求的最大突发大小。过多的请求被延迟，直到它们的数量超过最大突发大小，在这种情况下请求以错误终止。默认情况下，最大突发大小等于零。</code></p>
<ul>
<li><p>定义限制的Key</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat test1.oldboy.com.conf </span><br><span class="line">limit_req_zone $binary_remote_addr zone=req_zone:10m rate=1r/s;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name test1.oldboy.com;</span><br><span class="line">	</span><br><span class="line">	limit_req zone=req_zone burst=5 nodelay;</span><br><span class="line">	limit_req_status 412;</span><br><span class="line">	error_page 412 /err.html;    #这个文件必须存在/code/test1/err.html</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		root /code/test1;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>填写hosts域名解析 （测试：域名访问才有效果，直接访问没效果）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;10.0.0.7 test1.oldboy.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>
</li>
<li><p>压力测试</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ab -n 50 -c 20 http://test1.oldboy.com/index.html</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看错误日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2019/01/14 11:28:22 [error] 2073#2073: *3 limiting requests, excess: 5.737 by zone &quot;req_zone&quot;, client: 10.0.0.1, server: test1.oldboy.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;test1.oldboy.com&quot;</span><br><span class="line">2019/01/14 11:28:22 [error] 2073#2073: *3 limiting requests, excess: 5.611 by zone &quot;req_zone&quot;, client: 10.0.0.1, server: test1.oldboy.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;test1.oldboy.com&quot;</span><br><span class="line">2019/01/14 11:28:22 [error] 2073#2073: *3 limiting requests, excess: 5.450 by zone &quot;req_zone&quot;, client: 10.0.0.1, server: test1.oldboy.com, request: &quot;GET / HTTP/1.1&quot;, host: &quot;test1.oldboy.com&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="六、Nginx匹配符和优先级"><a href="#六、Nginx匹配符和优先级" class="headerlink" title="六、Nginx匹配符和优先级"></a>六、Nginx匹配符和优先级</h2><p>Location语法示例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location [=|^~|~|~*|!~|!~*|/] /uri/ &#123; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>匹配优先级</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">匹配符	匹配规则						优先级</span><br><span class="line">=		精确匹配						1 	用到</span><br><span class="line">^~		以某个字符串开头				2</span><br><span class="line">~		区分大小写的正则匹配			3	常用</span><br><span class="line">~*		不区分大小写的正则匹配			4</span><br><span class="line">!~		区分大小写不匹配的正则			5</span><br><span class="line">!~*		不区分大小写不匹配的正则		6</span><br><span class="line">/		通用匹配，任何请求都会匹配到	7	常用</span><br></pre></td></tr></table></figure>

<h3 id="6-1-匹配案例"><a href="#6-1-匹配案例" class="headerlink" title="6.1 匹配案例"></a>6.1 匹配案例</h3><blockquote>
<p>参考网站：<a href="https://blog.csdn.net/qq_41980405/article/details/111402208">https://blog.csdn.net/qq_41980405/article/details/111402208</a></p>
</blockquote>
<ul>
<li><p>通用匹配，任何请求都会匹配到</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>严格区分大小写，匹配以.php结尾的都走这个location    </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>严格区分大小写，匹配以.jsp结尾的都走这个location </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.jsp$</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不区分大小写匹配，只要用户访问.jpg,gif,png,js,css 都走这条location</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* .*\.(jpg|gif|png|js|css|mp4)$</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不区分大小写匹配</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* &quot;\.(sql|bak|tgz|tar.gz|.git)$&quot;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(三)LNMP介绍</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/09-Nginx(%E4%B8%89)LNMP%E6%9E%B6%E6%9E%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="一、LNMP简介-需补充"><a href="#一、LNMP简介-需补充" class="headerlink" title="一、LNMP简介(需补充)"></a>一、LNMP简介(需补充)</h2><h3 id="1-1-什么是LNMP"><a href="#1-1-什么是LNMP" class="headerlink" title="1.1 什么是LNMP"></a>1.1 什么是LNMP</h3><h3 id="1-2-LNMP架构是如何工作的"><a href="#1-2-LNMP架构是如何工作的" class="headerlink" title="1.2 LNMP架构是如何工作的"></a>1.2 LNMP架构是如何工作的</h3><p>浏览器 –http–&gt; Nginx(fastcgi_pass) –fastcgi–&gt;php(fastcgi_fpm调动wrapper再调动php解析再调用mysql)</p>
<p>大致流程：</p>
<p>用户在浏览器发起请求，如果请求的是静态资源，Nginx则直接返回，如果请求的是动态资源，Nginx会通过fastcgi协议，将请求交给PHP服务器，再返回动态资源。</p>
<h3 id="1-3-LNMP和LAMP的区别是什么"><a href="#1-3-LNMP和LAMP的区别是什么" class="headerlink" title="1.3 LNMP和LAMP的区别是什么"></a>1.3 LNMP和LAMP的区别是什么</h3><p>nginx 是以fastcgi协议调用的php<br>apache是以模块的方式加载的php</p>
<h2 id="二、LNMP架构简单搭建"><a href="#二、LNMP架构简单搭建" class="headerlink" title="二、LNMP架构简单搭建"></a>二、LNMP架构简单搭建</h2><p>1、准备一台名为nginx的服务器</p>
<p>2、使用官方仓库安装nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加安装源</span></span><br><span class="line">[root@nginx ~]# cat /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装Nginx</span></span><br><span class="line">[root@nginx ~]# yum install nginx -y</span><br></pre></td></tr></table></figure>

<p>3、安装php7.1</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nginx ~]# yum remove php-mysql-5.4 php php-fpm php-common # 卸载默认5.4版本的php</span><br><span class="line">[root@nginx ~]# cat /etc/yum.repos.d/php.repo</span><br><span class="line">[php]</span><br><span class="line">name = php Repository</span><br><span class="line">baseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/</span><br><span class="line">gpgcheck = 0</span><br><span class="line"></span><br><span class="line">[root@nginx ~]# yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb</span><br></pre></td></tr></table></figure>

<p>4、安装maria数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nginx ~]# yum install mariadb-server mariadb -y</span><br></pre></td></tr></table></figure>

<p>5、配置nginx和php集成</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cd /etc/nginx/conf.d/</span><br><span class="line">[root@web01 conf.d]# cat php.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name php.oldboy.com;</span><br><span class="line">	root /code;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.php index.html;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">		include fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、重载nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>7、启动php-fpm，并加入开机自启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# systemctl start php-fpm</span><br><span class="line">[root@web01 conf.d]# systemctl enable  php-fpm</span><br></pre></td></tr></table></figure>

<p>8、准备一个php文件，测试nginx和php是否继承成功</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat /code/page.php</span><br><span class="line">&lt;?php</span><br><span class="line">	phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试：网页访问:http://php.oldboy.com/page.php</span></span><br></pre></td></tr></table></figure>

<p>9、启动数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# systemctl start mariadb</span><br><span class="line">[root@web01 conf.d]# systemctl enable mariadb</span><br><span class="line">[root@web01 conf.d]# mysqladmin password &#x27;Bgx123.com&#x27;		#配置密码（默认mysql是空密码）</span><br><span class="line">[root@web01 conf.d]# mysql -uroot -pBgx123.com				#使用账号和密码登录mysql</span><br></pre></td></tr></table></figure>

<p>10、准备一个php文件，测试是否可以正常连接数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $servername = &quot;localhost&quot;;</span><br><span class="line">  $username = &quot;root&quot;;</span><br><span class="line">  $password = &quot;Bgx123.com&quot;;</span><br><span class="line"></span><br><span class="line">  // 创建连接</span><br><span class="line">  $conn = mysqli_connect($servername, $username, $password);</span><br><span class="line"></span><br><span class="line">  // 检测连接</span><br><span class="line">  if (!$conn) &#123;</span><br><span class="line">      die(&quot;Connection failed: &quot; . mysqli_connect_error()); // 注意格式</span><br><span class="line">  &#125;</span><br><span class="line">  echo &quot;php连接MySQL数据库成功&quot;;</span><br><span class="line">  ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="三、案例-搭建wordpress博客"><a href="#三、案例-搭建wordpress博客" class="headerlink" title="三、案例-搭建wordpress博客"></a>三、案例-搭建wordpress博客</h2><h3 id="3-1-环境准备"><a href="#3-1-环境准备" class="headerlink" title="3.1 环境准备"></a>3.1 环境准备</h3><table>
<thead>
<tr>
<th>用途</th>
<th>公网IP地址</th>
<th>内网IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>web服务器01</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
</tr>
</tbody></table>
<h3 id="3-2-部署安装"><a href="#3-2-部署安装" class="headerlink" title="3.2 部署安装"></a>3.2 部署安装</h3><p>1、添加nginx配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat blog.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name blog.oldboy.com;</span><br><span class="line">	root /code/wordpress;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.php index.html;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">		include fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、根据nginx中定义的内容，创建站点目录并进行授权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# mkdir /code</span><br><span class="line">[root@web01 conf.d]# cd /code</span><br><span class="line">[root@web01 code]# wget https://cn.wordpress.org/wordpress-5.0.3-zh_CN.tar.gz</span><br><span class="line">[root@web01 code]# tar xf wordpress-5.0.3-zh_CN.tar.gz</span><br></pre></td></tr></table></figure>

<p>3、修改nginx与php-fpm的运行用户为www，并授权代码属主和属组都为www</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">注意：如果没有该用户，启动一定会报错</span></span><br><span class="line">[root@web01 code]# groupadd -g 666 www</span><br><span class="line">[root@web01 code]# useradd -u666 -g666 www</span><br><span class="line"></span><br><span class="line">修改nginx与php-fpm管理进程，的运行身份为www</span><br><span class="line">[root@web01 code]# sed -i &#x27;/^user /c user  www;&#x27; /etc/nginx/nginx.conf</span><br><span class="line">[root@web01 code]# sed -i &#x27;/^user/c user = www&#x27; /etc/php-fpm.d/www.conf </span><br><span class="line">[root@web01 code]# sed -i &#x27;/^group/c group = www&#x27; /etc/php-fpm.d/www.conf </span><br><span class="line"></span><br><span class="line">一定要重启才生效</span><br><span class="line">[root@web01 code]# systemctl restart nginx</span><br><span class="line">[root@web01 code]# systemctl restart php-fpm</span><br><span class="line"></span><br><span class="line">最后授权代码为www</span><br><span class="line">[root@web01 code]# chown -R www.www /code/wordpress	</span><br></pre></td></tr></table></figure>

<p>4、创建数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; create database wordpress;			#创建一个库，名称叫wordpress</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;						#查询该台数据库服务有多少个库</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| wordpress          |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>5、解决nginx上传文件大小限制（默认1M，超过大小会报413）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">在wordpress的nginx配置文件中添加：client_max_body_size 100m;</span><br><span class="line">[root@web01 code]# cat /etc/nginx/conf.d/blog.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name blog.oldboy.com;</span><br><span class="line">        root /code/wordpress;</span><br><span class="line">        client_max_body_size 100m;  # 默认1M，超过大小会报413</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                index index.php index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">                fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">                include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">重启nginx：systemctl restart nginx	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试在wordpress页面上传主题或者写文章上传图片，均出现500报错<br>查看日志文件&#x2F;var&#x2F;log&#x2F;nginx&#x2F;err.log<br>2021&#x2F;08&#x2F;16 18:59:31 [crit] 1228#1228: *2 open() “&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;client_body&#x2F;0000000001” failed (13: Permission denied), client: 10.0.0.1, server: php.gs.com, request: “POST &#x2F;wp-admin&#x2F;update.php?action&#x3D;upload-theme HTTP&#x2F;1.1”, host: “php.gs.com”, referrer: “<a href="http://php.gs.com/wp-admin/theme-install.php?browse=popular&quot;">http://php.gs.com/wp-admin/theme-install.php?browse=popular&quot;</a><br>解决方法，参考<a href="https://blog.csdn.net/qq_15941409/article/details/114640122">https://blog.csdn.net/qq_15941409/article/details/114640122</a><br>chown www:www -R &#x2F;var&#x2F;lib&#x2F;nginx&#x2F;</p>
</blockquote>
<h2 id="四、案例-搭建wecenter知乎"><a href="#四、案例-搭建wecenter知乎" class="headerlink" title="四、案例-搭建wecenter知乎"></a>四、案例-搭建wecenter知乎</h2><h3 id="4-1-部署安装"><a href="#4-1-部署安装" class="headerlink" title="4.1 部署安装"></a>4.1 部署安装</h3><p>1、添加nginx配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name zh.oldboy.com;</span><br><span class="line">	root /code/zh;</span><br><span class="line">	client_max_body_size 100m;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.php index.html;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">		include fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@web01 code]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>2、wencenter部署</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# rz -E WeCenter_3-2-1.zip</span><br><span class="line">[root@web01 code]# unzip WeCenter_3-2-1.zip</span><br><span class="line">[root@web01 code]# mv WeCenter_3-2-1 zh</span><br><span class="line">[root@web01 code]# chown -R www.www zh/</span><br></pre></td></tr></table></figure>

<p>3、配置数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# mysql -uroot -pBgx123.com</span><br><span class="line">MariaDB [(none)]&gt; create database zh;</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| wordpress          |</span><br><span class="line">| zh                 |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="五、案例-搭建edusoho在线视频教育"><a href="#五、案例-搭建edusoho在线视频教育" class="headerlink" title="五、案例-搭建edusoho在线视频教育"></a>五、案例-搭建edusoho在线视频教育</h2><h3 id="5-1-部署安装"><a href="#5-1-部署安装" class="headerlink" title="5.1 部署安装"></a>5.1 部署安装</h3><p>1、添加nginx配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# cat /etc/nginx/conf.d/edu.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name edu.oldboy.com;</span><br><span class="line">    root /code/edusoho/web;</span><br><span class="line">    client_max_body_size 200m;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index app.php;</span><br><span class="line">        try_files $uri @rewriteapp;</span><br><span class="line">    &#125;</span><br><span class="line">    location @rewriteapp &#123;</span><br><span class="line">        rewrite ^(.*)$ /app.php/$1 last;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/udisk &#123;</span><br><span class="line">        internal;</span><br><span class="line">        root /code/edusoho/app/data/;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/(app|app_dev)\.php(/|$) &#123;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.*)$;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_param  HTTPS              off;</span><br><span class="line">        fastcgi_param HTTP_X-Sendfile-Type X-Accel-Redirect;</span><br><span class="line">        fastcgi_param HTTP_X-Accel-Mapping /udisk=/code/edusoho/app/data/udisk;</span><br><span class="line">        fastcgi_buffer_size 128k;</span><br><span class="line">        fastcgi_buffers 8 128k;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 配置设置图片格式文件</span><br><span class="line">    location ~* \.(jpg|jpeg|gif|png|ico|swf)$ &#123;</span><br><span class="line">        # 过期时间为3年</span><br><span class="line">        expires 3y;</span><br><span class="line">        # 关闭日志记录</span><br><span class="line">        access_log off;</span><br><span class="line">        # 关闭gzip压缩，减少CPU消耗，因为图片的压缩率不高。</span><br><span class="line">        gzip off;</span><br><span class="line">    &#125;</span><br><span class="line">    # 配置css/js文件</span><br><span class="line">    location ~* \.(css|js)$ &#123;</span><br><span class="line">        access_log off;</span><br><span class="line">        expires 3y;</span><br><span class="line">    &#125;</span><br><span class="line">    # 禁止用户上传目录下所有.php文件的访问，提高安全性</span><br><span class="line">    location ~ ^/files/.*\.(php|php5)$ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 以下配置允许运行.php的程序，方便于其他第三方系统的集成。</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.*)$;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_param  HTTPS              off;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、下载edusoho,并授权文件夹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://download.edusoho.com/edusoho-8.2.17.tar.gz</span><br><span class="line">tar xf edusoho-8.2.17.tar.gz</span><br><span class="line">chown -R www.www edusoho</span><br></pre></td></tr></table></figure>

<p>3、调整php的上传大小(上传文件默认有限制大小)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# vim /etc/php.ini</span><br><span class="line">post_max_size = 200M</span><br><span class="line">upload_max_filesize = 200M</span><br><span class="line">[root@web01 code]# systemctl restart php-fpm</span><br></pre></td></tr></table></figure>

<h2 id="六、各开源项目网站"><a href="#六、各开源项目网站" class="headerlink" title="六、各开源项目网站"></a>六、各开源项目网站</h2><p>phpmyadmin	<a href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a><br>zblog	<a href="https://www.zblogcn.com/">https://www.zblogcn.com/</a><br>wordpress	<a href="https://cn.wordpress.org/">https://cn.wordpress.org/</a><br>wecenter	<a href="http://www.wecenter.com/downloads/">http://www.wecenter.com/downloads/</a><br>edusohu	<a href="http://www.edusoho.com/open/show">http://www.edusoho.com/open/show</a></p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(四)LNMP架构拆分</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/10-Nginx(%E5%9B%9B)LNMP%E6%9E%B6%E6%9E%84%E6%8B%86%E5%88%86/</url>
    <content><![CDATA[<h2 id="一、拆分数据库"><a href="#一、拆分数据库" class="headerlink" title="一、拆分数据库"></a>一、拆分数据库</h2><blockquote>
<p>为什么要拆分数据库?</p>
<p>mysql内存占用大，容易引起网页访问速度变慢，甚至oom(out of memory)被系统自动kill掉，不安全</p>
</blockquote>
<h3 id="1-2-环境准备"><a href="#1-2-环境准备" class="headerlink" title="1.2 环境准备"></a>1.2 环境准备</h3><table>
<thead>
<tr>
<th>主机名称</th>
<th>应用环境</th>
<th>外网地址</th>
<th>内网地址</th>
</tr>
</thead>
<tbody><tr>
<td>web01</td>
<td>nginx+php</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
</tr>
<tr>
<td>db01</td>
<td>mysql</td>
<td></td>
<td>172.16.1.51</td>
</tr>
</tbody></table>
<h3 id="1-2-拆分过程"><a href="#1-2-拆分过程" class="headerlink" title="1.2 拆分过程"></a>1.2 拆分过程</h3><p>1、备份172.16.1.7服务器上mysql的数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# mysqldump -uroot -p&#x27;Bgx123.com&#x27; --all-databases --single-transaction &gt; mysql-all.sql</span><br></pre></td></tr></table></figure>

<p>2、传输172.16.1.7的备份数据至172.16.1.51的服务器上</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# scp mysql-all.sql root@172.16.1.51:/tmp</span><br></pre></td></tr></table></figure>

<p>3、需要先在172.16.1.51服务器上安装mysql服务，然后使用mysql命令进行还原。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@db01 ~]# yum install mariadb-server mariadb -y</span><br><span class="line">[root@db01 ~]# systemctl enable mariadb</span><br><span class="line">[root@db01 ~]# systemctl start mariadb</span><br><span class="line">[root@db01 ~]# mysql &lt;/tmp/mysql-all.sql</span><br><span class="line">[root@db01 ~]# systemctl restart mariadb</span><br><span class="line">[root@db01 ~]# mysql -uroot -pBgx123.com</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| edusoho            |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| wordpress          |</span><br><span class="line">| zh                 |</span><br><span class="line">+--------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>4、将web程序连接的本地数据库修改到远程数据库上。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1）先在本地172.16.1.7服务器上停止本地的数据库</span><br><span class="line">[root@web01 ~]# systemctl disable mariadb</span><br><span class="line">[root@web01 ~]# systemctl stop mariadb</span><br><span class="line"></span><br><span class="line">2）在172.16.1.51的服务器上授权远程主机能够能连接mysql数据库</span><br><span class="line">[root@db01 ~]# mysql -uroot -pBgx123.com</span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on *.* to oldboy@&#x27;%&#x27; identified by &#x27;Bgx123.com&#x27;;</span><br><span class="line">解释：</span><br><span class="line">*.*: 所有数据库下的所有表</span><br><span class="line">oldboy@&#x27;%&#x27;: 允许所有网段的oldboy用户访问</span><br><span class="line">identify: 设置密码</span><br><span class="line"></span><br><span class="line">3）在172.16.1.7服务器上测试远程账户能否连接172.16.1.51的数据库</span><br><span class="line">[root@web01 wordpress]# yum install mariadb -y</span><br><span class="line">[root@web01 wordpress]# mysql -h 172.16.1.51 -uoldboy -pBgx123.com</span><br><span class="line">MariaDB [(none)]&gt; </span><br><span class="line"></span><br><span class="line">4）在172.16.1.7服务器上修改web程序连接数据库的配置文件</span><br><span class="line">[root@web01 wordpress]# vim /code/wordpress/wp-config.php</span><br><span class="line">// ** MySQL 设置 - 具体信息来自您正在使用的主机 ** //</span><br><span class="line">/** WordPress数据库的名称 */</span><br><span class="line">define(&#x27;DB_NAME&#x27;, &#x27;wordpress&#x27;);</span><br><span class="line"></span><br><span class="line">/** MySQL数据库用户名 */</span><br><span class="line">define(&#x27;DB_USER&#x27;, &#x27;oldboy&#x27;);</span><br><span class="line"></span><br><span class="line">/** MySQL数据库密码 */</span><br><span class="line">define(&#x27;DB_PASSWORD&#x27;, &#x27;Bgx123.com&#x27;);</span><br><span class="line"></span><br><span class="line">/** MySQL主机 */</span><br><span class="line">define(&#x27;DB_HOST&#x27;, &#x27;172.16.1.51&#x27;);</span><br></pre></td></tr></table></figure>

<p>5、拆分172.16.1.7wecenter连接远程172.16.1.51数据库信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 zh]# grep -R &quot;Bgx123.com&quot; *</span><br><span class="line">	system/config/database.php:  &#x27;password&#x27; =&gt; &#x27;Bgx123.com&#x27;,</span><br><span class="line">[root@web01 zh]# vim /code/zh/system/config/database.php </span><br><span class="line"><span class="meta">	$</span><span class="bash">config[<span class="string">&#x27;driver&#x27;</span>] = <span class="string">&#x27;MySQLi&#x27;</span>;^M</span></span><br><span class="line"><span class="meta">	$</span><span class="bash">config[<span class="string">&#x27;master&#x27;</span>] = array (</span></span><br><span class="line">	  &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;,</span><br><span class="line">	  &#x27;host&#x27; =&gt; &#x27;172.16.1.51&#x27;,</span><br><span class="line">	  &#x27;username&#x27; =&gt; &#x27;oldboy&#x27;,</span><br><span class="line">	  &#x27;password&#x27; =&gt; &#x27;Bgx123.com&#x27;,</span><br><span class="line">	  &#x27;dbname&#x27; =&gt; &#x27;zh&#x27;,</span><br><span class="line">	);^M</span><br></pre></td></tr></table></figure>

<p>6、拆分172.16.1.7 edusoho连接远程172.16.1.51数据库信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 edusoho]# vim /code/edusoho/app/config/parameters.yml</span><br><span class="line">database_driver: pdo_mysql</span><br><span class="line">database_host: 172.16.1.51</span><br><span class="line">database_port: 3306</span><br><span class="line">database_name: edusoho</span><br><span class="line">database_user: oldboy</span><br><span class="line">database_password: &#x27;Bgx123.com&#x27;</span><br><span class="line"></span><br><span class="line">必须清理缓存</span><br><span class="line">[root@web01 edusoho]# rm -rf /code/edusoho/app/cache/*</span><br></pre></td></tr></table></figure>

<h2 id="二、扩展多台web服务器"><a href="#二、扩展多台web服务器" class="headerlink" title="二、扩展多台web服务器"></a>二、扩展多台web服务器</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.统一环境</span><br><span class="line">    0）准备对应的www用户</span><br><span class="line">    [root@web02 ~]# groupadd -g666 www</span><br><span class="line">    [root@web02 ~]# useradd -u666 -g666 www</span><br><span class="line"></span><br><span class="line">    1）拷贝web01上面的yum仓库</span><br><span class="line">    [root@web02 ~]# scp root@172.16.1.7:/etc/yum.repos.d/*.repo /etc/yum.repos.d/</span><br><span class="line"></span><br><span class="line">    2）安装nginx和php</span><br><span class="line">    [root@web02 ~]# yum -y install nginx php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb</span><br><span class="line"></span><br><span class="line">2.统一配置（同步web01上面的配置到web02）</span><br><span class="line">    1）同步nginx</span><br><span class="line">    [root@web02 ~]# rsync  -avz --delete root@172.16.1.7:/etc/nginx/ /etc/nginx/</span><br><span class="line">    [root@web02 ~]# nginx -t</span><br><span class="line">    [root@web02 ~]# systemctl enable nginx</span><br><span class="line">    [root@web02 ~]# systemctl start nginx</span><br><span class="line"></span><br><span class="line">    2）同步php（/etc/php-fpm.conf /etc/php-fpm.d  /etc/php.ini）</span><br><span class="line">    [root@web02 ~]# rsync  -avz --delete root@172.16.1.7:/etc/php* /etc/</span><br><span class="line">    [root@web02 ~]# systemctl enable php-fpm</span><br><span class="line">    [root@web02 ~]# systemctl start php-fpm</span><br><span class="line"></span><br><span class="line">3.统一代码</span><br><span class="line">    [root@web01 ~]# tar czf code.tar.gz /code				#在web01上打包站点</span><br><span class="line">    [root@web01 ~]# scp code.tar.gz root@172.16.1.8:/tmp	#在web01上将打包好的代码发送给web02</span><br><span class="line">    [root@web02 ~]# tar xf /tmp/code.tar.gz -C /			#在web02上进行解压，并解压到/目录下</span><br><span class="line"></span><br><span class="line">4.配置解析，进行访问</span><br></pre></td></tr></table></figure>

<h2 id="三、NFS共享多台web的静态资源"><a href="#三、NFS共享多台web的静态资源" class="headerlink" title="三、NFS共享多台web的静态资源"></a>三、NFS共享多台web的静态资源</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.准备172.16.1.31共享存储服务器，规划目录，配置好权限</span><br><span class="line">    0）创建用户</span><br><span class="line">    [root@nfs ~]# groupadd -g666 www</span><br><span class="line">    [root@nfs ~]# useradd -u666 -g666 www	</span><br><span class="line"></span><br><span class="line">    1）安装</span><br><span class="line">    [root@nfs ~]# yum install nfs-utils -y</span><br><span class="line"></span><br><span class="line">    2）配置</span><br><span class="line">    [root@nfs ~]# cat /etc/exports</span><br><span class="line">    /data/blog 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line">    /data/zh 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line">    /data/edu 172.16.1.0/24(rw,sync,all_squash,anonuid=666,anongid=666)</span><br><span class="line"></span><br><span class="line">    3）根据配置，创建目录，准备用户，授权等等</span><br><span class="line">    [root@nfs ~]# rm -rf /data/</span><br><span class="line">    [root@nfs ~]# mkdir /data/&#123;blog,zh,edu&#125; -p</span><br><span class="line">    [root@nfs ~]# chown -R www.www /data/</span><br><span class="line"></span><br><span class="line">    4）启动</span><br><span class="line">    [root@nfs ~]# systemctl enable nfs-utils </span><br><span class="line">    [root@nfs ~]# systemctl restart nfs-utils</span><br><span class="line"></span><br><span class="line">2.将图片较多的web02服务器，推送到nfs共享存储上</span><br><span class="line">    http://blog.oldboy.com/wp-content/uploads/2019/01/timg.jpg</span><br><span class="line"></span><br><span class="line">    [root@web02 ~]# cd /code/wordpress/wp-content</span><br><span class="line">    [root@web02 wp-content]# scp -r uploads/* root@172.16.1.31:/data/blog/</span><br><span class="line"></span><br><span class="line">    注意：需要上nfs服务器上进行重新的递归授权，否则会出现无法上传文件的错误</span><br><span class="line">    [root@nfs ~]# chown -R www.www /data/</span><br><span class="line"></span><br><span class="line">3.web01和web02分别都进行挂载，此时图片进行实现了共享</span><br><span class="line">    mount -t nfs 172.16.1.31:/data/blog  /code/wordpress/wp-content/uploads/</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(五)代理介绍</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/11-Nginx(%E4%BA%94)Nginx%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<h2 id="一、什么是代理"><a href="#一、什么是代理" class="headerlink" title="一、什么是代理"></a>一、什么是代理</h2><h3 id="1-1-正向代理和反向代理的区别"><a href="#1-1-正向代理和反向代理的区别" class="headerlink" title="1.1 正向代理和反向代理的区别"></a>1.1 正向代理和反向代理的区别</h3><p>区别在于形式上服务的”对象”不一样<br>    正向代理代理的对象是客户端，为客户端服务   PC电脑<br>    反向代理代理的对象是服务端，为服务端服务	服务器</p>
<h3 id="1-2-Nginx反向代理模式配置模块"><a href="#1-2-Nginx反向代理模式配置模块" class="headerlink" title="1.2 Nginx反向代理模式配置模块"></a>1.2 Nginx反向代理模式配置模块</h3><p>反向代理模式				Nginx配置模块<br>http、websocket、https		ngx_http_proxy_module<br>fastcgi						ngx_http_fastcgi_module<br>uwsgi						ngx_http_uwsgi_module<br>grpc						ngx_http_v2_module</p>
<h2 id="二、Nginx代理配置"><a href="#二、Nginx代理配置" class="headerlink" title="二、Nginx代理配置"></a>二、Nginx代理配置</h2><h3 id="2-1-测试环境准备"><a href="#2-1-测试环境准备" class="headerlink" title="2.1 测试环境准备"></a>2.1 测试环境准备</h3><table>
<thead>
<tr>
<th>主机名称</th>
<th>应用环境</th>
<th>外网地址</th>
<th>内网地址</th>
</tr>
</thead>
<tbody><tr>
<td>web01</td>
<td>nginx + php（提供网页服务）</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
</tr>
<tr>
<td>lb01</td>
<td>nginx（提供代理服务）</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
</tr>
<tr>
<td>db01</td>
<td>mysql</td>
<td>10.0.0.51</td>
<td>172.16.1.51</td>
</tr>
</tbody></table>
<h3 id="2-2-Nginx代理配置步骤"><a href="#2-2-Nginx代理配置步骤" class="headerlink" title="2.2 Nginx代理配置步骤"></a>2.2 Nginx代理配置步骤</h3><p>1、<code>web01</code>-配置后端的web</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat web.oldboy.com.conf </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name web.oldboy.com;</span><br><span class="line">	root /web;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.php index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建文件夹和网页文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# mkdir /web</span><br><span class="line">[root@web01 conf.d]# echo &quot;Web01.....&quot; &gt; /web/index.html</span><br></pre></td></tr></table></figure>

<p>3、重启nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# nginx -t</span><br><span class="line">sysnginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">t[root@web01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>4、<code>lb01</code>-nginx代理配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# cat proxy_web.conf</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name web.oldboy.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://10.0.0.7:80;</span><br><span class="line"><span class="meta">		#</span><span class="bash"> 设置header将域名传过去</span></span><br><span class="line">		proxy_set_header Host $http_host; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、重启Nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>6、客户机设置hosts，并测试访问网页，可以正常显示web01页面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">10.0.0.5 web.oldboy.com</span><br></pre></td></tr></table></figure>

<p><img src="/img/image-20210820101740471.png" alt="image-20210820101740471"></p>
<h2 id="三、代理流程分析"><a href="#三、代理流程分析" class="headerlink" title="三、代理流程分析"></a>三、代理流程分析</h2><p>1、走10网关，wireshark的抓包截图如下</p>
<p><img src="/img/image-20210820102735419.png" alt="image-20210820102735419"></p>
<p>2、流程图</p>
<p><img src="/img/image-20210820103041679.png" alt="image-20210820103041679"></p>
<p>3、测试，关掉web01的公网ip网口(10.0.0.7)，再尝试访问，也可以正常访问到web01的网页</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# cat /etc/nginx/conf.d/proxy_web.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name  web.oldboy.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://172.16.1.7:80;</span><br><span class="line">                include /etc/nginx/proxy_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、抓包分析</p>
<p>因为172网段走的虚拟机内部网络，抓不到</p>
<p><img src="/img/image-20210820111454152.png" alt="image-20210820111454152"></p>
<h2 id="三、Nginx代理常用参数"><a href="#三、Nginx代理常用参数" class="headerlink" title="三、Nginx代理常用参数"></a>三、Nginx代理常用参数</h2><h3 id="3-1-常用参数解释"><a href="#3-1-常用参数解释" class="headerlink" title="3.1 常用参数解释"></a>3.1 常用参数解释</h3><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>proxy_pass <a href="http://10.0.0.7/">http://10.0.0.7:80</a>;</td>
<td></td>
</tr>
<tr>
<td>proxy_http_version 1.1;</td>
<td>代理向后端请求使用的版本</td>
</tr>
<tr>
<td>proxy_set_header Host $http_host;</td>
<td>代理向后端请求携带的域名</td>
</tr>
<tr>
<td>proxy_set_header X-Real-IP $remote_addr;</td>
<td><font color="blue">用于获取客户端真实IP（不如x-forward）</font></td>
</tr>
<tr>
<td>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</td>
<td><font color="blue">获取客户端真实IP及全链路IP</font></td>
</tr>
<tr>
<td>proxy_connect_timeout 30;</td>
<td>代理接连后端超时时间</td>
</tr>
<tr>
<td>proxy_send_timeout 60;</td>
<td>后端传递数据至代理的超时时间</td>
</tr>
<tr>
<td>proxy_read_timeout 60;</td>
<td>后端相应代理的超时时间</td>
</tr>
<tr>
<td>proxy_buffering on;</td>
<td>是否开启proxy的buffer功能</td>
</tr>
<tr>
<td>proxy_buffer_size 32k;</td>
<td>设置buffer大小</td>
</tr>
<tr>
<td>proxy_buffers 4 128k;</td>
<td>设置存储被代理服务器上的数据所占用的buffer的个数和每个buffer的大小</td>
</tr>
</tbody></table>
<p>X-Forwarded-For可以nginx的日志查看到</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -f /var/log/nginx/access.log</span><br></pre></td></tr></table></figure>

<h3 id="3-2-参数多的时候如何配置"><a href="#3-2-参数多的时候如何配置" class="headerlink" title="3.2 参数多的时候如何配置"></a>3.2 参数多的时候如何配置</h3><blockquote>
<p>可将参数写到一个文件中，然后在nginx配置文件里include包含进去</p>
</blockquote>
<p>1、创建包含参数的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# cat /etc/nginx/proxy_params</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout 30;</span><br><span class="line">proxy_send_timeout 60;</span><br><span class="line">proxy_read_timeout 60;</span><br><span class="line"></span><br><span class="line">proxy_buffering on;</span><br><span class="line">proxy_buffer_size 32k;</span><br><span class="line">proxy_buffers 4 128k;</span><br></pre></td></tr></table></figure>

<p>2、在配置文件中导入，方便后续多个location使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:8080;</span><br><span class="line">    include proxy_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(六)七层负载均衡</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/12-Nginx(%E5%85%AD)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
    <content><![CDATA[<h2 id="一、七层负载均衡简介-需补充"><a href="#一、七层负载均衡简介-需补充" class="headerlink" title="一、七层负载均衡简介(需补充)"></a>一、七层负载均衡简介(需补充)</h2><h3 id="1-1-nginx代理的局限性"><a href="#1-1-nginx代理的局限性" class="headerlink" title="1.1 nginx代理的局限性"></a>1.1 nginx代理的局限性</h3><p>​	一个location仅能代理后端一台主机</p>
<h3 id="1-2-七层负载均衡"><a href="#1-2-七层负载均衡" class="headerlink" title="1.2 七层负载均衡"></a>1.2 七层负载均衡</h3><p>Nginx负载均衡<br>    负载<br>    负载均衡<br>    调度<br>    load balance<br>    LB<br>公有云<br>    SLB		阿里云负载均衡<br>    QLB		青云负载均衡<br>    CLB		腾讯负载均衡<br>    ULB		ucloud的负载均衡</p>
<h3 id="1-3-四层负载均衡和七层负载均衡的区别"><a href="#1-3-四层负载均衡和七层负载均衡的区别" class="headerlink" title="1.3 四层负载均衡和七层负载均衡的区别"></a>1.3 四层负载均衡和七层负载均衡的区别</h3><p>四层负载均衡数据包在底层就进行了分发，而七层负载均衡数据包则是在最顶层进行分发、由此可以看出，七层负载均衡效率没有四负载均衡高。<br>但七层负载均衡更贴近于服务，如:http协议就是七层协议，我们可以用Nginx可以作会话保持，URL路径规则匹配、head头改写等等，这些是四层负载均衡无法实现的。</p>
<h2 id="二、配置实例"><a href="#二、配置实例" class="headerlink" title="二、配置实例"></a>二、配置实例</h2><h3 id="2-1-测试环境准备"><a href="#2-1-测试环境准备" class="headerlink" title="2.1 测试环境准备"></a>2.1 测试环境准备</h3><table>
<thead>
<tr>
<th>主机名称</th>
<th>应用环境</th>
<th>外网地址</th>
<th>内网地址</th>
</tr>
</thead>
<tbody><tr>
<td>web01</td>
<td>nginx + php（提供网页服务）</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
</tr>
<tr>
<td>web01</td>
<td>nginx + php（提供网页服务）</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
</tr>
<tr>
<td>lb01</td>
<td>nginx（提供代理服务）</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
</tr>
<tr>
<td>db01</td>
<td>mysql</td>
<td>10.0.0.51</td>
<td>172.16.1.51</td>
</tr>
</tbody></table>
<h3 id="2-2-配置步骤"><a href="#2-2-配置步骤" class="headerlink" title="2.2 配置步骤"></a>2.2 配置步骤</h3><p>1、web01&#x2F;02的网页服务搭建</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# cd /etc/nginx/conf.d/</span><br><span class="line">[root@web01 conf.d]# cat node.conf </span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name node.oldboy.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /node;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@web01 conf.d]# mkdir /node</span><br><span class="line">[root@web01 conf.d]# echo &quot;Web01...&quot; &gt; /node/index.html</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>2、配置nginx负载均衡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# cd /etc/nginx/conf.d/</span><br><span class="line">[root@lb01 conf.d]# cat node_proxy.conf </span><br><span class="line">upstream node &#123;</span><br><span class="line">    server 172.16.1.7:80;</span><br><span class="line">    server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name node.oldboy.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://node;</span><br><span class="line">        include proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@lb01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>3、客户端网页测试访问，F5刷新，可见web01&#x2F;web02在循环</p>
<p><img src="/img/image-20210820132420586.png" alt="image-20210820132420586"></p>
<p><img src="/img/image-20210820132431971.png" alt="image-20210820132431971"></p>
<h3 id="2-3-负载均衡也可以使用代理参数"><a href="#2-3-负载均衡也可以使用代理参数" class="headerlink" title="2.3 负载均衡也可以使用代理参数"></a>2.3 负载均衡也可以使用代理参数</h3><blockquote>
<p>与之前部署的知乎wencenter、博客mywordpress结合</p>
</blockquote>
<p>1、准备Nginx负载均衡调度使用的proxy_params</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@Nginx ~]# vim /etc/nginx/proxy_params</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout 30;</span><br><span class="line">proxy_send_timeout 60;</span><br><span class="line">proxy_read_timeout 60;</span><br><span class="line"></span><br><span class="line">proxy_buffering on;</span><br><span class="line">proxy_buffer_size 32k;</span><br><span class="line">proxy_buffers 4 128k;</span><br></pre></td></tr></table></figure>

<p>2、负载均衡配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# vim proxy_oldboy.com.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name blog.oldboy.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://node;</span><br><span class="line">                include proxy_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name zh.oldboy.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://node;</span><br><span class="line">                include proxy_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-负载均衡测试"><a href="#2-4-负载均衡测试" class="headerlink" title="2.4 负载均衡测试"></a>2.4 负载均衡测试</h3><p>正常情况下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、两台web服务器的nginx服务均打开（模拟流量分摊）</span><br><span class="line">	可以负载均衡，轮流访问</span><br><span class="line">2、关掉一台web服务器的nginx服务（模拟容灾）</span><br><span class="line">	网页仍可以正常打开</span><br><span class="line">3、两台web服务器的Nginx服务均关闭</span><br><span class="line">	网页无法打开，502</span><br></pre></td></tr></table></figure>

<p>存在一种情况，两个web的nginx服务都没挂，但是其中一台的php-fpm服务挂了，模拟这种场景</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web02 ~]# systemctl stop php-fpm</span><br></pre></td></tr></table></figure>

<p>此时F5刷新wordpress的页面，将一会502，一会正常，体验不好，可通过添加nginx代理参数解决</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# cat /etc/nginx/proxy_params</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_next_upstream error timeout http_500 http_502 http_503 http_504; # 解决问题</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout 30;</span><br><span class="line">proxy_send_timeout 60;</span><br><span class="line">proxy_read_timeout 60;</span><br><span class="line"></span><br><span class="line">proxy_buffering on;</span><br><span class="line">proxy_buffer_size 32k;</span><br><span class="line">proxy_buffers 4 128k;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：问题原因</p>
<p>使用nginx负载均衡时，如何将后端请求超时的服务器流量平滑的切换到另一台上。<br>Nginx是本身是有机制的，如果出现一个节点down掉的时候，Nginx会更据你具体负载均衡的设置，将请求转移到其他的节点上，但是，如果后台服务连接没有down掉，并且返回错误异常码了如：504、502、500，Nginx就会直接返回从后端获取的异常代码。</p>
</blockquote>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(七)均衡调度</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/13-Nginx(%E4%B8%83)Nginx%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/</url>
    <content><![CDATA[<h2 id="一、Nginx均衡调度算法"><a href="#一、Nginx均衡调度算法" class="headerlink" title="一、Nginx均衡调度算法"></a>一、Nginx均衡调度算法</h2><p>Nginx七层负载均衡分为5种调度算法</p>
<table>
<thead>
<tr>
<th>调度算法</th>
<th>概述</th>
</tr>
</thead>
<tbody><tr>
<td>轮询（常用）</td>
<td>按时间顺序逐一分配到不同的后端服务器(默认)</td>
</tr>
<tr>
<td>weight（面试点）</td>
<td>加权轮询,weight值越大,分配到的访问几率越高</td>
</tr>
<tr>
<td>ip_hash（面试点）</td>
<td>每个请求按访问IP的hash结果分配,这样来自同一IP的固定访问一个后端服务器</td>
</tr>
<tr>
<td>url_hash</td>
<td>按照访问URL的hash结果来分配请求,是每个URL定向到同一个后端服务器</td>
</tr>
<tr>
<td>least_hash</td>
<td>最少链接数,那个机器链接数少就分发</td>
</tr>
</tbody></table>
<h3 id="1-1-加权轮询"><a href="#1-1-加权轮询" class="headerlink" title="1.1 加权轮询"></a>1.1 加权轮询</h3><p>比如实现访问5次web01，1次web02</p>
<p>当web服务器配置不相同，有差距时，可以用此方法</p>
<p>在<code>lb01</code>配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80 weight=5;</span><br><span class="line">        server 172.16.1.8:80 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="1-2-ip-hash"><a href="#1-2-ip-hash" class="headerlink" title="1.2 ip_hash"></a>1.2 ip_hash</h3><blockquote>
<p>PS：不能与weight一起使用</p>
</blockquote>
<p>根据请求的IP地址，固定访问到某一后端，除非已选择的后端down了，有点浪费资源</p>
<p>在<code>lb01</code>配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        ip_hash;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123; </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="二、Nginx负载均衡后端状态"><a href="#二、Nginx负载均衡后端状态" class="headerlink" title="二、Nginx负载均衡后端状态"></a>二、Nginx负载均衡后端状态</h2><table>
<thead>
<tr>
<th>状态</th>
<th>概述</th>
</tr>
</thead>
<tbody><tr>
<td>down</td>
<td>当前的server暂时不参与负载均衡</td>
</tr>
<tr>
<td>backup</td>
<td>预留的备份服务器</td>
</tr>
<tr>
<td>max_conns</td>
<td>限制最大的接收连接数</td>
</tr>
<tr>
<td>max_fails（健康检查）</td>
<td>允许请求失败的次数（不够精准，作用不大，得知道，面试会问）</td>
</tr>
<tr>
<td>fail_timeout（健康检查）</td>
<td>经过max_fails失败后, 服务暂停时间</td>
</tr>
</tbody></table>
<h3 id="2-1-down状态"><a href="#2-1-down状态" class="headerlink" title="2.1 down状态"></a>2.1 down状态</h3><blockquote>
<p>一般用于停机维护</p>
</blockquote>
<p>在<code>lb01</code>配置，可见当两台web的Nginx服务都正常时，只能访问web02，当web02的Nginx服务挂了，返回502</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80 down;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="2-2-backup状态"><a href="#2-2-backup状态" class="headerlink" title="2.2 backup状态"></a>2.2 backup状态</h3><p>在<code>lb01</code>配置，可见当两台web都正常时，只能访问web02，如果web02的服务挂了，会访问web01，当web02恢复后，再次访问到的是web02</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80 backup;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="2-3-健康检查"><a href="#2-3-健康检查" class="headerlink" title="2.3 健康检查"></a>2.3 健康检查</h3><blockquote>
<p>自带的健康检查不够精准，且看不到信息，面试会问</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80 max_fails=2 fail_timeout=10s;</span><br><span class="line">        server 172.16.1.8:80 max_fails=2 fail_timeout=10s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="三、第三方健康检查模块check-upstream"><a href="#三、第三方健康检查模块check-upstream" class="headerlink" title="三、第三方健康检查模块check_upstream"></a>三、第三方健康检查模块check_upstream</h2><blockquote>
<p>检测更精准，且有页面可以展示服务端的状态，需要编译安装</p>
</blockquote>
<h3 id="3-1-编译安装Nginx"><a href="#3-1-编译安装Nginx" class="headerlink" title="3.1 编译安装Nginx"></a>3.1 编译安装Nginx</h3><p>1、安装依赖包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb02 ~]# yum install -y gcc glibc gcc-c++ pcre-devel openssl-devel  patch libxml2 -libxml2-devel libxslt libxslt-devel gd-devel perl-ExtUtils-Embed gperftools-devel.x86_64 gperftools-libs.x86_64 gperftools.x86_64</span><br></pre></td></tr></table></figure>

<p>2、下载Nginx源码及第三方模块源码</p>
<blockquote>
<p>PS：为保持一致，先通过yum源安装nginx，这是当前实验环境的Nginx版本</p>
<p>[root@lb01 nginx]# nginx -version<br>nginx version: nginx&#x2F;1.20.1</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb02 ~]# wget http://nginx.org/download/nginx-1.20.1.tar.gz</span><br><span class="line">[root@lb02 ~]# wget https://github.com/yaoweibin/nginx_upstream_check_module/archive/master.zip</span><br></pre></td></tr></table></figure>

<p>3、解压nginx源码包以及第三方模块</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# unzip master.zip</span><br><span class="line">[root@lb01 ~]# tar -vxf nginx-1.20.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>4、打补丁</p>
<blockquote>
<p>打补丁(nginx的版本是1.20.1补丁就选择1.20.1的,p1代表在nginx目录，p0是不在nginx目录)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx-1.20.1]# cd nginx-1.20.1/</span><br><span class="line">[root@lb01 nginx-1.20.1]# patch -p1 &lt; ../nginx_upstream_check_module-master/check_1.20.1+.patch</span><br></pre></td></tr></table></figure>

<p>5、编译Nginx，附带模块参数</p>
<blockquote>
<p>通过nginx -V获取configure参数，尽量保持一致</p>
</blockquote>
<p>–add-module&#x3D;&#x2F;root&#x2F;nginx_upstream_check_module-master</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx-1.20.1]# ./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx --with-compat --with-debug --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --add-module=/root/nginx_upstream_check_module-master</span><br></pre></td></tr></table></figure>

<p>6、在已有的负载均衡上增加健康检查的功能</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx-1.20.1]# cat /etc/nginx/conf.d/proxy_node.conf</span><br><span class="line">upstream node &#123;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">        check interval=3000 rise=2 fall=3 timeout=1000 type=tcp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-功能测试"><a href="#3-2-功能测试" class="headerlink" title="3.2 功能测试"></a>3.2 功能测试</h3><p>1、正常情况下的检测数据</p>
<p><img src="/img/image-20210821113447825.png" alt="image-20210821113447825"></p>
<p>2、测试将web01的nginx服务关掉</p>
<p><img src="/img/image-20210821114011230.png" alt="image-20210821114011230"></p>
<p>3、日志分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 nginx-1.20.1]# tail -f /var/log/nginx/error.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 两web服务正常，能获取peer</span></span><br><span class="line">2021/08/21 02:42:11 [error] 50522#50522: enable check peer: 172.16.1.8:80</span><br><span class="line">2021/08/21 02:42:12 [error] 50522#50522: enable check peer: 172.16.1.7:80</span><br><span class="line">2021/08/21 02:46:17 [error] 50522#50522: *13 connect() failed (111: Connection refused) while connecting to upstream, client: 10.0.0.1, server: node.oldboy.com, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;http://172.16.1.7:80/&quot;, host: &quot;node.oldboy.com&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止web01的nginx服务</span></span><br><span class="line">2021/08/21 02:46:20 [error] 50522#50522: disable check peer: 172.16.1.7:80</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新启动web01的nginx服务</span></span><br><span class="line">2021/08/21 02:47:59 [error] 50522#50522: enable check peer: 172.16.1.7:80</span><br></pre></td></tr></table></figure>

<h2 id="四、如何解决网站重复登录的问题"><a href="#四、如何解决网站重复登录的问题" class="headerlink" title="四、如何解决网站重复登录的问题"></a>四、如何解决网站重复登录的问题</h2><p>有三种方法解决：</p>
<ol>
<li>ip_hash – 会造成某一台主机的压力过大</li>
<li>session复制</li>
<li>session共享<ol>
<li>本地文件 –&gt; nfs共享</li>
<li>通过程序，写入redis数据库（常用）</li>
<li>通过程序，写入mysql数据库</li>
</ol>
</li>
</ol>
<p>本案例，选用3.2配置，session共享，写入redis数据库</p>
<h3 id="4-1-安装phpmyadmin重现问题"><a href="#4-1-安装phpmyadmin重现问题" class="headerlink" title="4.1 安装phpmyadmin重现问题"></a>4.1 安装phpmyadmin重现问题</h3><p><code>web01</code>和<code>web02</code>都需要安装</p>
<p>1、配置Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cat php.conf</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name php.oldboy.com;</span><br><span class="line">	root /code/phpMyAdmin-4.8.4-all-languages;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.php index.html;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">		include fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@web01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>2、安装phpmyadmin</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# cd /code</span><br><span class="line">[root@web01 code]# wget https://files.phpmyadmin.net/phpMyAdmin/4.8.4/phpMyAdmin-4.8.4-all-languages.zip</span><br><span class="line">[root@web01 code]# unzip phpMyAdmin-4.8.4-all-languages.zip</span><br></pre></td></tr></table></figure>

<p>3、配置phpmyadmin连接远程数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# cd phpMyAdmin-4.8.4-all-languages/</span><br><span class="line">[root@web01 phpMyAdmin-4.8.4-all-languages]# cp config.sample.inc.php config.inc.php</span><br><span class="line">[root@web01 phpMyAdmin-4.8.4-all-languages]# vim config.inc.php</span><br><span class="line">/* Server parameters */</span><br><span class="line"><span class="meta">$</span><span class="bash">cfg[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;host&#x27;</span>] = <span class="string">&#x27;172.16.1.51&#x27;</span>;</span></span><br></pre></td></tr></table></figure>

<p>4、配置授权</p>
<blockquote>
<p>这个文件夹中会记录session，需要权限</p>
<p>session_start(): Failed to read session data: files (path: &#x2F;var&#x2F;lib&#x2F;php&#x2F;session)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]# chown -R www.www /var/lib/php/</span><br></pre></td></tr></table></figure>

<p>5、将web01上配置好的phpmyadmin以及nginx的配置文件推送到web02主机上</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# scp -rp  phpMyAdmin-4.8.4-all-languages root@172.16.1.8:/code/</span><br><span class="line">[root@web01 code]# scp /etc/nginx/conf.d/php.conf  root@172.16.1.8:/etc/nginx/conf.d/</span><br></pre></td></tr></table></figure>

<p>6、重载Nginx服务，授权访问权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web02 code]# systemctl restart nginx</span><br><span class="line">[root@web02 code]# chown -R www.www /var/lib/php/</span><br></pre></td></tr></table></figure>

<p>7、接入负载均衡，并重启nginx服务，<code>lb01</code>操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 conf.d]# vim proxy_php.com.conf </span><br><span class="line">upstream php &#123;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">        server 172.16.1.8:80;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name php.oldboy.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://php;</span><br><span class="line">                include proxy_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@lb01 conf.d]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@lb01 conf.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>9、测试访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">网页访问：</span><br><span class="line">	http://php.oldboy.com</span><br><span class="line">登录账户:</span><br><span class="line">	采用db01（172.16.1.51）的mysql远程账户oldboy/Bgx123.com</span><br><span class="line">此时访问phpmyadmin登录将一直失败，因为轮询访问，session一直变：</span><br><span class="line">报错：</span><br><span class="line">Failed to set session cookie. Maybe you are using HTTP instead of HTTPS to access phpMyAdmin.</span><br></pre></td></tr></table></figure>

<h3 id="4-2-解决问题"><a href="#4-2-解决问题" class="headerlink" title="4.2 解决问题"></a>4.2 解决问题</h3><p>1、在<code>db01</code>安装redis数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@db01 ~]# yum install redis -y</span><br></pre></td></tr></table></figure>

<p>2、配置并启动redis</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@db01 ~]# sed  -i &#x27;/^bind/c bind 127.0.0.1 172.16.1.51&#x27; /etc/redis.conf</span><br><span class="line">[root@db01 ~]# systemctl start redis</span><br><span class="line">[root@db01 ~]# systemctl enable redis</span><br></pre></td></tr></table></figure>

<p>3、<code>web01</code>的php配置session连接redis</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.修改/etc/php.ini文件</span></span><br><span class="line">[root@web01 ~]# vim /etc/php.ini</span><br><span class="line">session.save_handler = redis</span><br><span class="line">session.save_path = &quot;tcp://172.16.1.51:6379&quot;</span><br><span class="line">;session.save_path = &quot;tcp://172.16.1.51:6379?auth=123&quot; #如果redis存在密码，则使用该方式</span><br><span class="line">session.auto_start = 1</span><br></pre></td></tr></table></figure>

<p>4、注释php-fpm.d&#x2F;<a href="http://www.conf里面的两条内容,否则session内容会一直写入/var/lib/php/session%E7%9B%AE%E5%BD%95%E4%B8%AD">www.conf里面的两条内容，否则session内容会一直写入/var/lib/php/session目录中</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">;php_value[session.save_handler] = files</span><br><span class="line">;php_value[session.save_path]    = /var/lib/php/session</span><br></pre></td></tr></table></figure>

<p>5、重启php-fpm</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web02 code]# systemctl restart php-fpm</span><br></pre></td></tr></table></figure>

<p>6、将<code>web01</code>的配置文件推送到<code>web02</code>上</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@web01 code]# scp /etc/php.ini root@172.16.1.8:/etc/php.ini  </span><br><span class="line">[root@web01 code]# scp /etc/php-fpm.d/www.conf root@172.16.1.8:/etc/php-fpm.d/www.conf </span><br></pre></td></tr></table></figure>

<p>7、重启服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@web02 code]# systemctl restart php-fpm</span><br></pre></td></tr></table></figure>

<p>8、再次测试访问网站</p>
<p>可以登录，并且session的值将记录到redis数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@db01 ~]# redis-cli -h 172.16.1.51</span><br><span class="line">172.16.1.51:6379&gt; KEYS *</span><br><span class="line">1) &quot;PHPREDIS_SESSION:716e61cabeb40f974fcbcdcac65f8607&quot;</span><br><span class="line">2) &quot;PHPREDIS_SESSION:42ca5a8ea9375a93a7974427b77b3dd7&quot;</span><br><span class="line">172.16.1.51:6379&gt;</span><br></pre></td></tr></table></figure>

<p>9、刷新页面的负载均衡效果展示</p>
<p><img src="/img/image-20210823225246243.png" alt="image-20210823225246243"></p>
<p><img src="/img/image-20210823225305632.png" alt="image-20210823225305632"></p>
<p>10、cookie保存到redis展示</p>
<p><img src="/img/image-20210823225412626.png" alt="image-20210823225412626"></p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(八)四层负载均衡</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/14-Nginx(%E5%85%AB)Nginx%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
    <content><![CDATA[<h2 id="一、Nginx四层负载均衡介绍"><a href="#一、Nginx四层负载均衡介绍" class="headerlink" title="一、Nginx四层负载均衡介绍"></a>一、Nginx四层负载均衡介绍</h2><p>四层负载均衡：（OSI传输层   ip:port）<br>    nginx1.9 版本加入<br>硬件：F5<br>软件：LVS、Haproxy、Nginx</p>
<p>1.四层+七层来作负载均衡，4层可以保证7层的负载均衡的高可用性。如:nginx就无法保证自己的服务高可用，需要依赖lvs或者keepalive来作。</p>
<p>2.如:tcp协议的负载均衡，有些请求是TCP协议的(mysql、ssh)，或者说这些请求只需要使用4层进行端口的转发就可以了，所以使用4层负载均衡。<br>    比如做：mysql读的负载均衡（轮询）<br>    比如做：端口映射、端口转发         tcp&#x2F;udp</p>
<p>四层负载均衡总结<br>1.四层负载均衡仅能转发TCP&#x2F;IP协议、UDP协议，通常用来转发端口，如: tcp&#x2F;3306，tcp&#x2F;22，udp&#x2F;53。<br>2.四层负载均衡可以用来解决七层负载均衡的端口限制问题。（七层负载均衡最大使用65535个端口号）<br>3.可以用来解决七层负载均衡的高可用问题。（多台后端七层负载均衡能同时的使用）<br>4.四层的转发效率比七层的高的多，但仅支持tcp&#x2F;ip协议，不支持http或者https协议</p>
<p><img src="/img/image-20210823230415237.png" alt="image-20210823230415237"></p>
<h2 id="二、四层负载均衡配置"><a href="#二、四层负载均衡配置" class="headerlink" title="二、四层负载均衡配置"></a>二、四层负载均衡配置</h2><h3 id="2-1-环境准备"><a href="#2-1-环境准备" class="headerlink" title="2.1 环境准备"></a>2.1 环境准备</h3><table>
<thead>
<tr>
<th>服务器名</th>
<th>公网IP</th>
<th>内网IP</th>
</tr>
</thead>
<tbody><tr>
<td>lb4-01</td>
<td>10.0.0.3</td>
<td></td>
</tr>
<tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
</tr>
<tr>
<td>lb02</td>
<td>10.0.0.6</td>
<td>172.16.1.6</td>
</tr>
<tr>
<td>web、nfs、mysql服务器若干</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-2-新增lb02负载均衡服务器"><a href="#2-2-新增lb02负载均衡服务器" class="headerlink" title="2.2 新增lb02负载均衡服务器"></a>2.2 新增lb02负载均衡服务器</h3><p>1、准备<code>lb02</code>，安装Nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb02 ~]# cat /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@lb02 ~]#  yum install nginx -y</span><br></pre></td></tr></table></figure>

<p>2、拷贝<code>lb01</code>的 Nginx配置到<code>lb02</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb02 ~]# scp -rp root@172.16.1.5:/etc/nginx /etc/</span><br></pre></td></tr></table></figure>

<p>3、启动Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb02 conf.d]# nginx -t</span><br><span class="line">[root@lb02 conf.d]# systemctl start nginx</span><br><span class="line">[root@lb02 conf.d]# systemctl enable nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>报错：</p>
<p>[root@lb02 ~]# nginx -t<br>nginx: [emerg] unknown directive “check” in &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf:4<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed<br>[root@lb02 ~]# vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf<br>[root@lb02 ~]# nginx -t<br>nginx: [emerg] unknown directive “check_status” in &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy_node.conf:17<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed</p>
<p>解决方法：</p>
<p>因为lb01安装过第三方健康检查工具，而lb02上没有，先将这些报错点注释掉</p>
</blockquote>
<p>4、测试lb02是否正常</p>
<p>将hosts中的10.0.0.5换成10.0.0.6，phpadmin、wordpress网页可以正常访问,<br>但是wecenter异常502 Bad Gateway<br>解决方法: 将web01、02上的的php.ini中的session.auto_start改为0,不然会502</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 php]# vim /etc/php.ini</span><br><span class="line">session.auto_start = 0</span><br><span class="line">[root@web01 php]# systemctl restart php-fpm.service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>网上搜索的解释：<br>日常开发中，php.ini配置session.auto_start&#x3D;0默认关闭会话时如果想开启会话需要调用session_start：<br>session.auto_start 开启就自动完成了session_start()<br>区别就在于在用SESSION前是否需要session_start();<br>当session.auto_start &#x3D; on时，执行 session_start() 将产生新的 session_id<br>session.auto_start &#x3D; on 的优点在于，任何时候都不会因忘记执行 session_start() 或 session_start() 在程序里的位置不对，而导致错误<br>缺点在于，如果你使用的是第三方代码，则必须删去其中的全部 session_start() 。否则将不能得到正确的结果</p>
</blockquote>
<h3 id="2-3-配置四层负载均衡"><a href="#2-3-配置四层负载均衡" class="headerlink" title="2.3 配置四层负载均衡"></a>2.3 配置四层负载均衡</h3><p>1、新增<code>lb4-01</code>服务器，安装nginx</p>
<blockquote>
<p>nginx需要带–with-stream模块</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 ~]# cat /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@lb4-01 ~]#  yum install nginx -y	</span><br><span class="line">[root@lb4-01 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">events &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include /etc/nginx/conf.c/*.conf;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">	.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建四层负载均衡配置的目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 conf.c]# rm -f /etc/nginx/conf.d/default.conf   #删除http的80端口</span><br><span class="line">[root@lb4-01 ~]# mkdir /etc/nginx/conf.c</span><br><span class="line">[root@lb4-01 ~]# cd /etc/nginx/conf.c</span><br><span class="line">[root@lb4-01 conf.c]# cat lb_domain.conf </span><br><span class="line">stream &#123;</span><br><span class="line">    upstream lb &#123;</span><br><span class="line">        server 172.16.1.5:80 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">        server 172.16.1.6:80 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        proxy_connect_timeout 3s;</span><br><span class="line">        proxy_timeout 3s;</span><br><span class="line">        proxy_pass lb;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、重载服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 conf.c]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@lb4-01 conf.c]# systemctl restart nginx</span><br><span class="line">[root@lb4-01 conf.c]# systemctl enable nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>报错：<br>[root@lb4-01 nginx]# nginx  -t<br>nginx: [emerg] unknown directive “stream” in &#x2F;etc&#x2F;nginx&#x2F;conf.c&#x2F;lb_domain.conf:1<br>nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test failed<br>解决方法：<br>yum install nginx-mod-stream.x86_64 -y</p>
</blockquote>
<blockquote>
<p>报错：<br>[root@lb4-01 nginx]# systemctl status nginx<br>nginx.service - The nginx HTTP and reverse proxy server<br>Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service; enabled; vendor preset: disabled)<br>Active: failed (Result: exit-code) since Tue 2021-08-24 07:48:42 CST; 13s ago<br>Process: 2969 ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx (code&#x3D;exited, status&#x3D;1&#x2F;FAILURE)<br>Process: 2967 ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -t (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)<br>Process: 2965 ExecStartPre&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm -f &#x2F;run&#x2F;nginx.pid (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)<br>Main PID: 1959 (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</p>
<p>Aug 24 07:48:40 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:40 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:41 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:41 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:42 lb4-01 nginx[2969]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)<br>Aug 24 07:48:42 lb4-01 nginx[2969]: nginx: [emerg] still could not bind()<br>解决方法：<br>需要将[root@lb4-01 nginx]# vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf<br>中默认的80端口改掉，比如改成81,这样才不冲突（奇怪。。）</p>
</blockquote>
<p>4、访问测试</p>
<p>将Hosts中的对应网站地址的IP改成10.0.0.3，尝试访问，可以正常通过四层负载均衡来调度10.0.0.5和10.0.0.6七层负载均衡</p>
<p><img src="/img/image-20210824001613717.png" alt="image-20210824001613717"></p>
<p><img src="/img/image-20210824001638506.png" alt="image-20210824001638506"></p>
<h2 id="三、四层负载均衡日志"><a href="#三、四层负载均衡日志" class="headerlink" title="三、四层负载均衡日志"></a>三、四层负载均衡日志</h2><h3 id="3-1-配置过程"><a href="#3-1-配置过程" class="headerlink" title="3.1 配置过程"></a>3.1 配置过程</h3><p>在四层负载均衡中配置Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 ~]# cat /etc/nginx/conf.c/lb_domain.conf</span><br><span class="line">stream &#123;</span><br><span class="line">    log_format  proxy &#x27;$remote_addr $remote_port - [$time_local] $status $protocol &#x27;</span><br><span class="line">                  &#x27;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#x27; ;</span><br><span class="line">    access_log /var/log/nginx/proxy.log proxy;</span><br><span class="line"></span><br><span class="line">    upstream lb &#123;</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="3-2-查看日志"><a href="#3-2-查看日志" class="headerlink" title="3.2 查看日志"></a>3.2 查看日志</h3><p>网页访问后，可见产生的日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 ~]# tail -f /var/log/nginx/proxy.log</span><br><span class="line">10.0.0.1 56396 - [25/Aug/2021:19:25:33 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;15150&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 59800 - [25/Aug/2021:19:25:34 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;8327&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 63468 - [25/Aug/2021:19:25:34 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;17882&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 50394 - [25/Aug/2021:19:25:35 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;24490&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 55549 - [25/Aug/2021:19:25:35 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;13201&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 64324 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;70995&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 64566 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;72650&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 65216 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;68171&quot; &quot;0.000&quot;</span><br><span class="line">10.0.0.1 49668 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;82071&quot; &quot;0.004&quot;</span><br><span class="line">10.0.0.1 49745 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.5:80&quot; &quot;63941&quot; &quot;0.001&quot;</span><br><span class="line">10.0.0.1 50574 - [25/Aug/2021:19:25:42 +0800] 200 TCP &quot;172.16.1.6:80&quot; &quot;103581&quot; &quot;0.000&quot;</span><br></pre></td></tr></table></figure>

<h2 id="三、使用nginx四层负载均衡实现tcp的转发（跳板）"><a href="#三、使用nginx四层负载均衡实现tcp的转发（跳板）" class="headerlink" title="三、使用nginx四层负载均衡实现tcp的转发（跳板）"></a>三、使用nginx四层负载均衡实现tcp的转发（跳板）</h2><p>实现跳板机的功能，比如：</p>
<pre><code>请求负载均衡 5555    ---&gt;     172.16.1.7:22;
请求负载均衡 6666    ---&gt;     172.16.1.51:3306;
</code></pre>
<h3 id="3-1-配置过程-1"><a href="#3-1-配置过程-1" class="headerlink" title="3.1 配置过程"></a>3.1 配置过程</h3><p>配置Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb4-01 ~]# cat /etc/nginx/conf.c/lb_domain.conf </span><br><span class="line">stream &#123;</span><br><span class="line">log_format  proxy &#x27;$remote_addr $remote_port - [$time_local] $status $protocol &#x27;</span><br><span class="line">                  &#x27;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#x27; ;</span><br><span class="line">    access_log /var/log/nginx/proxy.log proxy;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">定义转发ssh的22端口</span></span><br><span class="line">	upstream ssh_7 &#123;</span><br><span class="line">		server 10.0.0.7:22;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">定义转发mysql的3306端口</span></span><br><span class="line">	upstream mysql_51 &#123;</span><br><span class="line">		server 10.0.0.51:3306;</span><br><span class="line">	&#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 5555;</span><br><span class="line">        proxy_connect_timeout 3s;</span><br><span class="line">        proxy_timeout 300s;</span><br><span class="line">        proxy_pass ssh_7;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 6666;</span><br><span class="line">        proxy_connect_timeout 3s;</span><br><span class="line">        proxy_timeout 3s;</span><br><span class="line">        proxy_pass mysql_51;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 连接web01</span></span><br><span class="line">ssh root@10.0.0.3 -p 5555</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接db01</span></span><br><span class="line">ssh root@10.0.0.3 -p 6666</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>运维之综合架构--07--Nginx(九)动静分离</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/02-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/15-Nginx(%E4%B9%9D)%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%92%8Crewrite/</url>
    <content><![CDATA[<h2 id="一、动静分离介绍"><a href="#一、动静分离介绍" class="headerlink" title="一、动静分离介绍"></a>一、动静分离介绍</h2><p>动静分离，通过中间件将动静分离和静态请求进⾏分离；<br>通过中间件将动态请求和静态请求分离，可以建上不必要的请求消耗，同时能减少请求的延时。<br>通过中间件将动态请求和静态请求分离，逻辑图如下:  </p>
<h2 id="二、单台服务器动静分离配置"><a href="#二、单台服务器动静分离配置" class="headerlink" title="二、单台服务器动静分离配置"></a>二、单台服务器动静分离配置</h2><p>逻辑图如下：</p>
<p><img src="/img/%E5%8D%95%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB.png" alt="单台服务器动静分离"></p>
<p>编辑Nginx配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 conf.d]vim blog.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name blog.linux.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">    root /code/wordpress;</span><br><span class="line">    index index.php;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果请求的是以.jpg结尾的静态⽂件 就去/code/images⽬录下访问</span></span><br><span class="line">location ~* \.jpg$ &#123;</span><br><span class="line">    root /code/images;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~* \.php$ &#123;</span><br><span class="line">    root /code/wordpress;</span><br><span class="line">    fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">    include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建⽬录</span></span><br><span class="line">[root@web01 conf.d]# mkdir /code/images/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 实现动静分离</span></span><br><span class="line">⽅式⼀：把⽂件挪到/code/images/</span><br><span class="line">cp -r /code/wordpress/wp-content /code/images/</span><br><span class="line"></span><br><span class="line">⽅式⼆：做软连接</span><br><span class="line">cd /code</span><br><span class="line">ln -s wordpress images</span><br></pre></td></tr></table></figure>

<h2 id="三、多台服务器动静分离配置"><a href="#三、多台服务器动静分离配置" class="headerlink" title="三、多台服务器动静分离配置"></a>三、多台服务器动静分离配置</h2><p>参考：<a href="https://www.cnblogs.com/backups/p/nginx10.html">https://www.cnblogs.com/backups/p/nginx10.html</a></p>
<h3 id="3-1-原理图"><a href="#3-1-原理图" class="headerlink" title="3.1 原理图"></a>3.1 原理图</h3><p><img src="/img/%E5%A4%9A%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB.png" alt="多台服务器动静分离"></p>
<h3 id="3-2-实验环境准备"><a href="#3-2-实验环境准备" class="headerlink" title="3.2 实验环境准备"></a>3.2 实验环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>外网</th>
<th>内网</th>
<th>作用服务</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
<td>负载均衡 nginx proxy</td>
</tr>
<tr>
<td>web01</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
<td>静态资源 nginx static</td>
</tr>
<tr>
<td>web02</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
<td>动态资源 tomcat server</td>
</tr>
</tbody></table>
<h3 id="3-3-配置web01提供静态资源"><a href="#3-3-配置web01提供静态资源" class="headerlink" title="3.3 配置web01提供静态资源"></a>3.3 配置web01提供静态资源</h3><p>1、配置Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 images]# cat /etc/nginx/conf.d/jt.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 动静分离，web01提供静态文件服务</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name dongjing.gs.com;</span><br><span class="line">        </span><br><span class="line">        # 提供临时测试的域名</span><br><span class="line">        root /code/dongjing;</span><br><span class="line">        index index.html;</span><br><span class="line"></span><br><span class="line">        location ~* ^.*\.(jpg|png|gif)$ &#123;</span><br><span class="line">                root /code/dongjing/images;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、上传静态资源，测试访问静态页面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web01 ~]# echo &quot;web01...jingtai&quot; &gt; /code/index.html</span><br><span class="line">[root@web01 ~]# mkdir /code/dongjing/images/ &amp;&amp; cd /code/dongjing/images/</span><br><span class="line">[root@web01 images]# rz 1.jpg</span><br><span class="line">[root@web01 images]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@web01 images]# systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p><code>在客户端配置hosts，10.0.0.7 dongjing.gs.com</code></p>
<p>打开浏览器访问<a href="http://dongjing.gs.com/">http://dongjing.gs.com</a></p>
<p><img src="/img/image-20210825141423629.png" alt="image-20210825141423629"></p>
<p>打开浏览器访问<a href="http://dongjing.gs.com/1.png">http://dongjing.gs.com/1.png</a></p>
<p><img src="/img/image-20210825142256349.png" alt="image-20210825142256349"></p>
<h3 id="3-4-配置web02提供动态资源（tomcat-java模拟"><a href="#3-4-配置web02提供动态资源（tomcat-java模拟" class="headerlink" title="3.4 配置web02提供动态资源（tomcat + java模拟)"></a>3.4 配置web02提供动态资源（tomcat + java模拟)</h3><p>1、安装Tomcat并添加jsp文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@web02 ~]# yum install -y tomcat</span><br><span class="line">[root@web02 ~]# mkdir /usr/share/tomcat/webapps/ROOT</span><br><span class="line">[root@web02 ~]# cat &gt;/usr/share/tomcat/webapps/ROOT/java_test.jsp &lt;&lt;EOF</span><br><span class="line">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;utf-8&quot;%&gt;</span><br><span class="line">&lt;HTML&gt;</span><br><span class="line">    &lt;HEAD&gt;</span><br><span class="line">        &lt;TITLE&gt;oldboy JSP Page&lt;/TITLE&gt;</span><br><span class="line">    &lt;/HEAD&gt;</span><br><span class="line">    &lt;BODY&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            Random rand = new Random();</span><br><span class="line">            out.println(&quot;&lt;h1&gt;随机数:&lt;h1&gt;&quot;);</span><br><span class="line">            out.println(rand.nextInt(99)+100);</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/BODY&gt;</span><br><span class="line">&lt;/HTML&gt;</span><br><span class="line">EOF</span><br><span class="line">[root@web02 ~]# systemctl start tomcat</span><br></pre></td></tr></table></figure>

<p>2、测试访问</p>
<p>访问<a href="http://10.0.0.8:8080/java_test.jsp">http://10.0.0.8:8080/java_test.jsp</a></p>
<p><img src="/img/image-20210825162829977.png" alt="image-20210825162829977"></p>
<h3 id="3-4-增加负载均衡，实现动静分离"><a href="#3-4-增加负载均衡，实现动静分离" class="headerlink" title="3.4 增加负载均衡，实现动静分离"></a>3.4 增加负载均衡，实现动静分离</h3><p>1、配置Nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 dongtai]# cat /etc/nginx/conf.d/proxy_dj.conf</span><br><span class="line">upstream jt &#123;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream dt &#123;</span><br><span class="line">        server 172.16.1.8:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name dongjing.gs.com;</span><br><span class="line"></span><br><span class="line">        location ~* ^.*\.(jpg|png|gif)$ &#123;</span><br><span class="line">                proxy_pass http://jt;</span><br><span class="line">                proxy_set_header HOST $http_host;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.jsp$ &#123;</span><br><span class="line">                proxy_pass http://dt;</span><br><span class="line">                proxy_set_header HOST $http_host;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、测试访问</p>
<p><code>客户端配置hosts，10.0.0.3 dongjing.gs.com</code></p>
<p>在浏览器访问</p>
<p><a href="http://dongjing.gs.com/1.png">http://dongjing.gs.com/1.png</a></p>
<p><a href="http://10.0.0.8:8080/java_test.jsp">http://10.0.0.8:8080/java_test.jsp</a></p>
<p>的效果是一样的，但是访问<a href="http://dongjing.gs.com显示的是nginx默认的主页,因为lb01中暂时没有对应文件夹的index.html/">http://dongjing.gs.com显示的是Nginx默认的主页，因为lb01中暂时没有对应文件夹的index.html</a></p>
<h3 id="3-5-在负载均衡上创建同时调用动态和静态资源的index-html"><a href="#3-5-在负载均衡上创建同时调用动态和静态资源的index-html" class="headerlink" title="3.5 在负载均衡上创建同时调用动态和静态资源的index.html"></a>3.5 在负载均衡上创建同时调用动态和静态资源的index.html</h3><p>1、修改Nginx配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 dongtai]# cat /etc/nginx/conf.d/proxy_dj.conf</span><br><span class="line">upstream jt &#123;</span><br><span class="line">        server 172.16.1.7:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream dt &#123;</span><br><span class="line">        server 172.16.1.8:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name dongjing.gs.com;</span><br><span class="line">		</span><br><span class="line"><span class="meta">		#</span><span class="bash"> 新增</span></span><br><span class="line">        location / &#123;</span><br><span class="line">                root /code/dongjing;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~* ^.*\.(jpg|png|gif)$ &#123;</span><br><span class="line">                proxy_pass http://jt;</span><br><span class="line">                proxy_set_header HOST $http_host;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.jsp$ &#123;</span><br><span class="line">                proxy_pass http://dt;</span><br><span class="line">                proxy_set_header HOST $http_host;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建对应的目录和页面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 /]# mkdir /code/dongjing</span><br><span class="line">[root@lb01 /]# cat /code/dongjing/index.html</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;title&gt;测试ajax和跨域访问&lt;/title&gt;</span><br><span class="line">        &lt;script src=&quot;http://libs.baidu.com/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"><span class="meta">$</span><span class="bash">(document).ready(<span class="function"><span class="title">function</span></span>()&#123;</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">        type: &quot;GET&quot;,</span><br><span class="line">        url: &quot;http://dongjing.gs.com/java_test.jsp&quot;,</span><br><span class="line">        success: function(data)&#123;</span><br><span class="line">                $(&quot;#get_data&quot;).html(data)</span><br><span class="line">        &#125;,</span><br><span class="line">        error: function() &#123;</span><br><span class="line">                alert(&quot;哎呦喂,失败了,回去检查你服务去~&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">        &lt;h1&gt;测试动静分离&lt;/h1&gt;</span><br><span class="line">        &lt;div id=&quot;get_data&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;img src=&quot;http://dongjing.gs.com/1.png&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>3、测试访问</p>
<p>浏览器访问：<a href="http://dongjing.gs.com/">http://dongjing.gs.com</a></p>
<p><img src="/img/image-20210825143746986.png" alt="image-20210825143746986"></p>
<p>正常负载均衡的现象：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">关掉web02的Tomcat服务，web01服务正常</span><br><span class="line"></span><br><span class="line">​	http://dongjing.gs.com可以正常打开，图片正常显示，随机数将显示异常</span><br><span class="line"></span><br><span class="line">web02的Tomcat服务正常，关掉web01的nginx服务</span><br><span class="line"></span><br><span class="line">​	http://dongjing.gs.com可以正常打开，图片显示异常，随机正常显示</span><br></pre></td></tr></table></figure>

<h2 id="四、综合案例-Nginx资源分离"><a href="#四、综合案例-Nginx资源分离" class="headerlink" title="四、综合案例-Nginx资源分离"></a>四、综合案例-Nginx资源分离</h2><h3 id="4-1-什么是资源分离？"><a href="#4-1-什么是资源分离？" class="headerlink" title="4.1 什么是资源分离？"></a>4.1 什么是资源分离？</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">根据浏览器Agent标识可以访问到不同的页面资源：</span><br><span class="line">比如：</span><br><span class="line">    Android访问到的是Android的页面</span><br><span class="line">    PC访问到的是PC的页面</span><br><span class="line">    iphone访问放到的是iphone的页面</span><br></pre></td></tr></table></figure>

<h3 id="4-2-实验环境准备"><a href="#4-2-实验环境准备" class="headerlink" title="4.2 实验环境准备"></a>4.2 实验环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>外网</th>
<th>内网</th>
<th>作用服务</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>10.0.0.5</td>
<td>172.16.1.5</td>
<td>负载均衡 nginx proxy</td>
</tr>
<tr>
<td>web01</td>
<td>10.0.0.7</td>
<td>172.16.1.7</td>
<td>提供Android手机页面</td>
</tr>
<tr>
<td>web02</td>
<td>10.0.0.8</td>
<td>172.16.1.8</td>
<td>提供PC访问页面</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>运维</category>
        <category>（二）综合架构</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(一)-安装Docker</title>
    <url>/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85Docker/</url>
    <content><![CDATA[<h2 id="一、容器简介"><a href="#一、容器简介" class="headerlink" title="一、容器简介"></a>一、容器简介</h2><blockquote>
<p>容器就是在隔离环境中运行一个进程，如果进程停止，容器就会销毁，隔离环境拥有自己的系统文件，ip地址，主机名等。</p>
</blockquote>
<h3 id="1-容器和虚拟化的区别"><a href="#1-容器和虚拟化的区别" class="headerlink" title="1 容器和虚拟化的区别"></a>1 容器和虚拟化的区别</h3><ul>
<li><p>KVM虚拟化：</p>
<ul>
<li><p>需要硬件的支持，需要模拟硬件，可以运行不同的操作系统，启动时间分钟级（有开机启动流程）</p>
<p>开机启动流程</p>
<p>bios开机硬件自检</p>
<p>根据bios设置的优先启动项boot</p>
<p>读取mbr&#x2F;gpt引导，读取mbr硬盘分区信息，内核加载路径</p>
<p>加载内核</p>
<p>启动第一个进程（C6：&#x2F;sbin&#x2F;init，C7：systemd）</p>
<p>系统初始化完成</p>
<p>运行服务</p>
</li>
</ul>
</li>
<li><p>容器：</p>
<ul>
<li><p>不需要硬件的支持，不需要模拟硬件，公用宿主机内核，启动时间秒级（没有开机启动流程）</p>
<p>容器的第一个进程直接运行服务，损耗少，启动快，性能高</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-容器的优缺点"><a href="#2-容器的优缺点" class="headerlink" title="2 容器的优缺点"></a>2 容器的优缺点</h3><ul>
<li><p>优点</p>
<ul>
<li><p>与宿主机使用同一个内核，性能损耗小</p>
<p>不需要指令级模拟</p>
<p>容器可以再cpu核心的本地运行指令，不需要任何专门的解释机制</p>
<p>避免了准虚拟化和系统调用替换中的复杂性</p>
<p>轻量级隔离，在隔离的同事还提供共享机制，以实现容器与宿主机的资源共享</p>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>使用同一内核，存在安全性问题</li>
</ul>
</li>
</ul>
<h3 id="3-容器技术的发展过程"><a href="#3-容器技术的发展过程" class="headerlink" title="3 容器技术的发展过程"></a>3 容器技术的发展过程</h3><blockquote>
<p>chroot — lxc —- docker</p>
</blockquote>
<h3 id="4-Docker组成"><a href="#4-Docker组成" class="headerlink" title="4 Docker组成"></a>4 Docker组成</h3><p>​	Docker基于Go语言开发，C&#x2F;S模式</p>
<ul>
<li>主要组件<ul>
<li>镜像</li>
<li>容器</li>
<li>仓库：最大的dockerhub</li>
<li>网络</li>
<li>存储</li>
</ul>
</li>
</ul>
<h2 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h2><blockquote>
<p>参考网站：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/">https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/</a></p>
</blockquote>
<h3 id="1-联网在线安装"><a href="#1-联网在线安装" class="headerlink" title="1 联网在线安装"></a>1 联网在线安装</h3><p>开启rpm包缓存，方便制作离线安装包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/yum.conf</span><br><span class="line">keepcache=1 </span><br></pre></td></tr></table></figure>

<p>如果你之前安装过 docker，请先删掉</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>

<p>安装一些依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<p>根据你的发行版下载repo文件（Centos）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>把软件仓库替换为TUNA：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo sed -i &#x27;s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>最后安装:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum makecache fast</span><br><span class="line">    sudo yum install docker-ce</span><br></pre></td></tr></table></figure>

<h3 id="2-无网环境下离线安装"><a href="#2-无网环境下离线安装" class="headerlink" title="2 无网环境下离线安装"></a>2 无网环境下离线安装</h3><p>搜集联网环境下下载的rpm包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find /var/cache/yum/x86_64/7/ -name &quot;*.rpm&quot; | xargs -i mv &#123;&#125; docker_rpm/</span><br><span class="line">tar -zvcf docker_rpm.tgz docker_rpm/</span><br></pre></td></tr></table></figure>

<p>拷贝到无网环境的服务器中安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -vxf docker_rpm.tgz # 解压</span><br><span class="line">cd docker_rpm	</span><br><span class="line">rpm -Uvh ./*.rpm # 安装</span><br></pre></td></tr></table></figure>

<h3 id="3-启动服务并验证安装是否成功"><a href="#3-启动服务并验证安装是否成功" class="headerlink" title="3 启动服务并验证安装是否成功"></a>3 启动服务并验证安装是否成功</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证是否安装成功</span></span><br><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>

<h3 id="4-Docker镜像下载加速"><a href="#4-Docker镜像下载加速" class="headerlink" title="4 Docker镜像下载加速"></a>4 Docker镜像下载加速</h3><ul>
<li>阿里云docker镜像加速器服务</li>
<li>配置docker镜像加速(推荐)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建文件</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line">&#123;    </span><br><span class="line">	&quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新加载</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="5-创建并运行一个nginx容器"><a href="#5-创建并运行一个nginx容器" class="headerlink" title="5 创建并运行一个nginx容器"></a>5 创建并运行一个nginx容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 80:80 nginx</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(三)-容器的网络访问</title>
    <url>/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%89-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<h2 id="一、容器的网络访问流程"><a href="#一、容器的网络访问流程" class="headerlink" title="一、容器的网络访问流程"></a>一、容器的网络访问流程</h2><blockquote>
<p>参考：<a href="https://z.itpub.net/article/detail/FE8EBAC62D5881E3A432291F8C8E4F02">https://z.itpub.net/article/detail/FE8EBAC62D5881E3A432291F8C8E4F02</a></p>
</blockquote>
<h3 id="1-虚拟机注意事项"><a href="#1-虚拟机注意事项" class="headerlink" title="1 虚拟机注意事项"></a>1 虚拟机注意事项</h3><p>查看net.ipv4.ip_forward值是否为1</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sysctl -a | grep ipv4 | grep forward </span><br></pre></td></tr></table></figure>

<p>只有值为1时docker容器才能上网，而vmware虚拟机挂起将使他变成0，解决方法：</p>
<ul>
<li>sysctl net.ipv4.ip_forward &#x3D; 1 设置为1</li>
<li>不要挂起虚拟机，直接关机重启，docker服务在启动时会将它改为1</li>
</ul>
<h2 id="二、容器端口映射"><a href="#二、容器端口映射" class="headerlink" title="二、容器端口映射"></a>二、容器端口映射</h2><h3 id="1-docker-run-p端口映射参数"><a href="#1-docker-run-p端口映射参数" class="headerlink" title="1 docker run -p端口映射参数"></a>1 docker run -p端口映射参数</h3><p>指定端口访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将容器80端口，映射到主机180端口</span></span><br><span class="line">docker run -p 180:80</span><br></pre></td></tr></table></figure>

<p>指定IP+端口访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 多网卡环境下，将容器80端口映射到10.0.0.1的180端口</span></span><br><span class="line">docker run -p 10.0.0.1:180:80</span><br></pre></td></tr></table></figure>

<p>指定随机端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 将容器80端口，映射到主机随机端口</span><br><span class="line">docker run -p 10.0.0.1::80</span><br></pre></td></tr></table></figure>

<p>指定随机端口+UDP (默认映射TCP)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将容器80端口映射到主机随机端口，并使用UDP协议</span></span><br><span class="line">-p 10.0.0.100:80:udp # 指定随机端口 + udp</span><br></pre></td></tr></table></figure>

<p>可以指定多个端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-p 180:80 -p 1443:443 # 指定多个端口</span><br></pre></td></tr></table></figure>

<p>随机映射</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -P</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(七)-Docker镜像分层与同主机中容器互连</title>
    <url>/2021/07/05/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%83-Docker%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E4%B8%8E%E5%90%8C%E4%B8%BB%E6%9C%BA%E4%B8%AD%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/</url>
    <content><![CDATA[<h2 id="一、Docker镜像分层"><a href="#一、Docker镜像分层" class="headerlink" title="一、Docker镜像分层"></a>一、Docker镜像分层</h2><blockquote>
<p>镜像分层的好处：</p>
<p>​	复用、节省磁盘空间，相同的内容只需加载一份到内存</p>
<p>​	修改dockerfile后，重新构建时可以用缓存，速度快</p>
</blockquote>
<h3 id="1-查看docker镜像分层"><a href="#1-查看docker镜像分层" class="headerlink" title="1 查看docker镜像分层"></a>1 查看docker镜像分层</h3><p>通过导入镜像可以查看到镜像分层</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker load -i [镜像文件]</span><br></pre></td></tr></table></figure>

<p>通过查看镜像历史可以查看到分层</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@docker01 ~]# docker image history centos6.9_ssh:v2</span><br><span class="line">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class="line">57761235f898   2 days ago    /bin/sh -c #(nop)  CMD [&quot;/usr/sbin/sshd&quot; &quot;-D…   0B</span><br><span class="line">c0a2c21457c4   2 days ago    /bin/sh -c echo &#x27;123456&#x27; | passwd --stdin ro…   537B</span><br><span class="line">29d10ff8b8e0   2 days ago    /bin/sh -c service sshd restart                 4.91kB</span><br><span class="line">666b9ddfff15   2 days ago    /bin/sh -c yum install openssh-server -y        154MB</span><br><span class="line">5b00553af9fc   2 days ago    /bin/sh -c #(nop) ADD file:65a30e1b327fec80b…   1.18kB</span><br><span class="line">2199b8eb8390   2 years ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B</span><br><span class="line">&lt;missing&gt;      2 years ago   /bin/sh -c #(nop)  LABEL name=CentOS Base Im…   0B</span><br><span class="line">&lt;missing&gt;      2 years ago   /bin/sh -c #(nop) ADD file:0e6d175401c5b4260…   195MB</span><br></pre></td></tr></table></figure>

<p>所有的这些层都会在<code>Docker</code>主机本地存储区域内存储，可以通过以下指令来列出：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls /var/lib/docker/overlay2/</span><br></pre></td></tr></table></figure>

<h3 id="2-通过Dockerfile优化分层信息"><a href="#2-通过Dockerfile优化分层信息" class="headerlink" title="2  通过Dockerfile优化分层信息"></a>2  通过Dockerfile优化分层信息</h3><ul>
<li>尽量合并RUN和ADD来减少镜像分层数</li>
<li>新加的Dockerfile语句加到最后，不要加到前面</li>
</ul>
<h2 id="二、同主机中容器互连（–link是单向的）"><a href="#二、同主机中容器互连（–link是单向的）" class="headerlink" title="二、同主机中容器互连（–link是单向的）"></a>二、同主机中容器互连（–link是单向的）</h2><blockquote>
<p>docker官方已不推荐使用docker run –link来链接2个容器互相通信，随后的版本中会删除–link</p>
</blockquote>
<h3 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1 功能介绍"></a>1 功能介绍</h3><p>docker run –link可以用来链接2个容器，使得源容器（被链接的容器）和接受容器（主动去链接的容器）之间可以互相通信，并且接收容器可以获取源容器的一些数据，如源容器的环境变量。使用案例如下：</p>
<p>源容器启动：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name src_docker nginx </span><br><span class="line">容器ID:xxxx01, IP:172.16.0.2</span><br></pre></td></tr></table></figure>

<p>接受容器连接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name dest_docker --link src_docker:web centos7.9:v2</span><br><span class="line">容器ID:xxxx02, IP:172.16.0.3</span><br></pre></td></tr></table></figure>

<p>进入接受容器测试，不需要ping IP，直接ping别名就可以，web和src_docker都指向172.16.0.2<font color=red>（单向）</font></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it xxxx01 /bin/bash</span><br><span class="line">ping web</span><br><span class="line">ping src_docker</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接受容器的&#x2F;etc&#x2F;hosts将更新</p>
</blockquote>
<h3 id="2-案例：构建zabbix-server"><a href="#2-案例：构建zabbix-server" class="headerlink" title="2 案例：构建zabbix-server"></a>2 案例：构建zabbix-server</h3><p>启动一个mysql的容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name mysql-server -t \</span><br><span class="line">      -e MYSQL_DATABASE=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \</span><br><span class="line">      -d mysql:5.7 \</span><br><span class="line">      --character-set-server=utf8 --collation-server=utf8_bin </span><br></pre></td></tr></table></figure>

<p>启动java-gateway容器监控java服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name zabbix-java-gateway -t \</span><br><span class="line">      -d zabbix/zabbix-java-gateway:latest</span><br></pre></td></tr></table></figure>

<p>启动zabbix-mysql容器使用link连接mysql与java-gateway</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST=&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \</span><br><span class="line">      -e ZBX_JAVAGATEWAY=&quot;zabbix-java-gateway&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-java-gateway:zabbix-java-gateway \</span><br><span class="line">      -p 10051:10051 \</span><br><span class="line">      -d zabbix/zabbix-server-mysql:latest</span><br></pre></td></tr></table></figure>

<p>启动zabbix web显示，使用link连接zabbix-mysql与mysql</p>
<blockquote>
<p>zabbix的默认端口已有80改为8080，可见配置文件&#x2F;etc&#x2F;zabbix&#x2F;nginx.conf</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST=&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER=&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-server-mysql:zabbix-server \</span><br><span class="line">      -p 8082:8080 \     </span><br><span class="line">      -d zabbix/zabbix-web-nginx-mysql:latest</span><br></pre></td></tr></table></figure>

<p>登录Zabbix</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">浏览器访问：10.0.0.11:8082</span><br><span class="line">Admin</span><br><span class="line">zabbix</span><br></pre></td></tr></table></figure>

<p>添加被监控节点-安装zabbix-agent</p>
<blockquote>
<p>获取zabbix-agent：</p>
<p>uname -a 查看内核版本</p>
<p>web页面查看zabbix版本</p>
<p><a href="https://www.zabbix.com/download">https://www.zabbix.com/download</a> 获取对应agent的安装方法</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/5.4/rhel/7/x86_64/zabbix-release-5.4-1.el7.noarch.rpm</span><br><span class="line">yum clean all</span><br><span class="line">yum install zabbix-agent</span><br></pre></td></tr></table></figure>

<p>添加被监控节点-agent配置文件修改</p>
<blockquote>
<p>117行：Server&#x3D;10.0.0.11, 注意防火墙和selinux的阻挡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">systemctl restart zabbix-agent</span><br></pre></td></tr></table></figure>

<h2 id="三、docker重启后容器不退出"><a href="#三、docker重启后容器不退出" class="headerlink" title="三、docker重启后容器不退出"></a>三、docker重启后容器不退出</h2><blockquote>
<p>默认情况下，systemctl restart docker之后，容器将处于Exited状态</p>
</blockquote>
<h3 id="1-添加容器启动参数"><a href="#1-添加容器启动参数" class="headerlink" title="1 添加容器启动参数"></a>1 添加容器启动参数</h3><blockquote>
<p>docker重启后，容器先停止，再立即重新启动</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=always</span><br></pre></td></tr></table></figure>

<h3 id="2-daemon配置文件修改（不推荐）"><a href="#2-daemon配置文件修改（不推荐）" class="headerlink" title="2 daemon配置文件修改（不推荐）"></a>2 daemon配置文件修改（不推荐）</h3><blockquote>
<p>docker重启后，容器不会停止，一直在运行，不推荐使用，不好控制</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加一行，上行后面加逗号</span></span><br><span class="line">&quot;live-restore&quot;:true</span><br></pre></td></tr></table></figure>





<p>​	</p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(九)-Dokcer跨主机容器互连</title>
    <url>/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B9%9D-Dokcer%E8%B7%A8%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/</url>
    <content><![CDATA[<h2 id="一、Docker容器的四种网络类型"><a href="#一、Docker容器的四种网络类型" class="headerlink" title="一、Docker容器的四种网络类型"></a>一、Docker容器的四种网络类型</h2><blockquote>
<p>哪四种？</p>
<ul>
<li>bridge（默认）：NAT桥接模式</li>
<li>none：不分配网络，什么服务都访问不了</li>
<li>host：与宿主机共享网络，共享主机名，端口共用(宿主机用了的端口，容器也不能用)，【网络性能最高】</li>
<li>container:容器id：与容器xx共享网络，共享主机名、hosts、hostname、端口等….【K8S常用】</li>
</ul>
</blockquote>
<h3 id="1-指定与查看容器网络类型的方法"><a href="#1-指定与查看容器网络类型的方法" class="headerlink" title="1 指定与查看容器网络类型的方法"></a>1 指定与查看容器网络类型的方法</h3><p>指定容器网络类型</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --network none # 指定网络类型</span><br></pre></td></tr></table></figure>

<p>查看容器网络类型</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker instpect 容器id # 可以查看当前的容器网络类型</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看字段</span></span><br><span class="line">&quot;NetworkSettings&quot;: &#123;</span><br><span class="line">	&quot;Bridge&quot;: &quot;&quot;,</span><br></pre></td></tr></table></figure>

<p>查看有哪些网络类型</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker network ls # 查看有哪些网络类型</span><br></pre></td></tr></table></figure>



<h2 id="二、使用macvlan实现"><a href="#二、使用macvlan实现" class="headerlink" title="二、使用macvlan实现"></a>二、使用macvlan实现</h2><blockquote>
<p>优势：</p>
<p>​	性能比overlay高</p>
<p>​	不用做端口映射，外界可直接访问</p>
<p>劣势：</p>
<p>​	IP需要手动指定</p>
</blockquote>
<h3 id="1-案例：使用macvlan实现两个centos6-9-ssh容器跨主机网络通信"><a href="#1-案例：使用macvlan实现两个centos6-9-ssh容器跨主机网络通信" class="headerlink" title="1 案例：使用macvlan实现两个centos6.9_ssh容器跨主机网络通信"></a>1 案例：使用macvlan实现两个centos6.9_ssh容器跨主机网络通信</h3><blockquote>
<p>宿主机信息（虚拟机）：</p>
<p>​	docker01: 10.0.0.11 网关: 10.0.0.2</p>
<p>​	docker02: 10.0.0.12 网关: 10.0.0.2</p>
</blockquote>
<p>宿主机1,2分别创建macvlan</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker network create --driver macvlan --subnet 10.0.0.0/24 --gateway 10.0.0.2 -o parent=ens33 macvlan_1</span><br></pre></td></tr></table></figure>

<p>设置网卡为混杂模式【Ubuntu需要设置】</p>
<blockquote>
<p>混杂模式是计算机网络中的术语。 是指一台机器的网卡能够接收所有经过它的数据流，而不论其目的地址是否是它。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip link set ens33 promisc on</span><br></pre></td></tr></table></figure>

<p>宿主机1,2分别使用centos7.9_ssh:v2镜像创建容器，并指定为macvlan_1网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker01</span></span><br><span class="line">docker run -d --network macvlan_1 --ip=10.0.0.100 centos6.9_ssh:v2</span><br><span class="line"><span class="meta">#</span><span class="bash"> docker02</span></span><br><span class="line">docker run -d --network macvlan_1 --ip=10.0.0.200 centos6.9_ssh:v2</span><br></pre></td></tr></table></figure>

<p>测试，docker exec进入docker01中运行容器，开启抓包，并使用docker02中的容器ping它</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tcpdump icmp</span><br></pre></td></tr></table></figure>

<p>通过xshell或者mobaxterm可以直接ssh到容器中 (PS:并没有 -p 22端口)</p>
<blockquote>
<p>实际测试宿主机并不能ssh到容器，显示No route to host，但是物理机可以连接</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh root@10.0.0.100</span><br></pre></td></tr></table></figure>



<h2 id="三、使用overlay实现"><a href="#三、使用overlay实现" class="headerlink" title="三、使用overlay实现"></a>三、使用overlay实现</h2><blockquote>
<p>优势：</p>
<p>​	可以自动分配ip地址</p>
<p>劣势：</p>
<p>​	需要做端口映射才能访问容器服务</p>
<p>overlay参考：<a href="https://www.cnblogs.com/CloudMan6/p/7270551.html">https://www.cnblogs.com/CloudMan6/p/7270551.html</a></p>
</blockquote>
<h3 id="1-案例：使用overlay实现两个centos6-9-ssh容器跨主机网络通信"><a href="#1-案例：使用overlay实现两个centos6-9-ssh容器跨主机网络通信" class="headerlink" title="1 案例：使用overlay实现两个centos6.9_ssh容器跨主机网络通信"></a>1 案例：使用overlay实现两个centos6.9_ssh容器跨主机网络通信</h3><p>docker01启动consul</p>
<blockquote>
<p>consul是一个key:value类型的存储数据库</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8500:8500 --restart=always -h consul --name consul progrium/consul -server -bootstrap</span><br></pre></td></tr></table></figure>

<p>docker01,02上设置daemon.json文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;hosts&quot;</span>:[<span class="string">&quot;tcp://0.0.0.0:2376&quot;</span>,<span class="string">&quot;unix:///var/run/docker.sock&quot;</span>],</span><br><span class="line"><span class="string">&quot;cluster-store&quot;</span>:<span class="string">&quot;consul://10.0.0.11:8500&quot;</span>,</span><br><span class="line"><span class="string">&quot;cluster-advertise&quot;</span>:<span class="string">&quot;10.0.0.11:2376&quot;</span> # 此处不同，docker01为<span class="number">10.0</span><span class="number">.0</span><span class="number">.11</span>，docker02为<span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>修改docker.service文件</p>
<blockquote>
<p>因为daemon.json中的hosts项与docker.service中的-H参数冲突，需要去掉</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除-H fd://</span></span><br><span class="line">ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>

<p>重启docker服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>测试consul是否搭建成功</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">浏览器访问：http://10.0.0.11:8500/</span><br><span class="line">在KEY/VALUE标签页正常显示10.0.0.11和12两台宿主机</span><br></pre></td></tr></table></figure>

<p>docker01,02创建overlay网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker network create -d overlay --subnet 172.16.1.0/24 --gateway 172.16.1.254 ol1</span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker01</span></span><br><span class="line">docker run -d --network ol1 --name centos6.9_01 centos6.9_ssh:v2</span><br><span class="line"><span class="meta">#</span><span class="bash"> docker02</span></span><br><span class="line">docker run -d --network ol1 --name centos6.9_02 centos6.9_ssh:v2</span><br></pre></td></tr></table></figure>

<p>测试容器间网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker01中的容器ping另一容器的hostname</span></span><br><span class="line">[root@e1e8cc01792d /]# ping centos6.9_02</span><br><span class="line">PING centos6.9_02 (172.16.1.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq=1 ttl=64 time=0.197 ms</span><br><span class="line">64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq=2 ttl=64 time=0.269 ms</span><br><span class="line">64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq=3 ttl=64 time=1.04 ms</span><br></pre></td></tr></table></figure>

<h3 id="2-Overlay的网络访问流程图"><a href="#2-Overlay的网络访问流程图" class="headerlink" title="2 Overlay的网络访问流程图"></a>2 Overlay的网络访问流程图</h3><img src="/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B9%9D-Dokcer%E8%B7%A8%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/overlay%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE.png" class="" title="overlay网络访问">

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(二)-Docker常用管理命令</title>
    <url>/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%8C-Docker%E5%B8%B8%E7%94%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="一、常用镜像管理命令"><a href="#一、常用镜像管理命令" class="headerlink" title="一、常用镜像管理命令"></a>一、常用镜像管理命令</h2><blockquote>
<p>​	Docker镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数(如匿名卷、环境变量、用户等)。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
</blockquote>
<h3 id="1-在镜像仓库查找镜像"><a href="#1-在镜像仓库查找镜像" class="headerlink" title="1 在镜像仓库查找镜像"></a>1 在镜像仓库查找镜像</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search tomcat</span><br></pre></td></tr></table></figure>

<h3 id="2-在镜像仓库拉取镜像"><a href="#2-在镜像仓库拉取镜像" class="headerlink" title="2 在镜像仓库拉取镜像"></a>2 在镜像仓库拉取镜像</h3><blockquote>
<p>不指定版本号时默认下载最新版（latest），版本可在dockerhub(官方仓库)、DaoCloud(私有仓库)等仓库查到</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dockerhub拉取</span></span><br><span class="line">docker pull alpine:3.6</span><br><span class="line"><span class="meta">#</span><span class="bash"> daocloud拉取</span></span><br><span class="line">docker pull daocloud.io/jermine/alpine:latest</span><br></pre></td></tr></table></figure>

<h3 id="3-查看已有镜像"><a href="#3-查看已有镜像" class="headerlink" title="3 查看已有镜像"></a>3 查看已有镜像</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker image ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> 别名</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h3 id="4-导出镜像"><a href="#4-导出镜像" class="headerlink" title="4 导出镜像"></a>4 导出镜像</h3><blockquote>
<p>弃用export，导出的镜像不带版本TAG信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker image save alpine -o alpine.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="5-删除镜像"><a href="#5-删除镜像" class="headerlink" title="5 删除镜像"></a>5 删除镜像</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除alpine镜像</span></span><br><span class="line">docker image rm d4ff818577bc</span><br></pre></td></tr></table></figure>

<h3 id="6-导入镜像"><a href="#6-导入镜像" class="headerlink" title="6 导入镜像"></a>6 导入镜像</h3><blockquote>
<p>弃用import，导入的镜像不带版本TAG信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker image load -i alpine.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="7-查看镜像属性"><a href="#7-查看镜像属性" class="headerlink" title="7 查看镜像属性"></a>7 查看镜像属性</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker image inspect 4f380adfc10f</span><br></pre></td></tr></table></figure>

<h3 id="8-镜像批量删除"><a href="#8-镜像批量删除" class="headerlink" title="8 镜像批量删除"></a>8 镜像批量删除</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure>

<h3 id="9-指定TAG信息"><a href="#9-指定TAG信息" class="headerlink" title="9 指定TAG信息"></a>9 指定TAG信息</h3><blockquote>
<p>docker images查看docker image import的镜像，没有镜像名和TAG，可以使用此方法来修改</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker image tag d4ff818577bc oldbly</span><br></pre></td></tr></table></figure>

<h2 id="二、常用容器管理命令"><a href="#二、常用容器管理命令" class="headerlink" title="二、常用容器管理命令"></a>二、常用容器管理命令</h2><blockquote>
<p>​	镜像(image)和容器(container)的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。<br>​	容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的root文件系统、自己的网络配置、自己的进程空间，甚至自己的用户ID空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立宿主的系统下操作一样。这种特性使容器封装的应用比直接在宿主运行更加安全。</p>
</blockquote>
<h3 id="1-运行容器"><a href="#1-运行容器" class="headerlink" title="1 运行容器"></a>1 运行容器</h3><blockquote>
<p>1、docker容器内的第一个进程（初始命令）必须一直处于前台运行的状态（必须夯住），否则这个容器，就会处于退出状态。</p>
<p>2、业务在容器中运行：前台运行夯住，启动服务</p>
<p>3、如果不指定执行命令，会运行默认的执行命令</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 放后台运行</span></span><br><span class="line">docker run -d -p 80:80 nginx:latest</span><br><span class="line">run 创建并运行一个容器</span><br><span class="line">-d	放在后台运行</span><br><span class="line">-p 	端口映射</span><br><span class="line">-v 	源地址(宿主机)：目标地址(容器)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 交互式方式进入容器执行</span></span><br><span class="line">docker run -it --name centos6 centos:6.9 /bin/bash</span><br><span class="line">-it 	分配交互式的终端</span><br><span class="line">--name 	制定容器的名称</span><br><span class="line">/bin/sh 容器执行的命令，每个进程默认有初始执行命令，可以覆盖</span><br></pre></td></tr></table></figure>

<h3 id="2-查看已有容器"><a href="#2-查看已有容器" class="headerlink" title="2 查看已有容器"></a>2 查看已有容器</h3><blockquote>
<p>-a 显示所有容器（默认只显示running的容器）</p>
<p>-l 显示最新的容器</p>
<p>–no-trunc 显示完整id</p>
<p>-q 静默输出（只显示容器id）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container ls -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 别名</span></span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h3 id="3-停止容器"><a href="#3-停止容器" class="headerlink" title="3 停止容器"></a>3 停止容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container stop 55e9c7c</span><br></pre></td></tr></table></figure>

<h3 id="4-杀死容器"><a href="#4-杀死容器" class="headerlink" title="4 杀死容器"></a>4 杀死容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container kill 55e9c7c</span><br></pre></td></tr></table></figure>

<blockquote>
<p>kill与stop的区别：</p>
<ul>
<li><p>kill：不管容器同不同意，发送SIGKILL信号，强行终止。</p>
</li>
<li><p>stop：首先给容器发送一个SIGTERM信号，让容器做一些退出前必须的保护性、安全性操作，然后让容器自动停止运行，如果在一段时间内，容器还是没有停止，再发送SIGKILL信号，强行终止。</p>
</li>
</ul>
</blockquote>
<h3 id="5-启动容器"><a href="#5-启动容器" class="headerlink" title="5 启动容器"></a>5 启动容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container start 55e9c7c</span><br></pre></td></tr></table></figure>

<h3 id="6-进入容器（重要！调试、排错）"><a href="#6-进入容器（重要！调试、排错）" class="headerlink" title="6 进入容器（重要！调试、排错）"></a>6 进入容器（重要！调试、排错）</h3><p>使用同一终端：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 交互式方式运行容器（开启新终端）</span></span><br><span class="line">docker run -it --name centos6.9 centos:6.9 /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 暂时退出当前终端</span></span><br><span class="line">ctrl + p 再 ctrl + q</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新进入该终端</span></span><br><span class="line">docker attach d4ff818577bc</span><br></pre></td></tr></table></figure>

<p>使用不同终端（常用）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it d4ff818577bc /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="7-删除容器"><a href="#7-删除容器" class="headerlink" title="7 删除容器"></a>7 删除容器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container rm 55e9c7cb59a6 55e9c7cb59a5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 别名</span></span><br><span class="line">docker rm 55e9c7cb59a6</span><br><span class="line"><span class="meta">#</span><span class="bash"> 批量删除容器</span></span><br><span class="line">docker rm `docker ps -a -q`</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(五)-手动制作docker镜像</title>
    <url>/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%94-%E6%89%8B%E5%8A%A8%E5%88%B6%E4%BD%9Cdocker%E9%95%9C%E5%83%8F/</url>
    <content><![CDATA[<h2 id="一、制作Docker镜像"><a href="#一、制作Docker镜像" class="headerlink" title="一、制作Docker镜像"></a>一、制作Docker镜像</h2><h3 id="1-启动基础容器"><a href="#1-启动基础容器" class="headerlink" title="1 启动基础容器"></a>1 启动基础容器</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -it centos:6.9 # yum</span><br><span class="line">docker run -it alpine:3.9 # apk</span><br></pre></td></tr></table></figure>

<h3 id="2-在容器中安装服务"><a href="#2-在容器中安装服务" class="headerlink" title="2 在容器中安装服务"></a>2 在容器中安装服务</h3><p>修改yum源（Centos6阿里源已停止维护）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;[centos-office]</span><br><span class="line">name=centos-office</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=https://vault.centos.org/6.10/os/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://vault.centos.org/6.10/os/x86_64/RPM-GPG-KEY-CentOS-6&#x27; &gt; CentOS-Base.repo</span><br></pre></td></tr></table></figure>

<p>安装并启动openssh服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install openssh-server -y</span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<p>修改root密码(默认没有密码)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;123456&#x27; | passwd --stdin root</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">echo root:123456 | chpassw</span><br></pre></td></tr></table></figure>

<p>将已经安装好sshd服务的容器打包成镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container commit 981877f137c9 centos6.9_ssh:v1</span><br></pre></td></tr></table></figure>

<p>测试镜像</p>
<blockquote>
<p>sshd -D：以后台守护进程的方式运行服务</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动sshd并将22端口映射出来，可以使用xshell连接</span></span><br><span class="line">docker run -d -p 1022:22 centos6.9_ssh:v1 /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure>

<h2 id="二、小案例：创建一个ssh-nginx双服务的镜像"><a href="#二、小案例：创建一个ssh-nginx双服务的镜像" class="headerlink" title="二、小案例：创建一个ssh+nginx双服务的镜像"></a>二、小案例：创建一个ssh+nginx双服务的镜像</h2><p>创建容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 1023:22 centos6.9_ssh:v1 /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure>

<p>修改yum源和epel源</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">由于Centos6阿里云停止维护</span><br><span class="line">参考：https://blog.csdn.net/u013250554/article/details/110684307</span><br></pre></td></tr></table></figure>

<p>安装nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>

<p>创建运行服务的脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /root/init.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">service sshd restart</span><br><span class="line">nginx -g &#x27;daemon off;&#x27;</span><br></pre></td></tr></table></figure>

<p>将容器封装成镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker commit e6a6dsa6 centos6.9_ssh_nginx:v2</span><br></pre></td></tr></table></figure>

<p>启动镜像，开启服务，并夯住</p>
<blockquote>
<p>可以使用工具ssh登录，并且可以访问到nginx的欢迎页面</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 1025:22 -p 80:80 centos6.9_ssh_nginx:v2 /bin/bash /root/init.sh</span><br></pre></td></tr></table></figure>

<h2 id="三、通过环境变量设置容器密码"><a href="#三、通过环境变量设置容器密码" class="headerlink" title="三、通过环境变量设置容器密码"></a>三、通过环境变量设置容器密码</h2><p>修改&#x2F;root&#x2F;init.sh文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if [ -z $SSH_PWD ];then</span><br><span class="line">        SSH_PWD=123456</span><br><span class="line">fi</span><br><span class="line">echo &quot;$SSH_PWD&quot; | passwd --stdin root</span><br><span class="line"></span><br><span class="line">service sshd restart</span><br><span class="line">nginx -g &#x27;daemon off;&#x27;</span><br></pre></td></tr></table></figure>

<p>打包成镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker commit 12386c6504d4 centos6.9_ssh_nginx_passwd</span><br></pre></td></tr></table></figure>

<p>运行容器</p>
<blockquote>
<p>docker run -e：指定环境变量</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 1022:22 -p 80:80 -e &quot;SSH_PWD=123456&quot; centos6.9_ssh_nginx_passwd /bin/bash /root/init.sh</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(八)-Docker私有仓库</title>
    <url>/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AB-Docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/</url>
    <content><![CDATA[<h2 id="一、官方私有仓库registry"><a href="#一、官方私有仓库registry" class="headerlink" title="一、官方私有仓库registry"></a>一、官方私有仓库registry</h2><h3 id="1-安装步骤"><a href="#1-安装步骤" class="headerlink" title="1 安装步骤"></a>1 安装步骤</h3><p>拉取私有仓库镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure>

<p>启动私有仓库容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -di --name=registry -p 5000:5000 registry</span><br></pre></td></tr></table></figure>

<p>验证是否正常</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 浏览器输入</span></span><br><span class="line">10.0.0.12:5000/v2/_catalog</span><br></pre></td></tr></table></figure>

<p>修改daemon.json，让 docker信任私有仓库地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加</span></span><br><span class="line">&#123;</span><br><span class="line">	&quot;insecure-registries&quot;:[&quot;10.0.0.12:5000&quot;]</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>重启docker服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl reset-failed docker.service</span><br></pre></td></tr></table></figure>

<p>上传镜像到私有仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push 10.0.0.11:5000/registry</span><br></pre></td></tr></table></figure>

<p>从私有仓库下载镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull http://10.0.0.12:5000/registry</span><br></pre></td></tr></table></figure>

<h2 id="二、企业级私有仓库Harbor"><a href="#二、企业级私有仓库Harbor" class="headerlink" title="二、企业级私有仓库Harbor"></a>二、企业级私有仓库Harbor</h2><blockquote>
<p>Harbor：第三方registry组件</p>
<p>项目地址：<a href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a></p>
<p>老男孩强哥博客地址：<a href="https://oldqiang.com/">https://oldqiang.com/</a></p>
</blockquote>
<h3 id="1-为什么使用Harbor"><a href="#1-为什么使用Harbor" class="headerlink" title="1 为什么使用Harbor"></a>1 为什么使用Harbor</h3><p>因为官方仓库registry存在诸多问题：</p>
<ul>
<li><p>https问题</p>
</li>
<li><p>网页简陋，查看镜像、删除镜像不方便</p>
</li>
<li><p>权限控制不方便（要么有权限，要么完全没权限），不支持多用户</p>
</li>
</ul>
<h3 id="2-Harbor安装步骤"><a href="#2-Harbor安装步骤" class="headerlink" title="2 Harbor安装步骤"></a>2 Harbor安装步骤</h3><blockquote>
<p>这里以v2.2.3为例</p>
</blockquote>
<p>离线安装包获取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.2.3/harbor-offline-installer-v2.2.3.tgz</span><br></pre></td></tr></table></figure>

<p>解压文件，并修改配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -vxf harbor-offline-installer-v2.2.3.tgz</span><br><span class="line">cd harbor/</span><br><span class="line">cp harbor.yml.tmpl harbor.yml</span><br><span class="line">vim harbor.yml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注释https设置项，并修改以下内容</span></span><br><span class="line">hostname = 10.0.0.12  </span><br><span class="line">harbor_admin_password = 1qaz@WSX</span><br></pre></td></tr></table></figure>

<p>执行安装脚本（时间比较长）</p>
<blockquote>
<p>需要先安装docker-compose，</p>
<p><a href="https://gsproj.github.io/2021/07/07/Docker%E7%B3%BB%E5%88%97-%E5%8D%81-Dokcer%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92docker-compose/">docker-compose安装参考</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<p>网页访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://10.0.0.12</span><br><span class="line">admin</span><br></pre></td></tr></table></figure>

<h3 id="3-镜像推送与下载"><a href="#3-镜像推送与下载" class="headerlink" title="3 镜像推送与下载"></a>3 镜像推送与下载</h3><p>docker配置文件添加白名单</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">&quot;insecure-registries&quot;:[&quot;10.0.0.12&quot;],  # 不要加端口,可以是IP或域名，中间逗号隔开可加多个</span><br></pre></td></tr></table></figure>

<p>镜像打标签</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull 10.0.0.12/xxx/centos6.9_ssh:v2   # xxx是仓库中的创建的项目名</span><br></pre></td></tr></table></figure>

<p>登录到仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker login 10.0.0.12</span><br></pre></td></tr></table></figure>

<p>推送到仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push 10.0.0.12/xxx/centos6.9_ssh:v2</span><br></pre></td></tr></table></figure>

<p>从仓库下载镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull 10.0.0.12/xxx/centos6.9_ssh:v2</span><br></pre></td></tr></table></figure>

<h3 id="4-将Harbor升级为https访问"><a href="#4-将Harbor升级为https访问" class="headerlink" title="4 将Harbor升级为https访问"></a>4 将Harbor升级为https访问</h3><p>配置文件修改，主要是添加证书路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> https related config</span></span><br><span class="line">https:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> https port <span class="keyword">for</span> harbor, default is 443</span></span><br><span class="line">  port: 443</span><br><span class="line"><span class="meta">  #</span><span class="bash"> The path of cert and key files <span class="keyword">for</span> nginx</span></span><br><span class="line">  certificate: /your/certificate/path</span><br><span class="line">  private_key: /your/private/key/path</span><br></pre></td></tr></table></figure>

<p>再次执行安装脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(六)-Dockfile的使用</title>
    <url>/2021/06/30/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AD-Dockfile%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="一、Dokerfile简介"><a href="#一、Dokerfile简介" class="headerlink" title="一、Dokerfile简介"></a>一、Dokerfile简介</h2><blockquote>
<p>Dockerfile 是一个用来自动构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>建议存放在&#x2F;opt&#x2F;dockerfile中，如创建centosXX的镜像，则创建&#x2F;opt&#x2F;dockerfile&#x2F;centosXX&#x2F;Dockerfile</p>
</blockquote>
<h3 id="1-Dockerfile的简单使用"><a href="#1-Dockerfile的简单使用" class="headerlink" title="1 Dockerfile的简单使用"></a>1 Dockerfile的简单使用</h3><blockquote>
<p>创建一个开启sshd服务的centos6.9镜像</p>
</blockquote>
<p>创建yum源文件，用于拷贝到centos6.9镜像中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /opt/dockfile/centos6.9_ssh</span><br><span class="line">vim CentOS-Base.repo</span><br><span class="line">...内容省略</span><br></pre></td></tr></table></figure>

<p>创建Dockerfile文件&#x2F;opt&#x2F;dockfile&#x2F;centos6.9_ssh&#x2F;Dockerfile，内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">6.9</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> CentOS-Base.repo /etc/yum.repos.d</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install openssh-server -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> service sshd restart</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;123456&#x27;</span> | passwd --stdin root</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/usr/sbin/sshd&quot;</span>,<span class="string">&quot;-D&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：RUN的执行过程：创建临时容器，执行命令，提交成临时镜像，删除临时容器，重复此步骤。</p>
</blockquote>
<p>构建镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build -t centos6.9_ssh:v2 /opt/dockfile/centos6.9_ssh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：最后传入的是包含Dockerfile的文件夹，区分大小写，可以用”.”代替 </p>
</blockquote>
<p>验证镜像是否正常</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 1022:22 centos6.9_ssh:v2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：最后不用接命令，将自动执行CMD指定的命令</p>
</blockquote>
<h3 id="2-小案例"><a href="#2-小案例" class="headerlink" title="2 小案例"></a>2 小案例</h3><blockquote>
<p>创建centos6.9 + ssh + nginx的Dockerfile</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@docker01 centos6.9_ssh_nginx]# pwd</span><br><span class="line">/opt/dockfile/centos6.9_ssh_nginx</span><br><span class="line">[root@docker01 centos6.9_ssh_nginx]# ls</span><br><span class="line">CentOS-Base.repo  Dockerfile  epel.repo  init.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> init.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">service sshd restart</span><br><span class="line">nginx -g &quot;daemon off;&quot;</span><br></pre></td></tr></table></figure>

<p>编写Dockerfile</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos:6.9</span><br><span class="line">ADD CentOS-Base.repo /etc/yum.repos.d</span><br><span class="line">ADD epel.repo /etc/yum.repos.d</span><br><span class="line">ADD init.sh /root</span><br><span class="line">RUN yum install openssh-server nginx -y</span><br><span class="line">RUN echo &#x27;123456&#x27; | passwd --stdin root</span><br><span class="line">CMD [&quot;/bin/bash&quot;,&quot;/root/init.sh&quot;]</span><br></pre></td></tr></table></figure>

<p>构建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t centos6.9_ssh_nginx:v3 .</span><br></pre></td></tr></table></figure>

<p>测试使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 1022:22 -p 81:80 centos6.9_ssh_nginx:v3</span><br></pre></td></tr></table></figure>

<h2 id="二、Docker指令"><a href="#二、Docker指令" class="headerlink" title="二、Docker指令"></a>二、Docker指令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">FROM</td>
<td align="left">基于那个镜像来构建</td>
</tr>
<tr>
<td align="left">MAINTAINER</td>
<td align="left">镜像的创建者</td>
</tr>
<tr>
<td align="left">ENV</td>
<td align="left">设置环境变量</td>
</tr>
<tr>
<td align="left">ADD</td>
<td align="left">添加宿主机文件到容器里，有需要解压的文件会自动解压</td>
</tr>
<tr>
<td align="left">COPY</td>
<td align="left">添加宿主机文件到容器里</td>
</tr>
<tr>
<td align="left">WORKDIR</td>
<td align="left">切换工作目录</td>
</tr>
<tr>
<td align="left">EXPOSE</td>
<td align="left">开放可用端口</td>
</tr>
<tr>
<td align="left">CMD</td>
<td align="left">容器启动后执行的命令，可被docker run指定的命令覆盖</td>
</tr>
<tr>
<td align="left">ENTRYPOINT</td>
<td align="left">容器启动后执行的命令，但不回被docker run指定的命令覆盖，如需覆盖，需要加–entrypoint参数</td>
</tr>
<tr>
<td align="left">VOLUME</td>
<td align="left">创建挂载卷，将宿主机的目录挂载到容器里</td>
</tr>
</tbody></table>
<h2 id="三、案例：Dockerfile构建可道云容器"><a href="#三、案例：Dockerfile构建可道云容器" class="headerlink" title="三、案例：Dockerfile构建可道云容器"></a>三、案例：Dockerfile构建可道云容器</h2><blockquote>
<p>项目：</p>
<p>​	可道云网盘kodexplorer</p>
<p>环境：</p>
<p>​	httpd+php或者nginx+php<br>​	php所需模块：php5.5以上<br>​	基础镜像：centos:7.9<br>​	项目下载地址: <a href="http://static.kodcloud.com/update/download/kodexplorer4.37.zip">http://static.kodcloud.com/update/download/kodexplorer4.37.zip</a><br>​	项目官网：<a href="https://kodcloud.com/download/">https://kodcloud.com/download/</a></p>
</blockquote>
<h3 id="1-手工部署一遍"><a href="#1-手工部署一遍" class="headerlink" title="1 手工部署一遍"></a>1 手工部署一遍</h3><blockquote>
<p>写Dockerfile前自己手动部署一遍，主要是nginx + php的搭建，参考博客</p>
<p><a href="https://cloud.tencent.com/developer/article/1015237">https://cloud.tencent.com/developer/article/1015237</a></p>
</blockquote>
<p>修改nginx.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For more information on configuration, see:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   * Official English Documentation: http://nginx.org/en/docs/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   * Official Russian Documentation: http://nginx.org/ru/docs/</span></span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    	location ~ \.php$ &#123;</span><br><span class="line">        try_files $uri =404;</span><br><span class="line">        fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    	&#125;</span><br><span class="line">	</span><br><span class="line">    	location / &#123;</span><br><span class="line">        index  index.php index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.php?$args;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Settings <span class="keyword">for</span> a TLS enabled server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#    server &#123;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">        listen       443 ssl http2;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        listen       [::]:443 ssl http2;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        server_name  _;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        root         /usr/share/nginx/html;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">        ssl_certificate_key <span class="string">&quot;/etc/pki/nginx/private/server.key&quot;</span>;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        ssl_session_cache shared:SSL:1m;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        ssl_session_timeout  10m;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        ssl_ciphers HIGH:!aNULL:!MD5;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        ssl_prefer_server_ciphers on;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#        # Load configuration files for the default server block.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">        include /etc/nginx/default.d/*.conf;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#        error_page 404 /404.html;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">            location = /40x.html &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        &#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#        error_page 500 502 503 504 /50x.html;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">            location = /50x.html &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        &#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改php-fpm.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">;;;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; FPM Configuration ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">; All relative paths in this configuration file are relative to PHP&#x27;s install</span><br><span class="line">; prefix.</span><br><span class="line"></span><br><span class="line">; Include one or more files. If glob(3) exists, it is used to include a bunch of</span><br><span class="line">; files from a glob(3) pattern. This directive can be used everywhere in the</span><br><span class="line">; file.</span><br><span class="line">include=/etc/php-fpm.d/*.conf</span><br><span class="line"></span><br><span class="line">;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Global Options ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">; Pid file</span><br><span class="line">; Default Value: none</span><br><span class="line">pid = /run/php-fpm/php-fpm.pid</span><br><span class="line"></span><br><span class="line">; Error log file</span><br><span class="line">; Default Value: /var/log/php-fpm.log</span><br><span class="line">error_log = /var/log/php-fpm/error.log</span><br><span class="line"></span><br><span class="line">; Log level</span><br><span class="line">; Possible Values: alert, error, warning, notice, debug</span><br><span class="line">; Default Value: notice</span><br><span class="line">;log_level = notice</span><br><span class="line"></span><br><span class="line">; If this number of child processes exit with SIGSEGV or SIGBUS within the time</span><br><span class="line">; interval set by emergency_restart_interval then FPM will restart. A value</span><br><span class="line">; of &#x27;0&#x27; means &#x27;Off&#x27;.</span><br><span class="line">; Default Value: 0</span><br><span class="line">;emergency_restart_threshold = 0</span><br><span class="line"></span><br><span class="line">; Interval of time used by emergency_restart_interval to determine when </span><br><span class="line">; a graceful restart will be initiated.  This can be useful to work around</span><br><span class="line">; accidental corruptions in an accelerator&#x27;s shared memory.</span><br><span class="line">; Available Units: s(econds), m(inutes), h(ours), or d(ays)</span><br><span class="line">; Default Unit: seconds</span><br><span class="line">; Default Value: 0</span><br><span class="line">;emergency_restart_interval = 0</span><br><span class="line"></span><br><span class="line">; Time limit for child processes to wait for a reaction on signals from master.</span><br><span class="line">; Available units: s(econds), m(inutes), h(ours), or d(ays)</span><br><span class="line">; Default Unit: seconds</span><br><span class="line">; Default Value: 0</span><br><span class="line">;process_control_timeout = 0</span><br><span class="line"></span><br><span class="line">; Send FPM to background. Set to &#x27;no&#x27; to keep FPM in foreground for debugging.</span><br><span class="line">; Default Value: yes</span><br><span class="line">daemonize = no</span><br><span class="line"></span><br><span class="line">;;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Pool Definitions ; </span><br><span class="line">;;;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">; See /etc/php-fpm.d/*.conf</span><br></pre></td></tr></table></figure>

<p>修改<a href="http://www.conf/">www.conf</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 12行</span></span><br><span class="line">listen = /var/run/php-fpm/php-fpm.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 31-32行</span></span><br><span class="line">listen.owner = nobody</span><br><span class="line">listen.group = nobody</span><br><span class="line"><span class="meta">#</span><span class="bash"> 39-41行</span></span><br><span class="line">user = nginx</span><br><span class="line">; RPM: Keep a group allowed to write in log dir.</span><br><span class="line">group = nginx</span><br></pre></td></tr></table></figure>

<p>修改php.ini</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cgi.fix_pathinfo 把它的值设置为 0</span><br></pre></td></tr></table></figure>

<h3 id="2-Dockerfile部署"><a href="#2-Dockerfile部署" class="headerlink" title="2 Dockerfile部署"></a>2 Dockerfile部署</h3><p>文件存放</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@docker01 centos7.9_kod]# ll</span><br><span class="line">total 92</span><br><span class="line">-rw-r--r--. 1 root root   661 Jul  2 11:21 Dockerfile</span><br><span class="line">-rw-r--r--. 1 root root   171 Jul  1 14:28 init.sh</span><br><span class="line">-rw-r--r--. 1 root root  2715 Jul  1 13:50 nginx.conf</span><br><span class="line">-rw-r--r--. 1 root root  1691 Jul  1 13:50 php-fpm.conf</span><br><span class="line">-rw-r--r--. 1 root root 64945 Jul  1 14:48 php.ini</span><br><span class="line">-rw-r--r--. 1 root root 10029 Jul  1 13:50 www.conf</span><br><span class="line">[root@docker01 centos7.9_kod]# pwd</span><br><span class="line">/opt/dockfile/centos7.9_kod</span><br></pre></td></tr></table></figure>

<p>编写Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7.9</span>.<span class="number">2009</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; \</span></span><br><span class="line"><span class="bash">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo &amp;&amp; \</span></span><br><span class="line"><span class="bash">yum install openssh-server nginx net-tools php-cli php-fpm unzip php-gd php-mbstring  -y</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx.conf /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> php-fpm.conf /etc/php-fpm.conf</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> www.conf /etc/php-fpm.d/www.conf</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> php.ini /etc</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> init.sh /root/</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">22</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/share/nginx/html</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -o kod.zip https://static.kodcloud.com/update/download/kodexplorer4.45.zip &amp;&amp; \</span></span><br><span class="line"><span class="bash">unzip kod.zip &amp;&amp; \</span></span><br><span class="line"><span class="bash">chmod -R 777 /usr/share/nginx/html/</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;/root/init.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>构建镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build -t centos7.9_kod:v1 .</span><br></pre></td></tr></table></figure>

<p>运行容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 80:80 -p 1022:22 -e &quot;SSH_PWD=redhat123&quot; --privileged centos7.9_kod:v1 /usr/sbin/init</span><br></pre></td></tr></table></figure>

<p>进入容器，并运行初始化命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it 865 /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器启动服务，设置root密码</span></span><br><span class="line">[root@88179198e672 html]#systemctl restart sshd php-fpm nginx</span><br><span class="line">[root@88179198e672 html]#echo &quot;redhat123&quot; | passwd --stdin root</span><br></pre></td></tr></table></figure>

<p>测试访问：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">网页访问：http://10.0.0.11可进去可道云界面</span><br><span class="line">ssh 10.0.0.11 -p1022 可以登录镜像</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(十)-Dokcer单机编排docker-compose</title>
    <url>/2021/07/07/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%8D%81-Dokcer%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92docker-compose/</url>
    <content><![CDATA[<blockquote>
<p>docker-compose 单机版的容器编排工具</p>
</blockquote>
<h2 id="一、安装docker-compose"><a href="#一、安装docker-compose" class="headerlink" title="一、安装docker-compose"></a>一、安装docker-compose</h2><p>添加Centos7的epel源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -o epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p>安装pip</p>
<blockquote>
<p>Python 2.7已于2020年1月1日到期，请停止使用。请升级您的Python，因为不再维护Python 2.7。pip 21.0将于2021年1月停止对Python 2.7的支持。pip 21.0将删除对此功能的支持。因此安装&lt;21.0的版本</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y python2-pip</span><br><span class="line">pip install --upgrade &quot;pip &lt; 21.0&quot;</span><br></pre></td></tr></table></figure>

<p>安装docker-compose</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>

<p>创建文件夹用于存放docker-compose脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /opt/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="一、案例：compose构建wordpress并使用nginx负载均衡"><a href="#一、案例：compose构建wordpress并使用nginx负载均衡" class="headerlink" title="一、案例：compose构建wordpress并使用nginx负载均衡"></a>一、案例：compose构建wordpress并使用nginx负载均衡</h2><p>docker01主机创建docker-compose文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /opt/docker-compose/wordpress/docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db_data:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">somewordpress</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:latest</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">web_data:/var/www/html</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">&quot;80&quot;</span>  <span class="comment"># 随机端口映射到内网80端口</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">     <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db:3306</span></span><br><span class="line">     <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">wordpress</span></span><br><span class="line">     <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db_data:</span></span><br><span class="line">  <span class="attr">web_data:</span></span><br></pre></td></tr></table></figure>

<p>构建Docker容器(三个wordpress，一个mysql）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up --scale wordpress=3 -d</span><br><span class="line">-d 后台运行</span><br><span class="line">--scale 生成的实例数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstaus -lntup可以看到3个连续的端口号</span><br><span class="line">tcp        0      0 0.0.0.0:49156           0.0.0.0:*               LISTEN      2110/docker-proxy</span><br><span class="line">tcp        0      0 0.0.0.0:49157           0.0.0.0:*               LISTEN      2126/docker-proxy</span><br><span class="line">tcp        0      0 0.0.0.0:49158           0.0.0.0:*               LISTEN      2143/docker-proxy</span><br></pre></td></tr></table></figure>

<p>docker02主机安装nginx，用于负载均衡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -o epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum install nginx</span><br></pre></td></tr></table></figure>

<p>配置nginx</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /etc/nginx/</span><br><span class="line">mv nginx.conf nginx.conf.bak</span><br><span class="line">grep -Ev &#x27;^$|#&#x27; nginx.conf.default  &gt; nginx.conf</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream wordpress &#123;</span><br><span class="line">        server 10.0.0.11:49156;</span><br><span class="line">        server 10.0.0.11:49157;</span><br><span class="line">        server 10.0.0.11:49158;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass  http://wordpress;</span><br><span class="line">            proxy_set_header Host $host;  # 不加上网页没有Host信息，显示不全</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启nginx服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>测试访问</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">浏览器访问:10.0.0.12,可以进入wordpress</span><br></pre></td></tr></table></figure>

<p>查看是否负载均衡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个查看信息的页面</span></span><br><span class="line">cd /var/lib/docker/volumes/wordpress_web_data/_data/</span><br><span class="line">vim info.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>浏览器访问：10.0.0.12&#x2F;info.php，查看其中IP信息</p>
<h2 id="二、案例：构建zabbix"><a href="#二、案例：构建zabbix" class="headerlink" title="二、案例：构建zabbix"></a>二、案例：构建zabbix</h2>]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(四)-容器的数据卷挂载与小案例练习</title>
    <url>/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%9B%9B-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E4%B8%8E%E5%B0%8F%E6%A1%88%E4%BE%8B%E7%BB%83%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="一、数据卷挂载"><a href="#一、数据卷挂载" class="headerlink" title="一、数据卷挂载"></a>一、数据卷挂载</h2><h3 id="1-临时挂载"><a href="#1-临时挂载" class="headerlink" title="1 临时挂载"></a>1 临时挂载</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将/opt/xiaoniao目录挂载到容器的html目录</span></span><br><span class="line">docker run -d -p 80:80 -v /opt/xiaoniao:/usr/share/nginx/html nginx:latest</span><br></pre></td></tr></table></figure>

<h3 id="2-使用卷挂载"><a href="#2-使用卷挂载" class="headerlink" title="2 使用卷挂载"></a>2 使用卷挂载</h3><blockquote>
<p>容器被删除，创建的卷可以保留，可以再次挂载到新建的容器中</p>
</blockquote>
<p>创建名为myvol的容器卷并挂载到容器html目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 80:80 -v myvol:/usr/share/nginx/html nginx:latest</span><br></pre></td></tr></table></figure>

<p>查看当前有哪些容器卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>

<p>查看名为myvol的卷的信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume inspect myvol</span><br></pre></td></tr></table></figure>

<p>删除容器并删除卷（无效）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> PS：删除容器并删除卷，无法将卷删除</span></span><br><span class="line">docker rm -f -v [容器ID]</span><br><span class="line">    -v --volume</span><br></pre></td></tr></table></figure>

<h2 id="二、小案例：多端口多站点"><a href="#二、小案例：多端口多站点" class="headerlink" title="二、小案例：多端口多站点"></a>二、小案例：多端口多站点</h2><blockquote>
<p>80端口访问nginx首页</p>
<p>81端口访问水果忍者</p>
</blockquote>
<p>获取水果忍者HTML5小游戏源码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://7npmedia.w3cschool.cn/1-FruitNinja.7z</span><br></pre></td></tr></table></figure>

<p>创建81端口nginx配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /opt/fruitninjia.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen       81;</span><br><span class="line">    listen  [::]:81;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /data;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将游戏源码文件解压至&#x2F;opt&#x2F;fruitninjia，并运行nginx容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将/opt/fruitninjia挂载到容器/data中</span></span><br><span class="line">docker run -d -p 80:80 -p 81:81 -v /opt/fruitninjia:/data -v /opt/fruitninjia.conf:/etc/nginx/conf.d/fruitninjia.conf nginx</span><br></pre></td></tr></table></figure>

<p>网页访问</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://10.0.0.11:80</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>Docker系列(零)-Docker介绍</title>
    <url>/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E9%9B%B6-Docker%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h1 id="一、容器简介"><a href="#一、容器简介" class="headerlink" title="一、容器简介"></a>一、容器简介</h1><p>容器就是在隔离环境中运行一个进程，如果进程停止，容器就会销毁。</p>
<p>隔离环境拥有自己的系统文件，ip地址，主机名等。</p>
<h2 id="1-1-容器和虚拟化的区别"><a href="#1-1-容器和虚拟化的区别" class="headerlink" title="1.1 容器和虚拟化的区别"></a>1.1 容器和虚拟化的区别</h2><p>KVM虚拟化：</p>
<p>需要硬件的支持，需要模拟硬件，可以运行不同的操作系统，启动时间分钟级（有开机启动流程）</p>
<p>开机启动流程</p>
<p>bios开机硬件自检</p>
<p>根据bios设置的优先启动项boot</p>
<p>读取mbr&#x2F;gpt引导，读取mbr硬盘分区信息，内核加载路径</p>
<p>加载内核</p>
<p>启动第一个进程（C6：&#x2F;sbin&#x2F;init，C7：systemd）</p>
<p>系统初始化完成</p>
<p>运行服务</p>
<p>容器：</p>
<p>不需要硬件的支持，不需要模拟硬件，公用宿主机内核，启动时间秒级（没有开机启动流程）</p>
<p>容器的第一个进程直接运行服务，损耗少，启动快，性能高</p>
<h2 id="1-2-容器的优缺点："><a href="#1-2-容器的优缺点：" class="headerlink" title="1.2 容器的优缺点："></a>1.2 容器的优缺点：</h2><p>优点：</p>
<p>与宿主机使用同一个内核，性能损耗小</p>
<p>不需要指令级模拟</p>
<p>容器可以再cpu核心的本地运行指令，不需要任何专门的解释机制</p>
<p>避免了准虚拟化和系统调用替换中的复杂性</p>
<p>轻量级隔离，在隔离的同事还提供共享机制，以实现容器与宿主机的资源共享</p>
<p>缺点：</p>
<p>使用同一内核，存在安全性问题</p>
<h2 id="1-3-容器技术的发展过程"><a href="#1-3-容器技术的发展过程" class="headerlink" title="1.3 容器技术的发展过程"></a>1.3 容器技术的发展过程</h2><p>chroot — lxc —- docker</p>
<h1 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h1><p># 添加docker安装源 </p>
<p>yum-config-manager –add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a> </p>
<p>查看所有仓库中docker版本，并选择特定版本安装：(此处我们查看社区版 docker-ce) yum list docker-ce –showduplicates | sort -r # 安装docker-ce yum install docker-ce -y</p>
<h1 id="三、Docker镜像的常用命令"><a href="#三、Docker镜像的常用命令" class="headerlink" title="三、Docker镜像的常用命令"></a>三、Docker镜像的常用命令</h1><p># 搜索镜像docker search [镜像名称]# 拉取镜像docker pull [域名镜像名称]:[版本号]例如：docker pull daocloud.io&#x2F;hzc&#x2F;alpine:3.6 # 默认拉取Lastest最新版PS: docker image pull &#x3D; docker pull# 如何查看镜像有那些版本？dockerhub网页搜索 daocloud 国内的dockhub# 镜像加速：（1）阿里云docker镜像加速器服务（2）配置docker镜像加速(推荐) vi &#x2F;etc&#x2F;docker&#x2F;daemon.json {   “registry-mirrors”:[“<a href="https://registry.docker-cn.com”]">https://registry.docker-cn.com”]</a> } systemctl daemon-reload# 上传镜像docker push [镜像名称]# 查看已有镜像docker images &#x3D; docker image ls# 导出镜像docker image save alpine:latest -o docker_alpine.tar.gz # save跟export选哪个？都是导出镜像，但是export没带版本标签，export弃用# 导入镜像docker image load -i docker_alpine.tar.gz # load跟import选哪个？都是导入镜像，load对应save，import不带版本标签，import弃用# 删除镜像docker image rm alpine:3.6# 构建镜像docker image build# 查看构建镜像用到的历史命令docker image histroy# 查看镜像的详细属性docker image inspect# 批量删除镜像docker image prune# 给镜像打标签docker image tag [镜像ID] oldboy:v1 # Docker的容器管理1、查看容器列表 docker container ls -a docker ps # 默认只查看活着的容器 docker ps -a # 查看所有容器 docker ps -a -q # 静默输出，显示所有容器的ID docker ps -a -l docker ps -a -l –no-trunc # 查看完整命令（不隐藏）# 停止容器docker container stop [容器ID] docker container kill [容器ID]# 恢复容器 docker container start 【容器ID】# 启动容器 docker run -d -p 80:80 nginx:latest run 创建并运行一个容器 -d   放在后台运行 -p 端口映射 -v 源地址(宿主机)：目标地址(容器) docker run -it –name centos6 centos:6.9 &#x2F;bin&#x2F;bash -it 分配交互式的终端 –name 制定容器的名称 &#x2F;bin&#x2F;sh 容器执行的命令，每个进程默认有初始执行命令，可以覆盖※进入容器（调试、排错）docker exec - it [容器名称&#x2F;ID] &#x2F;bin&#x2F;bash docker attach 【容器名称&#x2F;ID】 (使用同一个终端)临时退出容器：ctrl +p和ctrl + q退出# 删除容器docker container rm [容器ID] docker rm [容器ID]如何批量删除容器：docker rm <code>docker ps -a -q</code></p>
<p><strong>总结：</strong></p>
<p>docker容器内的第一个进程（初始命令）必须一直处于前台运行的状态（必须夯住），否则这个容器，就会处于退出状态。</p>
<p>业务在容器中运行：前台运行夯住，启动服务</p>
<h1 id="四、-Docker的网络访问"><a href="#四、-Docker的网络访问" class="headerlink" title="四、 Docker的网络访问"></a>四、 Docker的网络访问</h1><h2 id="4-1-容器网络访问流程"><a href="#4-1-容器网络访问流程" class="headerlink" title="4.1 容器网络访问流程"></a>4.1 容器网络访问流程</h2><p>实际上是端口映射，docker容器有自己的ip，需要靠宿主机NAT上网 </p>
<p> -p设置自动端口映射，在iptables中有增的Chain Docker, 也可以手动设置NAT</p>
<p>查看当前设置的nat：iptables -t nat -L -n</p>
<h2 id="4-2-容器网络访问注意事项："><a href="#4-2-容器网络访问注意事项：" class="headerlink" title="4.2 容器网络访问注意事项："></a>4.2 容器网络访问注意事项：</h2><p>sysctl -a | grep ipv4 | grep forward </p>
<p>查看</p>
<p>net.ipv4.ip_forward &#x3D; 1 # 为1时，docker容器才能上网，虚拟机挂起将使他变成0</p>
<p>解决方法:</p>
<p>1、sysctl net.ipv4.ip_forward &#x3D; 1 设置为1</p>
<p>2、不要挂起虚拟机，直接关机重启，docker服务在启动时会将它改为1</p>
<h2 id="4-3-指定映射-p-参数详解"><a href="#4-3-指定映射-p-参数详解" class="headerlink" title="4.3 指定映射(-p)参数详解"></a>4.3 指定映射(-p)参数详解</h2><p>-p hostPort:containerPort # 指定端口 -p ip:hostPort:containerPort # 指定ip+端口 -p ip::containerPort # 指定随机端口 -p 10.0.0.100:53:udp # 指定随机端口 + udp -p hostPort:containerPort -p hostPort:containerPort # 指定多个端口</p>
<h1 id="五、容器的数据卷挂载"><a href="#五、容器的数据卷挂载" class="headerlink" title="五、容器的数据卷挂载"></a>五、容器的数据卷挂载</h1><h2 id="5-1-临时挂载"><a href="#5-1-临时挂载" class="headerlink" title="5.1 临时挂载"></a>5.1 临时挂载</h2><p># 将&#x2F;opt&#x2F;xiaoniao目录挂载到容器的html目录 docker run -d -p 80:80 -v &#x2F;opt&#x2F;xiaoniao:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest</p>
<h2 id="5-2-持久化挂载"><a href="#5-2-持久化挂载" class="headerlink" title="5.2 持久化挂载"></a>5.2 持久化挂载</h2><p>容器被删除，创建的卷可以保留，可以再次挂载到新建的容器中</p>
<p># 创建名为oldboy的容器卷并挂载到容器html目录 docker run -d -p 80:80 -v oldboy:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest # 查看当前有哪些容器卷 docker volume ls # 查看名为oldboy的卷的信息 docker volume inspect oldboy # PS：删除容器并删除卷，无法将卷删除 docker rm -f -v [容器ID]   -v –volume</p>
<h1 id="六、小案例练习"><a href="#六、小案例练习" class="headerlink" title="六、小案例练习"></a>六、小案例练习</h1><p>&gt;&gt; 基于Nginx多端点的多站点 基于nginx启动一个容器，监听80和81，访问80，出现nginx默认的欢迎首页，访问81，出现小鸟页面。</p>
<h1 id="七、如何制作Docker镜像"><a href="#七、如何制作Docker镜像" class="headerlink" title="七、如何制作Docker镜像"></a>七、如何制作Docker镜像</h1><h2 id="7-1-启动一个基础的容器"><a href="#7-1-启动一个基础的容器" class="headerlink" title="7.1 启动一个基础的容器"></a>7.1 启动一个基础的容器</h2><p>docker run -it centos:6.9 # yum docker run -it alpine:3.9 # apk</p>
<h2 id="7-2-容器中安装服务"><a href="#7-2-容器中安装服务" class="headerlink" title="7.2 容器中安装服务"></a>7.2 容器中安装服务</h2><p># dns重定向 echo ‘192.168.15.84 mirrors.aliyun.com’ &gt;&gt; &#x2F;etc&#x2F;hosts # 替换源为阿里源 curl -o &#x2F;etc&#x2F;yum.repo.d&#x2F;CentOS-Base.repo <a href="https://mirrors.aliyun.com/repo/CentOS-6.repo">https://mirrors.aliyun.com/repo/CentOS-6.repo</a> # 安装并启动openssh服务 yum install openssh-server -y service opensshd restart # 修改root密码 echo ‘123456’ | passwd –stdin root 或者 echo 123456:root | chpassw</p>
<p>7.3 把已经安装服务的容器打包成镜像</p>
<p>docker contanier commit 5617e5d123432 centos6.9_ssh:v1</p>
<h2 id="7-4-测试镜像的功能"><a href="#7-4-测试镜像的功能" class="headerlink" title="7.4 测试镜像的功能"></a>7.4 测试镜像的功能</h2><p># 使用镜像启动一个新容器,并开启ssh服务 docker run -d -p 1022:22 centos6.9_ssh:v1 tail -f &#x2F;usr&#x2F;sbin&#x2F;sshd -D</p>
<h2 id="7-5-创建一个ssh-nginx双服务的镜像"><a href="#7-5-创建一个ssh-nginx双服务的镜像" class="headerlink" title="7.5 创建一个ssh + nginx双服务的镜像"></a>7.5 创建一个ssh + nginx双服务的镜像</h2><p>(1) 启动一个基础容器 docker yun -it -p 80:80 -p 1023:22 centos6.9_ssh:v1 &#x2F;bin&#x2F;bash (2) 在容器中安装服务(hosts与repo源在新容器会重新挂载) # dns重定向 echo ‘192.168.15.84 mirrors.aliyun.com’ &gt;&gt; &#x2F;etc&#x2F;hosts # 替换源为阿里源 curl -o &#x2F;etc&#x2F;yum.repo.d&#x2F;epel.repo <a href="https://mirrors.aliyun.com/repo/epel.repo">https://mirrors.aliyun.com/repo/epel.repo</a> # 安装nginx服务 yum install nginx -y (3) 把已经安装好服务的容器，提交为镜像 docker commit e6a6dsa6 centos6.9_ssh_nginx:v2 (4) 测试镜像功能 vim init.sh &gt;&gt;&gt;&gt;&gt; #!&#x2F;bin&#x2F;bash service sshd restart nginx -g ‘daemon off;’ &gt;&gt;&gt;&gt;&gt; # 启动镜像，执行脚本：开启服务，并夯住 docker run -d -p 1025:22 -p 80:80 centos6.9_ssh_nginx:v2 &#x2F;bin&#x2F;bash &#x2F;init.sh</p>
<h3 id="7-6-自定义容器镜像的密码"><a href="#7-6-自定义容器镜像的密码" class="headerlink" title="7.6 自定义容器镜像的密码"></a>7.6 自定义容器镜像的密码</h3><p># 修改脚本，添加密码相关的脚本行，见右图 vim init.sh # 启动容器，并附带环境变量 docker run -d -p 1025:22 -p 80:80 -e “SSH_PWD&#x3D;123456” centos6.9_ssh_nginx:v2 &#x2F;bin&#x2F;bash &#x2F;init.sh</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="7-7-作业"><a href="#7-7-作业" class="headerlink" title="7.7 作业"></a>7.7 作业</h3><p>制作基于centos6的lnmp架构的镜像，discuz论坛</p>
<p>怎么夯住？</p>
<p>启动所有需要的服务</p>
<p>最后tail -F (大F无论文件有没有) </p>
<h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="八、Dockfile的使用"><a href="#八、Dockfile的使用" class="headerlink" title="八、Dockfile的使用"></a>八、Dockfile的使用</h1><p>发布镜像太大了，而dockerfile只有几kb，使用dockfile文件可以构建出相同的镜像，</p>
<h2 id="8-1-使用dockfile自动构建镜像"><a href="#8-1-使用dockfile自动构建镜像" class="headerlink" title="8.1 使用dockfile自动构建镜像"></a>8.1 使用dockfile自动构建镜像</h2><p>自动构建镜像的步骤：</p>
<p>1、手动构建一遍</p>
<p>2、参考历史命令，编写dockerfile</p>
<p>3、构建镜像</p>
<p>dockerfile build -t centos6.9_ssh .</p>
<p>4、测试</p>
<h2 id="8-2-Dockerfile常用命令详解"><a href="#8-2-Dockerfile常用命令详解" class="headerlink" title="8.2 Dockerfile常用命令详解"></a>8.2 Dockerfile常用命令详解</h2>]]></content>
      <categories>
        <category>运维</category>
        <category>（三）Docker</category>
      </categories>
  </entry>
  <entry>
    <title>K8S系列(一)-安装K8S</title>
    <url>/2021/07/08/01_%E8%BF%90%E7%BB%B4/05-K8S/K8S%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85K8S/</url>
    <content><![CDATA[<p>课程目录：</p>
<blockquote>
<p>第一部分：K8S概念和架构</p>
<p>第二部分：K8S安装</p>
<p>​	kubeadm</p>
<p>​	二进制</p>
<p>第三部分：K8S核心概念</p>
<p>POD </p>
<p>CONTROLLER</p>
<p>SERVICE</p>
<p>INGRESS</p>
<p>RABC</p>
<p>HELM</p>
<p>持久化存储</p>
<p>第四部分：集群监控平台</p>
<p>第五部分：从零开始搭建高可用K8S集群</p>
<p>第六部分：在集群环境中部署项目</p>
</blockquote>
<h2 id="一、K8S概念和架构"><a href="#一、K8S概念和架构" class="headerlink" title="一、K8S概念和架构"></a>一、K8S概念和架构</h2><h3 id="1-K8S概述和特性"><a href="#1-K8S概述和特性" class="headerlink" title="1 K8S概述和特性"></a>1 K8S概述和特性</h3><h4 id="1-1-基本介绍"><a href="#1-1-基本介绍" class="headerlink" title="1.1 基本介绍"></a>1.1 基本介绍</h4><ul>
<li>K8S是谷歌在2014年开发的容器化集群管理系统</li>
<li>使用K8S可以进行容器化应用部署</li>
<li>使用K8S利于应用扩展</li>
<li>K8S目标是让部署容器化应用更加简洁和高效</li>
</ul>
<p>容器化部署的好处：</p>
<h4 id="1-2-K8S的特性和优势"><a href="#1-2-K8S的特性和优势" class="headerlink" title="1.2 K8S的特性和优势"></a>1.2 K8S的特性和优势</h4><p>自动装箱：自动部署应用容器</p>
<p>自我修复（自愈能力）： </p>
<p>水平扩展：副本数量增加</p>
<p>服务发现（负载均衡）：通过Service实现，为多个副本对外提供统一的入口，节点调度负载均衡</p>
<p>滚动更新：</p>
<p>版本回退：</p>
<p>密钥配置管理：不需要重新构建镜像，可以部署和更新密钥和应用配置</p>
<p>存储编排：</p>
<p>批处理：	</p>
<h3 id="2-K8S架构组件"><a href="#2-K8S架构组件" class="headerlink" title="2 K8S架构组件"></a>2 K8S架构组件</h3><h3 id="3-K8S核心概念"><a href="#3-K8S核心概念" class="headerlink" title="3 K8S核心概念"></a>3 K8S核心概念</h3><p>3.1 Pod</p>
<p>3.2 Controller</p>
<p>3.3 Service</p>
<h2 id="二、K8S安装"><a href="#二、K8S安装" class="headerlink" title="二、K8S安装"></a>二、K8S安装</h2><blockquote>
<p>master  192.168.44.146</p>
<p>node1	192.168.44.145</p>
<p>node2	192.168.44.144</p>
</blockquote>
<h3 id="1-kubeadm安装"><a href="#1-kubeadm安装" class="headerlink" title="1 kubeadm安装"></a>1 kubeadm安装</h3><h3 id="2-二进制安装"><a href="#2-二进制安装" class="headerlink" title="2 二进制安装"></a>2 二进制安装</h3><hr>
<p>生产环境通用需求：</p>
<p>​	服务的自动发现和负载均衡</p>
<p>​	自愈</p>
<p>​	一键升级和回滚</p>
<p>​	水平扩展（弹性伸缩） </p>
<h3 id="1-容器管理平台"><a href="#1-容器管理平台" class="headerlink" title="1 容器管理平台"></a>1 容器管理平台</h3><p>docker swarm</p>
<p>messos</p>
<p>marathon</p>
<p>kubernetes  (90%市场)</p>
<h2 id="2-K8S发展"><a href="#2-K8S发展" class="headerlink" title="2 K8S发展"></a>2 K8S发展</h2><p>发布频繁，一年4个版本	</p>
<h3 id="3-核心组件"><a href="#3-核心组件" class="headerlink" title="3 核心组件"></a>3 核心组件</h3><h2 id="二、K8S安装-1"><a href="#二、K8S安装-1" class="headerlink" title="二、K8S安装"></a>二、K8S安装</h2><blockquote>
<p>K8S安装方式很多：</p>
<ul>
<li>源码编译安装 ：golang编译环境</li>
<li>二进制安装 ：文档，全程手动，ansible等</li>
<li>kubeadm安装：网络要求</li>
<li>minikube ：开发者学习</li>
<li>yum安装</li>
</ul>
<p>这里使用yum安装的方法</p>
</blockquote>
<h3 id="1-虚拟机准备"><a href="#1-虚拟机准备" class="headerlink" title="1 虚拟机准备"></a>1 虚拟机准备</h3><blockquote>
<p>centos7, 1CPU 1G</p>
<p>设置主机名，<strong>添加hosts解析</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">k8s-master  --  10.0.0.21</span><br><span class="line">k8s-node1   --  10.0.0.22</span><br><span class="line">k8s-node2   --  10.0.0.23</span><br></pre></td></tr></table></figure>

<p>配置Centos7源和epel7源</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h3 id="2-Master节点安装"><a href="#2-Master节点安装" class="headerlink" title="2 Master节点安装"></a>2 Master节点安装</h3><h4 id="2-1-安装docker"><a href="#2-1-安装docker" class="headerlink" title="2.1 安装docker"></a>2.1 安装docker</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker -y</span><br></pre></td></tr></table></figure>

<h4 id="2-2-安装etcd"><a href="#2-2-安装etcd" class="headerlink" title="2.2 安装etcd"></a>2.2 安装etcd</h4><blockquote>
<p>etcd是一个nosql数据库</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install etcd -y</span><br></pre></td></tr></table></figure>

<p>修改etcd配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/etcd/etcd.conf</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:2379&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://10.0.0.21:2379&quot;</span><br></pre></td></tr></table></figure>

<p>启动etcd服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable etcd</span><br><span class="line">systemctl restart etcd</span><br></pre></td></tr></table></figure>

<p>测试etcd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcdctl set testdir/testkey0 0</span><br><span class="line">etcdctl get testdir/testkey0</span><br></pre></td></tr></table></figure>

<p>etcdctl相关设置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcdctl -C http://10.0.0.21:2379 cluster-health</span><br></pre></td></tr></table></figure>

<h4 id="2-3-安装k8s服务"><a href="#2-3-安装k8s服务" class="headerlink" title="2.3 安装k8s服务"></a>2.3 安装k8s服务</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install kubernetes-master -y</span><br></pre></td></tr></table></figure>

<p>配置文件修改</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/kubernetes/apiserver</span><br><span class="line">KUBE_API_ADDRESS=&quot;--insecure-bind-address=0.0.0.0&quot;</span><br><span class="line">KUBE_API_PORT=&quot;--port=8080&quot;</span><br><span class="line">KUBE_ETCD_SERVERS=&quot;--etcd-servers=http://10.0.0.21:2379&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 23行删除ServiceAccount，如下</span></span><br><span class="line">KUBE_ADMISSION_CONTROL=&quot;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota&quot; # </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/kubernetes/config</span><br><span class="line">KUBE_MASTER=&quot;--master=http://10.0.0.21:8080&quot;</span><br></pre></td></tr></table></figure>

<p>开放防火墙端口【重要】</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=2379/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable kube-apiserver</span><br><span class="line">systemctl restart kube-apiserver</span><br><span class="line">systemctl enable kube-controller-manager</span><br><span class="line">systemctl restart kube-controller-manager</span><br><span class="line">systemctl enable kube-scheduler</span><br><span class="line">systemctl restart kube-scheduler</span><br></pre></td></tr></table></figure>

<h3 id="3-Node节点安装"><a href="#3-Node节点安装" class="headerlink" title="3 Node节点安装"></a>3 Node节点安装</h3><h4 id="3-1-安装k8s-node服务"><a href="#3-1-安装k8s-node服务" class="headerlink" title="3.1 安装k8s-node服务"></a>3.1 安装k8s-node服务</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install kubernetes-node</span><br></pre></td></tr></table></figure>

<p>编辑配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/kubernetes/config</span><br><span class="line">KUBE_MASTER=&quot;--master=http://10.0.0.21:8080&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/kubernetes/kubelet</span><br><span class="line">KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;</span><br><span class="line">KUBELET_PORT=&quot;--port=10250&quot;</span><br><span class="line">KUBELET_HOSTNAME=&quot;--hostname-override=10.0.0.22&quot;</span><br><span class="line">KUBELET_API_SERVER=&quot;--api-servers=http://10.0.0.21:8080&quot;</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable kubelet</span><br><span class="line">systemctl restart kubelet</span><br><span class="line">systemctl enable kube-proxy</span><br><span class="line">systemctl restart kube-proxy</span><br></pre></td></tr></table></figure>

<h4 id="3-2-fannel网络服务安装"><a href="#3-2-fannel网络服务安装" class="headerlink" title="3.2 fannel网络服务安装"></a>3.2 fannel网络服务安装</h4><blockquote>
<p>用于节点之间通信</p>
</blockquote>
<p>所有节点安装并配置fannel</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install flannel -y</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/sysconfig/flanneld</span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=&quot;http://10.0.0.21:2379&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcdctl mk /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;172.16.0.0/16&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>重新启动服务—Master节点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable fanneld</span><br><span class="line">systemctl restart fanneld</span><br><span class="line">systemctl restart kube-apiserver</span><br><span class="line">systemctl restart kube-controller-manager</span><br><span class="line">systemctl restart kube-scheduler	</span><br></pre></td></tr></table></figure>

<p>重新启动服务—Node节点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable fanneld</span><br><span class="line">systemctl restart fanneld</span><br><span class="line">systemctl restart kubelet</span><br><span class="line">systemctl restart kube-proxy</span><br></pre></td></tr></table></figure>

<h3 id="4-配置Master为镜像服务器"><a href="#4-配置Master为镜像服务器" class="headerlink" title="4 配置Master为镜像服务器"></a>4 配置Master为镜像服务器</h3><h2 id="三、K8S使用"><a href="#三、K8S使用" class="headerlink" title="三、K8S使用"></a>三、K8S使用</h2><p>1 查看节点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p>2 查看服务状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get componentstatus</span><br></pre></td></tr></table></figure>

<h3 id="1-Pod使用"><a href="#1-Pod使用" class="headerlink" title="1 Pod使用"></a>1 Pod使用</h3><p>创建pod</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create -f k8s_pod.yml</span><br></pre></td></tr></table></figure>

<p>删除pod</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl delete pod oldboy</span><br><span class="line">kubectl delete pod --all 删除所有</span><br></pre></td></tr></table></figure>

<p>查看pod</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods</span><br><span class="line">kubectl get pods -o wides</span><br></pre></td></tr></table></figure>

<p>查看pod详细信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl descripe pod nginx</span><br></pre></td></tr></table></figure>

<p> 更新</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl replace xxxx.yml</span><br></pre></td></tr></table></figure>



<h4 id="1-1-创建一个pod-为什么要启动两个容器？"><a href="#1-1-创建一个pod-为什么要启动两个容器？" class="headerlink" title="1.1 创建一个pod,为什么要启动两个容器？"></a>1.1 创建一个pod,为什么要启动两个容器？</h4><blockquote>
<p>一个pod中可以挂多个容器</p>
</blockquote>
<p>比如创建一个niginx pod，将启动一个pod容器，一个nginx容器</p>
<p>Pod容器172.16.18.2</p>
<p>Nginx容器，共用pod容器ip</p>
<p>主要通过用POD来实现K8S的高级功能</p>
<h4 id="1-2-rc副本控制器的使用"><a href="#1-2-rc副本控制器的使用" class="headerlink" title="1.2 rc副本控制器的使用"></a>1.2 rc副本控制器的使用</h4><p>通过rc保证容器高可用</p>
<p>调整rc副本数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl scale rc myweb --replicates=1</span><br></pre></td></tr></table></figure>

<h4 id="1-3-利用rc实现滚动升级和一键回滚"><a href="#1-3-利用rc实现滚动升级和一键回滚" class="headerlink" title="1.3 利用rc实现滚动升级和一键回滚"></a>1.3 利用rc实现滚动升级和一键回滚</h4><p>案例：nginx 1.13升级1.15</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 每5s升级一个</span></span><br><span class="line">kubectl rolling-update myweb -f nginx-rc1.15.yaml --update-period=5s</span><br></pre></td></tr></table></figure>

<p>案例：nginx1.15回滚到1.13</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl rolling-update mywebv2 -f nginx-rc1.13.yaml</span><br></pre></td></tr></table></figure>



<h3 id="service的创建和访问"><a href="#service的创建和访问" class="headerlink" title="service的创建和访问"></a>service的创建和访问</h3><blockquote>
<p>外部访问容器，端口映射</p>
</blockquote>
<h4 id="K8S小结"><a href="#K8S小结" class="headerlink" title="K8S小结"></a>K8S小结</h4><p>1 端口30000开始？</p>
<p>2 查看yml字段编写帮助</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl explain svc.spec</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（五）K8S</category>
      </categories>
  </entry>
  <entry>
    <title>OpenStack学习笔记</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/04-%E8%99%9A%E6%8B%9F%E5%8C%96/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="OpenStack笔记"><a href="#OpenStack笔记" class="headerlink" title="OpenStack笔记"></a><strong><font color=green>OpenStack笔记</font></strong></h1><p>​	OpenStack实现的是云计算IAAS</p>
<h2 id="一、服务架构发展"><a href="#一、服务架构发展" class="headerlink" title="一、服务架构发展"></a><font color=blue>一、服务架构发展</font></h2><h3 id="1-1-MVC架构"><a href="#1-1-MVC架构" class="headerlink" title="1.1 MVC架构"></a>1.1 MVC架构</h3><p>​	业务不拆分，一个服务挂，则所有的全挂</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">首页 www.jd.com/index.html</span><br><span class="line">秒杀 www.jd.com/miaosha/index.html</span><br><span class="line">优惠券 www.jd.com/juan/index.html</span><br></pre></td></tr></table></figure>

<h3 id="1-2-SOA架构（千万级）"><a href="#1-2-SOA架构（千万级）" class="headerlink" title="1.2 SOA架构（千万级）"></a>1.2 SOA架构（千万级）</h3><p>​	业务拆分，每一个功能都拆分成一个独立的web服务，每个独立的web服务，都至少拥有一个集群</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">首页 www.jd.com/index.html</span><br><span class="line">秒杀 miaosha.jd.com/index.html</span><br><span class="line">优惠券 juan.jd.com/index.html</span><br></pre></td></tr></table></figure>

<h3 id="1-3-微服务架构（亿级）"><a href="#1-3-微服务架构（亿级）" class="headerlink" title="1.3 微服务架构（亿级）"></a>1.3 微服务架构（亿级）</h3><p>阿里开源dubbo</p>
<p>Spring Boot</p>
<p>自动化代码上线：Jekins + gilab ci</p>
<p>自动化代码质量检查：sonarqube</p>
<h2 id="二、搭建OpenStack"><a href="#二、搭建OpenStack" class="headerlink" title="二、搭建OpenStack"></a><font color=blue>二、搭建OpenStack</font></h2><p>​	本流程为手动安装M版，脚本安装可以参考</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://my.oschina.net/u/4367225/blog/4255750</span><br></pre></td></tr></table></figure>

<p>OpenStack的结构介绍：</p>
<blockquote>
<p>Nova – 提供VM虚拟化支持 8774</p>
<p>Glance – 提供镜像 9292</p>
<p>Clinder – 存储支持 8776</p>
<p>Neutron – 网络支持 9696</p>
<p>Cellometer –  监控计费 </p>
<p>KeyStone – 登录认证</p>
<p>Horizon – 网页UI，dashboard</p>
<p>Heat – 部署编排，批量建虚拟机</p>
<p>Switft – 对象存储（不是传统的文件夹存放，而是用数据库记录已上传的文件信息，当有文件上传，先查询数据库中是否有该文件的md5值，如果有，则不用重新上传，给个链接就是 — 百度云盘）</p>
</blockquote>
<p><img src="C:\Users\fr724\AppData\Roaming\Typora\typora-user-images\image-20210615135957367.png" alt="image-20210615135957367"></p>
<h3 id="2-1-虚拟机准备"><a href="#2-1-虚拟机准备" class="headerlink" title="2.1 虚拟机准备"></a>2.1 虚拟机准备</h3><p>虚拟机规划</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 系统：CentOS7.4</span></span><br><span class="line">controller: 内存3G, CPU开启虚拟化	10.0.0.11</span><br><span class="line">compute1: 内存1G，CPU开启虚拟化	    10.0.0.31</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改主机名，IP地址，host解析，测试ping百度</span></span><br></pre></td></tr></table></figure>

<p>配置本地M版yum源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、资源准备</span></span><br><span class="line">mount /dev/cdrom /mnt # 追加到/etc/rc.local,自动挂载</span><br><span class="line">解压openstack_rpm.tar.gz到/opt/repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、编辑repo文件</span></span><br><span class="line">vim /etc/yum.repo.d/local/repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### 内容</span></span></span><br><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[openstack]</span><br><span class="line">name=openstack</span><br><span class="line">baseurl=file:///opt/repo</span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、更新yum源</span></span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>



<h3 id="2-2-基础服务安装"><a href="#2-2-基础服务安装" class="headerlink" title="2.2 基础服务安装"></a>2.2 基础服务安装</h3><h4 id="2-2-1-NTP时间同步"><a href="#2-2-1-NTP时间同步" class="headerlink" title="2.2.1 NTP时间同步"></a>2.2.1 NTP时间同步</h4><p>controller与阿里NTP服务器同步</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/chrony.conf</span><br><span class="line">server ntp6.aliyun.com # 3行</span><br><span class="line">allow 10.0.0.0/24 # 24行</span><br><span class="line">systemctl restart chronyd</span><br></pre></td></tr></table></figure>

<p>computer与controller同步</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/chrony.conf</span><br><span class="line">server 10.0.0.11 iburst # 3行</span><br><span class="line">systemctl restart chronyd</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）"><a href="#2-2-2-扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）" class="headerlink" title="2.2.2 扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）"></a>2.2.2 扩展-公网安装O版OpenStack的方法介绍（跳过该步骤）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">yum makecache</span><br><span class="line">yum list | grep openstack</span><br><span class="line">yum install centos-release-openstack-ocata.noarch -y # 安装O版</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-安装OpenStack客户端openstack-selinux-（所有节点执行）"><a href="#2-2-3-安装OpenStack客户端openstack-selinux-（所有节点执行）" class="headerlink" title="2.2.3 安装OpenStack客户端openstack-selinux （所有节点执行）"></a>2.2.3 安装OpenStack客户端openstack-selinux （所有节点执行）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install python-openstackclient openstack-selinux -y</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-安装和配置mariadb-仅控制节点执行"><a href="#2-2-4-安装和配置mariadb-仅控制节点执行" class="headerlink" title="2.2.4 安装和配置mariadb (仅控制节点执行)"></a>2.2.4 安装和配置mariadb (仅控制节点执行)</h4><p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install mariadb mariadb-server python2-PyMySQL -y</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/my.cnf.d/openstack.cnf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">----------------</span></span><br><span class="line">[mysqld]	</span><br><span class="line">bind-address = 10.0.0.11	# 监听地址</span><br><span class="line">default-storage-engine = innodb # 默认存储引擎</span><br><span class="line">innodb_file_per_table  # 独立表空间文件</span><br><span class="line">max_connections = 4096	# 最大连接数</span><br><span class="line">collation-server = utf8_general_ci	# 默认字符集utf8</span><br><span class="line">character-set-server = utf8</span><br><span class="line"><span class="meta">#</span><span class="bash">-----------------</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库安全初始化,保障数据库安全性，如果不执行，同步数据库表会报错</span></span><br><span class="line">mysql_secure_installation</span><br><span class="line">回车 n y y y y</span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-消息队列配置-仅控制节点执行"><a href="#2-2-5-消息队列配置-仅控制节点执行" class="headerlink" title="2.2.5 消息队列配置(仅控制节点执行)"></a>2.2.5 消息队列配置(仅控制节点执行)</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装rabbitmq</span></span><br><span class="line">yum install rabbitmq-server -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl start rabbitmq-server</span><br><span class="line">systemctl enable rabbitmq-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加用户</span></span><br><span class="line">rabbitmqctl add_user openstack RABBIT_PASS</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置用户权限（读、写、执行）</span></span><br><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否开启15672端口</span></span><br><span class="line">netstat -lntup</span><br><span class="line"><span class="meta">#</span><span class="bash"> 浏览器登录rabbitmq</span></span><br><span class="line">http://10.0.0.11:15672</span><br><span class="line">默认用户名和密码：guest</span><br></pre></td></tr></table></figure>

<h4 id="2-2-6-缓存系统配置memcache（仅控制节点执行）"><a href="#2-2-6-缓存系统配置memcache（仅控制节点执行）" class="headerlink" title="2.2.6 缓存系统配置memcache（仅控制节点执行）"></a>2.2.6 缓存系统配置memcache（仅控制节点执行）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">yum install memcached python-memched -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置</span></span><br><span class="line">sed -i &#x27;s#127.0.0.1#10.0.0.11#g&#x27; /etc/sysconfig/memcached</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl restart memcached</span><br><span class="line">systemctl enable memcached</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询端口11211是否已监听，默认使用该端口</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-安装keystone认证服务-仅控制节点执行"><a href="#2-3-安装keystone认证服务-仅控制节点执行" class="headerlink" title="2.3 安装keystone认证服务(仅控制节点执行)"></a>2.3 安装keystone认证服务(仅控制节点执行)</h3><h4 id="2-3-1-Keystone功能介绍"><a href="#2-3-1-Keystone功能介绍" class="headerlink" title="2.3.1 Keystone功能介绍"></a>2.3.1 Keystone功能介绍</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、认证管理：</span><br><span class="line">	账户密码</span><br><span class="line">2、授权管理</span><br><span class="line">3、服务目录：</span><br><span class="line">	跟电话本一样，keystone上可以查询到glance、nova等服务的地址端口等信息，每一个新加的服务都需要在keystone上注册</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-OpenStack服务器安装的通用步骤"><a href="#2-3-2-OpenStack服务器安装的通用步骤" class="headerlink" title="2.3.2 OpenStack服务器安装的通用步骤"></a>2.3.2 OpenStack服务器安装的通用步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、创库授权</span><br><span class="line">2、在Keystone创建用户，关联角色</span><br><span class="line">3、在keystone创建服务，注册api</span><br><span class="line">4、安装服务相关的软件包</span><br><span class="line">5、修改配置</span><br><span class="line">	数据库的连接</span><br><span class="line">	keystone认证授权信息</span><br><span class="line">	rabbitmq连接信息</span><br><span class="line">	其他配置</span><br><span class="line">6、同步数据库，创建表</span><br><span class="line">7、启动服务</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-安装步骤"><a href="#2-3-3-安装步骤" class="headerlink" title="2.3.3 安装步骤"></a>2.3.3 安装步骤</h4><p>1、创库授权</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 登录mysql</span><br><span class="line">$ mysql -u root -p</span><br><span class="line"># 创建keystone数据库</span><br><span class="line">CREATE DATABASE keystone;</span><br><span class="line"># 对``keystone``数据库授予恰当的权限</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;KEYSTONE_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;KEYSTONE_DBPASS&#x27;;</span><br></pre></td></tr></table></figure>

<p>2、安装keystone相关软件包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install openstack-keystone httpd mod_wsgi -y</span><br></pre></td></tr></table></figure>

<p>3、修改配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 备份原配置文件</span></span><br><span class="line">\cp /etc/keystone/keystone.conf&#123;,.bak&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 去除配置文件中的空格行和注释行</span></span><br><span class="line">grep -Ev &#x27;^$|#&#x27; /etc/keystone/keystone.conf.bak &gt; /etc/keystone/keystone.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装自动配置工具</span></span><br><span class="line">yum install openstack-utils -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用工具设置（也可以直接修改文件）修改项 参数 = 值</span></span><br><span class="line">openstack-config --set /etc/keystone/keystone.conf DEFAULT admin_token ADMIN_TOKEN</span><br><span class="line">openstack-config --set /etc/keystone/keystone.conf database connection  mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone # 注意hostname--controller</span><br><span class="line">openstack-config --set /etc/keystone/keystone.conf token provider fernet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验</span></span><br><span class="line">md5sum /etc/keystone/keystone.conf</span><br><span class="line">d5acb3db852fe3f247f4f872b051b7a9 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同步数据库</span></span><br><span class="line">su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询是否生成表</span></span><br><span class="line">mysql keystone -e &quot;show tables;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化fernet</span></span><br><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line">/etc/keystone/fernet-keys已创建</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置httpd</span></span><br><span class="line">echo &quot;ServerName controller&quot; &gt;&gt; /etc/httpd/conf/httpd.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建wsgi配置文件</span></span><br><span class="line">vim /etc/httpd/conf.d/wsgi-keystone.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##内容</span></span></span><br><span class="line">Listen 5000</span><br><span class="line">Listen 35357</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:5000&gt;</span><br><span class="line">    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">    WSGIProcessGroup keystone-public</span><br><span class="line">    WSGIScriptAlias / /usr/bin/keystone-wsgi-public</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">    ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;</span><br><span class="line">    ErrorLog /var/log/httpd/keystone-error.log</span><br><span class="line">    CustomLog /var/log/httpd/keystone-access.log combined</span><br><span class="line"></span><br><span class="line">    &lt;Directory /usr/bin&gt;</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:35357&gt;</span><br><span class="line">    WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">    WSGIProcessGroup keystone-admin</span><br><span class="line">    WSGIScriptAlias / /usr/bin/keystone-wsgi-admin</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">    ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;</span><br><span class="line">    ErrorLog /var/log/httpd/keystone-error.log</span><br><span class="line">    CustomLog /var/log/httpd/keystone-access.log combined</span><br><span class="line"></span><br><span class="line">    &lt;Directory /usr/bin&gt;</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验</span></span><br><span class="line">md5sum /etc/httpd/conf.d/wsgi-keystone.conf</span><br><span class="line">8f051eb53577f67356ed03e4550315c2 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动httpd</span></span><br><span class="line">systemctl enable httpd</span><br><span class="line">systemctl start httpd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建服务和注册api</span></span><br><span class="line">export OS_TOKEN=ADMIN_TOKEN</span><br><span class="line">export OS_URL=http://controller:35357/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">openstack service create --name keystone --description &quot;OpenStack Identity&quot; identity</span><br><span class="line">openstack endpoint create --region RegionOne identity public http://controller:5000/v3</span><br><span class="line">openstack endpoint create --region RegionOne identity internal http://controller:5000/v3</span><br><span class="line">openstack endpoint create --region RegionOne identity admin http://controller:35357/v3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建域、项目（租户）、用户和角色</span></span><br><span class="line">openstack domain create --description &quot;Default Domain&quot; default</span><br><span class="line">openstack project create --domain default --description &quot;Admin Project&quot; admin</span><br><span class="line">openstack user create --domain default --password ADMIN_PASS admin</span><br><span class="line">openstack role create admin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关联项目，用户，角色</span></span><br><span class="line">openstack role add --project admin --user admin admin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在admin项目上，给admin用户赋予admin角色</span></span><br><span class="line">openstack project create --domain default --description &quot;Service Project&quot; service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建环境变量脚本</span></span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=default</span><br><span class="line">export OS_USER_DOMAIN_NAME=default</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=ADMIN_PASS</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_AUTH_URL=http://controller:35357/v3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 作为admin用户请求认证令牌</span></span><br><span class="line">openstack token issue  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果不设置环境变量可以通过传入参数的方式申请</span></span><br><span class="line">openstack --os-auth-url http://controller:35357/v3   --os-project-domain-name default --os-user-domain-name default   --os-project-name admin --os-username admin --os-password ADMIN_PASS token issue</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看用户列表</span></span><br><span class="line">openstack user list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看endpoint列表</span></span><br><span class="line">openstack endpoint list</span><br></pre></td></tr></table></figure>

<h3 id="2-4-安装glance镜像服务"><a href="#2-4-安装glance镜像服务" class="headerlink" title="2.4 安装glance镜像服务"></a>2.4 安装glance镜像服务</h3><p>​	镜像服务 (glance) 允许用户发现、注册和获取虚拟机镜像。</p>
<h4 id="2-4-1-安装步骤"><a href="#2-4-1-安装步骤" class="headerlink" title="2.4.1 安装步骤"></a>2.4.1 安装步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 数据库创库授权</span></span><br><span class="line">mysql &gt;&gt;</span><br><span class="line">CREATE DATABASE glance</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;GLANCE_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;GLANCE_DBPASS&#x27;;</span><br><span class="line">  </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 在keystone创建glance用户关联角色</span></span><br><span class="line"> openstack user create --domain default --password GLANCE_PASS glance</span><br><span class="line"> openstack role add --project service --user glance admin</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 在keystone上创建服务和注册api</span></span><br><span class="line">openstack service create --name glance   --description &quot;OpenStack Image&quot; image</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http://controller:9292</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http://controller:9292</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看已创建的信息</span></span><br><span class="line">openstack role assignment list</span><br><span class="line">openstack role list</span><br><span class="line">openstack project list</span><br><span class="line">openstack user list （要有glance用户）</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql中验证表是否已创建</span></span><br><span class="line">[root@controller ~]# mysql keystone -e &quot;show tables;&quot; | grep user</span><br><span class="line">federated_user</span><br><span class="line">local_user</span><br><span class="line">user</span><br><span class="line">user_group_membership</span><br><span class="line">[root@controller ~]# mysql keystone -e &quot;show tables;&quot; | grep project</span><br><span class="line">project</span><br><span class="line">project_endpoint</span><br><span class="line">project_endpoint_group</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装服务相应软件包</span></span><br><span class="line">yum install openstack-glance -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改相应的配置文件--api</span></span><br><span class="line">cp /etc/glance/glance-api.conf&#123;,.bak&#125;</span><br><span class="line">grep &#x27;^[a-Z\[]&#x27; /etc/glance/glance-api.conf.bak &gt; /etc/glance/glance-api.conf</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf database connection mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken username glance</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf keystone_authtoken password GLANCE_PASS</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf paste_deploy flavor keystone</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf glance_store stores file,http</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf glance_store default_store file</span><br><span class="line">openstack-config --set /etc/glance/glance-api.conf glance_store filesystem_store_datadir /var/lib/glance/images/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改相应的配置文件--registry</span></span><br><span class="line">cp /etc/glance/glance-registry.conf&#123;,.bak&#125;</span><br><span class="line">grep &#x27;^[a-Z\[]&#x27; /etc/glance/glance-registry.conf.bak &gt; /etc/glance/glance-registry.conf</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf database connection mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken username glance</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken password GLANCE_PASS</span><br><span class="line">openstack-config --set /etc/glance/glance-registry.conf paste_deploy flavor keystone</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> md5值验证</span></span><br><span class="line">md5sum /etc/glance/glance-api.conf</span><br><span class="line">3e1a4234c133eda11b413788e001cba3  /etc/glance/glance-api.conf</span><br><span class="line">md5sum /etc/glance/glance-registry.conf</span><br><span class="line">46acabd81a65b924256f56fe34d90b8f  /etc/glance/glance-registry.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 写入镜像服务数据库</span></span><br><span class="line">su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance # 会有Warning不用在意</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line">mysql glance -e &quot;show tables;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl enable openstack-glance-api.service   openstack-glance-registry.service</span><br><span class="line">systemctl start openstack-glance-api.service   openstack-glance-registry.service</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-上传镜像测试"><a href="#2-4-2-上传镜像测试" class="headerlink" title="2.4.2 上传镜像测试"></a>2.4.2 上传镜像测试</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 错误日志查看</span></span><br><span class="line">/var/log/glance</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 确保已获取token令牌</span></span><br><span class="line">openstack token issue</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载测试镜像</span></span><br><span class="line">wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 上传测试镜像</span></span><br><span class="line">openstack image create &quot;cirros&quot; \</span><br><span class="line">--file cirros-0.3.4-x86_64-disk.img \</span><br><span class="line">--disk-format qcow2 --container-format bare \</span><br><span class="line">--public</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 上传文件确认</span></span><br><span class="line">ls /var/lib/glance/images/ (在/etc/glance/glance-api.conf中设置)</span><br><span class="line">mysql glance -e &quot;show tables;&quot; | grep image</span><br></pre></td></tr></table></figure>

<h3 id="2-5-安装nova计算服务"><a href="#2-5-安装nova计算服务" class="headerlink" title="2.5 安装nova计算服务"></a>2.5 安装nova计算服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nova-api -- 接受并相应所有的计算服务请求，管理云主机生命周期</span><br><span class="line">nova-compute（多个）-- 真正管理虚拟机(nova-compute调用libvirt)</span><br><span class="line">nova-scheduler -- nova 调度器（挑选最合适的nova-compute）</span><br><span class="line">nova-conductor -- 帮助nova-compute连接数据库</span><br><span class="line">nova-network --  早期版本管理虚拟机的网络（已弃用，改用neutron，留着为了方便兼容早期版本）</span><br><span class="line">nova-consoleauth和nova-novncproxy -- web版的vnc来直接操作云主机</span><br><span class="line">novnproxy -- web版vnc客户端</span><br><span class="line">nova-api-metadata -- 接受来自虚拟机发送的元数据请求（配合neutron-metadata-agent实现虚拟机定制化）</span><br></pre></td></tr></table></figure>

<h4 id="2-5-1-控制节点–安装步骤"><a href="#2-5-1-控制节点–安装步骤" class="headerlink" title="2.5.1 控制节点–安装步骤"></a>2.5.1 控制节点–安装步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创库授权</span></span><br><span class="line">mysql &gt;&gt;</span><br><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NOVA_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NOVA_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NOVA_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NOVA_DBPASS&#x27;;</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在keystone创建用户nova</span></span><br><span class="line">openstack user create --domain default   --password NOVA_PASS nova</span><br><span class="line"><span class="meta">#</span><span class="bash"> 给Nova用户添加admin角色</span></span><br><span class="line">openstack role add --project service --user nova admin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在keystone上创建服务和注册api</span></span><br><span class="line">openstack service create --name nova   --description &quot;OpenStack Compute&quot; compute</span><br><span class="line">openstack endpoint create --region RegionOne   compute public http://controller:8774/v2.1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne   compute internal http://controller:8774/v2.1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne   compute admin http://controller:8774/v2.1/%\(tenant_id\)s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装相应软件包</span></span><br><span class="line">yum install -y openstack-nova-api openstack-nova-conductor \</span><br><span class="line">  openstack-nova-console openstack-nova-novncproxy \</span><br><span class="line">  openstack-nova-scheduler</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line">cp /etc/nova/nova.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &#x27;^$|#&#x27; /etc/nova/nova.conf.bak &gt; /etc/nova/nova.conf</span><br><span class="line"></span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend rabbit</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 10.0.0.11</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron True</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">openstack-config --set /etc/nova/nova.conf api_database connection mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api</span><br><span class="line">openstack-config --set /etc/nova/nova.conf database connection mysql+pymysql://nova:NOVA_DBPASS@controller/nova</span><br><span class="line">openstack-config --set /etc/nova/nova.conf glance api_servers http://controller:9292</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken password NOVA_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_host controller</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_userid openstack</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc vncserver_listen &#x27;$my_ip&#x27;</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc vncserver_proxyclient_address &#x27;$my_ip&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验</span></span><br><span class="line">md5sum /etc/nova/nova.conf</span><br><span class="line">47ded61fdd1a79ab91bdb37ce59ef192  /etc/nova/nova.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同步数据库</span></span><br><span class="line">su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage db sync&quot; nova</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line">mysql nova_api -e &quot;show tables;&quot;</span><br><span class="line">mysql nova -e &quot;show tables;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl enable openstack-nova-api.service \</span><br><span class="line">openstack-nova-consoleauth.service openstack-nova-scheduler.service \</span><br><span class="line">openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br><span class="line">systemctl restart openstack-nova-api.service \</span><br><span class="line">openstack-nova-consoleauth.service openstack-nova-scheduler.service \</span><br><span class="line">openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证</span></span><br><span class="line">[root@controller ~]# nova service-list</span><br><span class="line">+----+------------------+------------+----------+---------+-------+------------+-----------------+</span><br><span class="line">| Id | Binary           | Host       | Zone     | Status  | State | Updated_at | Disabled Reason |</span><br><span class="line">+----+------------------+------------+----------+---------+-------+------------+-----------------+</span><br><span class="line">| 1  | nova-conductor   | controller | internal | enabled | down  | -          | -               |</span><br><span class="line">| 4  | nova-scheduler   | controller | internal | enabled | down  | -          | -               |</span><br><span class="line">| 5  | nova-consoleauth | controller | internal | enabled | down  | -          | -               |</span><br><span class="line">+----+------------------+------------+----------+---------+-------+------------+-----------------+</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> novncproxy 怎么检测起来没有？</span></span><br><span class="line">[root@controller ~]# netstat -lntup | grep 6080</span><br><span class="line">tcp        0      0 0.0.0.0:6080            0.0.0.0:*               LISTEN      8719/python2</span><br><span class="line">[root@controller ~]# ps -ef | grep 8719</span><br><span class="line">nova       8719      1  0 21:53 ?        00:00:01 /usr/bin/python2 /usr/bin/nova-novncproxy --web /usr/share/novnc/</span><br></pre></td></tr></table></figure>

<h4 id="2-5-1-计算节点–安装步骤"><a href="#2-5-1-计算节点–安装步骤" class="headerlink" title="2.5.1 计算节点–安装步骤"></a>2.5.1 计算节点–安装步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装软件包</span></span><br><span class="line">yum install -y openstack-nova-compute openstack-utils</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line">cp /etc/nova/nova.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &#x27;^$|#&#x27; /etc/nova/nova.conf.bak &gt; /etc/nova/nova.conf</span><br><span class="line"></span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend rabbit</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 10.0.0.31 # 注意ip</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron True</span><br><span class="line">openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">openstack-config --set /etc/nova/nova.conf glance api_servers http://controller:9292</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">openstack-config --set /etc/nova/nova.conf keystone_authtoken password NOVA_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_host controller</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_userid openstack</span><br><span class="line">openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc enabled  True</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc vncserver_listen 0.0.0.0</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc vncserver_proxyclient_address &#x27;$my_ip&#x27;</span><br><span class="line">openstack-config --set /etc/nova/nova.conf vnc novncproxy_base_url http://controller:6080/vnc_auto.html</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验</span></span><br><span class="line">md5sum /etc/nova/nova.conf</span><br><span class="line">45cab6030a9ab82761e9f697d6d79e14  /etc/nova/nova.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">systemctl enable libvirtd.service openstack-nova-compute.service</span><br><span class="line">systemctl restart libvirtd.service openstack-nova-compute.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 服务启动错误排查</span></span><br><span class="line">参考博客：https://www.codeleading.com/article/89785382846/</span><br><span class="line">cat /etc/nova/nova.conf # compute1日志查看</span><br><span class="line">报错 nova AccessRefused: (0, 0): (403) ACCESS_REFUSED</span><br><span class="line">处理步骤：</span><br><span class="line">在controller</span><br><span class="line">cat /var/log/rabbitmq/rabbit@controller.log # 发现报错AMQPLAIN login refused: user &#x27;openstack&#x27; - invalid credentials 无效凭证</span><br><span class="line">rabbitmqctl list_users # 确认是否还有openstack用户</span><br><span class="line">rabbitmqctl add_user openstack RABBIT_PASS</span><br><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">systemctl restart rabbitmq-server.service # 重新创用户，并重启服务</span><br></pre></td></tr></table></figure>

<h3 id="2-6-安装neutron网络服务"><a href="#2-6-安装neutron网络服务" class="headerlink" title="2.6 安装neutron网络服务"></a>2.6 安装neutron网络服务</h3><p>neutron-server – 端口9696，api接受和响应外部的网络管理请求</p>
<p>neutron-linuxbridge-agent –  负责创建桥接网卡</p>
<p>neutron-dhcp-agent – 负责分配ip</p>
<p>neutron-metadata-agent –  配合nova-metadata-api实现虚拟机的定制化操作</p>
<p>L3-agent – 实现三层网络vxlan（网络层）</p>
<h4 id="2-6-1-控制节点–安装步骤"><a href="#2-6-1-控制节点–安装步骤" class="headerlink" title="2.6.1 控制节点–安装步骤"></a>2.6.1 控制节点–安装步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创库授权</span></span><br><span class="line">Mysql &gt;&gt;</span><br><span class="line">CREATE DATABASE neutron;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NEUTRON_DBPASS&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;NEUTRON_DBPASS&#x27;;</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在keystone创建用户neutron</span></span><br><span class="line">openstack user create --domain default   --password NEUTRON_PASS neutron</span><br><span class="line"><span class="meta">#</span><span class="bash"> 给neutron用户添加admin角色</span></span><br><span class="line">openstack role add --project service --user neutron admin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在keystone上创建服务和注册api</span></span><br><span class="line">openstack service create --name neutron   --description &quot;OpenStack Networking&quot; network</span><br><span class="line">openstack endpoint create --region RegionOne   network public http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne   network internal http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne   network admin http://controller:9696</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网络配置--公共网络</span></span><br><span class="line">cp /etc/neutron/neutron.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/neutron.conf.bak  &gt; /etc/neutron/neutron.conf</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf database connection mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT core_plugin ml2</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT service_plugins</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT rpc_backend rabbit</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes True</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes True</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_host controller</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_userid openstack</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password NEUTRON_PASS</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova auth_type password</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova project_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova user_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova region_name RegionOne</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova project_name service</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova username nova</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf nova password NOVA_PASS</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">cp /etc/neutron/plugins/ml2/ml2_conf.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/ml2_conf.ini.bak &gt; /etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers flat,vlan</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers linuxbridge</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers port_security</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks provider</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset True</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33  # 要修改网络接口名</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan False</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group True</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">cp /etc/neutron/dhcp_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/dhcp_agent.ini.bak &gt; /etc/neutron/dhcp_agent.ini</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/dhcp_agent.ini DEFAULT interface_driver neutron.agent.linux.interface.BridgeInterfaceDriver</span><br><span class="line">openstack-config --set /etc/neutron/dhcp_agent.ini DEFAULT  dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">openstack-config --set /etc/neutron/dhcp_agent.ini DEFAULT  enable_isolated_metadata True</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">cp /etc/neutron/metadata_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/metadata_agent.ini.bak &gt; /etc/neutron/metadata_agent.ini</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_ip controller</span><br><span class="line">openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret METADATA_SECRET</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次修改nova配置文件，添加neutron服务</span></span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron url http://controller:9696</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron region_name RegionOne</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron username neutron</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron password NEUTRON_PASS</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron service_metadata_proxy True</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron metadata_proxy_shared_secret METADATA_SECRET</span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验文件</span></span><br><span class="line">[root@controller ~]# md5sum /etc/nova/nova.conf</span><br><span class="line">6334f359655efdbcf083b812ab94efc1  /etc/nova/nova.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网络服务初始化脚本需要一个超链接</span></span><br><span class="line">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同步数据库</span></span><br><span class="line">su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查数据库</span></span><br><span class="line">mysql neutron -e &quot;show tables;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启Nova服务</span></span><br><span class="line">systemctl restart openstack-nova-api.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动Neutron服务</span></span><br><span class="line">systemctl enable neutron-server.service   neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service</span><br><span class="line">systemctl start neutron-server.service   neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看服务有没有起来</span></span><br><span class="line">neutron agent-list</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br><span class="line">| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br><span class="line">| 0d68dc27-f2b8-4cae-9c30-cddd126076b4 | Linux bridge agent | controller |                   | :-)   | True           | neutron-linuxbridge-agent |</span><br><span class="line">| 688cc47d-424d-4243-ae2b-b1c4b298a2a8 | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |</span><br><span class="line">| c4c5e360-ee02-4b9b-a1a5-59a0d0d088b0 | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="2-6-2-计算节点–安装步骤"><a href="#2-6-2-计算节点–安装步骤" class="headerlink" title="2.6.2 计算节点–安装步骤"></a>2.6.2 计算节点–安装步骤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装组件</span></span><br><span class="line">yum install -y openstack-neutron-linuxbridge ebtables ipset</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网络配置--公共网络</span></span><br><span class="line">cp /etc/neutron/neutron.conf&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/neutron.conf.bak  &gt; /etc/neutron/neutron.conf</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT rpc_backend rabbit</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_host controller</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_userid openstack</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_uri http://controller:5000</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller:11211</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password NEUTRON_PASS</span><br><span class="line">openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> md5校验</span></span><br><span class="line">md5sum /etc/nova/nova.conf</span><br><span class="line">328cd5f0745e26a420e828b0dfc2934e  /etc/nova/nova.conf</span><br><span class="line"></span><br><span class="line">cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini&#123;,.bak&#125;</span><br><span class="line">grep -Ev &quot;^$|#&quot; /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:ens33  # 要修改网络接口名</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan False</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group True</span><br><span class="line">openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次修改nova配置文件，添加neutron配置</span></span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron url http://controller:9696</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron auth_url http://controller:35357</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron auth_type password</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron project_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron user_domain_name default</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron region_name RegionOne</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron project_name service</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron username neutron</span><br><span class="line">openstack-config --set /etc/nova/nova.conf neutron password NEUTRON_PASS</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启nova服务</span></span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动linuxbridge代理服务</span></span><br><span class="line">systemctl enable neutron-linuxbridge-agent.service</span><br><span class="line">systemctl restart neutron-linuxbridge-agent.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否配置成功</span></span><br><span class="line">controller执行 &gt;&gt; neutron agent-list</span><br><span class="line">配置正确会多出来一个</span><br><span class="line">Linux bridge agent | compute1   |                   | :-)   | True </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看计算资源</span></span><br><span class="line">openstack compute service list</span><br></pre></td></tr></table></figure>

<h3 id="2-7-安装horizon-（Dashboard）web界面"><a href="#2-7-安装horizon-（Dashboard）web界面" class="headerlink" title="2.7 安装horizon （Dashboard）web界面"></a>2.7 安装horizon （Dashboard）web界面</h3><h4 id="2-7-1-安装步骤（控制节点"><a href="#2-7-1-安装步骤（控制节点" class="headerlink" title="2.7.1 安装步骤（控制节点)"></a>2.7.1 安装步骤（控制节点)</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装组件包</span></span><br><span class="line">yum install -y openstack-dashboard</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line">vim /etc/openstack-dashboard/local_settings</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;</span></span><br><span class="line">OPENSTACK_HOST = &quot;controller&quot;</span><br><span class="line">ALLOWED_HOSTS = [&#x27;*&#x27;, ]</span><br><span class="line">SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;</span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &#x27;default&#x27;: &#123;</span><br><span class="line">         &#x27;BACKEND&#x27;: &#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;,</span><br><span class="line">         &#x27;LOCATION&#x27;: &#x27;controller:11211&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    &quot;identity&quot;: 3,</span><br><span class="line">    &quot;image&quot;: 2,</span><br><span class="line">    &quot;volume&quot;: 2,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;default&quot;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;</span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#x27;enable_router&#x27;: False,</span><br><span class="line">    &#x27;enable_quotas&#x27;: False,</span><br><span class="line">    &#x27;enable_distributed_router&#x27;: False,</span><br><span class="line">    &#x27;enable_ha_router&#x27;: False,</span><br><span class="line">    &#x27;enable_lb&#x27;: False,</span><br><span class="line">    &#x27;enable_firewall&#x27;: False,</span><br><span class="line">    &#x27;enable_vpn&#x27;: False,</span><br><span class="line">    &#x27;enable_fip_topology_check&#x27;: False,</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = &quot;Asia/Shanghai&quot;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决不能进入页面的BUG</span></span><br><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf</span><br><span class="line">添加一行 &gt;&gt; WSGIAppicationGroup %&#123;GLOBAL&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">systemctl restart httpd.service memcached.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录界面</span></span><br><span class="line">https://10.0.0.11/dashboard</span><br><span class="line">域:default</span><br><span class="line">用户名:admin</span><br><span class="line">密码:ADMIN_PASS</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 扩展：查看文件输入那个rpm包</span></span><br><span class="line">rpm -qf /etc/openstack-dashboard/local_settings</span><br></pre></td></tr></table></figure>

<h4 id="2-7-2-Dashboard报错解决"><a href="#2-7-2-Dashboard报错解决" class="headerlink" title="2.7.2 Dashboard报错解决"></a>2.7.2 Dashboard报错解决</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 问题1--Invalid service catalog service: image</span></span><br><span class="line">发生原因：</span><br><span class="line">	openstack service list 存在两个 glance</span><br><span class="line">解决方法：</span><br><span class="line">    openstack service delete c12c125edc2041e3aaf2f250442162c6</span><br><span class="line">    openstack service delete 6a11431b95bc44d1bd1e9371c0faa16b # 两个glance都删掉</span><br><span class="line">    重复2.4.1在keystone上创建glance服务和注册api</span><br><span class="line">    再重启服务systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure>

<h3 id="2-8-启动一个云主机"><a href="#2-8-启动一个云主机" class="headerlink" title="2.8 启动一个云主机"></a>2.8 启动一个云主机</h3><h3 id="2-8-1-创建步骤"><a href="#2-8-1-创建步骤" class="headerlink" title="2.8.1 创建步骤"></a>2.8.1 创建步骤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建网络</span></span><br><span class="line">neutron net-create --shared --provider:physical_network provider \</span><br><span class="line">  --provider:network_type flat gs</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在网络中创建一个子网</span></span><br><span class="line">neutron subnet-create --name gs2 \</span><br><span class="line">  --allocation-pool start=10.0.0.101,end=10.0.0.250 \</span><br><span class="line">  --dns-nameserver 223.5.5.5 --gateway 10.0.0.2 \</span><br><span class="line">  gs 10.0.0.0/24</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建云主机硬件配置方案（规格）</span></span><br><span class="line">openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建密钥键值对</span></span><br><span class="line">ssh-keygen -q -N &quot;&quot; -f ~/.ssh/id_rsa</span><br><span class="line">openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证公钥的添加</span></span><br><span class="line">openstack keypair list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加安全组规则</span></span><br><span class="line">openstack security group rule create --proto icmp default</span><br><span class="line">openstack security group rule create --proto tcp --dst-port 22 default</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在公有网络启动一个实例</span></span><br><span class="line">openstack flavor list # 查看可用的配置规格</span><br><span class="line">openstack image list # 查看可用镜像</span><br><span class="line">openstack network list # 查看可用网络</span><br><span class="line">openstack security group list # 查看已设置的安全组</span><br><span class="line"></span><br><span class="line">openstack server create --flavor 规格名/ID --image 镜像名/ID \</span><br><span class="line">  --nic net-id=网络ID --security-group default \</span><br><span class="line">  --key-name mykey 实例名称</span><br><span class="line">示例：</span><br><span class="line">openstack server create --flavor m1.tiny --image cirros \</span><br><span class="line">--nic net-id=cb032582-893b-414d-b78d-c89c6548612d --security-group default \</span><br><span class="line">--key-name mykey my-instance</span><br></pre></td></tr></table></figure>

<h3 id="2-8-2-创建云主机问题解决"><a href="#2-8-2-创建云主机问题解决" class="headerlink" title="2.8.2 创建云主机问题解决"></a>2.8.2 创建云主机问题解决</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、启动云主机时，No valid host was found</span></span><br><span class="line">【计算节点中】</span><br><span class="line">查看云主机创建日志：/var/log/nova/nova-compute.log，里面有记录问题原因是CPU feature spec-ctrl not found</span><br><span class="line">修改/usr/share/libvirt/cpu_map.xml，将和spec-ctrl相关的特性删除</span><br><span class="line">然后重启服务</span><br><span class="line">systemctl restart libvirtd openstack-nova-compute</span><br><span class="line">参考博客：https://www.cnblogs.com/laolieren/p/solve_openstack_create_instance_error.html</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、云主机控制台seabios -- Booting from Hard Disk错误</span></span><br><span class="line">【计算节点中】</span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;</span></span><br><span class="line">[libvirt]</span><br><span class="line">virt_type = qemu</span><br><span class="line">cpu_mode = none</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;&gt;</span></span><br><span class="line">systemctl restart libvirtd openstack-nova-compute</span><br><span class="line">重启云主机</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>运维</category>
        <category>（四）虚拟化之OpenStack</category>
      </categories>
  </entry>
  <entry>
    <title>01_MySQL数据库(一)</title>
    <url>/2022/07/13/03_Python/01_MySQL/01-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%80/</url>
    <content><![CDATA[<h2 id="1-MySQL数据库的安装"><a href="#1-MySQL数据库的安装" class="headerlink" title="1 MySQL数据库的安装"></a>1 MySQL数据库的安装</h2><h3 id="1-1-版本获取"><a href="#1-1-版本获取" class="headerlink" title="1.1 版本获取"></a>1.1 版本获取</h3><p>版本选择</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">目前用的较多的是5.6 / 5.7 / 8.0 三个版本</span><br><span class="line">生产环境大多用5.X</span><br><span class="line">其中5.6版本在2021年2月暂停更新支持，这意味着MySQL 5.6会有安全风险，请及时升级到MySQL 5.7或是MySQL 8系列</span><br><span class="line">本文选用5.7版本</span><br></pre></td></tr></table></figure>

<p>windows版本下载地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://downloads.mysql.com/archives/installer/</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/image-20220713102756709.png" alt="image-20220713102756709"></p>
<h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h3><h2 id="2-数据库的基本操作"><a href="#2-数据库的基本操作" class="headerlink" title="2 数据库的基本操作"></a>2 数据库的基本操作</h2>]]></content>
      <categories>
        <category>Python</category>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL数据库(一)</title>
    <url>/2022/07/13/03_Python/01_MySQL/01_MySQL%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%80/</url>
    <content><![CDATA[<h2 id="1-MySQL数据库的安装"><a href="#1-MySQL数据库的安装" class="headerlink" title="1 MySQL数据库的安装"></a>1 MySQL数据库的安装</h2><h3 id="1-1-版本获取"><a href="#1-1-版本获取" class="headerlink" title="1.1 版本获取"></a>1.1 版本获取</h3><p>版本选择</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">目前用的较多的是5.6 / 5.7 / 8.0 三个版本</span><br><span class="line">生产环境大多用5.X</span><br><span class="line">其中5.6版本在2021年2月暂停更新支持，这意味着MySQL 5.6会有安全风险，请及时升级到MySQL 5.7或是MySQL 8系列</span><br><span class="line">本文选用5.7版本</span><br></pre></td></tr></table></figure>

<p>windows版本下载地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://downloads.mysql.com/archives/installer/</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/image-20220713102756709.png" alt="image-20220713102756709"></p>
<h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h3><h2 id="2-数据库的基本操作"><a href="#2-数据库的基本操作" class="headerlink" title="2 数据库的基本操作"></a>2 数据库的基本操作</h2>]]></content>
      <categories>
        <category>Python</category>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>01-计算机核心基础</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/01_%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A0%B8%E5%BF%83%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="1-引子"><a href="#1-引子" class="headerlink" title="1 引子:"></a>1 引子:</h2><p>接下来一段时间，我们的目标的是：学会使用python这门编程语言来编写ATM+购物车程序，那么问题来了:</p>
<h3 id="1-1-什么是语言？什么是编程语言？为何要有编程语言？"><a href="#1-1-什么是语言？什么是编程语言？为何要有编程语言？" class="headerlink" title="1.1 什么是语言？什么是编程语言？为何要有编程语言？"></a>1.1 什么是语言？什么是编程语言？为何要有编程语言？</h3><p><img src="/../../../img/image-20220715110229082.png" alt="image-20220715110229082"></p>
<p>语言其实就是人与人之间沟通的介质，如英语，汉语，俄语等。</p>
<p>而编程语言则是人与计算机之间沟通的介质。</p>
<p>那么为何要有编程语言，或者说人为何要与计算机沟通呢？这是因为在编程的世界里，计算机就好比是人的奴隶，人与计算机沟通的目的就是为了奴役计算机，让计算机按照人类的思维逻辑自发地去工作从而把人力解放出来。</p>
<p>此处我们可以提炼出如下两个重要的概念</p>
<h3 id="1-2-什么是编程？为什么要编程？"><a href="#1-2-什么是编程？为什么要编程？" class="headerlink" title="1.2 什么是编程？为什么要编程？"></a>1.2 什么是编程？为什么要编程？</h3><p>编程就是人把自己想命令计算机干的事用编程语言翻译出来并写到文件里（这一系列的文件就是程序），那么为什么要编程？</p>
<p>小人类编程的目的就是为了让计算机按照人类的思维逻辑(程序)自发地去工作从而把人力解放出来。</p>
<p>综上，我们接下来的学习应该分为两个层面</p>
<p>1、为了更好地控制人类的奴隶（即计算机），我们需要学习计算机是由什么组成的、它能做什么事、它是怎样工作的（详见计算机组成原理、操作系统概述）</p>
<p>2、我们需要学习编程语言，从而把原来需要人力来完成的业务（比如ATM和购物）交给计算机去做</p>
<h2 id="2-计算机组成原理"><a href="#2-计算机组成原理" class="headerlink" title="2 计算机组成原理"></a>2 计算机组成原理</h2><h3 id="2-1、什么是计算机？"><a href="#2-1、什么是计算机？" class="headerlink" title="2.1、什么是计算机？"></a>2.1、什么是计算机？</h3><p>俗称电脑，即通电的大脑，电脑二字蕴含了人类对计算机的终极期望，希望它能真的像人脑一样去工作，从而解放人力。</p>
<h3 id="2-2、为什么要用计算机？"><a href="#2-2、为什么要用计算机？" class="headerlink" title="2.2、为什么要用计算机？"></a>2.2、为什么要用计算机？</h3><p>世界是由聪明的懒人统治的，任何时期，总有一群聪明的懒人想要奴隶别人。在奴隶制社会，聪明的懒人奴役的是真正的人，而人是无法不吃、不喝、不睡觉一直工作的，但是计算机作为一台机器是可以做到的，所以把计算机当奴隶是上上之选。</p>
<h3 id="2-3、计算机的五大组成部分"><a href="#2-3、计算机的五大组成部分" class="headerlink" title="2.3、计算机的五大组成部分"></a>2.3、计算机的五大组成部分</h3><p>计算机有五大组成部分，既然计算机是人的奴隶，那么计算机设计核心肯定也是在模仿真正的人，所以我们完全可以把计算机的五大组件比喻成人类的各种器官</p>
<h4 id="2-3-1、控制器"><a href="#2-3-1、控制器" class="headerlink" title="2.3.1、控制器"></a>2.3.1、控制器</h4><p>控制器是计算机的指挥系统，用来控制计算机其他组件的运行，相当于人类的大脑</p>
<h4 id="2-3-2、运算器"><a href="#2-3-2、运算器" class="headerlink" title="2.3.2、运算器"></a>2.3.2、运算器</h4><p>运算器是计算机的运算功能，用来做算术运算和逻辑运算，相当于人脑。</p>
<p>ps：控制器+运算器&#x3D;CPU，cpu相当于人的大脑</p>
<p>cpu详解见：</p>
<p><a href="https://www.cnblogs.com/xiaoyuanqujing/articles/11640866.html">https://www.cnblogs.com/xiaoyuanqujing/articles/11640866.html</a></p>
<h4 id="2-3-3、存储器"><a href="#2-3-3、存储器" class="headerlink" title="2.3.3、存储器"></a>2.3.3、存储器</h4><p>存储器是计算机的记忆功能，用来存取数据。</p>
<p>存储器主要分为内存与外存：</p>
<p> 内存相当于人的短期记忆。断电数据丢失</p>
<p> 外存(如磁盘),相当于记事的本子，断电数据不会丢失，是用来永久保存数据的</p>
<p> ps：内存的存取速度要远远高于外存</p>
<h4 id="2-3-4、输入设备input"><a href="#2-3-4、输入设备input" class="headerlink" title="2.3.4、输入设备input"></a>2.3.4、输入设备input</h4><p>输入设备是计算接收外界输入数据的工具，如键盘、鼠标，相当于人的眼睛或耳朵。</p>
<h4 id="2-3-5、输出设备output"><a href="#2-3-5、输出设备output" class="headerlink" title="2.3.5、输出设备output"></a>2.3.5、输出设备output</h4><p>输出设备是计算机向外输出数据的工具，如显示器、打印机，相当于人说的话，写出的文章。</p>
<p>ps：存储器如内存、磁盘等既是输入设备又是输出设备，统称为IO设备</p>
<h4 id="一个非常重要的基础知识-与运行程序相关的三大核心硬件"><a href="#一个非常重要的基础知识-与运行程序相关的三大核心硬件" class="headerlink" title="一个非常重要的基础知识:与运行程序相关的三大核心硬件"></a>一个非常重要的基础知识:与运行程序相关的三大核心硬件</h4><p>我们编写的程序一定是要运行于计算机硬件之上，而站在硬件的角度，与运行程序有关的三大核心硬件为CPU、内存、硬盘。</p>
<p>程序最先是存放于硬盘中的，程序的运行是先从硬盘把代码加载到内存中，然后cpu是从内存中读取指令运行。</p>
<p><strong>ps：了解其他计算机硬件知识</strong></p>
<p><a href="https://www.cnblogs.com/linhaifeng/p/6523843.html#4462371">https://www.cnblogs.com/linhaifeng/p/6523843.html#4462371</a></p>
<h2 id="3-操作系统概述"><a href="#3-操作系统概述" class="headerlink" title="3 操作系统概述"></a>3 操作系统概述</h2><h3 id="3-1、操作系统的由来"><a href="#3-1、操作系统的由来" class="headerlink" title="3.1、操作系统的由来"></a>3.1、操作系统的由来</h3><p> 大前提：我们编程目的就是为了奴役计算机，让计算机硬件自发地运行起来，然而硬件毕竟是”死的“，硬件的运行都是由软件支配。</p>
<p> 倘若我们要开发一个应用程序，比如暴风音影，该软件的一个核心业务就是播放视频，开发者若要编写程序完成播放视频这个业务逻辑，必先涉及到底层硬件硬盘的基本运作（视频文件都是先存放于硬盘中），这意味着开发者在编写业务逻辑代码之前，必须先编写一个控制硬盘基本运行的控制程序，然而这仅仅只是一个开始，事实上，在编写应用程序的业务逻辑前，需要开发者编写出一套完整的控制程序用来控制所有硬件的基本运行（这要求开发者需要详细了解计算机硬件的各种控制细节，例如我们必须把CPU里面所有指令集都掌握一遍），如此，所有的开发者在开发程序时都必须依次开发两种：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、编写一套完整的的控制程序，用来控制硬件的基本运行，以及把复杂的硬件的操作封装成简单的接口</span></span><br><span class="line"><span class="comment">#2、基于控制程序的接口开发包含一系列业务逻辑的程序，为了与控制程序区分，可以称为应用程序，以ATM这款应用程序为例，业务逻辑有提款、转账、查询余额等</span></span><br></pre></td></tr></table></figure>

<p> 综上，对于不同公司的开发者来说，应用程序的业务逻辑各不相同，但硬件的控制程序都大致相同，为了避免所有程序员做重复劳动，以及不用再耗费精力去了解所有硬件的运行细节，有公司专门跳出来承担起控制程序的开发任务，这里所说的控制程序指的就是操作系统。</p>
<p> 操作系统的功能就是帮我们把复杂的硬件的控制封装成简单的接口，对于开发应用程序来说只需要调用操作系统提供给我们的接口即可</p>
<h3 id="3-2、系统软件与应用软件"><a href="#3-2、系统软件与应用软件" class="headerlink" title="3.2、系统软件与应用软件"></a>3.2、系统软件与应用软件</h3><p>硬件以上运行的都是软件，而软件分为两类：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#一、应用软件（例如qq、word、暴风影音，我们学习python就是为了开发应用软件的）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#二、操作系统，操作系统应用软件与硬件之间的一个桥梁，是协调、管理、控制计算机硬件与应用软件资源的控制程序。</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3、计算机系统三层结构"><a href="#3-3、计算机系统三层结构" class="headerlink" title="3.3、计算机系统三层结构"></a>3.3、计算机系统三层结构</h3><p>综上，我们开发应用程序本质是在控制硬件，但是我们直接打交道的是操作系统，应用程序都是通过操作系统来间接地操作硬件的，所以一套完整的计算机系统分为三层，如下</p>
<p><img src="/../../../img/image-20220715110139880.png" alt="image-20220715110139880"></p>
<h3 id="一个非常重要的基础概念：平台"><a href="#一个非常重要的基础概念：平台" class="headerlink" title="一个非常重要的基础概念：平台"></a>一个非常重要的基础概念：平台</h3><p>应用程序都是运行于操作系统之上，而操作系统则是运行于硬件之上的，所以承载应用程序的是一台运行有操作系统的计算机，称之为应用程序的运行平台，即：硬件 + 操作系统 &#x3D;&#x3D; 平台</p>
<p><img src="/../../../img/image-20220715110156372.png" alt="image-20220715110156372"></p>
<p>常见的平台有：windows系统+某款硬件、linux系统+某款硬件、ubuntu+某款硬件等，我们在开发应用程序时就需要考虑到应用程序的跨平台性，如果能开发出一款可以在任意平台运行的应用程序，那对于开发者来说真是极大的福音。而决定应用软件的跨平台性的关键因素往往是编程语言的选择，python恰好是一款跨平台性语言，这也是我们学习它的原因之一。</p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>02-编程语言与Python介绍</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/02_%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%8EPython%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h2 id="一-引子"><a href="#一-引子" class="headerlink" title="一 引子"></a>一 引子</h2><p> 基于上一章所学，有了计算机硬件，再在硬件之上安装好操作系统，我们就有了一个应用程序的运行平台，我们接下来的任务就是学习如何使用某款编程语言来开发应用程序。</p>
<p> 本章的主题是先带大家了解下编程语言，然后重点介绍python这门编程语言</p>
<p><img src="/../../../img/image-20220715110810985.png" alt="image-20220715110810985"></p>
<h2 id="二-编程语言分类："><a href="#二-编程语言分类：" class="headerlink" title="二 编程语言分类："></a>二 编程语言分类：</h2><h2 id="2-1-机器语言"><a href="#2-1-机器语言" class="headerlink" title="2.1 机器语言"></a>2.1 机器语言</h2><p><img src="/../../../img/image-20220715110833863.png" alt="image-20220715110833863"></p>
<p><code>机器语言</code>是站在计算机(奴隶)的角度，说计算机能听懂&#x2F;理解的语言，而计算机能直接理解的就是二进制指令，所以机器语言就是直接用<code>二进制编程</code>，这意味着机器语言是直接操作硬件的，因此机器语言属于低级语言，此处的低级指的是底层、贴近计算机硬件（贴近代指需要详细了解计算机硬件细节、直接控制硬件），详解如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#机器语言</span></span><br><span class="line">    用二进制代码<span class="number">0</span>和<span class="number">1</span>描述的指令称为机器指令，由于计算机内部是基于二进制指令工作的，所以机器语言是直接控制计算机硬件。</span><br><span class="line"></span><br><span class="line">    用机器语言编写程序，编程人员要首先熟记所用计算机的全部指令代码以及代码的含义，然后在编写程序时，程序员得自己处理每条指令和每一数据的存储分配和输入输出，还得记住编程过程中每步所使用的工作单元处在何种状态。这是一件十分繁琐的工作。编写程序花费的时间往往是实际运行时间的几十倍或几百倍。而且，编出的程序全是些<span class="number">0</span>和<span class="number">1</span>的指令代码，直观性差，不便阅读和书写，还容易出错，且依赖于具体的计算机硬件型号，局限性很大。除了计算机生产厂家的专业人员外，绝大多数的程序员已经不再去学习机器语言了。</span><br><span class="line"></span><br><span class="line">    机器语言是被微处理器理解和使用的，存在有多至<span class="number">100000</span>种机器语言的指令，下述是一些简单示例</span><br><span class="line"></span><br><span class="line">    <span class="comment">#指令部份的示例</span></span><br><span class="line">    <span class="number">0000</span> 代表 加载（LOAD）</span><br><span class="line">    0001 代表 存储（STORE）</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">#暂存器部份的示例</span></span><br><span class="line">    <span class="number">0000</span> 代表暂存器 A</span><br><span class="line">    0001 代表暂存器 B</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">#存储器部份的示例</span></span><br><span class="line">    <span class="number">000000000000</span> 代表地址为 <span class="number">0</span> 的存储器</span><br><span class="line">    000000000001 代表地址为 <span class="number">1</span> 的存储器</span><br><span class="line">    000000010000 代表地址为 <span class="number">16</span> 的存储器</span><br><span class="line">    <span class="number">100000000000</span> 代表地址为 <span class="number">2</span>^<span class="number">11</span> 的存储器</span><br><span class="line"></span><br><span class="line">    <span class="comment">#集成示例</span></span><br><span class="line">    <span class="number">0000</span>,<span class="number">0000</span>,000000010000 代表 LOAD A, <span class="number">16</span></span><br><span class="line">    <span class="number">0000</span>,0001,000000000001 代表 LOAD B, <span class="number">1</span></span><br><span class="line">    0001,0001,000000010000 代表 STORE B, <span class="number">16</span></span><br><span class="line">    0001,0001,000000000001 代表 STORE B, <span class="number">1</span>[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>总结机器语言</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、执行效率最高</span></span><br><span class="line">编写的程序可以被计算机无障碍理解、直接运行，执行效率高 。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、开发效率最低</span></span><br><span class="line">复杂，开发效率低</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、跨平台性差</span></span><br><span class="line">贴近\依赖具体的硬件，跨平台性差</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/image-20220715110856325.png" alt="image-20220715110856325"></p>
<h2 id="2-2-汇编语言"><a href="#2-2-汇编语言" class="headerlink" title="2.2 汇编语言"></a>2.2 汇编语言</h2><p>汇编语言仅仅是用一个英文标签代表一组二进制指令，毫无疑问，比起机器语言，汇编语言是一种进步，但汇编语言的本质仍然是直接操作硬件，因此汇编语言仍是比较低级&#x2F;底层的语言、贴近计算机硬件</p>
<p><img src="/../../../img/image-20220715110908252.png" alt="image-20220715110908252"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#汇编语言</span></span><br><span class="line">汇编语言的实质和机器语言是相同的，都是直接对硬件操作，只不过指令采用了英文缩写的标识符，更容易识别和记忆。它同样需要编程者将每一步具体的操作用命令的形式写出来。汇编程序的每一句指令只能对应实际操作过程中的一个很细微的动作。例如移动、自增，因此汇编源程序一般比较冗长、复杂、容易出错，而且使用汇编语言编程需要有更多的计算机专业知识，但汇编语言的优点也是显而易见的，用汇编语言所能完成的操作不是一般高级语言所能够实现的，而且源程序经汇编生成的可执行文件不仅比较小，而且执行速度很快。</span><br><span class="line"></span><br><span class="line">汇编的hello world，打印一句hello world, 需要写十多行，如下</span><br><span class="line"></span><br><span class="line">; hello.asm </span><br><span class="line">section .data            ; 数据段声明</span><br><span class="line">        msg db <span class="string">&quot;Hello, world!&quot;</span>, <span class="number">0xA</span>     ; 要输出的字符串</span><br><span class="line">        <span class="built_in">len</span> equ $ - msg                 ; 字串长度</span><br><span class="line">        section .text            ; 代码段声明</span><br><span class="line">        <span class="keyword">global</span> _start            ; 指定入口函数</span><br><span class="line">        _start:                  ; 在屏幕上显示一个字符串</span><br><span class="line">        mov edx, <span class="built_in">len</span>     ; 参数三：字符串长度</span><br><span class="line">        mov ecx, msg     ; 参数二：要显示的字符串</span><br><span class="line">        mov ebx, <span class="number">1</span>       ; 参数一：文件描述符(stdout) </span><br><span class="line">        mov eax, <span class="number">4</span>       ; 系统调用号(sys_write) </span><br><span class="line">        <span class="built_in">int</span> <span class="number">0x80</span>         ; 调用内核功能</span><br><span class="line">                         ; 退出程序</span><br><span class="line">        mov ebx, <span class="number">0</span>       ; 参数一：退出代码</span><br><span class="line">        mov eax, <span class="number">1</span>       ; 系统调用号(sys_exit) </span><br><span class="line">        <span class="built_in">int</span> <span class="number">0x80</span>         ; 调用内核功能</span><br></pre></td></tr></table></figure>

<p>总结汇编语言</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、执行效率高</span></span><br><span class="line">相对于机器语言，使用英文标签编写程序相对简单，执行效率高，但较之机器语言稍低，</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、开发效率低：</span></span><br><span class="line">仍然是直接操作硬件，比起机器语言来说，复杂度稍低，但依旧居高不下，所以开发效率依旧较低</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、跨平台性差</span></span><br><span class="line">同样依赖具体的硬件，跨平台性差</span><br></pre></td></tr></table></figure>

<h2 id="2-3-高级语言"><a href="#2-3-高级语言" class="headerlink" title="2.3 高级语言"></a>2.3 高级语言</h2><p>高级语言是站在人(奴隶主)的角度，说人话，即用人类的字符去编写程序，而人类的字符是在向操作系统发送指令，而非直接操作硬件，所以高级语言是与操作系统打交道的，此处的高级指的是高层、开发者无需考虑硬件细节，因而开发效率可以得到极大的提升，但正因为高级语言离硬件较远，更贴近人类语言，人类可以理解，而计算机则需要通过翻译才能理解，所以执行效率会低于低级语言。</p>
<p>按照翻译的方式的不同，高级语言又分为两种：</p>
<h3 id="2-3-1-编译型（如C语言）"><a href="#2-3-1-编译型（如C语言）" class="headerlink" title="2.3.1 编译型（如C语言）:"></a>2.3.1 编译型（如C语言）:</h3><p><img src="/../../../img/image-20220715110934572.png" alt="image-20220715110934572"></p>
<p>类似谷歌翻译，是把程序所有代码编译成计算机能识别的二进制指令，之后操作系统会拿着编译好的二进制指令直接操作硬件，详细如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、执行效率高</span></span><br><span class="line">编译是指在应用源程序执行之前，就将程序源代码“翻译”成目标代码（即机器语言），</span><br><span class="line">因此其目标程序可以脱离其语言环境独立执行，使用比较方便，执行效率较高。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、开发效率低：</span></span><br><span class="line">应用程序一旦需要修改，必须先修改源代码，然后重新编译、生成新的目标文件才能执行，</span><br><span class="line">而在只有目标文件而没有源代码，修改会很不方便。所以开发效率低于解释型</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、跨平台性差</span></span><br><span class="line">编译型代码是针对某一个平台翻译的，当前平台翻译的结果无法拿到不同的平台使用，针对不同的平台必须重新编译，即跨平台性差</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他</span></span><br><span class="line">现在大多数的编程语言都是编译型的。</span><br><span class="line">编译程序将源程序翻译成目标程序后保存在另一个文件中，该目标程序可脱离编译程序直接在计算机上多次运行。</span><br><span class="line">大多数软件产品都是以目标程序形式发行给用户的，不仅便于直接运行，同时又使他人难于盗用其中的技术。</span><br><span class="line">C、C++、Ada、Pascal都是编译实现的</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-解释型（如python）"><a href="#2-3-2-解释型（如python）" class="headerlink" title="2.3.2 解释型（如python）:"></a>2.3.2 解释型（如python）:</h3><p><img src="/../../../img/image-20220715111047082.png" alt="image-20220715111047082"></p>
<p>类似同声翻译，需要有一个解释器，解释器会读取程序代码，一边翻译一边执行，详细如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 1、执行效率低</span><br><span class="line">解释型语言的实现中，翻译器并不产生目标机器代码，而是产生易于执行的中间代码。</span><br><span class="line">这种中间代码与机器代码是不同的，中间代码的解释是由软件支持的，不能直接使用硬件，</span><br><span class="line">软件解释器通常会导致执行效率较低。</span><br><span class="line"></span><br><span class="line"># 2、开发效率高</span><br><span class="line">用解释型语言编写的程序是由另一个可以理解中间代码的解释程序执行的，与编译程序不同的是，</span><br><span class="line">解释程序的任务是逐一将源程序的语句解释成可执行的机器指令，不需要将源程序翻译成目标代码再执行。</span><br><span class="line">解释程序的优点是当语句出现语法错误时，可以立即引起程序员的注意，而程序员在程序开发期间就能进行校正。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 3、跨平台性强</span><br><span class="line">代码运行是依赖于解释器，不同平台有对应版本的解释器，所以解释型的跨平台性强</span><br><span class="line"></span><br><span class="line"># 其他</span><br><span class="line">对于解释型Basic语言，需要一个专门的解释器解释执行Basic程序，每条语句只有在执行时才被翻译，</span><br><span class="line">这种解释型语言每执行一次就翻译一次，因而效率低下。一般地，动态语言都是解释型的，</span><br><span class="line">例如：Tcl、Perl、Ruby、VBScript、JavaScript等</span><br></pre></td></tr></table></figure>

<p>ps：混合型语言</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Java是一类特殊的编程语言，Java程序也需要编译，但是却没有直接编译为机器语言，而是编译为字节码，</span><br><span class="line">然后在Java虚拟机上以解释方式执行字节码。</span><br></pre></td></tr></table></figure>

<h2 id="2-4-总结"><a href="#2-4-总结" class="headerlink" title="2.4 总结"></a>2.4 总结</h2><p> 综上选择不同编程语言来开发应用程序对比</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、执行效率：机器语言&gt;汇编语言&gt;高级语言（编译型&gt;解释型）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、开发效率：机器语言&lt;汇编语言&lt;高级语言（编译型&lt;解释型）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、跨平台性：解释型具有极强的跨平台型</span></span><br></pre></td></tr></table></figure>

<p> 由于我们开发是应用程序，而应用程序必须运行于某一个平台之上，应用程序的快慢受限于平台（就好比F1赛车与宝马车同时跑在北京五环高速，都受限于道路环境，车速是差不多的）的快慢，并不是单从语言层面就可以提升整体执行效率的，于是开发效率、跨平台性才是我们需要优先考虑的问题，这就是我们首选python的原因</p>
<p><img src="/../../../img/image-20220715111100262.png" alt="image-20220715111100262"></p>
<h2 id="三-python介绍"><a href="#三-python介绍" class="headerlink" title="三 python介绍"></a>三 python介绍</h2><p> 谈及python，涉及两层意思，一层代表的是python这门语言的语法风格，另外一层代表的则是专门用来解释该语法风格的应用程序：python解释器。</p>
<p> python的创始人为吉多·范罗苏姆（Guido van Rossum）。Python这个名字，来自Guido所挚爱的电视剧Monty Python’s Flying Circus，他希望这个新的叫做Python的语言，能符合他的理想：创造一种C和shell之间，语法能够像shell一样简洁，易学易用、可拓展性强，同时兼顾C的强大功能。于是Guido在1989年的圣诞节期间，开始编写能够解释Python语言语法的解释器。</p>
<p> Python崇尚优美、清晰、简单，是一个优秀并广泛使用的语言。最新的TIOBE排行榜<a href="https://link.zhihu.com/?target=https://www.tiobe.com/tiobe-index/">https://www.tiobe.com/tiobe-index/</a>，Python已飙升至世界第三。</p>
<p> Python可以应用于众多领域，如：人工智能、数据分析、爬虫、金融量化、云计算、WEB开发、自动化运维&#x2F;测试、游戏开发、网络服务、图像处理等众多领域。目前业内几乎所有大中型互联网企业都在使用Python，如：Youtube、Dropbox、BT、Quora（中国知乎）、豆瓣、知乎、Google、Yahoo!、Facebook、NASA、百度、腾讯、汽车之家、美团等。</p>
<h2 id="3-1-Python解释器的发展史"><a href="#3-1-Python解释器的发展史" class="headerlink" title="3.1 Python解释器的发展史"></a>3.1 Python解释器的发展史</h2><p>![](..&#x2F;新配图&#x2F;恶搞图&#x2F;01-09-人类历史发展史.jp</p>
<p>1989年，Guido开始写Python语言的编译器。 1991年，第一个Python编译器诞生。它是用C语言实现的，并能够调用C语言的库文件。从一出生，Python已经具有了：类，函数，异常处理，包含表和词典在内的核心数据类型，以及模块为基础的拓展系统。</p>
<p>Granddaddy of Python web frameworks, Zope 1 was released in 1999</p>
<p>Python 1.0 - January 1994 增加了 lambda, map, filter and reduce.</p>
<p>Python 2.0 - October 16, 2000，加入了内存回收机制，构成了现在Python语言框架的基础</p>
<p>Python 2.4 - November 30, 2004, 同年目前最流行的WEB框架Django 诞生</p>
<p>Python 2.5 - September 19, 2006</p>
<p>Python 2.6 - October 1, 2008</p>
<p>Python 2.7 - July 3, 2010</p>
<p>In November 2014, it was announced that Python 2.7 would be supported until 2020, and reaffirmed that there would be no 2.8 release as users were expected to move to Python 3.4+ as soon as possible</p>
<p>Python 3.0 - December 3, 2008 (细心的读者会发现，08年时就推出了3.0，2010年反而又推出了2.7？是因为3.0不向下兼容2.0，而很多公司已经基于2.0版本开发出了大量程序，公司已然投入了大量的人财物力，这就导致大家都拒绝升级3.0，无奈官方只能推出2.7过渡版本，之后我们都应该采用3.0解释器开发程序，但为了方便读者维护2.0版本的软件，我们在遇到两种版本的差异时会专门指出来)</p>
<p>Python 3.1 - June 27, 2009</p>
<p>Python 3.2 - February 20, 2011</p>
<p>Python 3.3 - September 29, 2012</p>
<p>Python 3.4 - March 16, 2014</p>
<p>Python 3.5 - September 13, 2015</p>
<p>Python 3.6 - 2016-12-23 发布python3.6.0版</p>
<h2 id="3-2-Python解释器有哪些种类"><a href="#3-2-Python解释器有哪些种类" class="headerlink" title="3.2 Python解释器有哪些种类?"></a>3.2 Python解释器有哪些种类?</h2><p>官方的Python解释器本质就是基于C语言开发的一个软件，该软件的功能就是读取以.py结尾的文件内容，然后按照Guido定义好的语法和规则去翻译并执行相应的代码。这种用C实现的解释器称为CPython，它是python领域性能最好，应用最广泛的一款解释器，我们在后面提到的解释器指的都是Cpython解释器。但其实解释器作为一款应用软件，完全可以采用其他语言来开发，只要能解释python这门语言的语法即可。Python解释器的一些种类如下，简单了解即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Jython</span></span><br><span class="line">JPython解释器是用JAVA编写的python解释器，可以直接把Python代码编译成Java字节码并执行，它不但使基于java的项目之上嵌入python脚本成为可能，同时也可以将java程序引入到python程序之中。</span><br><span class="line"></span><br><span class="line"><span class="comment"># IPython</span></span><br><span class="line">IPython是基于CPython之上的一个交互式解释器，也就是说，IPython只是在交互方式上有所增强，但是执行Python代码的功能和CPython是完全一样的。这就好比很多国产浏览器虽然外观不同，但内核其实都是调用了IE。</span><br><span class="line">CPython用&gt;&gt;&gt;作为提示符，而IPython用In [序号]:作为提示符。</span><br><span class="line"></span><br><span class="line"><span class="comment"># PyPy</span></span><br><span class="line">PyPy是Python开发者为了更好地Hack Python而用Python语言实现的Python解释器。PyPy提供了JIT编译器和沙盒功能，对Python代码进行动态编译（注意不是解释），因此运行速度比CPython还要快。</span><br><span class="line"></span><br><span class="line"><span class="comment"># IronPython</span></span><br><span class="line">IronPython和Jython类似，只不过IronPython是运行在微软.Net平台上的Python解释器，可以直接把Python代码编译成.Net的字节码。</span><br></pre></td></tr></table></figure>



<h2 id="四-安装Cpython解释器"><a href="#四-安装Cpython解释器" class="headerlink" title="四 安装Cpython解释器"></a>四 安装Cpython解释器</h2><p>Python解释器目前已支持所有主流操作系统，在Linux,Unix,Mac系统上自带Python解释器，在Windows系统上需要安装一下，具体步骤如下。</p>
<h2 id="4-1、下载python解释器"><a href="#4-1、下载python解释器" class="headerlink" title="4.1、下载python解释器"></a>4.1、下载python解释器</h2><p>打开官网 <a href="https://link.zhihu.com/?target=https://www.python.org">https://www.python.org</a>，按提示下载即可</p>
<h2 id="4-2、安装python解释器"><a href="#4-2、安装python解释器" class="headerlink" title="4.2、安装python解释器"></a>4.2、安装python解释器</h2><h2 id="4-3、测试安装是否成功"><a href="#4-3、测试安装是否成功" class="headerlink" title="4.3、测试安装是否成功"></a>4.3、测试安装是否成功</h2><p>windows –&gt; 运行 –&gt; 输入cmd ，然后回车，弹出cmd程序，输入python,如果能进入交互环境 ，代表安装成功。</p>
<h2 id="五-第一个python程序"><a href="#五-第一个python程序" class="headerlink" title="五 第一个python程序"></a>五 第一个python程序</h2><h2 id="5-1-运行python程序有两种方式"><a href="#5-1-运行python程序有两种方式" class="headerlink" title="5.1 运行python程序有两种方式"></a>5.1 运行python程序有两种方式</h2><p>方式一： 交互式模式</p>
<p><img src="/../../../img/image-20220715111232260.png" alt="image-20220715111232260"></p>
<p>方式二：脚本文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、打开一个文本编辑工具，写入下述代码，并保存文件，此处文件的路径为D:\test.py。强调：python解释器执行程序是解释执行，解释的根本就是打开文件读内容，因此文件的后缀名没有硬性限制，但通常定义为.py结尾</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、打开cmd，运行命令，如下图</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/image-20220715111243920.png" alt="image-20220715111243920"></p>
<p>总结：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、交互式模式下可以即时得到代码执行结果，调试程序十分方便</span></span><br><span class="line"><span class="comment">#2、若想将代码永久保存下来，则必须将代码写入文件中</span></span><br><span class="line"><span class="comment">#3、我们以后主要就是在代码写入文件中，偶尔需要打开交互式模式调试某段代码、验证结果</span></span><br></pre></td></tr></table></figure>

<h2 id="5-2-注释"><a href="#5-2-注释" class="headerlink" title="5.2 注释"></a>5.2 注释</h2><p>在正式学习python语法前，我们必须事先介绍一个非常重要的语法：注释</p>
<p><strong>1、什么是注释</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">注释就是就是对代码的解释说明，注释的内容不会被当作代码运行</span><br></pre></td></tr></table></figure>

<p><strong>2、为什么要注释</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">增强代码的可读性</span><br></pre></td></tr></table></figure>

<p><strong>3、怎么用注释?</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">代码注释分单行和多行注释</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、单行注释用<span class="comment">#号，可以跟在代码的正上方或者正后方</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、多行注释可以用三对双引号<span class="string">&quot;&quot;&quot; &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这是多行注释</span></span><br><span class="line"><span class="string">这是多行注释</span></span><br><span class="line"><span class="string">这是多行注释</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是单行注释，下面是测试代码</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>4、代码注释的原则：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、不用全部加注释，只需要为自己觉得重要或不好理解的部分加注释即可</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、注释可以用中文或英文，但不要用拼音</span><br></pre></td></tr></table></figure>

<h1 id="六-IDE工具pycharm的使用"><a href="#六-IDE工具pycharm的使用" class="headerlink" title="六 IDE工具pycharm的使用"></a>六 IDE工具pycharm的使用</h1><h2 id="6-1、什么是IDE？为何要有IDE"><a href="#6-1、什么是IDE？为何要有IDE" class="headerlink" title="6.1、什么是IDE？为何要有IDE"></a>6.1、什么是IDE？为何要有IDE</h2><p>在编写第一个python程序时，存在以下问题，严重影响开发效率</p>
<p>问题一：我们了解到一个python程序从开发到运行需要操作至少两个软件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、打开一个软件：文本编辑器，创建文本来编写程序</span><br><span class="line"><span class="number">2</span>、打开cmd，然后输入命令执行pyton程序</span><br></pre></td></tr></table></figure>

<p>问题二：在开发过程中，并没代码提示以及纠错功能</p>
<p>综上，如果能有一款工具能够集成n个软件的功能，同时又代码提示以及纠错等功能，那么将会极大地提升程序员的开发效率，这就是IDE的由来，IDE全称Integrated Development Environment，即集成开发环境，最好的开发Python程序的IDE就是PyCharm。</p>
<h2 id="6-2、pychram安装"><a href="#6-2、pychram安装" class="headerlink" title="6.2、pychram安装"></a>6.2、pychram安装</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载地址: https://www.jetbrains.com/pycharm/download  选择Professional专业版</span></span><br></pre></td></tr></table></figure>

<p><strong>安装完成后注册，然后启动，会让你先创建一个项目，其实就是一个文件夹，我们以后的代码都存在这里面。</strong></p>
<p><img src="/../../../img/image-20220715111737349.png" alt="image-20220715111737349"></p>
<h2 id="6-3、Pycharm创建文件夹"><a href="#6-3、Pycharm创建文件夹" class="headerlink" title="6.3、Pycharm创建文件夹"></a>6.3、Pycharm创建文件夹</h2><p>创建文件夹是管理文件的良好方式</p>
<p><img src="/../../../img/image-20220715111746387.png" alt="image-20220715111746387"></p>
<h2 id="6-4、如何创建文件并编写程序执行"><a href="#6-4、如何创建文件并编写程序执行" class="headerlink" title="6.4、如何创建文件并编写程序执行"></a>6.4、如何创建文件并编写程序执行</h2><p>创建py文件test.py</p>
<p>在test.py中写代码，输入关键字的开头可以用tab键补全后续，并且会有代码的错误提示</p>
<p><img src="/../../../img/image-20220715111759964.png" alt="image-20220715111759964"></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>04-基本数据类型</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/04_Python%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E4%B9%8B%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p>我们学习变量是为了让计算机能够像人一样去记忆事物的某种状态，而变量的值就是用来存储事物状态的，很明显事物的状态分成不同种类的（比如人的年龄，身高，职位，工资等等），所以变量值也应该有不同的类型，例如</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">salary = <span class="number">3.1</span> <span class="comment"># 用浮点型去记录薪资</span></span><br><span class="line">age = <span class="number">18</span> <span class="comment"># 用整型去记录年龄</span></span><br><span class="line">name = <span class="string">&#x27;lili&#x27;</span> <span class="comment"># 用字符串类型去记录人名</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-350a0a150010ed0dc13cf18062f4919b_720w.jpg" alt="img"></p>
<h2 id="二-数字类型"><a href="#二-数字类型" class="headerlink" title="二 数字类型"></a>二 数字类型</h2><h2 id="2-1-int整型"><a href="#2-1-int整型" class="headerlink" title="2.1 int整型"></a>2.1 int整型</h2><h3 id="2-1-1-作用"><a href="#2-1-1-作用" class="headerlink" title="2.1.1 作用"></a>2.1.1 作用</h3><p>用来记录人的年龄，出生年份，学生人数等整数相关的状态</p>
<h3 id="2-1-2-定义"><a href="#2-1-2-定义" class="headerlink" title="2.1.2 定义"></a>2.1.2 定义</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">age=<span class="number">18</span></span><br><span class="line"></span><br><span class="line">birthday=<span class="number">1990</span></span><br><span class="line"></span><br><span class="line">student_count=<span class="number">48</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-float浮点型"><a href="#2-2-float浮点型" class="headerlink" title="2.2 float浮点型"></a>2.2 float浮点型</h2><h3 id="2-2-1-作用"><a href="#2-2-1-作用" class="headerlink" title="2.2.1 作用"></a>2.2.1 作用</h3><p>用来记录人的身高，体重，薪资等小数相关的状态</p>
<h3 id="2-2-2-定义"><a href="#2-2-2-定义" class="headerlink" title="2.2.2 定义"></a>2.2.2 定义</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">height=<span class="number">172.3</span></span><br><span class="line"></span><br><span class="line">weight=<span class="number">103.5</span></span><br><span class="line"></span><br><span class="line">salary=<span class="number">15000.89</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-数字类型的使用"><a href="#2-3-数字类型的使用" class="headerlink" title="2.3 数字类型的使用"></a>2.3 数字类型的使用</h2><p>1 、数学运算</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = a + b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>2、比较大小</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = <span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x &gt; y</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="三-字符串类型str"><a href="#三-字符串类型str" class="headerlink" title="三 字符串类型str"></a>三 字符串类型str</h2><h2 id="3-1-作用"><a href="#3-1-作用" class="headerlink" title="3.1 作用"></a>3.1 作用</h2><p>用来记录人的名字，家庭住址，性别等描述性质的状态</p>
<h2 id="3-2-定义"><a href="#3-2-定义" class="headerlink" title="3.2 定义"></a>3.2 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&#x27;Tony&#x27;</span></span><br><span class="line"></span><br><span class="line">address = <span class="string">&#x27;上海市浦东新区&#x27;</span></span><br><span class="line"></span><br><span class="line">sex = <span class="string">&#x27;男&#x27;</span></span><br></pre></td></tr></table></figure>

<p>用单引号、双引号、多引号，都可以定义字符串，本质上是没有区别的，但是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、需要考虑引号嵌套的配对问题</span></span><br><span class="line">msg = <span class="string">&quot;My name is Tony , I&#x27;m 18 years old!&quot;</span> <span class="comment">#内层有单引号，外层就需要用双引号</span></span><br><span class="line"><span class="comment">#2、多引号可以写多行字符串</span></span><br><span class="line">msg = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        天下只有两种人。比如一串葡萄到手，一种人挑最好的先吃，另一种人把最好的留到最后吃。</span></span><br><span class="line"><span class="string">        照例第一种人应该乐观，因为他每吃一颗都是吃剩的葡萄里最好的；第二种人应该悲观，因为他每吃一颗都是吃剩的葡萄里最坏的。</span></span><br><span class="line"><span class="string">        不过事实却适得其反，缘故是第二种人还有希望，第一种人只有回忆。</span></span><br><span class="line"><span class="string">      &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-使用"><a href="#3-3-使用" class="headerlink" title="3.3 使用"></a>3.3 使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">数字可以进行加减乘除等运算，字符串呢？也可以，但只能进行<span class="string">&quot;相加&quot;</span>和<span class="string">&quot;相乘&quot;</span>运算。</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>age = <span class="string">&#x27;18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name + age <span class="comment">#相加其实就是简单的字符串拼接</span></span><br><span class="line"><span class="string">&#x27;tony18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name * <span class="number">5</span> <span class="comment">#相乘就相当于将字符串相加了5次</span></span><br><span class="line"><span class="string">&#x27;tonytonytonytonytony&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-118b686f12172e202cd10eceb93a2edd_720w.jpg" alt="img"></p>
<h2 id="四-列表list"><a href="#四-列表list" class="headerlink" title="四 列表list"></a>四 列表list</h2><h2 id="4-1-作用"><a href="#4-1-作用" class="headerlink" title="4.1 作用"></a>4.1 作用</h2><p>如果我们需要用一个变量记录多个学生的姓名，用数字类型是无法实现，字符串类型确实可以记录下来，比如</p>
<p>stu_names&#x3D;’张三 李四 王五’，但存的目的是为了取，此时若想取出第二个学生的姓名实现起来相当麻烦，而列表类型就是专门用来记录多个同种属性的值（比如同一个班级多个学生的姓名、同一个人的多个爱好等），并且存取都十分方便</p>
<h2 id="4-2-定义"><a href="#4-2-定义" class="headerlink" title="4.2 定义"></a>4.2 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_names=[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="4-3-使用"><a href="#4-3-使用" class="headerlink" title="4.3 使用"></a>4.3 使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、列表类型是用索引来对应值，索引代表的是数据的位置，从0开始计数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_names=[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_names[<span class="number">0</span>] </span><br><span class="line"><span class="string">&#x27;张三&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_names[<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;李四&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_names[<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;王五&#x27;</span></span><br><span class="line"><span class="comment"># 2、列表可以嵌套，嵌套取值如下</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>students_info=[[<span class="string">&#x27;tony&#x27;</span>,<span class="number">18</span>,[<span class="string">&#x27;jack&#x27;</span>,]],[<span class="string">&#x27;jason&#x27;</span>,<span class="number">18</span>,[<span class="string">&#x27;play&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>]]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>students_info[<span class="number">0</span>][<span class="number">2</span>][<span class="number">0</span>] <span class="comment">#取出第一个学生的第一个爱好</span></span><br><span class="line"><span class="string">&#x27;play&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="五-字典dict"><a href="#五-字典dict" class="headerlink" title="五 字典dict"></a>五 字典dict</h2><h2 id="5-1-作用"><a href="#5-1-作用" class="headerlink" title="5.1 作用"></a>5.1 作用</h2><p>如果我们需要用一个变量记录多个值，但多个值是不同属性的，比如人的姓名、年龄、身高，用列表可以存，但列表是用索引对应值的，而索引不能明确地表示值的含义，这就用到字典类型，字典类型是用key：value形式来存储数据，其中key可以对value有描述性的功能</p>
<h2 id="5-2-定义"><a href="#5-2-定义" class="headerlink" title="5.2 定义"></a>5.2 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>person_info=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;height&#x27;</span>:<span class="number">185.3</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-使用"><a href="#5-3-使用" class="headerlink" title="5.3 使用"></a>5.3 使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、字典类型是用key来对应值，key可以对值有描述性的功能，通常为字符串类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person_info=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;height&#x27;</span>:<span class="number">185.3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person_info[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person_info[<span class="string">&#x27;age&#x27;</span>]</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person_info[<span class="string">&#x27;height&#x27;</span>]</span><br><span class="line"><span class="number">185.3</span></span><br><span class="line"><span class="comment"># 2、字典可以嵌套，嵌套取值如下</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>students=[</span><br><span class="line"><span class="meta">... </span>&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">38</span>,<span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;play&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>]&#125;,</span><br><span class="line"><span class="meta">... </span>&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>]&#125;,</span><br><span class="line"><span class="meta">... </span>&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;rose&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">58</span>,<span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>]&#125;,</span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>students[<span class="number">1</span>][<span class="string">&#x27;hobbies&#x27;</span>][<span class="number">1</span>] <span class="comment">#取第二个学生的第二个爱好</span></span><br><span class="line"><span class="string">&#x27;sleep&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="六-布尔bool"><a href="#六-布尔bool" class="headerlink" title="六 布尔bool"></a>六 布尔bool</h2><h2 id="6-1-作用"><a href="#6-1-作用" class="headerlink" title="6.1 作用"></a>6.1 作用</h2><p>用来记录真假这两种状态</p>
<h2 id="6-2-定义"><a href="#6-2-定义" class="headerlink" title="6.2 定义"></a>6.2 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_ok = <span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_ok = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="6-3-使用"><a href="#6-3-使用" class="headerlink" title="6.3 使用"></a>6.3 使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">通常用来当作判断的条件，我们将在<span class="keyword">if</span>判断中用到它</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-a933426890a5ab350b920e812f7d7b99_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>编辑于 2022-04-26 18:53</p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>03-变量</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/03_Python%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E4%B9%8B%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p>我们知道学习 <strong>Python</strong> 语言的目的是为了与计算机进行沟通&#x2F;交流，从而控制计算机帮助我们做一些事情，所以，在 <strong>Python</strong> 语言的所有语法中，每个语法存在的意义都是为了让计算机能够像人类一样，直白地讲，就是让计算机具备我们人类的某一项技能。这是我们理解后续所有 <strong>Python</strong> 语法的根本，一定要熟记。</p>
<h2 id="二-变量"><a href="#二-变量" class="headerlink" title="二 变量"></a>二 变量</h2><h2 id="一、什么是变量？"><a href="#一、什么是变量？" class="headerlink" title="一、什么是变量？"></a>一、什么是变量？</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 变量就是可以变化的量，量指的是事物的状态，比如人的年龄、性别，游戏角色的等级、金钱等等</span></span><br></pre></td></tr></table></figure>

<h2 id="二、为什么要有变量？"><a href="#二、为什么要有变量？" class="headerlink" title="二、为什么要有变量？"></a>二、为什么要有变量？</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 为了让计算机能够像人一样去记忆事物的某种状态，并且状态是可以发生变化的</span></span><br><span class="line"><span class="comment"># 详细地说：</span></span><br><span class="line"><span class="comment"># 程序执行的本质就是一系列状态的变化，变是程序执行的直接体现，所以我们需要有一种机制能够反映或者说是保存下来程序执行时状态，以及状态的变化。</span></span><br></pre></td></tr></table></figure>



<h2 id="三、怎么使用变量（先定义、后使用）"><a href="#三、怎么使用变量（先定义、后使用）" class="headerlink" title="三、怎么使用变量（先定义、后使用）"></a>三、怎么使用变量（先定义、后使用）</h2><h3 id="3-1、变量的定义与使用"><a href="#3-1、变量的定义与使用" class="headerlink" title="3.1、变量的定义与使用"></a>3.1、变量的定义与使用</h3><p>变量的定义由三部分组成，如下图</p>
<p><img src="/../../../img/image-20220718091017221.png" alt="image-20220718091017221"></p>
<p>定义变量示范如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&#x27;Jason&#x27;</span> <span class="comment"># 记下人的名字为&#x27;Jason&#x27;</span></span><br><span class="line">sex = <span class="string">&#x27;男&#x27;</span>    <span class="comment"># 记下人的性别为男性</span></span><br><span class="line">age = <span class="number">18</span>      <span class="comment"># 记下人的年龄为18岁</span></span><br><span class="line">salary = <span class="number">30000.1</span>  <span class="comment"># 记下人的薪资为30000.1元</span></span><br></pre></td></tr></table></figure>

<p>解释器执行到变量定义的代码时会申请内存空间存放变量值，然后将变量值的内存地址绑定给变量名，以变量的定义age&#x3D;18为例，如下图</p>
<p>插图：定义变量申请内存</p>
<p>通过变量名即可引用到对应的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过变量名即可引用到值，我们可以结合print()功能将其打印出来</span></span><br><span class="line"><span class="built_in">print</span>(age) <span class="comment"># 通过变量名age找到值18，然后执行print(18),输出：18</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2、变量名的命名规范"><a href="#3-2、变量名的命名规范" class="headerlink" title="3.2、变量名的命名规范"></a>3.2、变量名的命名规范</h3><p>变量名的命名应该见名知意</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 如果我们要存储的数据18代表的是一个人的年龄，那么变量名推荐命名为age</span></span><br><span class="line">age = <span class="number">18</span> </span><br><span class="line"><span class="comment"># 如果我们要存储的数据18代表的是一个人的等级，那么变量名推荐命名为level</span></span><br><span class="line">level = <span class="number">18</span></span><br></pre></td></tr></table></figure>

<p>其他详细规范如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命名规范</span></span><br><span class="line"><span class="number">1.</span> 变量名只能是 字母、数字或下划线的任意组合</span><br><span class="line"><span class="number">2.</span> 变量名的第一个字符不能是数字</span><br><span class="line"><span class="number">3.</span> 关键字不能声明为变量名，常用关键字如下</span><br><span class="line">[<span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;as&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;continue&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;del&#x27;</span>, <span class="string">&#x27;elif&#x27;</span>, <span class="string">&#x27;else&#x27;</span>, <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;finally&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;from&#x27;</span>,<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;lambda&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;print&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>, <span class="string">&#x27;return&#x27;</span>, <span class="string">&#x27;try&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;yield&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误示范如下：</span></span><br><span class="line">*a=<span class="number">123</span></span><br><span class="line">$b=<span class="number">456</span></span><br><span class="line">c$=<span class="number">789</span></span><br><span class="line">2_name=<span class="string">&#x27;lili&#x27;</span></span><br><span class="line"><span class="number">123</span>=<span class="string">&#x27;lili&#x27;</span></span><br><span class="line"><span class="keyword">and</span>=<span class="number">123</span></span><br><span class="line">年龄=<span class="number">18</span> <span class="comment"># 强烈建议不要使用中文命名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确示范如下</span></span><br><span class="line">age_of_jason=<span class="number">31</span></span><br><span class="line">page1=<span class="string">&#x27;首页&#x27;</span></span><br><span class="line">_<span class="keyword">class</span>=<span class="string">&#x27;终极一班&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3、变量名的命名风格"><a href="#3-3、变量名的命名风格" class="headerlink" title="3.3、变量名的命名风格"></a>3.3、变量名的命名风格</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 风格一：驼峰体</span></span><br><span class="line">AgeOfTony = <span class="number">56</span> </span><br><span class="line">NumberOfStudents = <span class="number">80</span></span><br><span class="line"><span class="comment"># 风格二：纯小写下划线(在python中，变量名的命名推荐使用该风格)</span></span><br><span class="line">age_of_tony = <span class="number">56</span> </span><br><span class="line">number_of_students = <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4、变量值的三大特性"><a href="#3-4、变量值的三大特性" class="headerlink" title="3.4、变量值的三大特性"></a>3.4、变量值的三大特性</h3><p>变量的值具备三大特性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、id</span></span><br><span class="line">反应的是变量在内存中的唯一编号，内存地址不同<span class="built_in">id</span>肯定不同</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、type</span></span><br><span class="line">变量值的类型</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、value</span></span><br><span class="line">变量值</span><br></pre></td></tr></table></figure>

<p>查看变量值三大特性的方式如下，我们将会在运算符中用到变量值的三大特性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="string">&#x27;Info Tony:18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x),<span class="built_in">type</span>(x),x</span><br><span class="line"><span class="number">4376607152</span>，&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;,&#x27;<span class="title">Info</span> <span class="title">Tony</span>:</span><span class="number">18</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>了解：<a href="https://zhuanlan.zhihu.com/p/113408690">Python是一门解释型的强类型动态语言</a></p>
<h2 id="三、常量"><a href="#三、常量" class="headerlink" title="三、常量"></a>三、常量</h2><h2 id="3-1、什么是常量？"><a href="#3-1、什么是常量？" class="headerlink" title="3.1、什么是常量？"></a>3.1、什么是常量？</h2><p>常量指在程序运行过程中不会改变的量</p>
<h2 id="3-2、为什么要有常量？"><a href="#3-2、为什么要有常量？" class="headerlink" title="3.2、为什么要有常量？"></a>3.2、为什么要有常量？</h2><p>在程序运行过程中，有些值是固定的、不应该被改变，比如圆周率 3.141592653…</p>
<h2 id="3-3、怎么使用常量？"><a href="#3-3、怎么使用常量？" class="headerlink" title="3.3、怎么使用常量？"></a>3.3、怎么使用常量？</h2><p>在Python中没有一个专门的语法定义常量，约定俗成是用全部大写的变量名表示常量。如：PI&#x3D;3.14159。所以单从语法层面去讲，常量的使用与变量完全一致。</p>
<p><img src="/../../../img/image-20220718091033465.png" alt="image-20220718091033465"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=4">https://www.bilibili.com/video/av73342471?p=4www.bilibili.com/video/av73342471?p=4</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>05-垃圾回收机制</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/05_Python%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E4%B9%8B%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p> 解释器在执行到定义变量的语法时，会申请内存空间来存放变量的值，而内存的容量是有限的，这就涉及到变量值所占用内存空间的回收问题，当一个变量值没有用了（简称垃圾）就应该将其占用的内存给回收掉，那什么样的变量值是没有用的呢？</p>
<p>单从逻辑层面分析，我们定义变量将变量值存起来的目的是为了以后取出来使用，而取得变量值需要通过其绑定的直接引用（如x&#x3D;10，10被x直接引用）或间接引用（如l&#x3D;[x,]，x&#x3D;10，10被x直接引用，而被容器类型l间接引用），所以当一个变量值不再绑定任何引用时，我们就无法再访问到该变量值了，该变量值自然就是没有用的，就应该被当成一个垃圾回收。</p>
<p>毫无疑问，内存空间的申请与回收都是非常耗费精力的事情，而且存在很大的危险性，稍有不慎就有可能引发内存溢出问题，好在Cpython解释器提供了自动的垃圾回收机制来帮我们解决了这件事。</p>
<p><img src="https://pic4.zhimg.com/80/v2-fdd6ee1176778e295514ae8f3d0d6053_720w.jpg" alt="img"></p>
<h2 id="二、什么是垃圾回收机制？"><a href="#二、什么是垃圾回收机制？" class="headerlink" title="二、什么是垃圾回收机制？"></a>二、什么是垃圾回收机制？</h2><p>垃圾回收机制（简称GC）是Python解释器自带一种机，专门用来回收不可用的变量值所占用的内存空间</p>
<h2 id="三、为什么要用垃圾回收机制？"><a href="#三、为什么要用垃圾回收机制？" class="headerlink" title="三、为什么要用垃圾回收机制？"></a>三、为什么要用垃圾回收机制？</h2><p>程序运行过程中会申请大量的内存空间，而对于一些无用的内存空间如果不及时清理的话会导致内存使用殆尽（内存溢出），导致程序崩溃，因此管理内存是一件重要且繁杂的事情，而python解释器自带的垃圾回收机制把程序员从繁杂的内存管理中解放出来。</p>
<p><img src="https://pic2.zhimg.com/80/v2-1dade7ff0e1a23520534e517b2cde6b1_720w.jpg" alt="img"></p>
<h2 id="四、垃圾回收机制原理分析"><a href="#四、垃圾回收机制原理分析" class="headerlink" title="四、垃圾回收机制原理分析"></a>四、垃圾回收机制原理分析</h2><p>Python的GC模块主要运用了“引用计数”（reference counting）来跟踪和回收垃圾。在引用计数的基础上，还可以通过“标记-清除”（mark and sweep）解决容器对象可能产生的循环引用的问题，并且通过“分代回收”（generation collection）以空间换取时间的方式来进一步提高垃圾回收的效率。</p>
<p><img src="https://pic1.zhimg.com/80/v2-d0747b871d71091eff8ab5b0ebb6b3b0_720w.jpg" alt="img"></p>
<h2 id="4-1、什么是引用计数？"><a href="#4-1、什么是引用计数？" class="headerlink" title="4.1、什么是引用计数？"></a>4.1、什么是引用计数？</h2><p>引用计数就是：变量值被变量名关联的次数</p>
<p>如：age&#x3D;18</p>
<p>变量值18被关联了一个变量名age，称之为引用计数为1</p>
<p><img src="https://pic3.zhimg.com/80/v2-89915f2dc64db1fe79ce739a233bb09a_720w.jpg" alt="img"></p>
<p>引用计数增加：</p>
<p>age&#x3D;18 （此时，变量值18的引用计数为1）</p>
<p>m&#x3D;age （把age的内存地址给了m，此时，m,age都关联了18，所以变量值18的引用计数为2）</p>
<p><img src="https://pic4.zhimg.com/80/v2-8a46e8993c193017bbbbca370ce6970b_720w.jpg" alt="img"></p>
<p>引用计数减少：</p>
<p>age&#x3D;10（名字age先与值18解除关联，再与3建立了关联，变量值18的引用计数为1）</p>
<p>del m（del的意思是解除变量名x与变量值18的关联关系，此时，变量18的引用计数为0）</p>
<p><img src="https://pic3.zhimg.com/80/v2-6d0ed3fa462194215235ae22888b373a_720w.jpg" alt="img"></p>
<p>值18的引用计数一旦变为0，其占用的内存地址就应该被解释器的垃圾回收机制回收</p>
<h2 id="4-2、引用计数扩展阅读"><a href="#4-2、引用计数扩展阅读" class="headerlink" title="4.2、引用计数扩展阅读"></a>4.2、引用计数扩展阅读</h2><p>变量值被关联次数的增加或减少，都会引发引用计数机制的执行（增加或减少值的引用计数），这存在明显的效率问题。</p>
<p><img src="https://pic1.zhimg.com/80/v2-2876d1bad8466226f58b1edcb84714a0_720w.jpg" alt="img"></p>
<p>如果说执行效率还仅仅是引用计数机制的一个软肋的话，那么很不幸，引用计数机制还存在着一个致命的弱点，即循环引用（也称交叉引用）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 如下我们定义了两个列表，简称列表1与列表2，变量名l1指向列表1，变量名l2指向列表2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1=[<span class="string">&#x27;xxx&#x27;</span>]  <span class="comment"># 列表1被引用一次，列表1的引用计数变为1   </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2=[<span class="string">&#x27;yyy&#x27;</span>]  <span class="comment"># 列表2被引用一次，列表2的引用计数变为1   </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1.append(l2)             <span class="comment"># 把列表2追加到l1中作为第二个元素，列表2的引用计数变为2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2.append(l1)             <span class="comment"># 把列表1追加到l2中作为第二个元素，列表1的引用计数变为2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># l1与l2之间有相互引用</span></span><br><span class="line"><span class="comment"># l1 = [&#x27;xxx&#x27;的内存地址,列表2的内存地址]</span></span><br><span class="line"><span class="comment"># l2 = [&#x27;yyy&#x27;的内存地址,列表1的内存地址]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="string">&#x27;xxx&#x27;</span>, [<span class="string">&#x27;yyy&#x27;</span>, [...]]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2</span><br><span class="line">[<span class="string">&#x27;yyy&#x27;</span>, [<span class="string">&#x27;xxx&#x27;</span>, [...]]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure>

<p>循环引用会导致：值不再被任何名字关联，但是值的引用计数并不会为0，应该被回收但不能被回收，什么意思呢？试想一下，请看如下操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> l1 <span class="comment"># 列表1的引用计数减1，列表1的引用计数变为1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> l2 <span class="comment"># 列表2的引用计数减1，列表2的引用计数变为1</span></span><br></pre></td></tr></table></figure>

<p>此时，只剩下列表1与列表2之间的相互引用，两个列表的引用计数均不为0，但两个列表不再被任何其他对象关联，没有任何人可以再引用到它们，所以它俩占用内存空间应该被回收，但由于相互引用的存在，每一个对象的引用计数都不为0，因此这些对象所占用的内存永远不会被释放，所以循环引用是致命的，这与手动进行内存管理所产生的内存泄露毫无区别。 所以Python引入了“标记-清除” 与“分代回收”来分别解决引用计数的循环引用与效率低的问题</p>
<p><img src="https://pic1.zhimg.com/80/v2-3c62f9500a8809200caa264257b93b14_720w.jpg" alt="img"></p>
<h3 id="4-2-1-标记-清除"><a href="#4-2-1-标记-清除" class="headerlink" title="4.2.1 标记-清除"></a>4.2.1 标记-清除</h3><p>容器对象（比如：list，set，dict，class，instance）都可以包含对其他对象的引用，所以都可能产生循环引用。而“标记-清除”计数就是为了解决循环引用的问题。</p>
<p>在了解标记清除算法前，我们需要明确一点，关于变量的存储，内存中有两块区域：堆区与栈区，在定义变量时，变量名与值内存地址的关联关系存放于栈区，变量值存放于堆区，内存管理回收的则是堆区的内容，详解如下图,</p>
<p>定义了两个变量x &#x3D; 10、y &#x3D; 20</p>
<p><img src="https://pic1.zhimg.com/80/v2-73d5845ef7dc5a403333d2099d456fc0_720w.jpg" alt="img"></p>
<p>当我们执行x&#x3D;y时，内存中的栈区与堆区变化如下</p>
<p><img src="https://pic1.zhimg.com/80/v2-9ec5b20fd2c2d2e9c90194d57bcf7778_720w.jpg" alt="img"></p>
<p>标记&#x2F;清除算法的做法是当应用程序可用的内存空间被耗尽的时，就会停止整个程序，然后进行两项工作，第一项则是标记，第二项则是清除</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、标记</span></span><br><span class="line">通俗地讲就是：标记的过程就行相当于从栈区出发一条线，“连接”到堆区，再由堆区间接“连接”到其他地址，凡是被这条自栈区起始的线连接到内存空间都属于可以访达的，会被标记为存活</span><br><span class="line"></span><br><span class="line">具体地：标记的过程其实就是，遍历所有的GC Roots对象(栈区中的所有内容或者线程都可以作为GC Roots对象），然后将所有GC Roots的对象可以直接或间接访问到的对象标记为存活的对象，其余的均为非存活对象，应该被清除。</span><br><span class="line">                          </span><br><span class="line"><span class="comment">#2、清除</span></span><br><span class="line">清除的过程将遍历堆中所有的对象，将没有标记存活的对象全部清除掉。</span><br></pre></td></tr></table></figure>

<p>直接引用指的是从栈区出发直接引用到的内存地址，间接引用指的是从栈区出发引用到堆区后再进一步引用到的内存地址，以我们之前的两个列表l1与l2为例画出如下图像</p>
<p><img src="https://pic3.zhimg.com/80/v2-1bfee07a84fc747da5980d990430d10a_720w.jpg" alt="img"></p>
<p>当我们同时删除l1与l2时，会清理到栈区中l1与l2的内容</p>
<p><img src="https://pic2.zhimg.com/80/v2-509de2bd1adfb0566368719c73620fbd_720w.jpg" alt="img"></p>
<p>这样在启用标记清除算法时，发现栈区内不再有l1与l2（只剩下堆区内二者的相互引用），于是列表1与列表2都没有被标记为存活，二者会被清理掉，这样就解决了循环引用带来的内存泄漏问题。</p>
<h3 id="4-2-2-分代回收"><a href="#4-2-2-分代回收" class="headerlink" title="4.2.2 分代回收"></a>4.2.2 分代回收</h3><p>背景：</p>
<p>基于引用计数的回收机制，每次回收内存，都需要把所有对象的引用计数都遍历一遍，这是非常消耗时间的，于是引入了分代回收来提高回收效率，分代回收采用的是用“空间换时间”的策略。</p>
<p><strong>分代：</strong></p>
<p>分代回收的核心思想是：在历经多次扫描的情况下，都没有被回收的变量，gc机制就会认为，该变量是常用变量，gc对其扫描的频率会降低，具体实现原理如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">分代指的是根据存活时间来为变量划分不同等级（也就是不同的代）</span><br><span class="line"></span><br><span class="line">新定义的变量，放到新生代这个等级中，假设每隔<span class="number">1</span>分钟扫描新生代一次，如果发现变量依然被引用，那么该对象的权重（权重本质就是个整数）加一，当变量的权重大于某个设定得值（假设为<span class="number">3</span>），会将它移动到更高一级的青春代，青春代的gc扫描的频率低于新生代（扫描时间间隔更长），假设<span class="number">5</span>分钟扫描青春代一次，这样每次gc需要扫描的变量的总个数就变少了，节省了扫描的总时间，接下来，青春代中的对象，也会以同样的方式被移动到老年代中。也就是等级（代）越高，被垃圾回收机制扫描的频率越低</span><br></pre></td></tr></table></figure>

<p><strong>回收：</strong></p>
<p>回收依然是使用引用计数作为回收的依据</p>
<p><img src="https://pic1.zhimg.com/80/v2-2458685b385b338192d6b90628ed92a8_720w.jpg" alt="img"></p>
<p>虽然分代回收可以起到提升效率的效果，但也存在一定的缺点：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如一个变量刚刚从新生代移入青春代，该变量的绑定关系就解除了，该变量应该被回收，但青春代的扫描频率低于新生代，</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>06-用户交互与运算符</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/06_Python%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E4%B9%8B%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/</url>
    <content><![CDATA[<h2 id="一-程序与用户交互"><a href="#一-程序与用户交互" class="headerlink" title="一 程序与用户交互"></a>一 程序与用户交互</h2><h2 id="1-1、什么是与用户交互"><a href="#1-1、什么是与用户交互" class="headerlink" title="1.1、什么是与用户交互"></a>1.1、什么是与用户交互</h2><p>用户交互就是人往计算机中input&#x2F;输入数据，计算机print&#x2F;输出结果</p>
<h2 id="1-2、为什么要与用户交互？"><a href="#1-2、为什么要与用户交互？" class="headerlink" title="1.2、为什么要与用户交互？"></a>1.2、为什么要与用户交互？</h2><p><img src="https://pic2.zhimg.com/80/v2-f5f08a362ab78e8bc5ccce6bb1d3603d_720w.jpg" alt="img"></p>
<p>为了让计算机能够像人一样与用户沟通交流</p>
<p>比如，过去我们去银行取钱，用户需要把帐号密码告诉柜员，而现在，柜员被ATM机取代，ATM机就是一台计算机，所以用户同样需要将帐号密码告诉计算机，于是我们的程序中必须有相应的机制来控制计算机接收用户输入的内容，并且输出结果</p>
<h2 id="1-3、如何与用户交互"><a href="#1-3、如何与用户交互" class="headerlink" title="1.3、如何与用户交互"></a>1.3、如何与用户交互</h2><p><img src="https://pic2.zhimg.com/80/v2-d3247fc02443c3095673598cb86ed189_720w.jpg" alt="img"></p>
<p>交互的本质就是输入、输出</p>
<h3 id="1-3-1-输入input"><a href="#1-3-1-输入input" class="headerlink" title="1.3.1 输入input:"></a>1.3.1 输入input:</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在python3中input功能会等待用户的输入，用户输入任何内容，都存成字符串类型，然后赋值给等号左边的变量名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>username=<span class="built_in">input</span>(<span class="string">&#x27;请输入您的用户名：&#x27;</span>) </span><br><span class="line">请输入您的用户名：jack <span class="comment"># username = &quot;jack&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>password=<span class="built_in">input</span>(<span class="string">&#x27;请输入您的密码：&#x27;</span>) </span><br><span class="line">请输入您的密码：<span class="number">123</span> <span class="comment"># password = &quot;123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 了解知识：</span></span><br><span class="line"><span class="comment"># 1、在python2中存在一个raw_input功能与python3中的input功能一模一样</span></span><br><span class="line"><span class="comment"># 2、在python2中还存在一个input功能，需要用户输入一个明确的数据类型，输入什么类型就存成什么类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l=<span class="built_in">input</span>(<span class="string">&#x27;输入什么类型就存成什么类型: &#x27;</span>)</span><br><span class="line">输入什么类型就存成什么类型: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(l)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;list&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-输出print"><a href="#1-3-2-输出print" class="headerlink" title="1.3.2 输出print:"></a>1.3.2 输出print:</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>)  <span class="comment"># 只输出一个值</span></span><br><span class="line">hello world</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;first&#x27;</span>,<span class="string">&#x27;second&#x27;</span>,<span class="string">&#x27;third&#x27;</span>)  <span class="comment"># 一次性输出多个值，值用逗号隔开</span></span><br><span class="line">first second third</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认print功能有一个end参数，该参数的默认值为&quot;\n&quot;(代表换行)，可以将end参数的值改成任意其它字符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;aaaa&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;bbbb&quot;</span>,end=<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cccc&quot;</span>,end=<span class="string">&#x27;@&#x27;</span>)</span><br><span class="line"><span class="comment">#整体输出结果为：aaaabbbb&amp;cccc@</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-输出之格式化输出"><a href="#1-3-3-输出之格式化输出" class="headerlink" title="1.3.3 输出之格式化输出"></a>1.3.3 输出之格式化输出</h3><h3 id="1-什么是格式化输出？"><a href="#1-什么是格式化输出？" class="headerlink" title="(1)什么是格式化输出？"></a>(1)什么是格式化输出？</h3><p>把一段字符串里面的某些内容替换掉之后再输出，就是格式化输出。</p>
<h3 id="2-为什么要格式化输出？"><a href="#2-为什么要格式化输出？" class="headerlink" title="(2)为什么要格式化输出？"></a>(2)为什么要格式化输出？</h3><p>我们经常会输出具有某种固定格式的内容，比如：’亲爱的xxx你好！你xxx月的话费是xxx，余额是xxx‘，我们需要做的就是将xxx替换为具体的内容。</p>
<p><img src="https://pic4.zhimg.com/80/v2-93a076f4317dfc4d18eeb0e4bd4ae21f_720w.jpg" alt="img"></p>
<h3 id="3-如何格式化输出？"><a href="#3-如何格式化输出？" class="headerlink" title="(3)如何格式化输出？"></a>(3)如何格式化输出？</h3><p>这就用到了占位符，如：%s、%d：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># %s占位符：可以接收任意类型的值</span></span><br><span class="line"><span class="comment"># %d占位符：只能接收数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;亲爱的%s你好！你%s月的话费是%d，余额是%d&#x27;</span> %(<span class="string">&#x27;tony&#x27;</span>,<span class="number">12</span>,<span class="number">103</span>,<span class="number">11</span>))</span><br><span class="line">亲爱的tony你好！你<span class="number">12</span>月的话费是<span class="number">103</span>，余额是<span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 练习1：接收用户输入，打印成指定格式</span></span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&#x27;your name: &#x27;</span>)</span><br><span class="line">age = <span class="built_in">input</span>(<span class="string">&#x27;your age: &#x27;</span>) <span class="comment">#用户输入18,会存成字符串18,无法传给%d</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;My name is %s,my age is %s&#x27;</span> %(name,age))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 练习2：用户输入姓名、年龄、工作、爱好 ，然后打印成以下格式</span></span><br><span class="line">------------ info of Tony -----------</span><br><span class="line">Name  : Tony</span><br><span class="line">Age   : <span class="number">22</span></span><br><span class="line">Sex   : male</span><br><span class="line">Job   : Teacher </span><br><span class="line">------------- end -----------------</span><br></pre></td></tr></table></figure>

<h2 id="二-基本运算符"><a href="#二-基本运算符" class="headerlink" title="二 基本运算符"></a>二 基本运算符</h2><h2 id="2-1-算术运算符"><a href="#2-1-算术运算符" class="headerlink" title="2.1 算术运算符"></a>2.1 算术运算符</h2><p> python支持的算数运算符与数学上计算的符号使用是一致的，我们以x&#x3D;9，y&#x3D;2为例来依次介绍它们</p>
<p><img src="https://pic3.zhimg.com/80/v2-1e691dd00888ffbc6a6a91fd6b871fb2_720w.jpg" alt="img"></p>
<h2 id="2-2-比较运算符"><a href="#2-2-比较运算符" class="headerlink" title="2.2 比较运算符"></a>2.2 比较运算符</h2><p> 比较运算用来对两个值进行比较，返回的是布尔值True或False，我们以x&#x3D;9，y&#x3D;2为例来依次介绍它们</p>
<p><img src="https://pic2.zhimg.com/80/v2-4f35183b1ef049ae8e0dff21aa18bd35_720w.jpg" alt="img"></p>
<h2 id="2-3-赋值运算符"><a href="#2-3-赋值运算符" class="headerlink" title="2.3 赋值运算符"></a>2.3 赋值运算符</h2><p> python语法中除了有&#x3D;号这种简单的赋值运算外，还支持增量赋值、链式赋值、交叉赋值、解压赋值，这些赋值运算符存在的意义都是为了让我们的代码看起来更加精简。我们以x&#x3D;9，y&#x3D;2为例先来介绍一下增量赋值</p>
<h3 id="2-3-1-增量赋值"><a href="#2-3-1-增量赋值" class="headerlink" title="2.3.1 增量赋值"></a>2.3.1 增量赋值</h3><p><img src="https://pic4.zhimg.com/80/v2-b70005b039398a63c6e28fe7d31ab147_720w.jpg" alt="img"></p>
<h3 id="2-3-2-链式赋值"><a href="#2-3-2-链式赋值" class="headerlink" title="2.3.2 链式赋值"></a>2.3.2 链式赋值</h3><p>如果我们想把同一个值同时赋值给多个变量名，可以这么做</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>z=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y=z</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y,z</span><br><span class="line">(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>链式赋值指的是可以用一行代码搞定这件事</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=y=z=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y,z</span><br><span class="line">(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-5e10781fb6adb37f49a50623547bd2be_720w.jpg" alt="img"></p>
<h3 id="2-3-3-交叉赋值"><a href="#2-3-3-交叉赋值" class="headerlink" title="2.3.3 交叉赋值"></a>2.3.3 交叉赋值</h3><p>我们定义两个变量m与n</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=<span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>如果我们想将m与n的值交换过来，可以这么做</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>temp=m</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=n</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=temp</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n</span><br><span class="line">(<span class="number">20</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>交叉赋值指的是一行代码可以搞定这件事</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>m=<span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n=<span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n=n,m <span class="comment"># 交叉赋值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m,n</span><br><span class="line">(<span class="number">20</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-32d5097d72f9a856c249dc65d94ae965_720w.jpg" alt="img"></p>
<h3 id="2-3-4-解压赋值"><a href="#2-3-4-解压赋值" class="headerlink" title="2.3.4 解压赋值"></a>2.3.4 解压赋值</h3><p>如果我们想把列表中的多个值取出来依次赋值给多个变量名，可以这么做</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums=[<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=nums[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=nums[<span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c=nums[<span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d=nums[<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e=nums[<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>)</span><br></pre></td></tr></table></figure>

<p>解压赋值指的是一行代码可以搞定这件事</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e=nums <span class="comment"># nums包含多个值，就好比一个压缩包，解压赋值因此得名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-5136e82ba7ecce9e31b751b9e3075c5e_720w.jpg" alt="img"></p>
<p>注意，上述解压赋值，等号左边的变量名个数必须与右面包含值的个数相同,否则会报错</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、变量名少了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b=nums</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: too many values to unpack (expected <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、变量名多了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,c,d,e,f=nums</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: <span class="keyword">not</span> enough values to unpack (expected <span class="number">6</span>, got <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>但如果我们只想取头尾的几个值，可以用*_匹配</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b,*_=nums</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a,b</span><br><span class="line">(<span class="number">11</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<p>ps：字符串、字典、元组、集合类型都支持解压赋值</p>
<p><img src="https://pic1.zhimg.com/80/v2-4d0554fbbd86747cc7aab9fcc5d0ebd8_720w.jpg" alt="img"></p>
<h2 id="2-4-逻辑运算符"><a href="#2-4-逻辑运算符" class="headerlink" title="2.4 逻辑运算符"></a>2.4 逻辑运算符</h2><p> 逻辑运算符用于连接多个条件，进行关联判断，会返回布尔值True或False</p>
<p><img src="https://pic2.zhimg.com/80/v2-e4c3abe3eeb2546d6d093f1e5d690055_720w.jpg" alt="img"></p>
<h3 id="2-4-1-连续多个and"><a href="#2-4-1-连续多个and" class="headerlink" title="2.4.1 连续多个and"></a>2.4.1 连续多个and</h3><p>可以用and连接多个条件，会按照从左到右的顺序依次判断，一旦某一个条件为False，则无需再往右判断，可以立即判定最终结果就为False，只有在所有条件的结果都为True的情况下，最终结果才为True。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> != <span class="number">1</span> <span class="keyword">and</span> <span class="literal">True</span> <span class="keyword">and</span> <span class="number">3</span> &gt; <span class="number">2</span> <span class="comment"># 判断完第二个条件，就立即结束，得的最终结果为False</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-连续多个or"><a href="#2-4-2-连续多个or" class="headerlink" title="2.4.2 连续多个or"></a>2.4.2 连续多个or</h3><p>可以用or连接多个条件，会按照从左到右的顺序依次判断，一旦某一个条件为True，则无需再往右判断，可以立即判定最终结果就为True，只有在所有条件的结果都为False的情况下，最终结果才为False</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> &gt; <span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span> != <span class="number">1</span> <span class="keyword">or</span> <span class="literal">True</span> <span class="keyword">or</span> <span class="number">3</span> &gt; <span class="number">2</span> <span class="comment"># 判断完第一个条件，就立即结束，得的最终结果为True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-优先级not-gt-and-gt-or"><a href="#2-4-3-优先级not-gt-and-gt-or" class="headerlink" title="2.4.3 优先级not&gt;and&gt;or"></a>2.4.3 优先级not&gt;and&gt;or</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、三者的优先级关系：not&gt;and&gt;or，同一优先级默认从左往右计算。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span>&gt;<span class="number">4</span> <span class="keyword">and</span> <span class="number">4</span>&gt;<span class="number">3</span> <span class="keyword">or</span> <span class="number">1</span>==<span class="number">3</span> <span class="keyword">and</span> <span class="string">&#x27;x&#x27;</span> == <span class="string">&#x27;x&#x27;</span> <span class="keyword">or</span> <span class="number">3</span> &gt;<span class="number">3</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、最好使用括号来区别优先级，其实意义与上面的一样</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">原理为：</span></span><br><span class="line"><span class="string">(1) not的优先级最高，就是把紧跟其后的那个条件结果取反，所以not与紧跟其后的条件不可分割</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(2) 如果语句中全部是用and连接，或者全部用or连接，那么按照从左到右的顺序依次计算即可</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(3) 如果语句中既有and也有or，那么先用括号把and的左右两个条件给括起来，然后再进行运算</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">3</span>&gt;<span class="number">4</span> <span class="keyword">and</span> <span class="number">4</span>&gt;<span class="number">3</span>) <span class="keyword">or</span> (<span class="number">1</span>==<span class="number">3</span> <span class="keyword">and</span> <span class="string">&#x27;x&#x27;</span> == <span class="string">&#x27;x&#x27;</span>) <span class="keyword">or</span> <span class="number">3</span> &gt;<span class="number">3</span></span><br><span class="line"><span class="literal">False</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#3、短路运算：逻辑运算的结果一旦可以确定，那么就以当前处计算到的值作为最终结果返回</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">or</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;egon&#x27;</span> == <span class="string">&#x27;dsb&#x27;</span> <span class="keyword">and</span> <span class="number">333</span> <span class="keyword">or</span> <span class="number">10</span> &gt; <span class="number">4</span></span><br><span class="line">我们用括号来明确一下优先级</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">10</span> <span class="keyword">and</span> <span class="number">0</span>) <span class="keyword">or</span> (<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">0</span>) <span class="keyword">or</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">or</span> (<span class="string">&#x27;egon&#x27;</span> == <span class="string">&#x27;dsb&#x27;</span> <span class="keyword">and</span> <span class="number">333</span>) <span class="keyword">or</span> <span class="number">10</span> &gt; <span class="number">4</span></span><br><span class="line">短路：       <span class="number">0</span>      <span class="string">&#x27;&#x27;</span>            <span class="string">&#x27;abc&#x27;</span>                    </span><br><span class="line">            假     假              真</span><br><span class="line"></span><br><span class="line">返回：                            <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4、短路运算面试题：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">or</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">or</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">or</span> <span class="literal">False</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="literal">False</span> </span><br></pre></td></tr></table></figure>

<h2 id="2-5-成员运算符"><a href="#2-5-成员运算符" class="headerlink" title="2.5 成员运算符"></a>2.5 成员运算符</h2><p><img src="https://pic1.zhimg.com/80/v2-beecc7750f15f6600edce6b64ee41c18_720w.jpg" alt="img"></p>
<p>注意：虽然下述两种判断可以达到相同的效果，但我们推荐使用第二种格式，因为not in语义更加明确</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> <span class="string">&#x27;lili&#x27;</span> <span class="keyword">in</span> [<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;robin&#x27;</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;lili&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;robin&#x27;</span>]</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-身份运算符"><a href="#2-6-身份运算符" class="headerlink" title="2.6 身份运算符"></a>2.6 身份运算符</h2><p><img src="https://pic3.zhimg.com/80/v2-7a653e8151847e64a6b97d6488e51766_720w.jpg" alt="img"></p>
<p>需要强调的是：&#x3D;&#x3D;双等号比较的是value是否相等，而is比较的是id是否相等</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1. id相同，内存地址必定相同，意味着type和value必定相同</span></span><br><span class="line"><span class="comment">#2. value相同type肯定相同，但id可能不同,如下</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="string">&#x27;Info Tony:18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y=<span class="string">&#x27;Info Tony:18&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x),<span class="built_in">id</span>(y) <span class="comment"># x与y的id不同，但是二者的值相同</span></span><br><span class="line">(<span class="number">4327422640</span>, <span class="number">4327422256</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x == y <span class="comment"># 等号比较的是value</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(x),<span class="built_in">type</span>(y) <span class="comment"># 值相同type肯定相同</span></span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">str</span>&#x27;&gt;)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">x</span> <span class="title">is</span> <span class="title">y</span> # <span class="title">is</span>比较的是<span class="title">id</span>，<span class="title">x</span>与<span class="title">y</span>的值相等但<span class="title">id</span>可以不同</span></span><br><span class="line"><span class="class"><span class="title">False</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-4b1be1c9b8e933ac37e47cf14f58503b_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>1、与用户交互：</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471/?p=5">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471/?p=5<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>2、运算符：</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=9">https://www.bilibili.com/video/av73342471?p=9www.bilibili.com/video/av73342471?p=9</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>07-流程控制</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/07_Python%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<h2 id="一-引子："><a href="#一-引子：" class="headerlink" title="一 引子："></a>一 引子：</h2><p>流程控制即控制流程，具体指控制程序的执行流程，而程序的执行流程分为三种结构：顺序结构（之前我们写的代码都是顺序结构）、分支结构（用到if判断）、循环结构（用到while与for）</p>
<p><img src="https://pic3.zhimg.com/80/v2-1c94b67e61036b4b8029f1ff0e04021e_720w.jpg" alt="img"></p>
<h2 id="二-分支结构"><a href="#二-分支结构" class="headerlink" title="二 分支结构"></a>二 分支结构</h2><h2 id="2-1-什么是分支结构"><a href="#2-1-什么是分支结构" class="headerlink" title="2.1 什么是分支结构"></a>2.1 什么是分支结构</h2><p>分支结构就是根据条件判断的真假去执行不同分支对应的子代码</p>
<h2 id="2-2-为什么要用分支结构"><a href="#2-2-为什么要用分支结构" class="headerlink" title="2.2 为什么要用分支结构"></a>2.2 为什么要用分支结构</h2><p>人类某些时候需要根据条件来决定做什么事情，比如：如果今天下雨，就带伞</p>
<p>所以程序中必须有相应的机制来控制计算机具备人的这种判断能力</p>
<h2 id="2-3-如何使用分支结构"><a href="#2-3-如何使用分支结构" class="headerlink" title="2.3 如何使用分支结构"></a>2.3 如何使用分支结构</h2><h3 id="2-3-1-if语法"><a href="#2-3-1-if语法" class="headerlink" title="2.3.1 if语法"></a>2.3.1 if语法</h3><p><img src="https://pic3.zhimg.com/80/v2-a75171615cb658ae9bb3db7afabc6846_720w.jpg" alt="img"></p>
<p>用if关键字来实现分支结构，完整语法如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件<span class="number">1</span>:   <span class="comment"># 如果条件1的结果为True，就依次执行：代码1、代码2，......</span></span><br><span class="line">  　代码<span class="number">1</span></span><br><span class="line">    代码<span class="number">2</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">elif</span> 条件<span class="number">2</span>: <span class="comment"># 如果条件2的结果为True，就依次执行：代码3、代码4，......</span></span><br><span class="line">  　代码<span class="number">3</span></span><br><span class="line">    代码<span class="number">4</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">elif</span> 条件<span class="number">3</span>: <span class="comment"># 如果条件3的结果为True，就依次执行：代码5、代码6，......</span></span><br><span class="line">  　代码<span class="number">5</span></span><br><span class="line">    代码<span class="number">6</span></span><br><span class="line">    ......</span><br><span class="line"><span class="keyword">else</span>:　　   <span class="comment"># 其它情况，就依次执行：代码7、代码8，......</span></span><br><span class="line">    代码<span class="number">7</span></span><br><span class="line">    代码<span class="number">8</span></span><br><span class="line">    ......</span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 1、python用相同缩进(4个空格表示一个缩进)来标识一组代码块，同一组代码会自上而下依次运行</span></span><br><span class="line"><span class="comment"># 2、条件可以是任意表达式，但执行结果必须为布尔类型</span></span><br><span class="line">     <span class="comment"># 在if判断中所有的数据类型也都会自动转换成布尔类型</span></span><br><span class="line">       <span class="comment"># 2.1、None，0，空（空字符串，空列表，空字典等）三种情况下转换成的布尔值为False</span></span><br><span class="line">       <span class="comment"># 2.2、其余均为True</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-if应用案例"><a href="#2-3-2-if应用案例" class="headerlink" title="2.3.2 if应用案例"></a>2.3.2 if应用案例</h3><p><img src="https://pic4.zhimg.com/80/v2-0dff1efd05c82779f08db912b84ed5a3_720w.jpg" alt="img"></p>
<p>案例1：</p>
<p>如果：女人的年龄&gt;30岁，那么：叫阿姨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">age_of_girl=31</span><br><span class="line">if age_of_girl &gt; 30:</span><br><span class="line">    print(&#x27;阿姨好&#x27;)</span><br></pre></td></tr></table></figure>

<p>案例2：</p>
<p>如果：女人的年龄&gt;30岁，那么：叫阿姨，否则：叫小姐</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">age_of_girl=18</span><br><span class="line">if age_of_girl &gt; 30:</span><br><span class="line">    print(&#x27;阿姨好&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;小姐好&#x27;)</span><br></pre></td></tr></table></figure>

<p>案例3：</p>
<p>如果：女人的年龄&gt;&#x3D;18并且&lt;22岁并且身高&gt;170并且体重&lt;100并且是漂亮的，那么：表白，否则：叫阿姨**</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">age_of_girl=18</span><br><span class="line">height=171</span><br><span class="line">weight=99</span><br><span class="line">is_pretty=True</span><br><span class="line">if age_of_girl &gt;= 18 and age_of_girl &lt; 22 and height &gt; 170 and weight &lt; 100 and is_pretty == True:</span><br><span class="line">    print(&#x27;表白...&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;阿姨好&#x27;)</span><br></pre></td></tr></table></figure>

<p>案例4：</p>
<p>如果：成绩&gt;&#x3D;90，那么：优秀</p>
<p>如果成绩&gt;&#x3D;80且&lt;90,那么：良好</p>
<p>如果成绩&gt;&#x3D;70且&lt;80,那么：普通</p>
<p>其他情况：很差</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">score=<span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;: &#x27;</span>)</span><br><span class="line">score=<span class="built_in">int</span>(score)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;优秀&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;良好&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">70</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;普通&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;很差&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>案例5：if嵌套</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#在表白的基础上继续：</span><br><span class="line">#如果表白成功，那么：在一起</span><br><span class="line">#否则：打印。。。</span><br><span class="line"></span><br><span class="line">age_of_girl=18</span><br><span class="line">height=171</span><br><span class="line">weight=99</span><br><span class="line">is_pretty=True</span><br><span class="line">success=False</span><br><span class="line"></span><br><span class="line">if age_of_girl &gt;= 18 and age_of_girl &lt; 22 and height &gt; 170 and weight &lt; 100 and is_pretty == True:</span><br><span class="line">    if success:</span><br><span class="line">        print(&#x27;表白成功,在一起&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;什么爱情不爱情的,爱nmlgb的爱情,爱nmlg啊...&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;阿姨好&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-3a90716a58a4458640aee154894b0bd2_720w.jpg" alt="img"></p>
<p>练习1: 登陆功能</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name=<span class="built_in">input</span>(<span class="string">&#x27;请输入用户名字：&#x27;</span>).strip()</span><br><span class="line">password=<span class="built_in">input</span>(<span class="string">&#x27;请输入密码：&#x27;</span>).strip()</span><br><span class="line"><span class="keyword">if</span> name == <span class="string">&#x27;tony&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;tony login success&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;用户名或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>练习2：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#根据用户输入内容打印其权限</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">egon --&gt; 超级管理员</span><br><span class="line">tom  --&gt; 普通管理员</span><br><span class="line">jack,rain --&gt; 业务主管</span><br><span class="line">其他 --&gt; 普通用户</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">name=input(&#x27;请输入用户名字：&#x27;)</span><br><span class="line"></span><br><span class="line">if name == &#x27;egon&#x27;:</span><br><span class="line">    print(&#x27;超级管理员&#x27;)</span><br><span class="line">elif name == &#x27;tom&#x27;:</span><br><span class="line">    print(&#x27;普通管理员&#x27;)</span><br><span class="line">elif name == &#x27;jack&#x27; or name == &#x27;rain&#x27;:</span><br><span class="line">    print(&#x27;业务主管&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;普通用户&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="三-循环结构"><a href="#三-循环结构" class="headerlink" title="三 循环结构"></a>三 循环结构</h2><h2 id="3-1-什么是循环结构"><a href="#3-1-什么是循环结构" class="headerlink" title="3.1 什么是循环结构"></a>3.1 什么是循环结构</h2><p>循环结构就是重复执行某段代码块</p>
<h2 id="3-2-为什么要用循环结构"><a href="#3-2-为什么要用循环结构" class="headerlink" title="3.2 为什么要用循环结构"></a>3.2 为什么要用循环结构</h2><p><img src="https://pic4.zhimg.com/80/v2-f174b482ecf2583633bd31e3a13f8e8b_720w.jpg" alt="img"></p>
<p>人类某些时候需要重复做某件事情</p>
<p>所以程序中必须有相应的机制来控制计算机具备人的这种循环做事的能力</p>
<h2 id="3-3-如何使用循环结构"><a href="#3-3-如何使用循环结构" class="headerlink" title="3.3 如何使用循环结构"></a>3.3 如何使用循环结构</h2><h3 id="3-3-1-while循环语法"><a href="#3-3-1-while循环语法" class="headerlink" title="3.3.1 while循环语法"></a>3.3.1 while循环语法</h3><p><img src="https://pic4.zhimg.com/80/v2-43c2d731786fa1b75f5e45b55f0cf833_720w.jpg" alt="img"></p>
<p>python中有while与for两种循环机制，其中while循环称之为条件循环，语法如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">     代码<span class="number">1</span>     </span><br><span class="line">     代码<span class="number">2</span>     </span><br><span class="line">     代码<span class="number">3</span></span><br><span class="line"><span class="keyword">while</span>的运行步骤：</span><br><span class="line">步骤<span class="number">1</span>：如果条件为真，那么依次执行：代码<span class="number">1</span>、代码<span class="number">2</span>、代码<span class="number">3</span>、......</span><br><span class="line">步骤<span class="number">2</span>：执行完毕后再次判断条件,如果条件为<span class="literal">True</span>则再次执行：代码<span class="number">1</span>、代码<span class="number">2</span>、代码<span class="number">3</span>、......，如果条件为<span class="literal">False</span>,则循环终止</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-6f56fdbd7d92dd2a7ce02573d950136a_720w.jpg" alt="img"></p>
<h3 id="3-3-2-while循环应用案例"><a href="#3-3-2-while循环应用案例" class="headerlink" title="3.3.2 while循环应用案例"></a>3.3.2 while循环应用案例</h3><p><img src="https://pic4.zhimg.com/80/v2-0dff1efd05c82779f08db912b84ed5a3_720w.jpg" alt="img"></p>
<p>案例一：while循环的基本使用</p>
<p>用户认证程序</p>
<p><img src="https://pic2.zhimg.com/80/v2-72163eb478e754fbfd478839c5cbf845_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用户认证程序的基本逻辑就是接收用户输入的用户名密码然后与程序中存放的用户名密码进行判断，判断成功则登陆成功，判断失败则输出账号或密码错误</span></span><br><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line"></span><br><span class="line">inp_name =  <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">inp_pwd =  <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line"><span class="comment">#通常认证失败的情况下，会要求用户重新输入用户名和密码进行验证，如果我们想给用户三次试错机会，本质就是将上述代码重复运行三遍，你总不会想着把代码复制3次吧。。。。</span></span><br><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次验证</span></span><br><span class="line">inp_name =  <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">inp_pwd =  <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二次验证</span></span><br><span class="line">inp_name =  <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">inp_pwd =  <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三次验证</span></span><br><span class="line">inp_name =  <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">inp_pwd =  <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#即使是小白的你，也觉得的太low了是不是，以后要修改功能还得修改3次，因此记住，写重复的代码是程序员最不耻的行为。</span></span><br><span class="line"><span class="comment">#那么如何做到不用写重复代码又能让程序重复一段代码多次呢？ 循环语句就派上用场啦（使用while循环实现）</span></span><br><span class="line"></span><br><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment"># 记录错误验证的次数</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    inp_name = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    inp_pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>案例二：while+break的使用</p>
<p>使用了while循环后，代码确实精简多了，但问题是用户输入正确的用户名密码以后无法结束循环，那如何结束掉一个循环呢？这就需要用到break了！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment"># 记录错误验证的次数</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    inp_name = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    inp_pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span> <span class="comment"># 用于结束本层循环</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>案例三：while循环嵌套+break</p>
<p>如果while循环嵌套了很多层，要想退出每一层循环则需要在每一层循环都有一个break</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:  <span class="comment"># 第一层循环</span></span><br><span class="line">    inp_name = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    inp_pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># 第二层循环</span></span><br><span class="line">            cmd = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;: &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> cmd == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span>  <span class="comment"># 用于结束本层循环，即第二层循环</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;run &lt;%s&gt;&#x27;</span> % cmd)</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># 用于结束本层循环，即第一层循环</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>案例四：while循环嵌套+tag的使用</p>
<p>针对嵌套多层的while循环，如果我们的目的很明确就是要在某一层直接退出所有层的循环，其实有一个窍门，就让所有while循环的条件都用同一个变量，该变量的初始值为True，一旦在某一层将该变量的值改成False，则所有层的循环都结束</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username = <span class="string">&quot;jason&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">tag = <span class="literal">True</span></span><br><span class="line"><span class="keyword">while</span> tag: </span><br><span class="line">    inp_name = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    inp_pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> inp_name == username <span class="keyword">and</span> inp_pwd == password:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登陆成功&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> tag:  </span><br><span class="line">            cmd = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;: &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> cmd == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">                tag = <span class="literal">False</span>  <span class="comment"># tag变为False， 所有while循环的条件都变为False </span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;run &lt;%s&gt;&#x27;</span> % cmd)</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># 用于结束本层循环，即第一层循环</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名或密码错误！&quot;</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>案例五：while+continue的使用</p>
<p>break代表结束本层循环，而continue则用于结束本次循环，直接进入下一次循环</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打印1到10之间，除7以外的所有数字</span></span><br><span class="line">number=<span class="number">11</span></span><br><span class="line"><span class="keyword">while</span> number&gt;<span class="number">1</span>:</span><br><span class="line">    number -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> number==<span class="number">7</span>:</span><br><span class="line">        <span class="keyword">continue</span> <span class="comment"># 结束掉本次循环，即本次循环continue之后的代码都不会运行了，而是直接进入下一次循环</span></span><br><span class="line">    <span class="built_in">print</span>(number)</span><br></pre></td></tr></table></figure>

<p>案例五：while+else的使用</p>
<p>在while循环的后面，我们可以跟else语句，当while 循环正常执行完并且中间没有被break 中止的话，就会执行else后面的语句，所以我们可以用else来验证，循环是否正常结束</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt;= <span class="number">5</span> :</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Loop&quot;</span>,count)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;循环正常执行完啦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-----out of while loop ------&quot;</span>)</span><br><span class="line">输出</span><br><span class="line">Loop <span class="number">1</span></span><br><span class="line">Loop <span class="number">2</span></span><br><span class="line">Loop <span class="number">3</span></span><br><span class="line">Loop <span class="number">4</span></span><br><span class="line">Loop <span class="number">5</span></span><br><span class="line">Loop <span class="number">6</span></span><br><span class="line">循环正常执行完啦   <span class="comment">#没有被break打断，所以执行了该行代码</span></span><br><span class="line">-----out of <span class="keyword">while</span> loop ------</span><br></pre></td></tr></table></figure>

<p>如果执行过程中被break，就不会执行else的语句</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt;= <span class="number">5</span> :</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Loop&quot;</span>,count)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;循环正常执行完啦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-----out of while loop ------&quot;</span>)</span><br><span class="line">输出</span><br><span class="line">Loop <span class="number">1</span></span><br><span class="line">Loop <span class="number">2</span></span><br><span class="line">-----out of <span class="keyword">while</span> loop ------ <span class="comment">#由于循环被break打断了，所以不执行else后的输出语句</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-3a90716a58a4458640aee154894b0bd2_720w.jpg" alt="img"></p>
<p>练习1：</p>
<p>寻找1到100之间数字7最大的倍数（结果是98）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">number=<span class="number">100</span></span><br><span class="line"><span class="keyword">while</span> number&gt;<span class="number">0</span>:</span><br><span class="line">    <span class="keyword">if</span> number%<span class="number">7</span>==<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(number)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    number-=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>练习2：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">age=<span class="number">18</span></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count&lt;<span class="number">3</span>:</span><br><span class="line">    count+=<span class="number">1</span></span><br><span class="line">    guess = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;:&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> guess &gt; age :</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;猜的太大了，往小里试试...&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> guess &lt; age :</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;猜的太小了，往大里试试...&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;恭喜你，猜对了...&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-for循环语法"><a href="#3-3-3-for循环语法" class="headerlink" title="3.3.3 for循环语法"></a>3.3.3 for循环语法</h3><p><img src="https://pic3.zhimg.com/80/v2-3a90716a58a4458640aee154894b0bd2_720w.jpg" alt="img"></p>
<p>循环结构的第二种实现方式是for循环，for循环可以做的事情while循环都可以实现，之所以用for循环是因为在循环取值（即遍历值）时for循环比while循环的使用更为简洁，</p>
<p><strong>for循环语法如下</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> 变量名 <span class="keyword">in</span> 可迭代对象: <span class="comment"># 此时只需知道可迭代对象可以是字符串\列表\字典，我们之后会专门讲解可迭代对象</span></span><br><span class="line">    代码一</span><br><span class="line">    代码二</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="comment">#例1</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"><span class="comment"># 运行结果</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参照例1来介绍for循环的运行步骤</span></span><br><span class="line"><span class="comment"># 步骤1：从列表[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]中读出第一个值赋值给item（item=‘a’），然后执行循环体代码</span></span><br><span class="line"><span class="comment"># 步骤2：从列表[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]中读出第二个值赋值给item（item=‘b’），然后执行循环体代码</span></span><br><span class="line"><span class="comment"># 步骤3: 重复以上过程直到列表中的值读尽</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-7d7dc5ae41a09a7cd6e043d75c63b81c_720w.jpg" alt="img"></p>
<h3 id="3-3-4-for循环应用案例"><a href="#3-3-4-for循环应用案例" class="headerlink" title="3.3.4 for循环应用案例"></a>3.3.4 for循环应用案例</h3><p><img src="https://pic4.zhimg.com/80/v2-0dff1efd05c82779f08db912b84ed5a3_720w.jpg" alt="img"></p>
<p>案例一：打印数字0-5</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 简单版：for循环的实现方式</span></span><br><span class="line"><span class="keyword">for</span> count <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):  <span class="comment"># range(6)会产生从0-5这6个数</span></span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂版：while循环的实现方式</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">6</span>:</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>案例二：遍历字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 简单版：for循环的实现方式</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;gender&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;:  <span class="comment"># for 循环默认取的是字典的key赋值给变量名k</span></span><br><span class="line">    <span class="built_in">print</span>(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂版：while循环确实可以遍历字典，后续将会迭代器部分详细介绍</span></span><br></pre></td></tr></table></figure>

<p>案例三：for循环嵌套</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#请用for循环嵌套的方式打印如下图形：</span></span><br><span class="line">*****</span><br><span class="line">*****</span><br><span class="line">*****</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()  <span class="comment"># print()表示换行</span></span><br></pre></td></tr></table></figure>

<p>注意：break 与 continue也可以用于for循环，使用语法同while循环</p>
<p><img src="https://pic3.zhimg.com/80/v2-3a90716a58a4458640aee154894b0bd2_720w.jpg" alt="img"></p>
<p>练习一：</p>
<p>打印九九乘法表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i+<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s*%s=%s&#x27;</span> %(i,j,i*j),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<p>练习二：</p>
<p>打印金字塔</p>
<p><img src="https://pic3.zhimg.com/80/v2-53598748f490542a9700e63433b79496_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 分析</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">#max_level=5</span></span><br><span class="line"><span class="string">     *        # current_level=1，空格数=4，*号数=1</span></span><br><span class="line"><span class="string">    ***       # current_level=2,空格数=3,*号数=3</span></span><br><span class="line"><span class="string">   *****      # current_level=3,空格数=2,*号数=5</span></span><br><span class="line"><span class="string">  *******     # current_level=4,空格数=1,*号数=7</span></span><br><span class="line"><span class="string"> *********    # current_level=5,空格数=0,*号数=9</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 数学表达式</span></span><br><span class="line"><span class="string">空格数=max_level-current_level</span></span><br><span class="line"><span class="string">*号数=2*current_level-1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 实现：</span></span><br><span class="line">max_level=<span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> current_level <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,max_level+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_level-current_level):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>,end=<span class="string">&#x27;&#x27;</span>) <span class="comment">#在一行中连续打印多个空格</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*current_level-<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;*&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>) <span class="comment">#在一行中连续打印多个空格</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>1、if判断</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471/?p=10">https://www.bilibili.com/video/av73342471/?p=10www.bilibili.com/video/av73342471/?p=10</a></p>
<p>2、while循环</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=11">https://www.bilibili.com/video/av73342471?p=11www.bilibili.com/video/av73342471?p=11</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>08-基本数据类型及内置方法</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/08_%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="一-引子"><a href="#一-引子" class="headerlink" title="一 引子"></a>一 引子</h2><p> 数据类型是用来记录事物状态的，而事物的状态是不断变化的(如:一个人年龄的增长（操作int类型） ，单个人名的修改（操作str类型），学生列表中增加学生（操作list类型）等)，这意味着我们在开发程序时需要频繁对数据进行操作，为了提升我们的开发效率， python针对这些常用的操作，为每一种数据类型内置了一系列方法。本章的主题就是带大家详细了解下它们，以及每种数据类型的详细定义、类型转换。</p>
<p><img src="https://pic1.zhimg.com/80/v2-10e28bbd95c783f2266fea32400e48d0_720w.jpg" alt="img"></p>
<h2 id="二-数字类型int与float"><a href="#二-数字类型int与float" class="headerlink" title="二 数字类型int与float"></a>二 数字类型int与float</h2><p><img src="https://pic3.zhimg.com/80/v2-c2179471827cd00d18d8a286eb708fd6_720w.jpg" alt="img"></p>
<h2 id="2-1-定义"><a href="#2-1-定义" class="headerlink" title="2.1 定义"></a>2.1 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、定义：</span></span><br><span class="line"><span class="comment"># 1.1 整型int的定义</span></span><br><span class="line">age=<span class="number">10</span>  <span class="comment"># 本质age = int(10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2 浮点型float的定义</span></span><br><span class="line">salary=<span class="number">3000.3</span>  <span class="comment"># 本质salary=float(3000.3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：名字+括号的意思就是调用某个功能，比如</span></span><br><span class="line"><span class="comment"># print(...)调用打印功能</span></span><br><span class="line"><span class="comment"># int(...)调用创建整型数据的功能</span></span><br><span class="line"><span class="comment"># float(...)调用创建浮点型数据的功能</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-类型转换"><a href="#2-2-类型转换" class="headerlink" title="2.2 类型转换"></a>2.2 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、数据类型转换</span></span><br><span class="line"><span class="comment"># 1.1 int可以将由纯整数构成的字符串直接转换成整型，若包含其他任意非整数符号，则会报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = <span class="built_in">int</span>(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res,<span class="built_in">type</span>(res)</span><br><span class="line">(<span class="number">123</span>, &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">int</span>&#x27;&gt;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">int</span>(<span class="params"><span class="string">&#x27;12.3&#x27;</span></span>) # 错误演示：字符串内包含了非整数符号.</span></span><br><span class="line"><span class="class"><span class="title">Traceback</span> (<span class="params">most recent call last</span>):</span></span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: invalid literal <span class="keyword">for</span> <span class="built_in">int</span>() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">&#x27;12.3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2 进制转换</span></span><br><span class="line"><span class="comment"># 十进制转其他进制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bin</span>(<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;0b11&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">oct</span>(<span class="number">9</span>)</span><br><span class="line"><span class="string">&#x27;0o11&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">17</span>)</span><br><span class="line"><span class="string">&#x27;0x11&#x27;</span></span><br><span class="line"><span class="comment"># 其他进制转十进制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0b11&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0o11&#x27;</span>,<span class="number">8</span>)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0x11&#x27;</span>,<span class="number">16</span>)</span><br><span class="line"><span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.3 float同样可以用来做数据类型的转换</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;12.3&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=<span class="built_in">float</span>(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res,<span class="built_in">type</span>(res)</span><br><span class="line">(<span class="number">12.3</span>, &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">float</span>&#x27;&gt;)</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-使用"><a href="#2-3-使用" class="headerlink" title="2.3 使用"></a>2.3 使用</h2><p>数字类型主要就是用来做数学运算与比较运算，因此数字类型除了与运算符结合使用之外，并无需要掌握的内置方法</p>
<p><img src="https://pic3.zhimg.com/80/v2-45110f0279c9d352ab9c17dca57c140e_720w.jpg" alt="img"></p>
<h2 id="三-字符串"><a href="#三-字符串" class="headerlink" title="三 字符串"></a>三 字符串</h2><p><img src="https://pic4.zhimg.com/80/v2-15b3e5110d3102e523299c53ddadf663_720w.jpg" alt="img"></p>
<h2 id="3-1-定义："><a href="#3-1-定义：" class="headerlink" title="3.1 定义："></a>3.1 定义：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义：在单引号\双引号\三引号内包含一串字符</span></span><br><span class="line">name1 = <span class="string">&#x27;jason&#x27;</span>  <span class="comment"># 本质:name = str(&#x27;任意形式内容&#x27;)</span></span><br><span class="line">name2 = <span class="string">&quot;lili&quot;</span>  <span class="comment"># 本质:name = str(&quot;任意形式内容&quot;)</span></span><br><span class="line">name3 = <span class="string">&quot;&quot;&quot;ricky&quot;&quot;&quot;</span>  <span class="comment"># 本质:name = str(&quot;&quot;&quot;任意形式内容&quot;&quot;&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-类型转换"><a href="#3-2-类型转换" class="headerlink" title="3.2 类型转换"></a>3.2 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据类型转换：str()可以将任意数据类型转换成字符串类型，例如 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="built_in">str</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])) <span class="comment"># list-&gt;str</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span>(<span class="params"><span class="built_in">str</span>(<span class="params">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>&#125;</span>)</span>) # <span class="title">dict</span>-&gt;<span class="built_in">str</span></span></span><br><span class="line"><span class="class">&lt;<span class="keyword">class</span> &#x27;<span class="built_in">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="built_in">type</span>(<span class="built_in">str</span>((1,2,3)))  # <span class="built_in">tuple</span>-&gt;<span class="built_in">str</span></span></span><br><span class="line"><span class="class">&lt;<span class="keyword">class</span> &#x27;<span class="built_in">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="built_in">type</span>(<span class="built_in">str</span>(&#123;1,2,3,4&#125;)) # <span class="built_in">set</span>-&gt;<span class="built_in">str</span></span></span><br><span class="line"><span class="class">&lt;<span class="keyword">class</span> &#x27;<span class="built_in">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-使用"><a href="#3-3-使用" class="headerlink" title="3.3 使用"></a>3.3 使用</h2><h3 id="3-3-1-优先掌握的操作"><a href="#3-3-1-优先掌握的操作" class="headerlink" title="3.3.1 优先掌握的操作"></a>3.3.1 优先掌握的操作</h3><p><img src="https://pic4.zhimg.com/80/v2-fefd043609f271fb50a01020cea03f73_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1 = <span class="string">&#x27;hello python!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.按索引取值(正向取，反向取)：</span></span><br><span class="line"><span class="comment"># 1.1 正向取(从左往右)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[<span class="number">6</span>]</span><br><span class="line">p</span><br><span class="line"><span class="comment"># 1.2 反向取(负号表示从右往左)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[-<span class="number">4</span>]</span><br><span class="line">h</span><br><span class="line"><span class="comment"># 1.3 对于str来说，只能按照索引取值，不能改</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[<span class="number">0</span>]=<span class="string">&#x27;H&#x27;</span> <span class="comment"># 报错TypeError</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.切片(顾头不顾尾，步长)</span></span><br><span class="line"><span class="comment"># 2.1 顾头不顾尾：取出索引为0到8的所有字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[<span class="number">0</span>:<span class="number">9</span>]  </span><br><span class="line">hello pyt</span><br><span class="line"><span class="comment"># 2.2 步长：0:9:2,第三个参数2代表步长，会从0开始，每次累加一个2即可，所以会取出索引0、2、4、6、8的字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[<span class="number">0</span>:<span class="number">9</span>:<span class="number">2</span>]  </span><br><span class="line">hlopt </span><br><span class="line"><span class="comment"># 2.3 反向切片</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1[::-<span class="number">1</span>]  <span class="comment"># -1表示从右往左依次取值</span></span><br><span class="line">!nohtyp olleh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.长度len</span></span><br><span class="line"><span class="comment"># 3.1 获取字符串的长度，即字符的个数，但凡存在于引号内的都算作字符)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(str1) <span class="comment"># 空格也算字符</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.成员运算 in 和 not in    </span></span><br><span class="line"><span class="comment"># 4.1 int:判断hello 是否在 str1里面</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;hello&#x27;</span> <span class="keyword">in</span> str1  </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment"># 4.2 not in:判断tony 是否不在 str1里面</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;tony&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> str1 </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.strip移除字符串首尾指定的字符(默认移除空格)</span></span><br><span class="line"><span class="comment"># 5.1 括号内不指定字符，默认移除首尾空白字符(空格、\n、\t)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1 = <span class="string">&#x27;  life is short!  &#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1.strip()  </span><br><span class="line">life <span class="keyword">is</span> short!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.2 括号内指定字符，移除首尾指定的字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str2 = <span class="string">&#x27;**tony**&#x27;</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str2.strip(<span class="string">&#x27;*&#x27;</span>)  </span><br><span class="line">tony</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.切分split</span></span><br><span class="line"><span class="comment"># 6.1 括号内不指定字符，默认以空格作为切分符号</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3=<span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3.split()</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"><span class="comment"># 6.2 括号内指定分隔字符，则按照括号内指定的字符切割字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4.split(<span class="string">&#x27;.&#x27;</span>)  </span><br><span class="line">[<span class="string">&#x27;127&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>]  <span class="comment"># 注意:split切割得到的结果是列表数据类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.循环</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str5 = <span class="string">&#x27;今天你好吗？&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> line <span class="keyword">in</span> str5:  <span class="comment"># 依次取出字符串中每一个字符</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(line)</span><br><span class="line">...</span><br><span class="line">今</span><br><span class="line">天</span><br><span class="line">你</span><br><span class="line">好</span><br><span class="line">吗</span><br><span class="line">？</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-需要掌握的操作"><a href="#3-3-2-需要掌握的操作" class="headerlink" title="3.3.2 需要掌握的操作"></a>3.3.2 需要掌握的操作</h3><p><img src="https://pic4.zhimg.com/80/v2-3870f73c837fd6488da8a24bec358a6f_720w.jpg" alt="img"></p>
<p><strong>1.strip, lstrip, rstrip</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1 = <span class="string">&#x27;**tony***&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1.strip(<span class="string">&#x27;*&#x27;</span>)  <span class="comment"># 移除左右两边的指定字符</span></span><br><span class="line"><span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1.lstrip(<span class="string">&#x27;*&#x27;</span>)  <span class="comment"># 只移除左边的指定字符</span></span><br><span class="line">tony***</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str1.rstrip(<span class="string">&#x27;*&#x27;</span>)  <span class="comment"># 只移除右边的指定字符</span></span><br><span class="line">**tony</span><br></pre></td></tr></table></figure>

<p><strong>2.lower(),upper()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str2 = <span class="string">&#x27;My nAme is tonY！&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str2.lower()  <span class="comment"># 将英文字符串全部变小写</span></span><br><span class="line">my name <span class="keyword">is</span> tony！</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str2.upper()  <span class="comment"># 将英文字符串全部变大写</span></span><br><span class="line">MY NAME IS TONY！</span><br></pre></td></tr></table></figure>

<p><strong>3.startswith,endswith</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3 = <span class="string">&#x27;tony jam&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># startswith()判断字符串是否以括号内指定的字符开头，结果为布尔值True或False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3.startswith(<span class="string">&#x27;t&#x27;</span>) </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3.startswith(<span class="string">&#x27;j&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="comment"># endswith()判断字符串是否以括号内指定的字符结尾，结果为布尔值True或False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3.endswith(<span class="string">&#x27;jam&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str3.endswith(<span class="string">&#x27;tony&#x27;</span>)  </span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><strong>4.格式化输出之format</strong></p>
<p>之前我们使用%s来做字符串的格式化输出操作，在传值时，必须严格按照位置与%s一一对应，而字符串的内置方法format则提供了一种不依赖位置的传值方式</p>
<p>案例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># format括号内在传参数时完全可以打乱顺序，但仍然能指名道姓地为指定的参数传值，name=‘tony’就是传给&#123;name&#125;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;name&#125;, my age is &#123;age&#125;!&#x27;</span>.<span class="built_in">format</span>(age=<span class="number">18</span>,name=<span class="string">&#x27;tony&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4  </span><br><span class="line"><span class="string">&#x27;my name is tony, my age is 18!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;name&#125;&#123;name&#125;&#123;name&#125;, my age is &#123;name&#125;!&#x27;</span>.<span class="built_in">format</span>(name=<span class="string">&#x27;tony&#x27;</span>, age=<span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4  </span><br><span class="line"><span class="string">&#x27;my name is tonytonytony, my age is tony!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>format的其他使用方式（了解）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 类似于%s的用法，传入的值会按照位置与&#123;&#125;一一对应</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;&#125;, my age is &#123;&#125;!&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;tony&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 </span><br><span class="line">my name <span class="keyword">is</span> tony, my age <span class="keyword">is</span> <span class="number">18</span>!</span><br><span class="line"><span class="comment"># 把format传入的多个值当作一个列表，然后用&#123;索引&#125;取值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;0&#125;, my age is &#123;1&#125;!&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;tony&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4</span><br><span class="line">my name <span class="keyword">is</span> tony, my age <span class="keyword">is</span> <span class="number">18</span>!</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;1&#125;, my age is &#123;0&#125;!&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;tony&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4  </span><br><span class="line">my name <span class="keyword">is</span> <span class="number">18</span>, my age <span class="keyword">is</span> tony!</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4 = <span class="string">&#x27;my name is &#123;1&#125;, my age is &#123;1&#125;!&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;tony&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str4  </span><br><span class="line">my name <span class="keyword">is</span> <span class="number">18</span>, my age <span class="keyword">is</span> <span class="number">18</span>!</span><br></pre></td></tr></table></figure>

<p><strong>5.split,rsplit</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-56cf164d7e6dc3467c228bf141f1585b_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># split会按照从左到右的顺序对字符串进行切分，可以指定切割次数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str5=<span class="string">&#x27;C:/a/b/c/d.txt&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str5.split(<span class="string">&#x27;/&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">[<span class="string">&#x27;C:&#x27;</span>, <span class="string">&#x27;a/b/c/d.txt&#x27;</span>]  </span><br><span class="line"></span><br><span class="line"><span class="comment"># rsplit刚好与split相反，从右往左切割，可以指定切割次数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str5=<span class="string">&#x27;a|b|c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str5.rsplit(<span class="string">&#x27;|&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">[<span class="string">&#x27;a|b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>6.join</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 从可迭代对象中取出多个字符串，然后按照指定的分隔符进行拼接，拼接的结果为字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;%&#x27;</span>.join(<span class="string">&#x27;hello&#x27;</span>) <span class="comment"># 从字符串&#x27;hello&#x27;中取出多个字符串，然后按照%作为分隔符号进行拼接</span></span><br><span class="line"><span class="string">&#x27;h%e%l%l%o&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;|&#x27;</span>.join([<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;18&#x27;</span>,<span class="string">&#x27;read&#x27;</span>])  <span class="comment"># 从列表中取出多个字符串，然后按照*作为分隔符号进行拼接</span></span><br><span class="line"><span class="string">&#x27;tony|18|read&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>7.replace</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用新的字符替换字符串中旧的字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7 = <span class="string">&#x27;my name is tony, my age is 18!&#x27;</span>  <span class="comment"># 将tony的年龄由18岁改成73岁</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7 = str7.replace(<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;73&#x27;</span>)  <span class="comment"># 语法:replace(&#x27;旧内容&#x27;, &#x27;新内容&#x27;)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7</span><br><span class="line">my name <span class="keyword">is</span> tony, my age <span class="keyword">is</span> <span class="number">73</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以指定修改的个数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7 = <span class="string">&#x27;my name is tony, my age is 18!&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7 = str7.replace(<span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;MY&#x27;</span>,<span class="number">1</span>) <span class="comment"># 只把一个my改为MY</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str7</span><br><span class="line"><span class="string">&#x27;MY name is tony, my age is 18!&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>8.isdigit</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 判断字符串是否是纯数字组成，返回结果为True或False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str8 = <span class="string">&#x27;5201314&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str8.isdigit()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str8 = <span class="string">&#x27;123g123&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str8.isdigit()</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-了解操作"><a href="#3-3-3-了解操作" class="headerlink" title="3.3.3 了解操作"></a>3.3.3 了解操作</h3><p><img src="https://pic1.zhimg.com/80/v2-44989c1a59822b2480dc44ed07e1987c_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.find,rfind,index,rindex,count</span></span><br><span class="line"><span class="comment"># 1.1 find：从指定范围内查找子字符串的起始索引，找得到则返回数字1，找不到则返回-1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg=<span class="string">&#x27;tony say hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg.find(<span class="string">&#x27;o&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>)  <span class="comment"># 在索引为1和2(顾头不顾尾)的字符中查找字符o的索引</span></span><br><span class="line"><span class="number">1</span>  </span><br><span class="line"><span class="comment"># 1.2 index:同find,但在找不到时会报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg.index(<span class="string">&#x27;e&#x27;</span>,<span class="number">2</span>,<span class="number">4</span>) <span class="comment"># 报错ValueError</span></span><br><span class="line"><span class="comment"># 1.3 rfind与rindex：略</span></span><br><span class="line"><span class="comment"># 1.4 count:统计字符串在大字符串中出现的次数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg = <span class="string">&quot;hello everyone&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg.count(<span class="string">&#x27;e&#x27;</span>)  <span class="comment"># 统计字符串e出现的次数</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg.count(<span class="string">&#x27;e&#x27;</span>,<span class="number">1</span>,<span class="number">6</span>)  <span class="comment"># 字符串e在索引1~5范围内出现的次数</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.center,ljust,rjust,zfill</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name=<span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.center(<span class="number">30</span>,<span class="string">&#x27;-&#x27;</span>)  <span class="comment"># 总宽度为30，字符串居中显示，不够用-填充</span></span><br><span class="line">-------------tony-------------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.ljust(<span class="number">30</span>,<span class="string">&#x27;*&#x27;</span>)  <span class="comment"># 总宽度为30，字符串左对齐显示，不够用*填充</span></span><br><span class="line">tony**************************</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.rjust(<span class="number">30</span>,<span class="string">&#x27;*&#x27;</span>)  <span class="comment"># 总宽度为30，字符串右对齐显示，不够用*填充</span></span><br><span class="line">**************************tony</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.zfill(<span class="number">50</span>)  <span class="comment"># 总宽度为50，字符串右对齐显示，不够用0填充</span></span><br><span class="line">0000000000000000000000000000000000000000000000tony</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.expandtabs</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&#x27;tony\thello&#x27;</span>  <span class="comment"># \t表示制表符(tab键)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">tony    hello</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.expandtabs(<span class="number">1</span>)  <span class="comment"># 修改\t制表符代表的空格数</span></span><br><span class="line">tony hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.captalize,swapcase,title</span></span><br><span class="line"><span class="comment"># 4.1 captalize：首字母大写</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message = <span class="string">&#x27;hello everyone nice to meet you!&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message.capitalize()</span><br><span class="line">Hello everyone nice to meet you!  </span><br><span class="line"><span class="comment"># 4.2 swapcase：大小写翻转</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message1 = <span class="string">&#x27;Hi girl, I want make friends with you!&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message1.swapcase()  </span><br><span class="line">hI GIRL, i WANT MAKE FRIENDS WITH YOU!  </span><br><span class="line"><span class="comment">#4.3 title：每个单词的首字母大写</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg = <span class="string">&#x27;dear my friend i miss you very much&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg.title()</span><br><span class="line">Dear My Friend I Miss You Very Much </span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.is数字系列</span></span><br><span class="line"><span class="comment">#在python3中</span></span><br><span class="line">num1 = <span class="string">b&#x27;4&#x27;</span> <span class="comment">#bytes</span></span><br><span class="line">num2 = <span class="string">u&#x27;4&#x27;</span> <span class="comment">#unicode,python3中无需加u就是unicode</span></span><br><span class="line">num3 = <span class="string">&#x27;四&#x27;</span> <span class="comment">#中文数字</span></span><br><span class="line">num4 = <span class="string">&#x27;Ⅳ&#x27;</span> <span class="comment">#罗马数字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#isdigt:bytes,unicode</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num1.isdigit()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num2.isdigit()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num3.isdigit()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num4.isdigit() </span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#isdecimal:uncicode(bytes类型无isdecimal方法)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num2.isdecimal() </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num3.isdecimal() </span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num4.isdecimal() </span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#isnumberic:unicode,中文数字,罗马数字(bytes类型无isnumberic方法)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num2.isnumeric() </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num3.isnumeric() </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num4.isnumeric() </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 三者不能判断浮点数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num5 = <span class="string">&#x27;4.3&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num5.isdigit()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num5.isdecimal()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num5.isnumeric()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">总结:</span></span><br><span class="line"><span class="string">    最常用的是isdigit,可以判断bytes和unicode类型,这也是最常见的数字应用场景</span></span><br><span class="line"><span class="string">    如果要判断中文数字或罗马数字,则需要用到isnumeric。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.is其他</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&#x27;tony123&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.isalnum() <span class="comment">#字符串中既可以包含数字也可以包含字母</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.isalpha() <span class="comment">#字符串中只包含字母</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.isidentifier()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.islower()  <span class="comment"># 字符串是否是纯小写</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.isupper()  <span class="comment"># 字符串是否是纯大写</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.isspace()  <span class="comment"># 字符串是否全是空格</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.istitle()  <span class="comment"># 字符串中的单词首字母是否都是大写</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="四-列表"><a href="#四-列表" class="headerlink" title="四 列表"></a>四 列表</h2><p><img src="https://pic4.zhimg.com/80/v2-c388190efab0d91f2604988622f3fd37_720w.jpg" alt="img"></p>
<h2 id="4-1-定义"><a href="#4-1-定义" class="headerlink" title="4.1 定义"></a>4.1 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义：在[]内,用逗号分隔开多个任意数据类型的值</span></span><br><span class="line">l1 = [<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,[<span class="number">1</span>,<span class="number">2</span>]]  <span class="comment"># 本质:l1 = list([1,&#x27;a&#x27;,[1,2]])</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-类型转换"><a href="#4-2-类型转换" class="headerlink" title="4.2 类型转换"></a>4.2 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 但凡能被for循环遍历的数据类型都可以传给list()转换成列表类型，list()会跟for循环一样遍历出数据类型中包含的每一个元素然后放到列表中</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="string">&#x27;wdad&#x27;</span>) <span class="comment"># 结果：[&#x27;w&#x27;, &#x27;d&#x27;, &#x27;a&#x27;, &#x27;d&#x27;] </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment"># 结果：[1, 2, 3]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>&#125;) <span class="comment">#结果：[&#x27;name&#x27;, &#x27;age&#x27;]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># 结果：[1, 2, 3] </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;) <span class="comment"># 结果：[1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3-使用"><a href="#4-3-使用" class="headerlink" title="4.3 使用"></a>4.3 使用</h2><h3 id="4-3-1-优先掌握的操作"><a href="#4-3-1-优先掌握的操作" class="headerlink" title="4.3.1 优先掌握的操作"></a>4.3.1 优先掌握的操作</h3><p><img src="https://pic3.zhimg.com/80/v2-17400abd279a6fb484ecc78c5d8d3b8e_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.按索引存取值(正向存取+反向存取)：即可存也可以取  </span></span><br><span class="line"><span class="comment"># 1.1 正向取(从左往右)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends=[<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends[<span class="number">0</span>]  </span><br><span class="line">tony</span><br><span class="line"><span class="comment"># 1.2 反向取(负号表示从右往左)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends[-<span class="number">1</span>]  </span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="comment"># 1.3 对于list来说，既可以按照索引取值，又可以按照索引修改指定位置的值，但如果索引不存在则报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends = [<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends[<span class="number">1</span>] = <span class="string">&#x27;martthow&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends</span><br><span class="line">[<span class="string">&#x27;tony&#x27;</span>, <span class="string">&#x27;martthow&#x27;</span>, <span class="string">&#x27;jason&#x27;</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.切片(顾头不顾尾，步长)</span></span><br><span class="line"><span class="comment"># 2.1 顾头不顾尾：取出索引为0到3的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends[<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">[<span class="string">&#x27;tony&#x27;</span>, <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;tom&#x27;</span>, <span class="number">4</span>]</span><br><span class="line"><span class="comment"># 2.2 步长：0:4:2,第三个参数2代表步长，会从0开始，每次累加一个2即可，所以会取出索引0、2的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_friends[<span class="number">0</span>:<span class="number">4</span>:<span class="number">2</span>]  </span><br><span class="line">[<span class="string">&#x27;tony&#x27;</span>, <span class="string">&#x27;tom&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.长度</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(my_friends)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.成员运算in和not in</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;tony&#x27;</span> <span class="keyword">in</span> my_friends</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;xxx&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> my_friends</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.添加</span></span><br><span class="line"><span class="comment"># 5.1 append()列表尾部追加元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1 = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1.append(<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.2 extend()一次性在列表尾部添加多个元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1.extend([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.3 insert()在指定位置插入元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1.insert(<span class="number">0</span>,<span class="string">&quot;first&quot;</span>)  <span class="comment"># 0表示按索引位置插值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;alisa&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.删除</span></span><br><span class="line"><span class="comment"># 6.1 del</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> l[<span class="number">2</span>]  <span class="comment"># 删除索引为2的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">11</span>,<span class="number">22</span>,<span class="number">44</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.2 pop()默认删除列表最后一个元素，并将删除的值返回，括号内可以通过加索引值来指定删除元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">22</span>,<span class="number">44</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=l.pop()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res</span><br><span class="line"><span class="number">44</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=l.pop(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res</span><br><span class="line"><span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.3 remove()括号内指名道姓表示要删除哪个元素，没有返回值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">22</span>,<span class="number">44</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=l.remove(<span class="number">22</span>) <span class="comment"># 从左往右查找第一个括号内需要删除的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(res)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.reverse()颠倒列表内元素顺序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.reverse() </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">44</span>,<span class="number">33</span>,<span class="number">22</span>,<span class="number">11</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.sort()给列表内所有元素排序</span></span><br><span class="line"><span class="comment"># 8.1 排序时列表元素之间必须是相同数据类型，不可混搭，否则报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">3</span>,<span class="number">42</span>,<span class="number">7</span>,<span class="number">55</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.sort()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">42</span>, <span class="number">55</span>]  <span class="comment"># 默认从小到大排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">3</span>,<span class="number">42</span>,<span class="number">7</span>,<span class="number">55</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.sort(reverse=<span class="literal">True</span>)  <span class="comment"># reverse用来指定是否跌倒排序，默认为False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">55</span>, <span class="number">42</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment"># 8.2 了解知识：</span></span><br><span class="line"><span class="comment"># 我们常用的数字类型直接比较大小，但其实，字符串、列表等都可以比较大小，原理相同：都是依次比较对应位置的元素的大小，如果分出大小，则无需比较下一个元素，比如</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2=[<span class="number">2</span>,]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 &gt; l1</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment"># 字符之间的大小取决于它们在ASCII表中的先后顺序，越往后越大</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1=<span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2=<span class="string">&#x27;az&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 &gt; s1 <span class="comment"># s1与s2的第一个字符没有分出胜负，但第二个字符&#x27;z&#x27;&gt;&#x27;b&#x27;,所以s2&gt;s1成立</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment"># 所以我们也可以对下面这个列表排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;adjk&#x27;</span>,<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;hea&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.sort()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;adjk&#x27;</span>, <span class="string">&#x27;hea&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.循环</span></span><br><span class="line"><span class="comment"># 循环遍历my_friends列表里面的值</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> my_friends:</span><br><span class="line">    <span class="built_in">print</span>(line) </span><br><span class="line"><span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="string">&#x27;jack&#x27;</span></span><br><span class="line"><span class="string">&#x27;jason&#x27;</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-了解操作"><a href="#4-3-2-了解操作" class="headerlink" title="4.3.2 了解操作"></a>4.3.2 了解操作</h3><p><img src="https://pic3.zhimg.com/80/v2-7c242fdec61e16c79e06f9181bb71a1a_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">0</span>:<span class="number">3</span>:<span class="number">1</span>] </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]  <span class="comment"># 正向步长</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>::-<span class="number">1</span>] </span><br><span class="line">[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]  <span class="comment"># 反向步长</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过索引取值实现列表翻转</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[::-<span class="number">1</span>]</span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<h2 id="五-元组"><a href="#五-元组" class="headerlink" title="五 元组"></a>五 元组</h2><p><img src="https://pic1.zhimg.com/80/v2-c2d1b8f652b5290b197d97c45f115830_720w.jpg" alt="img"></p>
<h2 id="5-1-作用"><a href="#5-1-作用" class="headerlink" title="5.1 作用"></a>5.1 作用</h2><p>元组与列表类似，也是可以存多个任意类型的元素，不同之处在于元组的元素不能修改，即元组相当于不可变的列表，用于记录多个固定不允许修改的值，单纯用于取</p>
<p><img src="https://pic1.zhimg.com/80/v2-66e37151e39efc17ad3473a1ccadafc4_720w.jpg" alt="img"></p>
<h2 id="5-2-定义方式"><a href="#5-2-定义方式" class="headerlink" title="5.2 定义方式"></a>5.2 定义方式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在()内用逗号分隔开多个任意类型的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>countries = (<span class="string">&quot;中国&quot;</span>，<span class="string">&quot;美国&quot;</span>，<span class="string">&quot;英国&quot;</span>)  <span class="comment"># 本质:countries = tuple(&quot;中国&quot;，&quot;美国&quot;，&quot;英国&quot;)</span></span><br><span class="line"><span class="comment"># 强调：如果元组内只有一个值，则必须加一个逗号，否则()就只是包含的意思而非定义元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>countries = (<span class="string">&quot;中国&quot;</span>，)  <span class="comment"># 本质:countries = tuple(&quot;中国&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="5-3-类型转换"><a href="#5-3-类型转换" class="headerlink" title="5.3 类型转换"></a>5.3 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 但凡能被for循环的遍历的数据类型都可以传给tuple()转换成元组类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(<span class="string">&#x27;wdad&#x27;</span>) <span class="comment"># 结果：(&#x27;w&#x27;, &#x27;d&#x27;, &#x27;a&#x27;, &#x27;d&#x27;) </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment"># 结果：(1, 2, 3)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>&#125;) <span class="comment"># 结果：(&#x27;name&#x27;, &#x27;age&#x27;)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># 结果：(1, 2, 3)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;) <span class="comment"># 结果：(1, 2, 3, 4)</span></span><br><span class="line"><span class="comment"># tuple()会跟for循环一样遍历出数据类型中包含的每一个元素然后放到元组中</span></span><br></pre></td></tr></table></figure>

<h2 id="5-4-使用"><a href="#5-4-使用" class="headerlink" title="5.4 使用"></a>5.4 使用</h2><p><img src="https://pic3.zhimg.com/80/v2-4ece19ae4a48f1677deb018019fe2c2a_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple1 = (<span class="number">1</span>, <span class="string">&#x27;hhaha&#x27;</span>, <span class="number">15000.00</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>) </span><br><span class="line"><span class="comment"># 1、按索引取值(正向取+反向取)：只能取，不能改否则报错！  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple1[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple1[-<span class="number">2</span>]</span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple1[<span class="number">0</span>] = <span class="string">&#x27;hehe&#x27;</span>  <span class="comment"># 报错：TypeError:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、切片(顾头不顾尾，步长)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple1[<span class="number">0</span>:<span class="number">6</span>:<span class="number">2</span>] </span><br><span class="line">(<span class="number">1</span>, <span class="number">15000.0</span>, <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、长度</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(tuple1)  </span><br><span class="line"><span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、成员运算 in 和 not in</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;hhaha&#x27;</span> <span class="keyword">in</span> tuple1 </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;hhaha&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> tuple1  </span><br><span class="line"><span class="literal">False</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、循环</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> line <span class="keyword">in</span> tuple1:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(line)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">hhaha</span><br><span class="line"><span class="number">15000.0</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="number">33</span></span><br></pre></td></tr></table></figure>

<h2 id="六-字典"><a href="#六-字典" class="headerlink" title="六 字典"></a>六 字典</h2><p><img src="https://pic4.zhimg.com/80/v2-d1303c9f61b67e515d181e47ea284163_720w.jpg" alt="img"></p>
<h2 id="6-1-定义方式"><a href="#6-1-定义方式" class="headerlink" title="6.1 定义方式"></a>6.1 定义方式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义：在&#123;&#125;内用逗号分隔开多元素，每一个元素都是key:value的形式，其中value可以是任意类型，而key则必须是不可变类型，详见第八小节，通常key应该是str类型，因为str类型会对value有描述性的功能</span></span><br><span class="line">info=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tony&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125; <span class="comment">#本质info=dict(&#123;....&#125;)</span></span><br><span class="line"><span class="comment"># 也可以这么定义字典</span></span><br><span class="line">info=<span class="built_in">dict</span>(name=<span class="string">&#x27;tony&#x27;</span>,age=<span class="number">18</span>,sex=<span class="string">&#x27;male&#x27;</span>) <span class="comment"># info=&#123;&#x27;age&#x27;: 18, &#x27;sex&#x27;: &#x27;male&#x27;, &#x27;name&#x27;: &#x27;tony&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-2-类型转换"><a href="#6-2-类型转换" class="headerlink" title="6.2 类型转换"></a>6.2 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 转换1: </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>info=<span class="built_in">dict</span>([[<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;tony&#x27;</span>],(<span class="string">&#x27;age&#x27;</span>,<span class="number">18</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>info</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tony&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换2：fromkeys会从元组中取出每个值当做key，然后与None组成key:value放到字典中</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;&#125;.fromkeys((<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>),<span class="literal">None</span>)  </span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;name&#x27;</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-使用"><a href="#6-3-使用" class="headerlink" title="6.3 使用"></a>6.3 使用</h2><h3 id="6-3-1-优先掌握的操作"><a href="#6-3-1-优先掌握的操作" class="headerlink" title="6.3.1 优先掌握的操作"></a>6.3.1 优先掌握的操作</h3><p><img src="https://pic3.zhimg.com/80/v2-f9177137b88b9fc3f31c88d91ff854ee_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、按key存取值：可存可取</span></span><br><span class="line"><span class="comment"># 1.1 取</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = &#123;</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>]</span><br><span class="line"><span class="meta">... </span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;hobbies&#x27;</span>][<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;basketball&#x27;</span></span><br><span class="line"><span class="comment"># 1.2 对于赋值操作，如果key原先不存在于字典，则会新增key:value</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;gender&#x27;</span>] = <span class="string">&#x27;male&#x27;</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tony&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>],<span class="string">&#x27;gender&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># 1.3 对于赋值操作，如果key原先存在于字典，则会修改对应value的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;tony&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tony&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、长度len</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(dic) </span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、成员运算in和not in</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> dic  <span class="comment"># 判断某个值是否是字典的key</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、删除</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.pop(<span class="string">&#x27;name&#x27;</span>)  <span class="comment"># 通过指定字典的key来删除字典的键值对</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、键keys()，值values()，键值对items()</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>], <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># 获取字典所有的key</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.keys()  </span><br><span class="line">dict_keys([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;hobbies&#x27;</span>])</span><br><span class="line"><span class="comment"># 获取字典所有的value</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.values()</span><br><span class="line">dict_values([<span class="string">&#x27;xxx&#x27;</span>, <span class="number">18</span>, [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>]])</span><br><span class="line"><span class="comment"># 获取字典所有的键值对</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.items()</span><br><span class="line">dict_items([(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>), (<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>), (<span class="string">&#x27;hobbies&#x27;</span>, [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>])])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、循环</span></span><br><span class="line"><span class="comment"># 6.1 默认遍历的是字典的key</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key <span class="keyword">in</span> dic:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">age</span><br><span class="line">hobbies</span><br><span class="line">name</span><br><span class="line"><span class="comment"># 6.2 只遍历key</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key <span class="keyword">in</span> dic.keys():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">age</span><br><span class="line">hobbies</span><br><span class="line">name</span><br><span class="line"><span class="comment"># 6.3 只遍历value</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key <span class="keyword">in</span> dic.values():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="number">18</span></span><br><span class="line">[<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>]</span><br><span class="line">xxx</span><br><span class="line"><span class="comment"># 6.4 遍历key与value</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key <span class="keyword">in</span> dic.items():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">(<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">(<span class="string">&#x27;hobbies&#x27;</span>, [<span class="string">&#x27;play game&#x27;</span>, <span class="string">&#x27;basketball&#x27;</span>])</span><br><span class="line">(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-3-2-需要掌握的操作"><a href="#6-3-2-需要掌握的操作" class="headerlink" title="6.3.2 需要掌握的操作"></a>6.3.2 需要掌握的操作</h3><p><img src="https://pic1.zhimg.com/80/v2-9a6cb9d36cc1ce915091d1937532a35c_720w.jpg" alt="img"></p>
<p><strong>1.get()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic= &#123;<span class="string">&#x27;k1&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="string">&#x27;Tony&#x27;</span>,<span class="string">&#x27;k3&#x27;</span>:<span class="string">&#x27;JY&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.get(<span class="string">&#x27;k1&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;jason&#x27;</span>  <span class="comment"># key存在，则获取key对应的value值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=dic.get(<span class="string">&#x27;xxx&#x27;</span>) <span class="comment"># key不存在，不会报错而是默认返回None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(res)</span><br><span class="line"><span class="literal">None</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=dic.get(<span class="string">&#x27;xxx&#x27;</span>,<span class="number">666</span>) <span class="comment"># key不存在时，可以设置默认返回的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(res)</span><br><span class="line"><span class="number">666</span> </span><br><span class="line"><span class="comment"># ps:字典取值建议使用get方法</span></span><br></pre></td></tr></table></figure>

<p><strong>2.pop()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic= &#123;<span class="string">&#x27;k1&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="string">&#x27;Tony&#x27;</span>,<span class="string">&#x27;k3&#x27;</span>:<span class="string">&#x27;JY&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v = dic.pop(<span class="string">&#x27;k2&#x27;</span>)  <span class="comment"># 删除指定的key对应的键值对,并返回值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;k1&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;kk2&#x27;</span>: <span class="string">&#x27;JY&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v</span><br><span class="line"><span class="string">&#x27;Tony&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.popitem()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic= &#123;<span class="string">&#x27;k1&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="string">&#x27;Tony&#x27;</span>,<span class="string">&#x27;k3&#x27;</span>:<span class="string">&#x27;JY&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item = dic.popitem()  <span class="comment"># 随机删除一组键值对,并将删除的键值放到元组内返回</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;k3&#x27;</span>: <span class="string">&#x27;JY&#x27;</span>, <span class="string">&#x27;k2&#x27;</span>: <span class="string">&#x27;Tony&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item</span><br><span class="line">(<span class="string">&#x27;k1&#x27;</span>, <span class="string">&#x27;jason&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>4.update()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用新字典更新旧字典，有则修改，无则添加</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic= &#123;<span class="string">&#x27;k1&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="string">&#x27;Tony&#x27;</span>,<span class="string">&#x27;k3&#x27;</span>:<span class="string">&#x27;JY&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic.update(&#123;<span class="string">&#x27;k1&#x27;</span>:<span class="string">&#x27;JN&#x27;</span>,<span class="string">&#x27;k4&#x27;</span>:<span class="string">&#x27;xxx&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;k1&#x27;</span>: <span class="string">&#x27;JN&#x27;</span>, <span class="string">&#x27;k3&#x27;</span>: <span class="string">&#x27;JY&#x27;</span>, <span class="string">&#x27;k2&#x27;</span>: <span class="string">&#x27;Tony&#x27;</span>, <span class="string">&#x27;k4&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5.fromkeys()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = <span class="built_in">dict</span>.fromkeys([<span class="string">&#x27;k1&#x27;</span>,<span class="string">&#x27;k2&#x27;</span>,<span class="string">&#x27;k3&#x27;</span>],[])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;k1&#x27;</span>: [], <span class="string">&#x27;k2&#x27;</span>: [], <span class="string">&#x27;k3&#x27;</span>: []&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6.setdefault()</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># key不存在则新增键值对，并将新增的value返回</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic=&#123;<span class="string">&#x27;k1&#x27;</span>:<span class="number">111</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="number">222</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=dic.setdefault(<span class="string">&#x27;k3&#x27;</span>,<span class="number">333</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res</span><br><span class="line"><span class="number">333</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic <span class="comment"># 字典中新增了键值对</span></span><br><span class="line">&#123;<span class="string">&#x27;k1&#x27;</span>: <span class="number">111</span>, <span class="string">&#x27;k3&#x27;</span>: <span class="number">333</span>, <span class="string">&#x27;k2&#x27;</span>: <span class="number">222</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># key存在则不做任何修改，并返回已存在key对应的value值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic=&#123;<span class="string">&#x27;k1&#x27;</span>:<span class="number">111</span>,<span class="string">&#x27;k2&#x27;</span>:<span class="number">222</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=dic.setdefault(<span class="string">&#x27;k1&#x27;</span>,<span class="number">666</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res</span><br><span class="line"><span class="number">111</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic <span class="comment"># 字典不变</span></span><br><span class="line">&#123;<span class="string">&#x27;k1&#x27;</span>: <span class="number">111</span>, <span class="string">&#x27;k2&#x27;</span>: <span class="number">222</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七-集合"><a href="#七-集合" class="headerlink" title="七 集合"></a>七 集合</h2><p><img src="https://pic4.zhimg.com/80/v2-a7172908ebf2b327251e4defb86b6d67_720w.jpg" alt="img"></p>
<h2 id="7-1-作用"><a href="#7-1-作用" class="headerlink" title="7.1 作用"></a>7.1 作用</h2><p>集合、list、tuple、dict一样都可以存放多个值，但是集合主要用于：去重、关系运算</p>
<p><img src="https://pic2.zhimg.com/80/v2-3c82eb7aaa1df9d7830884196d689979_720w.jpg" alt="img"></p>
<h2 id="7-2-定义"><a href="#7-2-定义" class="headerlink" title="7.2 定义"></a>7.2 定义</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">定义：在&#123;&#125;内用逗号分隔开多个元素，集合具备以下三个特点：</span></span><br><span class="line"><span class="string">     1：每个元素必须是不可变类型</span></span><br><span class="line"><span class="string">     2：集合内没有重复的元素</span></span><br><span class="line"><span class="string">     3：集合内元素无序</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;  <span class="comment"># 本质 s = set(&#123;1,2,3,4&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意1：列表类型是索引对应值，字典是key对应值，均可以取得单个指定的值，而集合类型既没有索引也没有key与值对应，所以无法取得单个的值，而且对于集合来说，主要用于去重与关系元素，根本没有取出单个指定值这种需求。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意2:&#123;&#125;既可以用于定义dict，也可以用于定义集合，但是字典内的元素必须是key:value的格式，现在我们想定义一个空字典和空集合，该如何准确去定义两者?</span></span><br><span class="line">d = &#123;&#125; <span class="comment"># 默认是空字典 </span></span><br><span class="line">s = <span class="built_in">set</span>() <span class="comment"># 这才是定义空集合</span></span><br></pre></td></tr></table></figure>

<h2 id="7-3-类型转换"><a href="#7-3-类型转换" class="headerlink" title="7.3 类型转换"></a>7.3 类型转换</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 但凡能被for循环的遍历的数据类型（强调：遍历出的每一个值都必须为不可变类型）都可以传给set()转换成集合类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = <span class="built_in">set</span>((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="built_in">set</span>(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = <span class="built_in">set</span>(<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s,s1,s2,s3</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125; &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125; &#123;<span class="string">&#x27;name&#x27;</span>&#125; &#123;<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;n&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-4-使用"><a href="#7-4-使用" class="headerlink" title="7.4 使用"></a>7.4 使用</h2><h3 id="7-4-1-关系运算"><a href="#7-4-1-关系运算" class="headerlink" title="7.4.1 关系运算"></a>7.4.1 关系运算</h3><p>我们定义两个集合friends与friends2来分别存放两个人的好友名字，然后以这两个集合为例讲解集合的关系运算</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 = &#123;<span class="string">&quot;zero&quot;</span>,<span class="string">&quot;kevin&quot;</span>,<span class="string">&quot;jason&quot;</span>,<span class="string">&quot;egon&quot;</span>&#125; <span class="comment"># 用户1的好友们 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends2 = &#123;<span class="string">&quot;Jy&quot;</span>,<span class="string">&quot;ricky&quot;</span>,<span class="string">&quot;jason&quot;</span>,<span class="string">&quot;egon&quot;</span>&#125;   <span class="comment"># 用户2的好友们</span></span><br></pre></td></tr></table></figure>

<p>两个集合的关系如下图所示</p>
<p><img src="https://pic1.zhimg.com/80/v2-db98a5092d33449c4667fd2f9717a2c0_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.合集/并集(|)：求两个用户所有的好友（重复好友只留一个）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 | friends2</span><br><span class="line">&#123;<span class="string">&#x27;kevin&#x27;</span>, <span class="string">&#x27;ricky&#x27;</span>, <span class="string">&#x27;zero&#x27;</span>, <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;Jy&#x27;</span>, <span class="string">&#x27;egon&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.交集(&amp;)：求两个用户的共同好友</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 &amp; friends2</span><br><span class="line">&#123;<span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;egon&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.差集(-)：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 - friends2 <span class="comment"># 求用户1独有的好友</span></span><br><span class="line">&#123;<span class="string">&#x27;kevin&#x27;</span>, <span class="string">&#x27;zero&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends2 - friends1 <span class="comment"># 求用户2独有的好友</span></span><br><span class="line">&#123;<span class="string">&#x27;ricky&#x27;</span>, <span class="string">&#x27;Jy&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.对称差集(^) # 求两个用户独有的好友们（即去掉共有的好友）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 ^ friends2</span><br><span class="line">&#123;<span class="string">&#x27;kevin&#x27;</span>, <span class="string">&#x27;zero&#x27;</span>, <span class="string">&#x27;ricky&#x27;</span>, <span class="string">&#x27;Jy&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.值是否相等(==)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>friends1 == friends2</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.父集：一个集合是否包含另外一个集合</span></span><br><span class="line"><span class="comment"># 6.1 包含则返回True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; &gt; &#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; &gt;= &#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment"># 6.2 不存在包含关系，则返回False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; &gt; &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; &gt;= &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.子集</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125; &lt; &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125; &lt;= &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-2-去重"><a href="#7-4-2-去重" class="headerlink" title="7.4.2 去重"></a>7.4.2 去重</h3><p><img src="https://pic4.zhimg.com/80/v2-3c863c52c62660f0547ff39f09ac41b7_720w.jpg" alt="img"></p>
<p>集合去重复有局限性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 只能针对不可变类型</span></span><br><span class="line"><span class="comment"># 2. 集合本身是无序的，去重之后无法保留原来的顺序</span></span><br></pre></td></tr></table></figure>

<p>示例如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s=<span class="built_in">set</span>(l)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s <span class="comment"># 将列表转成了集合</span></span><br><span class="line">&#123;<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_new=<span class="built_in">list</span>(s) <span class="comment"># 再将集合转回列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_new</span><br><span class="line">[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>] <span class="comment"># 去除了重复，但是打乱了顺序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对不可变类型，并且保证顺序则需要我们自己写代码实现，例如</span></span><br><span class="line">l=[</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">73</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">20</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;female&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lili&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">new_l=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dic <span class="keyword">in</span> l:</span><br><span class="line">    <span class="keyword">if</span> dic <span class="keyword">not</span> <span class="keyword">in</span> new_l:</span><br><span class="line">        new_l.append(dic)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(new_l)</span><br><span class="line"><span class="comment"># 结果：既去除了重复，又保证了顺序，而且是针对不可变类型的去重</span></span><br><span class="line">[</span><br><span class="line">    &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;lili&#x27;</span>&#125;, </span><br><span class="line">    &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">73</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jack&#x27;</span>&#125;, </span><br><span class="line">    &#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;female&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tom&#x27;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="7-4-3-其他操作"><a href="#7-4-3-其他操作" class="headerlink" title="7.4.3 其他操作"></a>7.4.3 其他操作</h3><p><img src="https://pic3.zhimg.com/80/v2-825386b940849f68a704c35e40a1a5de_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.长度</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s=&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.成员运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;c&#x27;</span> <span class="keyword">in</span> s</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.循环</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> item <span class="keyword">in</span> s:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(item)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">c</span><br><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></table></figure>

<h2 id="7-5-练习"><a href="#7-5-练习" class="headerlink" title="7.5 练习"></a>7.5 练习</h2><p><img src="https://pic2.zhimg.com/80/v2-59e6a2d4c402f9178c89e0716037ec51_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">一.关系运算</span></span><br><span class="line"><span class="string">　　有如下两个集合，pythons是报名python课程的学员名字集合，linuxs是报名linux课程的学员名字集合</span></span><br><span class="line"><span class="string">　　pythons=&#123;&#x27;jason&#x27;,&#x27;egon&#x27;,&#x27;kevin&#x27;,&#x27;ricky&#x27;,&#x27;gangdan&#x27;,&#x27;biubiu&#x27;&#125;</span></span><br><span class="line"><span class="string">　　linuxs=&#123;&#x27;kermit&#x27;,&#x27;tony&#x27;,&#x27;gangdan&#x27;&#125;</span></span><br><span class="line"><span class="string">　　1. 求出即报名python又报名linux课程的学员名字集合</span></span><br><span class="line"><span class="string">　　2. 求出所有报名的学生名字集合</span></span><br><span class="line"><span class="string">　　3. 求出只报名python课程的学员名字</span></span><br><span class="line"><span class="string">　　4. 求出没有同时这两门课程的学员名字集合</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 求出即报名python又报名linux课程的学员名字集合</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pythons &amp; linuxs</span><br><span class="line"><span class="comment"># 求出所有报名的学生名字集合</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pythons | linuxs</span><br><span class="line"><span class="comment"># 求出只报名python课程的学员名字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pythons - linuxs</span><br><span class="line"><span class="comment"># 求出没有同时这两门课程的学员名字集合</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pythons ^ linuxs</span><br></pre></td></tr></table></figure>

<h2 id="八-可变类型与不可变类型"><a href="#八-可变类型与不可变类型" class="headerlink" title="八 可变类型与不可变类型"></a>八 可变类型与不可变类型</h2><p><strong>可变数据类型：</strong>值发生改变时，内存地址不变，即id不变，证明在改变原值</p>
<p><strong>不可变类型：</strong>值发生改变时，内存地址也发生改变，即id也变，证明是没有在改变原值，是产生了新的值</p>
<p><strong>数字类型:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x)</span><br><span class="line"><span class="number">1830448896</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x)</span><br><span class="line"><span class="number">1830448928</span></span><br><span class="line"><span class="comment"># 内存地址改变了，说明整型是不可变数据类型，浮点型也一样</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-aba483b5a4fce5be3c97c4e9eb358c6d_720w.jpg" alt="img"></p>
<p><strong>字符串</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="string">&quot;Jy&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x)</span><br><span class="line"><span class="number">938809263920</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="string">&quot;Ricky&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x)</span><br><span class="line"><span class="number">938809264088</span></span><br><span class="line"><span class="comment"># 内存地址改变了，说明字符串是不可变数据类型</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-bb67114dc6c8fe2694d4f9971b8ddc09_720w.jpg" alt="img"></p>
<p><strong>列表</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list1 = [<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;egon&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(list1)</span><br><span class="line"><span class="number">486316639176</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list1[<span class="number">2</span>] = <span class="string">&#x27;kevin&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(list1)</span><br><span class="line"><span class="number">486316639176</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list1.append(<span class="string">&#x27;lili&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(list1)</span><br><span class="line"><span class="number">486316639176</span></span><br><span class="line"><span class="comment"># 对列表的值进行操作时，值改变但内存地址不变，所以列表是可变数据类型</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-e2cc6a90794d0d79719ff0a898b3c467_720w.jpg" alt="img"></p>
<p><strong>元组</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;jack&quot;</span>,[<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1[<span class="number">0</span>]=<span class="string">&#x27;TOM&#x27;</span> <span class="comment"># 报错：TypeError</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1.append(<span class="string">&#x27;lili&#x27;</span>) <span class="comment"># 报错：TypeError</span></span><br><span class="line"><span class="comment"># 元组内的元素无法修改，指的是元组内索引指向的内存地址不能被修改</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;jack&quot;</span>,[<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t1[<span class="number">0</span>]),<span class="built_in">id</span>(t1[<span class="number">1</span>]),<span class="built_in">id</span>(t1[<span class="number">2</span>])</span><br><span class="line">(<span class="number">4327403152</span>, <span class="number">4327403072</span>, <span class="number">4327422472</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1[<span class="number">2</span>][<span class="number">0</span>]=<span class="number">111</span> <span class="comment"># 如果元组中存在可变类型，是可以修改，但是修改后的内存地址不变</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1</span><br><span class="line">(<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>, [<span class="number">111</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t1[<span class="number">0</span>]),<span class="built_in">id</span>(t1[<span class="number">1</span>]),<span class="built_in">id</span>(t1[<span class="number">2</span>]) <span class="comment"># 查看id仍然不变</span></span><br><span class="line">(<span class="number">4327403152</span>, <span class="number">4327403072</span>, <span class="number">4327422472</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-19bc37e4a9fedf83d1b352a502c49a57_720w.jpg" alt="img"></p>
<p><strong>字典</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;egon&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(dic)</span><br><span class="line"><span class="number">4327423112</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;age&#x27;</span>]=<span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;egon&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(dic)</span><br><span class="line"><span class="number">4327423112</span></span><br><span class="line"><span class="comment"># 对字典进行操作时，值改变的情况下，字典的id也是不变，即字典也是可变数据类型</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-52e2baab5ad65f3e470166e35bde772a_720w.jpg" alt="img"></p>
<h2 id="九-数据类型总结"><a href="#九-数据类型总结" class="headerlink" title="九 数据类型总结"></a>九 数据类型总结</h2><p><img src="https://pic4.zhimg.com/80/v2-a20045894184b0a3afad79f0542adbab_720w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-de70fc0b51f69ade62df5cc235acd493_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>1、数字类型：</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=13">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=13<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>2、字符串类型</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=14">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=14<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=15">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=15<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=16">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=16<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>3、列表类型</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=17">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=17<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=18">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=18<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>4、元组类型</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=19">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=19<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>5、字典类型</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=20">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=20<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=21">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=21<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=22">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=22<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=23">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=23<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>6、集合类型</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=24">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=24<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=25">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=25<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>7、小结</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=26">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=26<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>09-字符编码</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/09_%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p> 字符串类型、文本文件的内容都是由字符组成的，但凡涉及到字符的存取，都需要考虑字符编码的问题。</p>
<p> 字符编码这个知识点的典型特征就是理论多、结论少，但对于开发而言只需要记住结论即可，下面让我们来一点点介绍它</p>
<p><img src="https://pic1.zhimg.com/80/v2-621d28181cc40a235414a49fc9d14738_720w.jpg" alt="img"></p>
<h2 id="二-知识储备"><a href="#二-知识储备" class="headerlink" title="二 知识储备"></a>二 知识储备</h2><h2 id="2-1-三大核心硬件"><a href="#2-1-三大核心硬件" class="headerlink" title="2.1 三大核心硬件"></a>2.1 三大核心硬件</h2><p>所有软件都是运行硬件之上的，与运行软件相关的三大核心硬件为cpu、内存、硬盘，我们需要明确三点</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、软件运行前，软件的代码及其相关数据都是存放于硬盘中的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、任何软件的启动都是将数据从硬盘中读入内存，然后cpu从内存中取出指令并执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、软件运行过程中产生的数据最先都是存放于内存中的，若想永久保存软件产生的数据，则需要将数据由内存写入硬盘</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-48e25e7f03030e066f8fcaf4750cc892_720w.jpg" alt="img"></p>
<h2 id="2-2-文本编辑器读取文件内容的流程"><a href="#2-2-文本编辑器读取文件内容的流程" class="headerlink" title="2.2 文本编辑器读取文件内容的流程"></a>2.2 文本编辑器读取文件内容的流程</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#阶段1、启动一个文件编辑器（文本编辑器如nodepad++，pycharm，word）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#阶段2、文件编辑器会将文件内容从硬盘读入内存</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#阶段3、文本编辑器会将刚刚读入内存中的内容显示到屏幕上</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-python解释器执行文件的流程"><a href="#2-3-python解释器执行文件的流程" class="headerlink" title="2.3 python解释器执行文件的流程"></a>2.3 python解释器执行文件的流程</h2><p>以python test.py为例，执行流程如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#阶段1、启动python解释器，此时就相当于启动了一个文本编辑器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#阶段2、python解释器相当于文本编辑器，从硬盘上将test.py的内容读入到内存中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#阶段3、python解释器解释执行刚刚读入的内存的内容，开始识别python语法</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-总结"><a href="#2-4-总结" class="headerlink" title="2.4 总结"></a>2.4 总结</h2><p>python解释器与文件本编辑的异同如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、相同点：前两个阶段二者完全一致，都是将硬盘中文件的内容读入内存，详解如下</span></span><br><span class="line">python解释器是解释执行文件内容的，因而python解释器具备读py文件的功能，这一点与文本编辑器一样</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、不同点：在阶段3时，针对内存中读入的内容处理方式不同，详解如下</span></span><br><span class="line">文本编辑器将文件内容读入内存后，是为了显示或者编辑，根本不去理会python的语法，而python解释器将文件内容读入内存后，可不是为了给你瞅一眼python代码写的啥，而是为了执行python代码、会识别python语法）</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-c80921c5d7ede2fd94262892c7e0a733_720w.jpg" alt="img"></p>
<h2 id="三、字符编码介绍"><a href="#三、字符编码介绍" class="headerlink" title="三、字符编码介绍"></a>三、字符编码介绍</h2><h2 id="3-1-什么是字符编码？"><a href="#3-1-什么是字符编码？" class="headerlink" title="3.1 什么是字符编码？"></a>3.1 什么是字符编码？</h2><p>人类在与计算机交互时，用的都是人类能读懂的字符，如中文字符、英文字符、日文字符等</p>
<p>而计算机只能识别二进制数,详解如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#二进制数即由0和1组成的数字，例如010010101010。计算机是基于电工作的，电的特性即高低电平，人类从逻辑层面将高电平对应为数字1,低电平对应为数字0，这直接决定了计算机可以识别的是由0和1组成的数字</span></span><br></pre></td></tr></table></figure>

<p>毫无疑问，由人类的字符到计算机中的数字，必须经历一个过程，如下</p>
<p><img src="https://pic1.zhimg.com/80/v2-80b925e192579faa59dcffbb046535a4_720w.jpg" alt="img"></p>
<p>翻译的过程必须参照一个特定的标准，该标准称之为字符编码表，该表上存放的就是字符与数字一一对应的关系。</p>
<p>字符编码中的编码指的是翻译或者转换的意思，即将人能理解的字符翻译成计算机能识别的数字</p>
<h2 id="3-2-字符编码表的发展史-了解"><a href="#3-2-字符编码表的发展史-了解" class="headerlink" title="3.2 字符编码表的发展史 (了解)"></a>3.2 字符编码表的发展史 (了解)</h2><p>字符编码的发展经历了三个重要的阶段，如下</p>
<h3 id="3-2-1-阶段一：一家独大"><a href="#3-2-1-阶段一：一家独大" class="headerlink" title="3.2.1 阶段一：一家独大"></a>3.2.1 阶段一：一家独大</h3><p>现代计算机起源于美国，所以最先考虑仅仅是让计算机识别英文字符，于是诞生了ASCII表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ASCII表的特点:</span></span><br><span class="line">    <span class="number">1</span>、只有英文字符与数字的一一对应关系</span><br><span class="line">    <span class="number">2</span>、一个英文字符对应1Bytes，1Bytes=8bit，8bit最多包含<span class="number">256</span>个数字，可以对应<span class="number">256</span>个字符，足够表示所有英文字符</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-c4a210efb1a57b869288eb7e89bf6fc9_720w.jpg" alt="img"></p>
<h3 id="3-2-2-阶段二：诸侯割据、天下大乱"><a href="#3-2-2-阶段二：诸侯割据、天下大乱" class="headerlink" title="3.2.2 阶段二：诸侯割据、天下大乱"></a>3.2.2 阶段二：诸侯割据、天下大乱</h3><p><img src="https://pic2.zhimg.com/80/v2-114700ee2814bcf3de172a4b673001e1_720w.jpg" alt="img"></p>
<p>为了让计算机能够识别中文和英文，中国人定制了GBK</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># GBK表的特点：</span></span><br><span class="line">    <span class="number">1</span>、只有中文字符、英文字符与数字的一一对应关系</span><br><span class="line">    <span class="number">2</span>、一个英文字符对应1Bytes</span><br><span class="line">       一个中文字符对应2Bytes   </span><br><span class="line">       补充说明：</span><br><span class="line">       1Bytes=8bit，8bit最多包含<span class="number">256</span>个数字，可以对应<span class="number">256</span>个字符，足够表示所有英文字符</span><br><span class="line">       2Bytes=16bit，16bit最多包含<span class="number">65536</span>个数字，可以对应<span class="number">65536</span>个字符，足够表示所有中文字符</span><br></pre></td></tr></table></figure>

<p>每个国家都各自的字符，为让计算机能够识别自己国家的字符外加英文字符，各个国家都制定了自己的字符编码表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Shift_JIS表的特点：</span></span><br><span class="line">    <span class="number">1</span>、只有日文字符、英文字符与数字的一一对应关系</span><br><span class="line"></span><br><span class="line"><span class="comment"># Euc-kr表的特点：</span></span><br><span class="line">    <span class="number">1</span>、只有韩文字符、英文字符与数字的一一对应关系</span><br></pre></td></tr></table></figure>

<p>此时,美国人用的计算机里使用字符编码标准是ASCII、中国人用的计算机里使用字符编码标准是GBK、日本人用的计算机里使用字符编码标准是Shift_JIS,如下图所示，</p>
<p><img src="https://pic3.zhimg.com/80/v2-19bac7b0910652bbd1f7e026683a28be_720w.jpg" alt="img"></p>
<p>字符编码发展到了这个阶段，可以用一句话概括：诸侯割据、天下大乱，详解如下</p>
<p><img src="https://pic3.zhimg.com/80/v2-b6ac2031b2082daa422c8dc233be95ee_720w.jpg" alt="img"></p>
<p>图1中，文本编辑存取文件的原理如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">文本文件内容全都为字符，无论存取都是涉及到字符编码问题</span><br><span class="line"><span class="comment">#1、存文本文件</span></span><br><span class="line">人类通过文本编辑器输入的字符会被转化成ASCII格式的二进制存放于内存中，如果需要永久保存，则直接将内存中的ASCII格式的二进制写入硬盘</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、读文本文件</span></span><br><span class="line">直接将硬盘中的ASCII格式的二进制读入内存，然后通过ASCII表反解成英文字符</span><br></pre></td></tr></table></figure>

<p>图2图3都是相同的过程，此时无论是存还是取由于采用的字符编码表一样，所以肯定不会出现乱码问题，但问题是在美国人用的计算机里只能输入英文字符，而在中国人用的计算机里只能输入中文字符和英文字符….,毫无疑问我们希望计算机允许我们输入万国字符均可识别、不乱码，而现阶段计算机采用的字符编码ASCII、GBK、Shift_JIS都无法识别万国字符，所以我们必须定制一个兼容万国字符的编码表，请看阶段三</p>
<p><img src="https://pic3.zhimg.com/80/v2-aeb16d83abab152e00e7e2f99eaeb102_720w.jpg" alt="img"></p>
<h3 id="3-2-3-阶段三：分久必合"><a href="#3-2-3-阶段三：分久必合" class="headerlink" title="3.2.3 阶段三：分久必合"></a>3.2.3 阶段三：分久必合</h3><p><img src="https://pic1.zhimg.com/80/v2-f405404cd434f2280b4586c4f95ce760_720w.jpg" alt="img"></p>
<p>unicode于1990年开始研发，1994年正式公布，具备两大特点：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1. 存在所有语言中的所有字符与数字的一一对应关系,即兼容万国字符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 与传统的字符编码的二进制数都有对应关系，详解如下</span></span><br></pre></td></tr></table></figure>

<p>很多地方或老的系统、应用软件仍会采用各种各样传统的编码，这是历史遗留问题。此处需要强调：软件是存放于硬盘的，而运行软件是要将软件加载到内存的，面对硬盘中存放的各种传统编码的软件，想让我们的计算机能够将它们全都正常运行而不出现乱码，内存中必须有一种兼容万国的编码，并且该编码需要与其他编码有相对应的映射&#x2F;转换关系，这就是unicode的第二大特点产生的缘由</p>
<p><img src="https://pic1.zhimg.com/80/v2-484a43054d2217ed11c7d5d9170675f8_720w.jpg" alt="img"></p>
<p>文本编辑器输入任何字符都是最新存在于内存中，是unicode编码的，存放于硬盘中，则可以转换成任意其他编码，只要该编码可以支持相应的字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 英文字符可以被ASCII识别</span></span><br><span class="line">英文字符---&gt;unciode格式的数字---&gt;ASCII格式的数字</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中文字符、英文字符可以被GBK识别</span></span><br><span class="line">中文字符、英文字符---&gt;unicode格式的数字---&gt;gbk格式的数字</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日文字符、英文字符可以被shift-JIS识别</span></span><br><span class="line">日文字符、英文字符---&gt;unicode格式的数字---&gt;shift-JIS格式的数字</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-77be4ea6e528d6ed700fd08b2096566f_720w.jpg" alt="img"></p>
<h2 id="3-3-编码与解码"><a href="#3-3-编码与解码" class="headerlink" title="3.3 编码与解码"></a>3.3 编码与解码</h2><p>由字符转换成内存中的unicode，以及由unicode转换成其他编码的过程，都称为编码encode</p>
<p><img src="https://pic3.zhimg.com/80/v2-08a12814397a5a6d3e530a66cf2dbc02_720w.jpg" alt="img"></p>
<p>由内存中的unicode转换成字符，以及由其他编码转换成unicode的过程，都称为解码decode</p>
<p><img src="https://pic4.zhimg.com/80/v2-5f7b25aaeb4ccc913f0c23d586acdbab_720w.jpg" alt="img"></p>
<p>在诸多文件类型中，只有文本文件的内存是由字符组成的，因而文本文件的存取也涉及到字符编码的问题</p>
<h2 id="3-4-utf-8的由来"><a href="#3-4-utf-8的由来" class="headerlink" title="3.4 utf-8的由来"></a>3.4 utf-8的由来</h2><p>注意：如果保存到硬盘的是GBK格式二进制，当初用户输入的字符只能是中文或英文，同理如果保存到硬盘的是Shift_JIS格式二进制，当初用户输入的字符只能是日文或英文……如果我们输入的字符中包含多国字符，那么该如何处理？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#多国字符—√—》内存（unicode格式的二进制）——X—》硬盘（GBK格式的二进制）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多国字符—√—》内存（unicode格式的二进制）——X—》硬盘（Shift_JIS格式的二进制）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多国字符—√—》内存（unicode格式的二进制）——√—》硬盘（???格式的二进制）</span></span><br></pre></td></tr></table></figure>

<p>理论上是可以将内存中unicode格式的二进制直接存放于硬盘中的，但由于unicode固定使用两个字节来存储一个字符，如果多国字符中包含大量的英文字符时，使用unicode格式存放会额外占用一倍空间（英文字符其实只需要用一个字节存放即可），然而空间占用并不是最致命的问题，最致命地是当我们由内存写入硬盘时会额外耗费一倍的时间，所以将内存中的unicode二进制写入硬盘或者基于网络传输时必须将其转换成一种精简的格式，这种格式即utf-8（全称Unicode Transformation Format，即unicode的转换格式）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 多国字符—√—》内存（unicode格式的二进制）——√—》硬盘（utf-8格式的二进制）</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-c2a4ec82d946e4e35645f9782dbc798a_720w.jpg" alt="img"></p>
<p>那为何在内存中不直接使用utf-8呢？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">utf-<span class="number">8</span>是针对Unicode的可变长度字符编码：一个英文字符占1Bytes，一个中文字符占3Bytes，生僻字用更多的Bytes存储</span><br><span class="line"></span><br><span class="line">unicode更像是一个过渡版本，我们新开发的软件或文件存入硬盘都采用utf-<span class="number">8</span>格式，等过去几十年，所有老编码的文件都淘汰掉之后，会出现一个令人开心的场景，即硬盘里放的都是utf-<span class="number">8</span>格式，此时unicode便可以退出历史舞台，内存里也改用utf-<span class="number">8</span>，天下重新归于统一</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-183090ce203c9e1b6edab8aff77460cb_720w.jpg" alt="img"></p>
<h2 id="四-字符编码的应用"><a href="#四-字符编码的应用" class="headerlink" title="四 字符编码的应用"></a>四 字符编码的应用</h2><p>我们学习字符编码就是为了存取字符时不发生乱码问题：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、内存中固定使用unicode无论输入任何字符都不会发生乱码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、我们能够修改的是存/取硬盘的编码方式，如果编码设置不正确将会出现乱码问题。乱码问题分为两种：存乱了，读乱了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.1 存乱了：如果用户输入的内容中包含中文和日文字符，如果单纯以shift_JIS存，日文可以正常写入硬盘，而由于中文字符在shift_jis中没有找到对应关系而导致存乱了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.2 读乱了：如果硬盘中的数据是shift_JIS格式存储的，采GBK格式读入内存就读乱了</span></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1. 保证存的时候不乱：在由内存写入硬盘时，必须将编码格式设置为支持所输入字符的编码格式</span></span><br><span class="line"><span class="comment">#2. 保证存的时候不乱：在由硬盘读入内存时，必须采用与写入硬盘时相同的编码格式</span></span><br></pre></td></tr></table></figure>

<h2 id="4-1-文本编辑器nodpad-存取文本文件"><a href="#4-1-文本编辑器nodpad-存取文本文件" class="headerlink" title="4.1 文本编辑器nodpad++存取文本文件"></a>4.1 文本编辑器nodpad++存取文本文件</h2><p>文本编辑器存取的都是文本文件，而文本文件中包含的内容全为字符，所以存取文本文件都涉及到字符编码的问题。</p>
<p><img src="https://pic4.zhimg.com/80/v2-80d179cdb9262eced650c8574bc74d33_720w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-75e2cb4b6932bc76c6161a086ad1a5a3_720w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-3d3b0ae681354751c1a85d75b27ee1d0_720w.jpg" alt="img"></p>
<h2 id="4-2-python解释器执行文件的前两个阶段"><a href="#4-2-python解释器执行文件的前两个阶段" class="headerlink" title="4.2 python解释器执行文件的前两个阶段"></a>4.2 python解释器执行文件的前两个阶段</h2><p>执行py文件的前两个阶段就是python解释器读文本文件的过程，与文本编辑读文本文件的前两个阶段没人任何区别，要保证读不乱码，则必须将python解释器读文件时采用的编码方式设置为文件当初写入硬盘时的编码格式，如果没有设置，python解释器则才用默认的编码方式，在python3中默认为utf-8，在python2中默认为ASCII，我们可以通过指定文件头来修改默认的编码</p>
<ul>
<li>在文件首行写入包含#号在内的以下内容</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: 当初文件写入硬盘时采用的编码格式</span></span><br></pre></td></tr></table></figure>

<p>解释器会先用默认的编码方式读取文件的首行内容，由于首行是纯英文组成，而任何编码方式都可以识别英文字符。</p>
<p><img src="https://pic4.zhimg.com/80/v2-b39022bd9969bcba565b7cfe6c067b13_720w.jpg" alt="img"></p>
<h2 id="4-3-python解释器执行文件的第三个阶段"><a href="#4-3-python解释器执行文件的第三个阶段" class="headerlink" title="4.3 python解释器执行文件的第三个阶段"></a>4.3 python解释器执行文件的第三个阶段</h2><p>设置文件头的作用是保证运行python程序的前两个阶段不乱码，经过前两个阶段后py文件的内容都会以unicode格式存放于内存中。</p>
<p>在经历第三个阶段时开始识别python语法，当遇到特定的语法name &#x3D; ‘上’（代码本身也都全都是unicode格式存的）时，需要申请内存空间来存储字符串’上’，这就又涉及到应该以什么编码存储‘上’的问题了。</p>
<p>在Python3中，字符串类的值都是使用unicode格式来存储</p>
<p>由于Python2的盛行是早于unicode的，因此在Python2中是按照文件头指定的编码来存储字符串类型的值的（如果文件头中没有指定编码，那么解释器会按照它自己默认的编码方式来存储‘上’），所以，这就有可能导致乱码问题</p>
<p><img src="https://pic2.zhimg.com/80/v2-d27cfdaa0659c34c85fcff4a48a4e2f9_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line">x = <span class="string">&#x27;上&#x27;</span> <span class="comment"># x的值为untf-8格式的二进制</span></span><br><span class="line"><span class="built_in">print</span>(x) <span class="comment"># 打印操作是将x的值，即utf-8格式的二进制交给终端，当终端收到后发现并不是unicode（只有unicode才与字符有对应关系），所以终端会执行操作：utf-8二进制---解码--&gt;unicode格式的二进制，解码的过程终端会采用自己默认的编码，而在pycharm的终端默认编码为utf-8、windows下的cmd终端的默认编码为gbk，所以该打印操作在pycharm中显示正常，而在windows下的cmd中则乱码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在windows下的cmd中运行效果如下</span></span><br><span class="line">C:\Users\Administrator&gt;python2 E:\aaa.py</span><br><span class="line">涓</span><br></pre></td></tr></table></figure>

<p>python2后推出了一种补救措施，就是在字符串类型前加u，则会将字符串类型强制存储unicode，这就与python3保持一致了，对于unicode格式无论丢给任何终端进行打印，都可以直接对应字符不会出现乱码问题</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line">x = <span class="string">u&#x27;上&#x27;</span> <span class="comment"># 即便文件头为utf-8，x的值依然存成unicode</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-1ef12a426d5d928e8ce10eafef489616_720w.jpg" alt="img"></p>
<h2 id="4-4-字符串encode编码与decode解码的使用"><a href="#4-4-字符串encode编码与decode解码的使用" class="headerlink" title="4.4 字符串encode编码与decode解码的使用"></a>4.4 字符串encode编码与decode解码的使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、unicode格式------编码encode--------&gt;其它编码格式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="string">&#x27;上&#x27;</span> <span class="comment"># 在python3在&#x27;上&#x27;被存成unicode</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=x.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res,<span class="built_in">type</span>(res) <span class="comment"># unicode编码成了utf-8格式，而编码的结果为bytes类型，可以当作直接当作二进制去使用</span></span><br><span class="line">(<span class="string">b&#x27;\xe4\xb8\x8a&#x27;</span>, &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">bytes</span>&#x27;&gt;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># 2、其它编码格式------解码<span class="title">decode</span>--------&gt;unicode格式</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; res.decode(&#x27;utf-8&#x27;) </span></span><br><span class="line"><span class="class">&#x27;上&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=27">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=27<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=28">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=28<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=29">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=29<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=30">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=30<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>10-文件处理</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/10_%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p> 应用程序运行过程中产生的数据最先都是存放于内存中的，若想永久保存下来，必须要保存于硬盘中。应用程序若想操作硬件必须通过操作系统，而文件就是操作系统提供给应用程序来操作硬盘的虚拟概念，用户或应用程序对文件的操作，就是向操作系统发起调用，然后由操作系统完成对硬盘的具体操作。</p>
<p><img src="https://pic2.zhimg.com/80/v2-e1c5ac2494f15c2d7a1ee4732fbb9289_720w.jpg" alt="img"></p>
<h2 id="二-文件操作的基本流程"><a href="#二-文件操作的基本流程" class="headerlink" title="二 文件操作的基本流程"></a>二 文件操作的基本流程</h2><h2 id="2-1-基本流程"><a href="#2-1-基本流程" class="headerlink" title="2.1 基本流程"></a>2.1 基本流程</h2><p><img src="https://pic3.zhimg.com/80/v2-5f2bdccc6b9d407c733fe1c4315a050a_720w.jpg" alt="img"></p>
<p>有了文件的概念，我们无需再去考虑操作硬盘的细节，只需要关注操作文件的流程：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 打开文件，由应用程序向操作系统发起系统调用open(...)，操作系统打开该文件，对应一块硬盘空间，并返回一个文件对象赋值给一个变量f</span></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment">#默认打开模式就为r</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 调用文件对象下的读/写方法，会被操作系统转换为读/写硬盘的操作</span></span><br><span class="line">data=f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 向操作系统发起关闭文件的请求，回收系统资源</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-df5334d72003b1b12e88bdf983af6b5d_720w.jpg" alt="img"></p>
<h2 id="2-2-资源回收与with上下文管理"><a href="#2-2-资源回收与with上下文管理" class="headerlink" title="2.2 资源回收与with上下文管理"></a>2.2 资源回收与with上下文管理</h2><p>打开一个文件包含两部分资源：应用程序的变量f和操作系统打开的文件。在操作完毕一个文件时，必须把与该文件的这两部分资源全部回收，回收方法为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、f.close() <span class="comment">#回收操作系统打开的文件资源</span></span><br><span class="line"><span class="number">2</span>、<span class="keyword">del</span> f <span class="comment">#回收应用程序级的变量</span></span><br></pre></td></tr></table></figure>

<p>其中del f一定要发生在f.close()之后，否则就会导致操作系统打开的文件无法关闭，白白占用资源， 而python自动的垃圾回收机制决定了我们无需考虑del f，这就要求我们，在操作完毕文件后，一定要记住f.close()，虽然我们如此强调，但是大多数读者还是会不由自主地忘记f.close()，考虑到这一点，python提供了with关键字来帮我们管理上下文</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1、在执行完子代码块后，with 会自动执行f.close()</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">pass</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、可用用with同时打开多个文件，用逗号分隔开即可</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> read_f,<span class="built_in">open</span>(<span class="string">&#x27;b.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> write_f:  </span><br><span class="line">    data = read_f.read()</span><br><span class="line">    write_f.write(data)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-d5d2e9ba1e1584d711be9141313c9a55_720w.jpg" alt="img"></p>
<h2 id="2-3-指定操作文本文件的字符编码"><a href="#2-3-指定操作文本文件的字符编码" class="headerlink" title="2.3 指定操作文本文件的字符编码"></a>2.3 指定操作文本文件的字符编码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(...)是由操作系统打开文件，如果打开的是文本文件，会涉及到字符编码问题，如果没有为<span class="built_in">open</span>指定编码，那么打开文本文件的默认编码很明显是操作系统说了算了，操作系统会用自己的默认编码去打开文件，在windows下是gbk，在linux下是utf-<span class="number">8</span>。</span><br><span class="line">这就用到了上节课讲的字符编码的知识：若要保证不乱码，文件以什么方式存的，就要以什么方式打开。</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-fc61df44636a5f14346f24fae99f1b67_720w.jpg" alt="img"></p>
<h2 id="三-文件的操作模式"><a href="#三-文件的操作模式" class="headerlink" title="三 文件的操作模式"></a>三 文件的操作模式</h2><h2 id="3-1-控制文件读写操作的模式"><a href="#3-1-控制文件读写操作的模式" class="headerlink" title="3.1 控制文件读写操作的模式"></a>3.1 控制文件读写操作的模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r(默认的)：只读</span><br><span class="line">w：只写</span><br><span class="line">a：只追加写</span><br></pre></td></tr></table></figure>

<h3 id="3-1-1-案例一：r-模式的使用"><a href="#3-1-1-案例一：r-模式的使用" class="headerlink" title="3.1.1 案例一：r 模式的使用"></a>3.1.1 案例一：r 模式的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># r只读模式: 在文件不存在时则报错,文件存在文件内指针直接跳到文件开头</span></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     res=f.read() <span class="comment"># 会将文件的内容由硬盘全部读入内存，赋值给res</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小练习：实现用户认证功能</span></span><br><span class="line"> inp_name=<span class="built_in">input</span>(<span class="string">&#x27;请输入你的名字: &#x27;</span>).strip()</span><br><span class="line"> inp_pwd=<span class="built_in">input</span>(<span class="string">&#x27;请输入你的密码: &#x27;</span>).strip()</span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;db.txt&#x27;</span>,mode=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">         <span class="comment"># 把用户输入的名字与密码与读出内容做比对</span></span><br><span class="line">         u,p=line.strip(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">         <span class="keyword">if</span> inp_name == u <span class="keyword">and</span> inp_pwd == p:</span><br><span class="line">             <span class="built_in">print</span>(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">             <span class="keyword">break</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&#x27;账号名或者密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-案例二：w-模式的使用"><a href="#3-1-2-案例二：w-模式的使用" class="headerlink" title="3.1.2 案例二：w 模式的使用"></a>3.1.2 案例二：w 模式的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># w只写模式: 在文件不存在时会创建空文档,文件存在会清空文件,文件指针跑到文件开头</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;b.txt&#x27;</span>,mode=<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;你好\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;我好\n&#x27;</span>) </span><br><span class="line">    f.write(<span class="string">&#x27;大家好\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;111\n222\n333\n&#x27;</span>)</span><br><span class="line"><span class="comment">#强调：</span></span><br><span class="line"><span class="comment"># 1 在文件不关闭的情况下,连续的写入，后写的内容一定跟在前写内容的后面</span></span><br><span class="line"><span class="comment"># 2 如果重新以w模式打开文件，则会清空文件内容</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-案例三：a-模式的使用"><a href="#3-1-3-案例三：a-模式的使用" class="headerlink" title="3.1.3 案例三：a 模式的使用"></a>3.1.3 案例三：a 模式的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># a只追加写模式: 在文件不存在时会创建空文档,文件存在会将文件指针直接移动到文件末尾</span></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;c.txt&#x27;</span>,mode=<span class="string">&#x27;a&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     f.write(<span class="string">&#x27;44444\n&#x27;</span>)</span><br><span class="line">     f.write(<span class="string">&#x27;55555\n&#x27;</span>)</span><br><span class="line"><span class="comment">#强调 w 模式与 a 模式的异同：</span></span><br><span class="line"><span class="comment"># 1 相同点：在打开的文件不关闭的情况下，连续的写入，新写的内容总会跟在前写的内容之后</span></span><br><span class="line"><span class="comment"># 2 不同点：以 a 模式重新打开文件，不会清空原文件内容，会将文件指针直接移动到文件末尾，新写的内容永远写在最后</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小练习：实现注册功能:</span></span><br><span class="line"> name=<span class="built_in">input</span>(<span class="string">&#x27;username&gt;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line"> pwd=<span class="built_in">input</span>(<span class="string">&#x27;password&gt;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db1.txt&#x27;</span>,mode=<span class="string">&#x27;a&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     info=<span class="string">&#x27;%s:%s\n&#x27;</span> %(name,pwd)</span><br><span class="line">     f.write(info)</span><br></pre></td></tr></table></figure>

<h3 id="3-1-4-案例四：-模式的使用-了解"><a href="#3-1-4-案例四：-模式的使用-了解" class="headerlink" title="3.1.4 案例四：+ 模式的使用(了解)"></a>3.1.4 案例四：+ 模式的使用(了解)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># r+ w+ a+ :可读可写</span></span><br><span class="line"><span class="comment">#在平时工作中，我们只单纯使用r/w/a，要么只读，要么只写，一般不用可读可写的模式</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-bea42b94950b49f8be785289904e17b7_720w.jpg" alt="img"></p>
<h2 id="3-2-控制文件读写内容的模式"><a href="#3-2-控制文件读写内容的模式" class="headerlink" title="3.2 控制文件读写内容的模式"></a>3.2 控制文件读写内容的模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">大前提: tb模式均不能单独使用,必须与r/w/a之一结合使用</span><br><span class="line">t（默认的）：文本模式</span><br><span class="line">    <span class="number">1.</span> 读写文件都是以字符串为单位的</span><br><span class="line">    <span class="number">2.</span> 只能针对文本文件</span><br><span class="line">    <span class="number">3.</span> 必须指定encoding参数</span><br><span class="line">b：二进制模式:</span><br><span class="line">   <span class="number">1.</span>读写文件都是以<span class="built_in">bytes</span>/二进制为单位的</span><br><span class="line">   <span class="number">2.</span> 可以针对所有文件</span><br><span class="line">   <span class="number">3.</span> 一定不能指定encoding参数</span><br></pre></td></tr></table></figure>

<h3 id="3-2-1-案例一：t-模式的使用"><a href="#3-2-1-案例一：t-模式的使用" class="headerlink" title="3.2.1 案例一：t 模式的使用"></a>3.2.1 案例一：t 模式的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># t 模式：如果我们指定的文件打开模式为r/w/a，其实默认就是rt/wt/at</span></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     res=f.read() </span><br><span class="line">     <span class="built_in">print</span>(<span class="built_in">type</span>(res)) <span class="comment"># 输出结果为：&lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;wt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     s=<span class="string">&#x27;abc&#x27;</span></span><br><span class="line">     f.write(s) <span class="comment"># 写入的也必须是字符串类型</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#强调：t 模式只能用于操作文本文件,无论读写，都应该以字符串为单位，而存取硬盘本质都是二进制的形式，当指定 t 模式时，内部帮我们做了编码与解码</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-案例二：-b-模式的使用"><a href="#3-2-2-案例二：-b-模式的使用" class="headerlink" title="3.2.2 案例二： b 模式的使用"></a>3.2.2 案例二： b 模式的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># b: 读写都是以二进制位单位</span></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.mp4&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     data=f.read()</span><br><span class="line">     <span class="built_in">print</span>(<span class="built_in">type</span>(data)) <span class="comment"># 输出结果为：&lt;class &#x27;bytes&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     msg=<span class="string">&quot;你好&quot;</span></span><br><span class="line">     res=msg.encode(<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># res为bytes类型</span></span><br><span class="line">     f.write(res) <span class="comment"># 在b模式下写入文件的只能是bytes类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#强调：b模式对比t模式</span></span><br><span class="line"><span class="number">1</span>、在操作纯文本文件方面t模式帮我们省去了编码与解码的环节，b模式则需要手动编码与解码，所以此时t模式更为方便</span><br><span class="line"><span class="number">2</span>、针对非文本文件（如图片、视频、音频等）只能使用b模式</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小练习： 编写拷贝工具</span></span><br><span class="line">src_file=<span class="built_in">input</span>(<span class="string">&#x27;源文件路径: &#x27;</span>).strip()</span><br><span class="line">dst_file=<span class="built_in">input</span>(<span class="string">&#x27;目标文件路径: &#x27;</span>).strip()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;%s&#x27;</span> %src_file,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> read_f,<span class="built_in">open</span>(<span class="string">r&#x27;%s&#x27;</span> %dst_file,mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> write_f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> read_f:</span><br><span class="line">        <span class="comment"># print(line)</span></span><br><span class="line">        write_f.write(line)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-4af94c11c6a45976fca8c53a0794c3a2_720w.jpg" alt="img"></p>
<h2 id="四-操作文件的方法"><a href="#四-操作文件的方法" class="headerlink" title="四 操作文件的方法"></a>四 操作文件的方法</h2><h2 id="4-1-重点"><a href="#4-1-重点" class="headerlink" title="4.1 重点"></a>4.1 重点</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 读操作</span></span><br><span class="line">f.read()  <span class="comment"># 读取所有内容,执行完该操作后，文件指针会移动到文件末尾</span></span><br><span class="line">f.readline()  <span class="comment"># 读取一行内容,光标移动到第二行首部</span></span><br><span class="line">f.readlines()  <span class="comment"># 读取每一行内容,存放于列表中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强调：</span></span><br><span class="line"><span class="comment"># f.read()与f.readlines()都是将内容一次性读入内容，如果内容过大会导致内存溢出，若还想将内容全读入内存，则必须分多次读入，有两种实现方式：</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line) <span class="comment"># 同一时刻只读入一行内容到内存中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.mp4&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data=f.read(<span class="number">1024</span>) <span class="comment"># 同一时刻只读入1024个Bytes到内存中</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(data) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写操作</span></span><br><span class="line">f.write(<span class="string">&#x27;1111\n222\n&#x27;</span>)  <span class="comment"># 针对文本模式的写,需要自己写换行符</span></span><br><span class="line">f.write(<span class="string">&#x27;1111\n222\n&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 针对b模式的写,需要自己写换行符</span></span><br><span class="line">f.writelines([<span class="string">&#x27;333\n&#x27;</span>,<span class="string">&#x27;444\n&#x27;</span>])  <span class="comment"># 文件模式</span></span><br><span class="line">f.writelines([<span class="built_in">bytes</span>(<span class="string">&#x27;333\n&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>),<span class="string">&#x27;444\n&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)]) <span class="comment">#b模式</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-30d5763461db05414c3ac2cc944a8f6e_720w.jpg" alt="img"></p>
<h2 id="4-2-了解"><a href="#4-2-了解" class="headerlink" title="4.2 了解"></a>4.2 了解</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f.readable()  <span class="comment"># 文件是否可读</span></span><br><span class="line">f.writable()  <span class="comment"># 文件是否可读</span></span><br><span class="line">f.closed  <span class="comment"># 文件是否关闭</span></span><br><span class="line">f.encoding  <span class="comment"># 如果文件打开模式为b,则没有该属性</span></span><br><span class="line">f.flush()  <span class="comment"># 立刻将文件内容从内存刷到硬盘</span></span><br><span class="line">f.name</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-3474d487b3fb518ce9b511c73153ce78_720w.jpg" alt="img"></p>
<h2 id="五-主动控制文件内指针移动"><a href="#五-主动控制文件内指针移动" class="headerlink" title="五 主动控制文件内指针移动"></a>五 主动控制文件内指针移动</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#大前提:文件内指针的移动都是Bytes为单位的,唯一例外的是t模式下的read(n),n以字符为单位</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     data=f.read(<span class="number">3</span>) <span class="comment"># 读取3个字符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     data=f.read(<span class="number">3</span>) <span class="comment"># 读取3个Bytes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 之前文件内指针的移动都是由读/写操作而被动触发的，若想读取文件某一特定位置的数据，则则需要用f.seek方法主动控制文件内指针的移动，详细用法如下：</span></span><br><span class="line"><span class="comment"># f.seek(指针移动的字节数,模式控制): </span></span><br><span class="line"><span class="comment"># 模式控制:</span></span><br><span class="line"><span class="comment"># 0: 默认的模式,该模式代表指针移动的字节数是以文件开头为参照的</span></span><br><span class="line"><span class="comment"># 1: 该模式代表指针移动的字节数是以当前所在的位置为参照的</span></span><br><span class="line"><span class="comment"># 2: 该模式代表指针移动的字节数是以文件末尾的位置为参照的</span></span><br><span class="line"><span class="comment"># 强调:其中0模式可以在t或者b模式使用,而1跟2模式只能在b模式下用</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-2b5a0f6ecedec41601c52959b34d7f5a_720w.jpg" alt="img"></p>
<h2 id="5-1-案例一：-0模式详解"><a href="#5-1-案例一：-0模式详解" class="headerlink" title="5.1 案例一： 0模式详解"></a>5.1 案例一： 0模式详解</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># a.txt用utf-8编码，内容如下（abc各占1个字节，中文“你好”各占3个字节）</span></span><br><span class="line">abc你好</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0模式的使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">3</span>,<span class="number">0</span>)     <span class="comment"># 参照文件开头移动了3个字节</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell()) <span class="comment"># 查看当前文件指针距离文件开头的位置，输出结果为3</span></span><br><span class="line">    <span class="built_in">print</span>(f.read()) <span class="comment"># 从第3个字节的位置读到文件末尾，输出结果为：你好</span></span><br><span class="line">    <span class="comment"># 注意：由于在t模式下，会将读取的内容自动解码，所以必须保证读取的内容是一个完整中文数据，否则解码失败</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">6</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment">#输出结果为: 好</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-9a9115785268e099152bbed9d0bc7e97_720w.jpg" alt="img"></p>
<h2 id="5-2-案例二：-1模式详解"><a href="#5-2-案例二：-1模式详解" class="headerlink" title="5.2 案例二： 1模式详解"></a>5.2 案例二： 1模式详解</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1模式的使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">3</span>,<span class="number">1</span>) <span class="comment"># 从当前位置往后移动3个字节，而此时的当前位置就是文件开头</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell()) <span class="comment"># 输出结果为：3</span></span><br><span class="line">    f.seek(<span class="number">4</span>,<span class="number">1</span>)     <span class="comment"># 从当前位置往后移动4个字节，而此时的当前位置为3</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell()) <span class="comment"># 输出结果为：7</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-2122d50b6c97ed1c5fe27a13126266d0_720w.jpg" alt="img"></p>
<h2 id="5-3-案例三：-2模式详解"><a href="#5-3-案例三：-2模式详解" class="headerlink" title="5.3 案例三： 2模式详解"></a>5.3 案例三： 2模式详解</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># a.txt用utf-8编码，内容如下（abc各占1个字节，中文“你好”各占3个字节）</span></span><br><span class="line">abc你好</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2模式的使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0</span>,<span class="number">2</span>)     <span class="comment"># 参照文件末尾移动0个字节， 即直接跳到文件末尾</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell()) <span class="comment"># 输出结果为：9</span></span><br><span class="line">    f.seek(-<span class="number">3</span>,<span class="number">2</span>)     <span class="comment"># 参照文件末尾往前移动了3个字节</span></span><br><span class="line">    <span class="built_in">print</span>(f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment"># 输出结果为：好</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 小练习：实现动态查看最新一条日志的效果</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;access.log&#x27;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line=f.readline()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 没有内容</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(line.decode(<span class="string">&#x27;utf-8&#x27;</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-009f54e4493921a84480b80a4fa5aa90_720w.jpg" alt="img"></p>
<h2 id="六-文件的修改"><a href="#六-文件的修改" class="headerlink" title="六 文件的修改"></a>六 文件的修改</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 文件a.txt内容如下</span></span><br><span class="line">张一蛋     山东    <span class="number">179</span>    <span class="number">49</span>    <span class="number">12344234523</span></span><br><span class="line">李二蛋     河北    <span class="number">163</span>    <span class="number">57</span>    <span class="number">13913453521</span></span><br><span class="line">王全蛋     山西    <span class="number">153</span>    <span class="number">62</span>    <span class="number">18651433422</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行操作</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;r+t&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">9</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;&lt;妇女主任&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件修改后的内容如下</span></span><br><span class="line">张一蛋&lt;妇女主任&gt; <span class="number">179</span>    <span class="number">49</span>    <span class="number">12344234523</span></span><br><span class="line">李二蛋     河北    <span class="number">163</span>    <span class="number">57</span>    <span class="number">13913453521</span></span><br><span class="line">王全蛋     山西    <span class="number">153</span>    <span class="number">62</span>    <span class="number">18651433422</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强调：</span></span><br><span class="line"><span class="comment"># 1、硬盘空间是无法修改的,硬盘中数据的更新都是用新内容覆盖旧内容</span></span><br><span class="line"><span class="comment"># 2、内存中的数据是可以修改的</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-138c4c7000b5db3a37d691ea0aa09fb0_720w.jpg" alt="img"></p>
<p>文件对应的是硬盘空间,硬盘不能修改对应着文件本质也不能修改, 那我们看到文件的内容可以修改,是如何实现的呢? 大致的思路是将硬盘中文件内容读入内存,然后在内存中修改完毕后再覆盖回硬盘 具体的实现方式分为两种:</p>
<h2 id="6-1-文件修改方式一"><a href="#6-1-文件修改方式一" class="headerlink" title="6.1 文件修改方式一"></a>6.1 文件修改方式一</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 实现思路：将文件内容发一次性全部读入内存,然后在内存中修改完毕后再覆盖写回原文件</span></span><br><span class="line"><span class="comment"># 优点: 在文件修改过程中同一份数据只有一份</span></span><br><span class="line"><span class="comment"># 缺点: 会过多地占用内存</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data=f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txt&#x27;</span>,mode=<span class="string">&#x27;wt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data.replace(<span class="string">&#x27;kevin&#x27;</span>,<span class="string">&#x27;SB&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="6-1-文件修改方式二"><a href="#6-1-文件修改方式二" class="headerlink" title="6.1 文件修改方式二"></a>6.1 文件修改方式二</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 实现思路：以读的方式打开原文件,以写的方式打开一个临时文件,一行行读取原文件内容,修改完后写入临时文件...,删掉原文件,将临时文件重命名原文件名</span></span><br><span class="line"><span class="comment"># 优点: 不会占用过多的内存</span></span><br><span class="line"><span class="comment"># 缺点: 在文件修改过程中同一份数据存了两份</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txt&#x27;</span>,mode=<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> read_f,\</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;.db.txt.swap&#x27;</span>,mode=<span class="string">&#x27;wt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> wrife_f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> read_f:</span><br><span class="line">        wrife_f.write(line.replace(<span class="string">&#x27;SB&#x27;</span>,<span class="string">&#x27;kevin&#x27;</span>))</span><br><span class="line"></span><br><span class="line">os.remove(<span class="string">&#x27;db.txt&#x27;</span>)</span><br><span class="line">os.rename(<span class="string">&#x27;.db.txt.swap&#x27;</span>,<span class="string">&#x27;db.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-d45f4a423f5dd6e9880e4dbcdb1bdaf7_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>文件处理</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=31">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=31<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=32">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=32<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=33">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=33<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=34">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=34<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=35">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=35<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=36">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=36<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=37">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=37<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>11-函数基本使用</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/11_%E5%87%BD%E6%95%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="一-引入"><a href="#一-引入" class="headerlink" title="一 引入"></a>一 引入</h2><p> 基于前一部分的学习，我们已经能开发一些功能简单的小程序了，但随着程序功能的增多，代码量随之增大，此时仍不加区分地把所有功能的实现代码放到一起，将会使得程序的组织结构不清晰，可读性变差，且程序中需要频繁使用同一功能时，只能重复编写该功能的实现代码，日积月累，程序将变得冗长，并且当某一功能需要修改时，又不得不找出所有定义及使用这段功能的地方修改之，管理维护的难度极大，好吧，装了半天逼，到底该如何解决提出的这些问题呢？</p>
<p><img src="https://pic1.zhimg.com/80/v2-9c9953bf70a721520e78add4ceeeb340_720w.jpg" alt="img"></p>
<p>我们完全可以从现实生活中找到简化程序设计的方案：比如一个修理工会事先准备好螺丝刀、锤子等工具，这样在进行修理的过程中，需要用到拧螺丝的功能时就直接拿来螺丝刀使用，需要用到锤击物体的功能时就直接拿来锤子使用，而无需临时制造。这个例子的核心在于’事先准备好工具’，遇到应用场景时’拿来就用’，。</p>
<p>在程序中，具备某一功能的‘工具’指的就是函数，‘事先准备工具’的过程即函数的定义，‘拿来就用’即函数的调用。</p>
<h2 id="二-定义函数"><a href="#二-定义函数" class="headerlink" title="二 定义函数"></a>二 定义函数</h2><p>函数的使用必须遵循’先定义，后调用’的原则。函数的定义就相当于事先将函数体代码保存起来，然后将内存地址赋值给函数名，函数名就是对这段代码的引用，这和变量的定义是相似的。没有事先定义函数而直接调用，就相当于在引用一个不存在的’变量名’。</p>
<p>定义函数的语法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名(<span class="params">参数<span class="number">1</span>,参数<span class="number">2</span>,...</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;文档描述&quot;&quot;&quot;</span></span><br><span class="line">    函数体</span><br><span class="line">    <span class="keyword">return</span> 值</span><br></pre></td></tr></table></figure>

<ol>
<li>def: 定义函数的关键字；</li>
<li>函数名：函数名指向函数内存地址，是对函数体代码的引用。函数的命名应该反映出函数的功能；</li>
<li>括号：括号内定义参数，参数是可有可无的，且无需指定参数的类型；</li>
<li>冒号：括号后要加冒号，然后在下一行开始缩进编写函数体的代码；</li>
<li>“””文档描述”””: 描述函数功能，参数介绍等信息的文档，非必要，但是建议加上，从而增强函数的可读性；</li>
<li>函数体：由语句和表达式组成；</li>
<li>return 值：定义函数的返回值，return是可有可无的。</li>
</ol>
<p><img src="https://pic1.zhimg.com/80/v2-b6820acb8b8135a298d22c46d88dc078_720w.jpg" alt="img"></p>
<p>参数是函数的调用者向函数体传值的媒介，若函数体代码逻辑依赖外部传来的参数时则需要定义为参函数，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_min</span>(<span class="params">x,y</span>):</span></span><br><span class="line">    res=x <span class="keyword">if</span> x &lt; y <span class="keyword">else</span> y</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<p>否则定义为无参函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">interactive</span>():</span></span><br><span class="line">    user=<span class="built_in">input</span>(<span class="string">&#x27;user&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line">    pwd=<span class="built_in">input</span>(<span class="string">&#x27;password&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> (user,pwd)</span><br></pre></td></tr></table></figure>

<p> 函数体为pass代表什么都不做，称之为空函数。定义空函数通常是有用的，因为在程序设计的开始，往往是先想好程序都需要完成什么功能，然后把所有功能都列举出来用pass充当函数体“占位符”，这将使得程序的体系结构立见，清晰且可读性强。例如要编写一个ftp程序，我们可能想到的功能有用户认证，下载，上传，浏览，切换目录等功能，可以先做出如下定义：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth_user</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;user authentication function&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_file</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;download file function&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;upload file function&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ls</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;list contents function&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cd</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;change directory&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>之后我们便可以统筹安排编程任务，有选择性的去实现上述功能来替换掉pass，从而提高开发效率。</p>
<p><img src="https://pic3.zhimg.com/80/v2-7eec3d29ee04903367255ddf4ba56fa2_720w.jpg" alt="img"></p>
<h2 id="三-调用函数与函数返回值"><a href="#三-调用函数与函数返回值" class="headerlink" title="三 调用函数与函数返回值"></a>三 调用函数与函数返回值</h2><p> 函数的使用分为定义阶段与调用阶段，定义函数时只检测语法，不执行函数体代码，函数名加括号即函数调用，只有调用函数时才会执行函数体代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#定义阶段</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;in the foo&#x27;</span>)</span><br><span class="line">    bar()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;in the bar&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用阶段</span></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">in</span> the foo</span><br><span class="line"><span class="keyword">in</span> the bar</span><br></pre></td></tr></table></figure>

<p>定义阶段函数foo与bar均无语法错误，而在调用阶段调用foo()时，函数foo与bar都早已经存在于内存中了，所以不会有任何问题。</p>
<p><img src="https://pic4.zhimg.com/80/v2-49571392a08c9cb0980b37d25890cf57_720w.jpg" alt="img"></p>
<p>按照在程序出现的形式和位置，可将函数的调用形式分为三种：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1、语句形式：</span></span><br><span class="line">foo()</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、表达式形式：</span></span><br><span class="line">m=my_min(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">#将调用函数的返回值赋值给x</span></span><br><span class="line">n=<span class="number">10</span>*my_min(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">#将调用函数的返回值乘以10的结果赋值给n</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、函数调用作为参数的形式：</span></span><br><span class="line"><span class="comment"># my_min（2，3）作为函数my_min的第二个参数，实现了取1,2,3中的较小者赋值给m</span></span><br><span class="line">m=my_min(<span class="number">1</span>，my_min（<span class="number">2</span>，<span class="number">3</span>）)</span><br></pre></td></tr></table></figure>

<p>若需要将函数体代码执行的结果返回给调用者，则需要用到return。return后无值或直接省略return，则默认返回None，return的返回值无类型限制，且可以将多个返回值放到一个元组内。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">x,y,z</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x,y,z <span class="comment">#等同于return (x,y,z)</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res=test(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(res)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>return是一个函数结束的标志,函数内可以有多个return，但只执行一次函数就结束了，并把return后定义的值作为本次调用的结果返回。</p>
<p><img src="https://pic3.zhimg.com/80/v2-46449ad493f48f4863cefab55f8da196_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>函数基础</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=38">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=38<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p>函数返回值</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=39">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=39<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>11-函数的参数</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/12_%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<h2 id="一-形参与实参介绍"><a href="#一-形参与实参介绍" class="headerlink" title="一 形参与实参介绍"></a>一 形参与实参介绍</h2><p><img src="https://pic2.zhimg.com/80/v2-3be956bc3ace8da945af47995ea41b19_720w.jpg" alt="img"></p>
<p>函数的参数分为形式参数和实际参数，简称形参和实参：</p>
<p>形参即在定义函数时，括号内声明的参数。形参本质就是一个变量名，用来接收外部传来的值。</p>
<p>实参即在调用函数时，括号内传入的值，值可以是常量、变量、表达式或三者的组合:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1：实参是常量</span></span><br><span class="line">res=my_min(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2：实参是变量</span></span><br><span class="line">a=<span class="number">1</span></span><br><span class="line">b=<span class="number">2</span></span><br><span class="line">res=my_min(a,b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3：实参是表达式</span></span><br><span class="line">res=my_min(<span class="number">10</span>*<span class="number">2</span>,<span class="number">10</span>*my_min(<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#4：实参可以是常量、变量、表达式的任意组合</span></span><br><span class="line">a=<span class="number">2</span></span><br><span class="line">my_min(<span class="number">1</span>,a,<span class="number">10</span>*my_min(<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>在调用有参函数时，实参（值）会赋值给形参（变量名）。在Python中，变量名与值只是单纯的绑定关系，而对于函数来说，这种绑定关系只在函数调用时生效，在调用结束后解除。</p>
<p><img src="https://pic2.zhimg.com/80/v2-b0036c8f8942a558d95a3200f38338d1_720w.jpg" alt="img"></p>
<h2 id="二-形参与实参的具体使用"><a href="#二-形参与实参的具体使用" class="headerlink" title="二 形参与实参的具体使用"></a>二 形参与实参的具体使用</h2><h2 id="2-1-位置参数"><a href="#2-1-位置参数" class="headerlink" title="2.1 位置参数"></a>2.1 位置参数</h2><p>位置即顺序，位置参数指的是按顺序定义的参数，需要从两个角度去看：</p>
<ol>
<li>在定义函数时，按照从左到右的顺序依次定义形参,称为位置形参，凡是按照这种形式定义的形参都必须被传值</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex</span>):</span> <span class="comment">#定义位置形参：name，age，sex，三者都必须被传值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s Age:%s Sex:%s&#x27;</span> %(name,age,sex))</span><br><span class="line">register() <span class="comment">#TypeError：缺少3个位置参数 </span></span><br></pre></td></tr></table></figure>

<ol>
<li>在调用函数时，按照从左到右的顺序依次定义实参，称为位置实参，凡是按照这种形式定义的实参会按照从左到右的顺序与形参一一对应</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex</span>):</span> <span class="comment">#定义位置形参：name，age，sex，三者都必须被传值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s Age:%s Sex:%s&#x27;</span> %(name,age,sex))</span><br><span class="line">register() <span class="comment">#TypeError：缺少3个位置参数</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-1152d1943f7d6b217981965ad5d2b8be_720w.jpg" alt="img"></p>
<h2 id="2-2-关键字参数"><a href="#2-2-关键字参数" class="headerlink" title="2.2 关键字参数"></a>2.2 关键字参数</h2><p>在调用函数时，实参可以是key&#x3D;value的形式，称为关键字参数，凡是按照这种形式定义的实参，可以完全不按照从左到右的顺序定义，但仍能为指定的形参赋值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(sex=<span class="string">&#x27;male&#x27;</span>,name=<span class="string">&#x27;lili&#x27;</span>,age=<span class="number">18</span>)</span><br><span class="line">Name:lili Age:<span class="number">18</span> Sex:male</span><br></pre></td></tr></table></figure>

<p>需要注意在调用函数时，实参也可以是按位置或按关键字的混合使用，但必须保证关键字参数在位置参数后面，且不可以对一个形参重复赋值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,sex=<span class="string">&#x27;male&#x27;</span>,age=<span class="number">18</span>) <span class="comment">#正确使用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(name=<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,sex=<span class="string">&#x27;male&#x27;</span>) <span class="comment">#SyntaxError：关键字参数name=‘lili’在位置参数18之前</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,sex=<span class="string">&#x27;male&#x27;</span>,age=<span class="number">18</span>,name=<span class="string">&#x27;jack&#x27;</span>) <span class="comment">#TypeError：形参name被重复赋值</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-751903e8073067049e6c42c5196754fe_720w.jpg" alt="img"></p>
<h2 id="2-3-默认参数"><a href="#2-3-默认参数" class="headerlink" title="2.3 默认参数"></a>2.3 默认参数</h2><p>在定义函数时，就已经为形参赋值，这类形参称之为默认参数，当函数有多个参数时，需要将值经常改变的参数定义成位置参数，而将值改变较少的参数定义成默认参数。例如编写一个注册学生信息的函数，如果大多数学生的性别都为男，那完全可以将形参sex定义成默认参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,sex=<span class="string">&#x27;male&#x27;</span></span>):</span> <span class="comment">#默认sex的值为male</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s Age:%s Sex:%s&#x27;</span> %(name,age,sex))</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>定义时就已经为参数sex赋值，意味着调用时可以不对sex赋值，这降低了函数调用的复杂度</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;tom&#x27;</span>,<span class="number">17</span>) <span class="comment">#大多数情况,无需为sex传值,默认为male</span></span><br><span class="line">Name:tom Age:<span class="number">17</span> Sex:male</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;Lili&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;female&#x27;</span>) <span class="comment">#少数情况,可以为sex传值female</span></span><br><span class="line">Name:Lili Age:<span class="number">18</span> Sex:female</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-85c49040b5ca19b0a6cd236d6a335d21_720w.jpg" alt="img"></p>
<p>需要注意：</p>
<ol>
<li>默认参数必须在位置参数之后</li>
<li>默认参数的值仅在函数定义阶段被赋值一次</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">arg=x</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(arg)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=<span class="number">5</span> <span class="comment">#定义阶段arg已被赋值为1，此处的修改与默认参数arg无任何关系</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo()</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<ol>
<li>默认参数的值通常应设为不可变类型</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">n,arg=[]</span>):</span>    </span><br><span class="line">     arg.append(n)    </span><br><span class="line">     <span class="keyword">return</span> arg    </span><br><span class="line">foo(<span class="number">1</span>)    </span><br><span class="line">[<span class="number">1</span>] </span><br><span class="line">foo(<span class="number">2</span>)    </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>] </span><br><span class="line">foo(<span class="number">3</span>)    </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>每次调用是在上一次的基础上向同一列表增加值，修改如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">n,arg=<span class="literal">None</span></span>):</span>    </span><br><span class="line">     <span class="keyword">if</span> arg <span class="keyword">is</span> <span class="literal">None</span>:    </span><br><span class="line">         arg=[]    </span><br><span class="line">     arg.append(n)    </span><br><span class="line">     <span class="keyword">return</span> arg    </span><br><span class="line">foo(<span class="number">1</span>)    </span><br><span class="line">[<span class="number">1</span>] </span><br><span class="line">foo(<span class="number">2</span>)    </span><br><span class="line">[<span class="number">2</span>] </span><br><span class="line">foo(<span class="number">3</span>)    </span><br><span class="line">[<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-c48b74c4968b946d68531c2ef2c1b40e_720w.jpg" alt="img"></p>
<h2 id="2-4-可变长度的参数（-与-的用法）"><a href="#2-4-可变长度的参数（-与-的用法）" class="headerlink" title="2.4 可变长度的参数（*与**的用法）"></a>2.4 可变长度的参数（*与**的用法）</h2><p><img src="https://pic2.zhimg.com/80/v2-ac1ed3f13dbd9fea9e3c5cfbb1047611_720w.jpg" alt="img"></p>
<p>参数的长度可变指的是在调用函数时，实参的个数可以不固定，而在调用函数时，实参的定义无非是按位置或者按关键字两种形式，这就要求形参提供两种解决方案来分别处理两种形式的可变长度的参数</p>
<h3 id="2-4-1-可变长度的位置参数"><a href="#2-4-1-可变长度的位置参数" class="headerlink" title="2.4.1 可变长度的位置参数"></a>2.4.1 可变长度的位置参数</h3><p>如果在最后一个形参名前加<em>号,那么在调用函数时，溢出的位置实参，都会被</em>接收，以元组的形式保存下来赋值给该形参</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,z=<span class="number">1</span>,*args</span>):</span> <span class="comment">#在最后一个形参名args前加*号</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(y)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(z)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(args)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)  <span class="comment">#实参1、2、3按位置为形参x、y、z赋值，多余的位置实参4、5、6、7都被*接收，以元组的形式保存下来，赋值给args，即args=(4, 5, 6,7)</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<p>如果我们事先生成了一个列表,仍然是可以传值给*args的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,*args</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(y)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(args)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L=[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,*L) <span class="comment"># *L就相当于位置参数3，4，5, foo(1,2,*L)就等同于foo(1,2,3,4,5)</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-e73cc42b02d988741717036dab3ef3d8_720w.jpg" alt="img"></p>
<p>注意：如果在传入L时没有加*,那L就只是一个普通的位置参数了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,L) <span class="comment">#仅多出一个位置实参L</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],)</span><br></pre></td></tr></table></figure>

<p>如果形参为常规的参数（位置或默认），实参仍可以是*的形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,z=<span class="number">3</span></span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(y)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(z)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(*[<span class="number">1</span>,<span class="number">2</span>]) <span class="comment">#等同于foo(1,2)</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>如果我们想要求多个值的和，*args就派上用场了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">*args</span>):</span></span><br><span class="line"><span class="meta">... </span>    res=<span class="number">0</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> args:</span><br><span class="line"><span class="meta">... </span>        res+=i</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> res</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-8996656ee55ad76ec5b15628a8044140_720w.jpg" alt="img"></p>
<h3 id="2-4-2-可变长度的关键字参数"><a href="#2-4-2-可变长度的关键字参数" class="headerlink" title="2.4.2 可变长度的关键字参数"></a>2.4.2 可变长度的关键字参数</h3><p>如果在最后一个形参名前加<strong>号,那么在调用函数时，溢出的关键字参数，都会被</strong>接收，以字典的形式保存下来赋值给该形参</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,**kwargs</span>):</span> <span class="comment">#在最后一个参数kwargs前加**</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)        </span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(kwargs)   </span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(y=<span class="number">2</span>,x=<span class="number">1</span>,z=<span class="number">3</span>) <span class="comment">#溢出的关键字实参y=2，z=3都被**接收，以字典的形式保存下来，赋值给kwargs</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">&#123;<span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们事先生成了一个字典,仍然是可以传值给**kwargs的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(y)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(kwargs)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,**dic) <span class="comment">#**dic就相当于关键字参数a=1，b=2，foo(1,2,**dic)等同foo(1,2,a=1,b=2)</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-b4374327737ac837551b67f7813666e8_720w.jpg" alt="img"></p>
<p>注意：如果在传入dic时没有加**,那dic就只是一个普通的位置参数了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,dic) <span class="comment">#TypeError:函数foo只需要2个位置参数，但是传了3个</span></span><br></pre></td></tr></table></figure>

<p>如果形参为常规参数（位置或默认），实参仍可以是**的形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,z=<span class="number">3</span></span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(y)</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(z)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(**&#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;y&#x27;</span>:<span class="number">2</span>&#125;) <span class="comment">#等同于foo(y=2,x=1)</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>如果我们要编写一个用户认证的函数，起初可能只基于用户名密码的验证就可以了，可以使用**kwargs为日后的扩展供良好的环境，同时保持了函数的简洁性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">auth</span>(<span class="params">user,password,**kwargs</span>):</span> </span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span> </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="2-5-命名关键字参数"><a href="#2-5-命名关键字参数" class="headerlink" title="2.5 命名关键字参数"></a>2.5 命名关键字参数</h2><p>在定义了**kwargs参数后，函数调用者就可以传入任意的关键字参数key&#x3D;value，如果函数体代码的执行需要依赖某个key，必须在函数内进行判断</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> <span class="string">&#x27;sex&#x27;</span> <span class="keyword">in</span> kwargs:</span><br><span class="line"><span class="meta">... </span>        <span class="comment">#有sex参数</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> <span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> kwargs:</span><br><span class="line"><span class="meta">... </span>        <span class="comment">#有height参数</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>想要限定函数的调用者必须以key&#x3D;value的形式传值，Python3提供了专门的语法：需要在定义形参时，用<em>作为一个分隔符号，</em>号之后的形参称为命名关键字参数。对于这类参数，在函数调用时，必须按照key&#x3D;value的形式为其传值，且必须被传值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,*,sex,height</span>):</span> <span class="comment">#sex,height为命名关键字参数</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,sex=<span class="string">&#x27;male&#x27;</span>,height=<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment">#正确使用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;male&#x27;</span>,<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment"># TypeError:未使用关键字的形式为sex和height传值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,height=<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment"># TypeError没有为命名关键字参数height传值。</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-536b4db7a18e1f39795a152f4c6249bb_720w.jpg" alt="img"></p>
<p>命名关键字参数也可以有默认值，从而简化调用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,*,sex=<span class="string">&#x27;male&#x27;</span>,height</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;Name:%s,Age:%s,Sex:%s,Height:%s&#x27;</span> %(name,age,sex,height))</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,height=<span class="string">&#x27;1.8m&#x27;</span>)</span><br><span class="line">Name:lili,Age:<span class="number">18</span>,Sex:male,Height:<span class="number">1.8</span>m</span><br></pre></td></tr></table></figure>

<p>需要强调的是：sex不是默认参数，height也不是位置参数，因为二者均在<em>后，所以都是命名关键字参数，形参sex&#x3D;’male’属于命名关键字参数的默认值，因而即便是放到形参height之前也不会有问题。另外，如果形参中已经有一个</em>args了，命名关键字参数就不再需要一个单独的*作为分隔符号了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">name,age,*args,sex=<span class="string">&#x27;male&#x27;</span>,height</span>):</span></span><br><span class="line"><span class="meta">... </span>  <span class="built_in">print</span>(<span class="string">&#x27;Name:%s,Age:%s,Args:%s,Sex:%s,Height:%s&#x27;</span> %(name,age,args,sex,height))</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(<span class="string">&#x27;lili&#x27;</span>,<span class="number">18</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,height=<span class="string">&#x27;1.8m&#x27;</span>) <span class="comment">#sex与height仍为命名关键字参数</span></span><br><span class="line">Name:lili,Age:<span class="number">18</span>,Args:(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),Sex:male,Height:<span class="number">1.8</span>m</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-daa2f3a7038bc4603a334da19e216dcf_720w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-f69da71d076e7119fd2ec2e84817dd6c_720w.jpg" alt="img"></p>
<h2 id="2-6-组合使用"><a href="#2-6-组合使用" class="headerlink" title="2.6 组合使用"></a>2.6 组合使用</h2><p>综上所述所有参数可任意组合使用，但定义顺序必须是：位置参数、默认参数、*args、命名关键字参数、**kwargs</p>
<p>可变参数*args与关键字参数<strong>kwargs通常是组合在一起使用的，如果一个函数的形参为*args与</strong>kwargs，那么代表该函数可以接收任何形式、任意长度的参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-8a33c0e3ae4f314dc75eca6250b66fe7_720w.jpg" alt="img"></p>
<p>在该函数内部还可以把接收到的参数传给另外一个函数（这在4.6小节装饰器的实现中大有用处）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">x,y,z</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x,y,z)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line"><span class="meta">... </span>    func(*args,**kwargs)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapper(<span class="number">1</span>,z=<span class="number">3</span>,y=<span class="number">2</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>按照上述写法，在为函数wrapper传参时，其实遵循的是函数func的参数规则，调用函数wrapper的过程分析如下：</p>
<ol>
<li>位置实参1被*接收，以元组的形式保存下来，赋值给args，即args&#x3D;(1,),关键字实参z&#x3D;3，y&#x3D;2被**接收，以字典的形式保存下来，赋值给kwargs，即kwargs&#x3D;{‘y’: 2, ‘z’: 3}</li>
<li>执行func(<em>args,<em>kwargs),即func(</em>(1,),</em>* {‘y’: 2, ‘z’: 3}),等同于func(1,z&#x3D;3,y&#x3D;2)</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">提示： *args、**kwargs中的args和kwargs被替换成其他名字并无语法错误，但使用args、kwargs是约定俗成的。</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-0064bdc3b1e3fd19d4240f375fecce8a_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471/?p=40">https://www.bilibili.com/video/av73342471/?p=40www.bilibili.com/video/av73342471/?p=40</a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=41">https://www.bilibili.com/video/av73342471?p=41www.bilibili.com/video/av73342471?p=41</a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=42">https://www.bilibili.com/video/av73342471?p=42www.bilibili.com/video/av73342471?p=42</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>13-名称空间和作用域</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/13_%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    <content><![CDATA[<h2 id="一-名称空间"><a href="#一-名称空间" class="headerlink" title="一 名称空间"></a>一 名称空间</h2><p>名称空间即存放名字与对象映射&#x2F;绑定关系的地方。对于x&#x3D;3，Python会申请内存空间存放对象3，然后将名字x与3的绑定关系存放于名称空间中，del x表示清除该绑定关系。</p>
<p> 在程序执行期间最多会存在三种名称空间</p>
<p><img src="https://pic2.zhimg.com/80/v2-596e030156bc539213fb080d356ca1d9_720w.jpg" alt="img"></p>
<h2 id="1-1-内建名称空间"><a href="#1-1-内建名称空间" class="headerlink" title="1.1 内建名称空间"></a>1.1 内建名称空间</h2><p>伴随python解释器的启动&#x2F;关闭而产生&#x2F;回收，因而是第一个被加载的名称空间，用来存放一些内置的名字，比如内建函数名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">max</span>&gt; <span class="comment">#built-in内建</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-6b1e7070c484f0d266dcfdc04ebf265a_720w.jpg" alt="img"></p>
<h2 id="1-2-全局名称空间"><a href="#1-2-全局名称空间" class="headerlink" title="1.2 全局名称空间"></a>1.2 全局名称空间</h2><p>伴随python文件的开始执行&#x2F;执行完毕而产生&#x2F;回收，是第二个被加载的名称空间，文件执行过程中产生的名字都会存放于该名称空间中，如下名字</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys <span class="comment">#模块名sys</span></span><br><span class="line"></span><br><span class="line">x=<span class="number">1</span> <span class="comment">#变量名x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x == <span class="number">1</span>:</span><br><span class="line">    y=<span class="number">2</span> <span class="comment">#变量名y</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x</span>):</span> <span class="comment">#函数名foo</span></span><br><span class="line">    y=<span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span>():</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Class Bar: <span class="comment">#类名Bar</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-2def7f8d2d87802b200813e691a5acfd_720w.jpg" alt="img"></p>
<h2 id="1-3-局部名称空间"><a href="#1-3-局部名称空间" class="headerlink" title="1.3 局部名称空间"></a>1.3 局部名称空间</h2><p>伴随函数的调用&#x2F;结束而临时产生&#x2F;回收，函数的形参、函数内定义的名字都会被存放于该名称空间中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x</span>):</span></span><br><span class="line">    y=<span class="number">3</span> <span class="comment">#调用函数时，才会执行函数代码，名字x和y都存放于该函数的局部名称空间中</span></span><br></pre></td></tr></table></figure>

<p>名称空间的加载顺序是：内置名称空间-&gt;全局名称空间-&gt;局部名称空间，而查找一个名字，必须从三个名称空间之一找到，查找顺序为：局部名称空间-&gt;全局名称空间-&gt;内置名称空间。</p>
<p><img src="https://pic1.zhimg.com/80/v2-521d2bf3131371f8d2656b184ad17798_720w.jpg" alt="img"></p>
<h2 id="二-作用域"><a href="#二-作用域" class="headerlink" title="二 作用域"></a>二 作用域</h2><h2 id="2-1-全局作用域与局部作用域"><a href="#2-1-全局作用域与局部作用域" class="headerlink" title="2.1 全局作用域与局部作用域"></a>2.1 全局作用域与局部作用域</h2><p>按照名字作用范围的不同可以将三个名称空间划分为两个区域：</p>
<ol>
<li>全局作用域:位于全局名称空间、内建名称空间中的名字属于全局范围，该范围内的名字全局存活（除非被删除，否则在整个文件执行过程中存活）、全局有效（在任意位置都可以使用）；</li>
<li>局部作用域:位于局部名称空间中的名字属于局部范围。该范围内的名字临时存活（即在函数调用时临时生成，函数调用结束后就释放）、局部有效（只能在函数内使用）。</li>
</ol>
<p><img src="https://pic4.zhimg.com/80/v2-c7c952d4554d6db0cf46305be525bafb_720w.jpg" alt="img"></p>
<h2 id="2-2-作用域与名字查找的优先级"><a href="#2-2-作用域与名字查找的优先级" class="headerlink" title="2.2 作用域与名字查找的优先级"></a>2.2 作用域与名字查找的优先级</h2><p> 在局部作用域查找名字时，起始位置是局部作用域，所以先查找局部名称空间，没有找到，再去全局作用域查找：先查找全局名称空间，没有找到，再查找内置名称空间，最后都没有找到就会抛出异常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">100</span> <span class="comment">#全局作用域的名字x</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    x=<span class="number">300</span> <span class="comment">#局部作用域的名字x</span></span><br><span class="line">    <span class="built_in">print</span>(x) <span class="comment">#在局部找x</span></span><br><span class="line">foo()<span class="comment">#结果为300</span></span><br></pre></td></tr></table></figure>

<p>在全局作用域查找名字时，起始位置便是全局作用域，所以先查找全局名称空间，没有找到，再查找内置名称空间，最后都没有找到就会抛出异常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    x=<span class="number">300</span> <span class="comment">#在函数调用时产生局部作用域的名字x</span></span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">print</span>(x) <span class="comment">#在全局找x,结果为100</span></span><br></pre></td></tr></table></figure>

<p>提示：可以调用内建函数locals()和globals()来分别查看局部作用域和全局作用域的名字，查看的结果都是字典格式。在全局作用域查看到的locals()的结果等于globals()</p>
<p><img src="https://pic3.zhimg.com/80/v2-7adbbd64e5216724e7933789054d0f1e_720w.jpg" alt="img"></p>
<p>Python支持函数的嵌套定义，在内嵌的函数内查找名字时，会优先查找自己局部作用域的名字，然后由内而外一层层查找外部嵌套函数定义的作用域，没有找到，则查找全局作用域</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    x=<span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span> <span class="comment"># 函数名inner属于outer这一层作用域的名字</span></span><br><span class="line">        x=<span class="number">3</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;inner x:%s&#x27;</span> %x)</span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;outer x:%s&#x27;</span> %x)</span><br><span class="line"></span><br><span class="line">outer() </span><br><span class="line"><span class="comment">#结果为</span></span><br><span class="line">inner x:<span class="number">3</span></span><br><span class="line">outer x:<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>在函数内，无论嵌套多少层，都可以查看到全局作用域的名字，若要在函数内修改全局名称空间中名字的值，当值为不可变类型时，则需要用到global关键字</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="keyword">global</span> x <span class="comment">#声明x为全局名称空间的名字</span></span><br><span class="line">    x=<span class="number">2</span></span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">print</span>(x) <span class="comment">#结果为2</span></span><br></pre></td></tr></table></figure>

<p>当实参的值为可变类型时，函数体内对该值的修改将直接反应到原值，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">num_list=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">nums</span>):</span></span><br><span class="line">    nums.append(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">foo(num_list)</span><br><span class="line"><span class="built_in">print</span>(num_list)</span><br><span class="line"><span class="comment">#结果为</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>

<p>对于嵌套多层的函数，使用nonlocal关键字可以将名字声明为来自外部嵌套函数定义的作用域（非全局）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span>  <span class="title">f1</span>():</span></span><br><span class="line">    x=<span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> x</span><br><span class="line">        x=<span class="number">3</span></span><br><span class="line">    f2() <span class="comment">#调用f2(),修改f1作用域中名字x的值</span></span><br><span class="line">    <span class="built_in">print</span>(x) <span class="comment">#在f1作用域查看x</span></span><br><span class="line"></span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line"><span class="comment">#结果</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>nonlocal x会从当前函数的外层函数开始一层层去查找名字x，若是一直到最外层函数都找不到，则会抛出异常。</p>
<p><img src="https://pic2.zhimg.com/80/v2-632ec1c5586b42b1b603268097360c35_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471/?p=45">https://www.bilibili.com/video/av73342471/?p=45www.bilibili.com/video/av73342471/?p=45</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>15-装饰器</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/15_%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    <content><![CDATA[<h2 id="一-装饰器介绍"><a href="#一-装饰器介绍" class="headerlink" title="一 装饰器介绍"></a>一 装饰器介绍</h2><h2 id="1-1-为何要用装饰器"><a href="#1-1-为何要用装饰器" class="headerlink" title="1.1 为何要用装饰器"></a>1.1 为何要用装饰器</h2><p><img src="https://pic3.zhimg.com/80/v2-5f0bd90a1428a4b373be52c22f7d871a_720w.jpg" alt="img"></p>
<p>软件的设计应该遵循开放封闭原则，即对扩展是开放的，而对修改是封闭的。对扩展开放，意味着有新的需求或变化时，可以对现有代码进行扩展，以适应新的情况。对修改封闭，意味着对象一旦设计完成，就可以独立完成其工作，而不要对其进行修改。</p>
<p>软件包含的所有功能的源代码以及调用方式，都应该避免修改，否则一旦改错，则极有可能产生连锁反应，最终导致程序崩溃，而对于上线后的软件，新需求或者变化又层出不穷，我们必须为程序提供扩展的可能性，这就用到了装饰器。</p>
<h2 id="1-2-什么是装饰器"><a href="#1-2-什么是装饰器" class="headerlink" title="1.2 什么是装饰器"></a>1.2 什么是装饰器</h2><p><img src="https://pic2.zhimg.com/80/v2-b43bfaa7c4abf2a53d535ce272d937b9_720w.jpg" alt="img"></p>
<p>’装饰’代指为被装饰对象添加新的功能，’器’代指器具&#x2F;工具，装饰器与被装饰的对象均可以是任意可调用对象。概括地讲，装饰器的作用就是在不修改被装饰对象源代码和调用方式的前提下为被装饰对象添加额外的功能。装饰器经常用于有切面需求的场景，比如：插入日志、性能测试、事务处理、缓存、权限校验等应用场景，装饰器是解决这类问题的绝佳设计，有了装饰器，就可以抽离出大量与函数功能本身无关的雷同代码并继续重用。</p>
<p>提示：可调用对象有函数，方法或者类，此处我们单以本章主题函数为例，来介绍函数装饰器，并且被装饰的对象也是函数。</p>
<h2 id="二-装饰器的实现"><a href="#二-装饰器的实现" class="headerlink" title="二 装饰器的实现"></a>二 装饰器的实现</h2><p>函数装饰器分为：无参装饰器和有参装饰两种，二者的实现原理一样，都是’函数嵌套+闭包+函数对象’的组合使用的产物。</p>
<p><img src="https://pic2.zhimg.com/80/v2-21b3488ea792ad818b3eea81740f6945_720w.jpg" alt="img"></p>
<h2 id="2-1-无参装饰器的实现"><a href="#2-1-无参装饰器的实现" class="headerlink" title="2.1 无参装饰器的实现"></a>2.1 无参装饰器的实现</h2><p>如果想为下述函数添加统计其执行时间的功能</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Welcome to the index page’)</span></span><br><span class="line"><span class="string">    return 200</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">index() #函数执行</span></span><br></pre></td></tr></table></figure>

<p>遵循不修改被装饰对象源代码的原则，我们想到的解决方法可能是这样</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">start_time=time.time()</span><br><span class="line">index() <span class="comment">#函数执行</span></span><br><span class="line">stop_time=time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-2e3af8429a3c2606c4cfbedb0b196e89_720w.jpg" alt="img"></p>
<p>考虑到还有可能要统计其他函数的执行时间，于是我们将其做成一个单独的工具，函数体需要外部传入被装饰的函数从而进行调用，我们可以使用参数的形式传入</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">func</span>):</span> <span class="comment"># 通过参数接收外部的值</span></span><br><span class="line">    start_time=time.time()</span><br><span class="line">    res=func()</span><br><span class="line">    stop_time=time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<p>但之后函数的调用方式都需要统一改成</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wrapper(index)</span><br><span class="line">wrapper(其他函数)</span><br></pre></td></tr></table></figure>

<p>这便违反了不能修改被装饰对象调用方式的原则，于是我们换一种为函数体传值的方式，即将值包给函数，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>():</span> <span class="comment"># 引用外部作用域的变量func</span></span><br><span class="line">        start_time=time.time()</span><br><span class="line">        res=func()</span><br><span class="line">        stop_time=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p>这样我们便可以在不修改被装饰函数源代码和调用方式的前提下为其加上统计时间的功能，只不过需要事先执行一次timer将被装饰的函数传入，返回一个闭包函数wrapper重新赋值给变量名 &#x2F;函数名index，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index=timer(index)  <span class="comment">#得到index=wrapper，wrapper携带对外作用域的引用：func=原始的index</span></span><br><span class="line">index() <span class="comment"># 执行的是wrapper()，在wrapper的函数体内再执行最原始的index</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-6c1260375fb70d489df20b676c5cac51_720w.jpg" alt="img"></p>
<p>至此我们便实现了一个无参装饰器timer，可以在不修改被装饰对象index源代码和调用方式的前提下为其加上新功能。但我们忽略了若被装饰的函数是一个有参函数，便会抛出异常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">name</span>):</span></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Welcome to the home page&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line">home=timer(home)</span><br><span class="line">home(<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"><span class="comment">#抛出异常</span></span><br><span class="line">TypeError: wrapper() takes <span class="number">0</span> positional arguments but <span class="number">1</span> was given</span><br></pre></td></tr></table></figure>

<p>之所以会抛出异常，是因为home(‘egon’)调用的其实是wrapper(‘egon’)，而函数wrapper没有参数。wrapper函数接收的参数其实是给最原始的func用的，为了能满足被装饰函数参数的所有情况，便用上*args+**kwargs组合（见4.3小节）,于是修正装饰器timer如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        start_time=time.time()</span><br><span class="line">        res=func(*args,**kwargs)</span><br><span class="line">        stop_time=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-da8d9c6733f96b2a897c986e3515ffe3_720w.jpg" alt="img"></p>
<p>此时我们就可以用timer来装饰带参数或不带参数的函数了，但是为了简洁而优雅地使用装饰器，Python提供了专门的装饰器语法来取代index&#x3D;timer(index)的形式，需要在被装饰对象的正上方单独一行添加@timer,当解释器解释到@timer时就会调用timer函数，且把它正下方的函数名当做实参传入，然后将返回的结果重新赋值给原函数名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@timer </span><span class="comment"># index=timer(index)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Welcome to the index page&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span></span><br><span class="line"><span class="meta">@timer </span><span class="comment"># index=timer(home)</span>           <span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">name</span>):</span></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Welcome to the home page’,name)</span></span><br></pre></td></tr></table></figure>

<p>如果我们有多个装饰器，可以叠加多个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@deco3</span></span><br><span class="line"><span class="meta">@deco2</span></span><br><span class="line"><span class="meta">@deco1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>叠加多个装饰器也无特殊之处，上述代码语义如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index=deco3(deco2(deco1(index)))</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-c6e67404ac0e4319ce3cd89af56ead5d_720w.jpg" alt="img"></p>
<h2 id="2-2-有参装饰器的实现"><a href="#2-2-有参装饰器的实现" class="headerlink" title="2.2 有参装饰器的实现"></a>2.2 有参装饰器的实现</h2><p>了解无参装饰器的实现原理后，我们可以再实现一个用来为被装饰对象添加认证功能的装饰器，实现的基本形式如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deco</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        编写基于文件的认证,认证通过则执行res=func(*args,**kwargs),并返回res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p>如果我们想提供多种不同的认证方式以供选择，单从wrapper函数的实现角度改写如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deco</span>(<span class="params">func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">            <span class="keyword">if</span> driver == <span class="string">&#x27;file&#x27;</span>:</span><br><span class="line">                编写基于文件的认证,认证通过则执行res=func(*args,**kwargs),并返回res</span><br><span class="line">            <span class="keyword">elif</span> driver == <span class="string">&#x27;mysql&#x27;</span>:</span><br><span class="line">                编写基于mysql认证,认证通过则执行res=func(*args,**kwargs),并返回res</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-82fb584a53b2277048a09561b3e19b58_720w.jpg" alt="img"></p>
<p>函数wrapper需要一个driver参数，而函数deco与wrapper的参数都有其特定的功能，不能用来接受其他类别的参数，可以在deco的外部再包一层函数auth，用来专门接受额外的参数，这样便保证了在auth函数内无论多少层都可以引用到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span>(<span class="params">driver</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deco</span>(<span class="params">func</span>):</span></span><br><span class="line">        ……</span><br><span class="line">    <span class="keyword">return</span> deco</span><br></pre></td></tr></table></figure>

<p>此时我们就实现了一个有参装饰器，使用方式如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">先调用auth_type(driver=<span class="string">&#x27;file&#x27;</span>)，得到@deco，deco是一个闭包函数，</span><br><span class="line">包含了对外部作用域名字driver的引用，@deco的语法意义与无参装饰器一样</span><br><span class="line"><span class="meta">@auth(<span class="params">driver=<span class="string">&#x27;file&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span>     </span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">@auth(<span class="params">driver=<span class="string">&#x27;mysql&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>():</span></span><br><span class="line">    <span class="keyword">pass</span>  </span><br></pre></td></tr></table></figure>

<p>可以使用help(函数名)来查看函数的文档注释，本质就是查看函数的<strong>doc</strong>属性，但对于被装饰之后的函数，查看文档注释</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    home page function</span></span><br><span class="line"><span class="string">    :param name: str</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Welcome to the home page&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">help</span>(home))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">打印结果：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Help on function wrapper in module __main__:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">wrapper(*args, **kwargs)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">None</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-3380e05c82d8501f9ac1c2681311a062_720w.jpg" alt="img"></p>
<p>在被装饰之后home&#x3D;wrapper,查看home.<strong>name</strong>也可以发现home的函数名确实是wrapper，想要保留原函数的文档和函数名属性，需要修正装饰器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        start_time=time.time()</span><br><span class="line">        res=func(*args,**kwargs)</span><br><span class="line">        stop_time=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    wrapper.__doc__=func.__doc__</span><br><span class="line">    wrapper.__name__=func.__name__</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p>按照上述方式来实现保留原函数属性过于麻烦，functools模块下提供一个装饰器wraps专门用来帮我们实现这件事，用法如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        start_time=time.time()</span><br><span class="line">        res=func(*args,**kwargs)</span><br><span class="line">        stop_time=time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;run time is %s&#x27;</span> %(stop_time-start_time))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-091acff94160bf2b8258553158168f79_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>简单装饰器的实现</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=47">https://www.bilibili.com/video/av73342471?p=47www.bilibili.com/video/av73342471?p=47</a></p>
<p>装饰器修订</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=48">https://www.bilibili.com/video/av73342471?p=48www.bilibili.com/video/av73342471?p=48</a></p>
<p>wraps补充</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=49">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=49<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>14-函数对象和闭包</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/14_%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E5%92%8C%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<h2 id="一-函数对象"><a href="#一-函数对象" class="headerlink" title="一 函数对象"></a>一 函数对象</h2><p>函数对象指的是函数可以被当做’数据’来处理，具体可以分为四个方面的使用，我们如下</p>
<p><img src="https://pic2.zhimg.com/80/v2-610f07da055d449976326f5e234075d9_720w.jpg" alt="img"></p>
<h2 id="1-1-函数可以被引用"><a href="#1-1-函数可以被引用" class="headerlink" title="1.1 函数可以被引用"></a>1.1 函数可以被引用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x,y</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x+y</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func=add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-函数可以作为容器类型的元素"><a href="#1-2-函数可以作为容器类型的元素" class="headerlink" title="1.2 函数可以作为容器类型的元素"></a>1.2 函数可以作为容器类型的元素</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic=&#123;<span class="string">&#x27;add&#x27;</span>:add,<span class="string">&#x27;max&#x27;</span>:<span class="built_in">max</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic</span><br><span class="line">&#123;<span class="string">&#x27;add&#x27;</span>: &lt;function add at <span class="number">0x100661e18</span>&gt;, <span class="string">&#x27;max&#x27;</span>: &lt;built-<span class="keyword">in</span> function <span class="built_in">max</span>&gt;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic[<span class="string">&#x27;add&#x27;</span>](<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="1-3-函数可以作为参数传入另外一个函数"><a href="#1-3-函数可以作为参数传入另外一个函数" class="headerlink" title="1.3 函数可以作为参数传入另外一个函数"></a>1.3 函数可以作为参数传入另外一个函数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x,y,func</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> func(x,y)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,<span class="number">2</span>,add)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-函数的返回值可以是一个函数"><a href="#1-4-函数的返回值可以是一个函数" class="headerlink" title="1.4 函数的返回值可以是一个函数"></a>1.4 函数的返回值可以是一个函数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span>():</span> </span><br><span class="line">     <span class="keyword">return</span> add </span><br><span class="line">func=bar() </span><br><span class="line">func(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-3a92b83b2c4ab23b0e237f071b6bcd7e_720w.jpg" alt="img"></p>
<h2 id="二-闭包函数"><a href="#二-闭包函数" class="headerlink" title="二 闭包函数"></a>二 闭包函数</h2><h2 id="2-1-闭与包"><a href="#2-1-闭与包" class="headerlink" title="2.1 闭与包"></a>2.1 闭与包</h2><p>基于函数对象的概念，可以将函数返回到任意位置去调用，但作用域的关系是在定义完函数时就已经被确定了的，与函数的调用位置无关。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>():</span></span><br><span class="line">    x=<span class="number">3</span></span><br><span class="line">    f2=f1() <span class="comment">#调用f1()返回函数f2</span></span><br><span class="line">    f2() <span class="comment">#需要按照函数定义时的作用关系去执行，与调用位置无关</span></span><br><span class="line"></span><br><span class="line">f3() <span class="comment">#结果为1</span></span><br></pre></td></tr></table></figure>

<p>也就是说函数被当做数据处理时，始终以自带的作用域为准。若内嵌函数包含对外部函数作用域（而非全局作用域）中变量的引用，那么该’内嵌函数’就是闭包函数，简称闭包(Closures)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    x=<span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">func=outer()</span><br><span class="line">func() <span class="comment"># 结果为2</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-f8b3a3ff993a95277b4ec5b1514cb103_720w.jpg" alt="img"></p>
<p>可以通过函数的<strong>closure</strong>属性，查看到闭包函数所包裹的外部变量</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x10212af78</span>: <span class="built_in">int</span> <span class="built_in">object</span> at <span class="number">0x10028cca0</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__closure__[<span class="number">0</span>].cell_contents</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>“闭”代表函数是内部的，“包”代表函数外’包裹’着对外层作用域的引用。因而无论在何处调用闭包函数，使用的仍然是包裹在其外层的变量。</p>
<p><img src="https://pic4.zhimg.com/80/v2-c6e623206aa2c60c1036f30656ffbbaf_720w.jpg" alt="img"></p>
<h2 id="2-2-闭包的用途"><a href="#2-2-闭包的用途" class="headerlink" title="2.2 闭包的用途"></a>2.2 闭包的用途</h2><p>目前为止，我们得到了两种为函数体传值的方式，一种是直接将值以参数的形式传入，另外一种就是将值包给函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式一：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">return</span> requests.get(url).text</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式二：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>():</span></span><br><span class="line">        <span class="keyword">return</span> requests.get(url).text</span><br><span class="line">    <span class="keyword">return</span> get</span><br></pre></td></tr></table></figure>

<p>提示：requests模块是用来模拟浏览器向网站发送请求并将页面内容下载到本地，需要事先安装：pip3 install requests</p>
<p><img src="https://pic1.zhimg.com/80/v2-25aba810eb15ef9e3d59241516b05358_720w.jpg" alt="img"></p>
<p>对比两种方式，方式一在下载同一页面时需要重复传入url，而方式二只需要传一次值，就会得到一个包含指定url的闭包函数，以后调用该闭包函数无需再传url</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方式一下载同一页面</span></span><br><span class="line">get(<span class="string">&#x27;https://www.python.org&#x27;</span>)</span><br><span class="line">get(<span class="string">&#x27;https://www.python.org&#x27;</span>)</span><br><span class="line">get(<span class="string">&#x27;https://www.python.org&#x27;</span>)</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二下载同一页面</span></span><br><span class="line">python=page(<span class="string">&#x27;https://www.python.org&#x27;</span>)</span><br><span class="line">python()</span><br><span class="line">python()</span><br><span class="line">python()</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<p>闭包函数的这种特性有时又称为惰性计算。使用将值包给函数的方式，在接下来的装饰器中也将大有用处</p>
<p><img src="https://pic3.zhimg.com/80/v2-fbcde5e64980428d3864f2c389ce3f3e_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p>函数对象：</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=43">https://www.bilibili.com/video/av73342471?p=43www.bilibili.com/video/av73342471?p=43</a></p>
<p>闭包函数：</p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=46">https://www.bilibili.com/video/av73342471?p=46www.bilibili.com/video/av73342471?p=46</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>17-生成器</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/17_%E7%94%9F%E6%88%90%E5%99%A8/</url>
    <content><![CDATA[<h2 id="一-生成器与yield"><a href="#一-生成器与yield" class="headerlink" title="一 生成器与yield"></a>一 生成器与yield</h2><p><img src="https://pic2.zhimg.com/80/v2-2c92ed3ae0da1fd192339be9abc973a1_720w.jpg" alt="img"></p>
<p>若函数体包含yield关键字，再调用函数，并不会执行函数体代码，得到的返回值即生成器对象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_range</span>(<span class="params">start,stop,step=<span class="number">1</span></span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;start...&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> start &lt; stop:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> start</span><br><span class="line"><span class="meta">... </span>        start+=step</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;end...&#x27;</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g=my_range(<span class="number">0</span>,<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g</span><br><span class="line">&lt;generator <span class="built_in">object</span> my_range at <span class="number">0x104105678</span>&gt;</span><br></pre></td></tr></table></figure>

<p>生成器内置有__iter__和__next__方法，所以生成器本身就是一个迭代器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.__iter__</span><br><span class="line">&lt;method-wrapper <span class="string">&#x27;__iter__&#x27;</span> of generator <span class="built_in">object</span> at <span class="number">0x1037d2af0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.__next__</span><br><span class="line">&lt;method-wrapper <span class="string">&#x27;__next__&#x27;</span> of generator <span class="built_in">object</span> at <span class="number">0x1037d2af0</span>&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-31590362f23201814f45879db5dd6a51_720w.jpg" alt="img"></p>
<p>因而我们可以用next(生成器)触发生成器所对应函数的执行，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g) <span class="comment"># 触发函数执行直到遇到yield则停止,将yield后的值返回，并在当前位置挂起函数</span></span><br><span class="line">start...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g) <span class="comment"># 再次调用next(g)，函数从上次暂停的位置继续执行，直到重新遇到yield...</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g) <span class="comment"># 周而复始...</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g) <span class="comment"># 触发函数执行没有遇到yield则无值返回，即取值完毕抛出异常结束迭代</span></span><br><span class="line">end...</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-fa04ec0eaa5bd7bb8804908ad7b88369_720w.jpg" alt="img"></p>
<p>既然生成器对象属于迭代器，那么必然可以使用for循环迭代，如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> countdown(<span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">countdown start</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">Done!</span><br></pre></td></tr></table></figure>

<p>有了yield关键字，我们就有了一种自定义迭代器的实现方式。yield可以用于返回值，但不同于return，函数一旦遇到return就结束了，而yield可以保存函数的运行状态挂起函数，用来返回多次值</p>
<p><img src="https://pic4.zhimg.com/80/v2-024f3ac36393f784226497828d53eebf_720w.jpg" alt="img"></p>
<h2 id="二-yield表达式应用"><a href="#二-yield表达式应用" class="headerlink" title="二 yield表达式应用"></a>二 yield表达式应用</h2><p>在函数内可以采用表达式形式的yield</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">eater</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;Ready to eat&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>        food=<span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(<span class="string">&#x27;get the food: %s, and start to eat&#x27;</span> %food)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>可以拿到函数的生成器对象持续为函数体send值，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>g=eater() <span class="comment"># 得到生成器对象</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g</span><br><span class="line">&lt;generator <span class="built_in">object</span> eater at <span class="number">0x101b6e2b0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(e) <span class="comment"># 需要事先”初始化”一次，让函数挂起在food=yield，等待调用g.send()方法为其传值</span></span><br><span class="line">Ready to eat</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.send(<span class="string">&#x27;包子&#x27;</span>)</span><br><span class="line">get the food: 包子, <span class="keyword">and</span> start to eat</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g.send(<span class="string">&#x27;鸡腿&#x27;</span>)</span><br><span class="line">get the food: 鸡腿, <span class="keyword">and</span> start to eat</span><br></pre></td></tr></table></figure>

<p>针对表达式形式的yield，生成器对象必须事先被初始化一次，让函数挂起在food&#x3D;yield的位置，等待调用g.send()方法为函数体传值，g.send(None)等同于next(g)。</p>
<p><img src="https://pic1.zhimg.com/80/v2-277c3fe7374520dba8973dea02474790_720w.jpg" alt="img"></p>
<p> 我们可以编写装饰器来完成为所有表达式形式yield对应生成器的初始化操作，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        g=func(*args,**kwargs)</span><br><span class="line">        <span class="built_in">next</span>(g)</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@init</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eater</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Ready to eat&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        food=<span class="keyword">yield</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get the food: %s, and start to eat&#x27;</span> %food)</span><br></pre></td></tr></table></figure>

<p>表达式形式的yield也可以用于返回多次值，即<code>变量名=yield 值</code>的形式，如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">eater</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">&#x27;Ready to eat&#x27;</span>)</span><br><span class="line"><span class="meta">... </span>    food_list=[]</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>        food=<span class="keyword">yield</span> food_list</span><br><span class="line"><span class="meta">... </span>        food_list.append(food)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e=eater()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(e)</span><br><span class="line">Ready to eat</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.send(<span class="string">&#x27;蒸羊羔&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;蒸羊羔&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.send(<span class="string">&#x27;蒸熊掌&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;蒸羊羔&#x27;</span>, <span class="string">&#x27;蒸熊掌&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.send(<span class="string">&#x27;蒸鹿尾儿&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;蒸羊羔&#x27;</span>, <span class="string">&#x27;蒸熊掌&#x27;</span>, <span class="string">&#x27;蒸鹿尾儿&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="三-三元表达式、列表生成式、生成器表达式"><a href="#三-三元表达式、列表生成式、生成器表达式" class="headerlink" title="三 三元表达式、列表生成式、生成器表达式"></a>三 三元表达式、列表生成式、生成器表达式</h2><h2 id="3-1-三元表达式"><a href="#3-1-三元表达式" class="headerlink" title="3.1 三元表达式"></a>3.1 三元表达式</h2><p>三元表达式是python为我们提供的一种简化代码的解决方案，语法如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = 条件成立时返回的值 <span class="keyword">if</span> 条件 <span class="keyword">else</span> 条件不成立时返回的值</span><br></pre></td></tr></table></figure>

<p>针对下述场景</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max2</span>(<span class="params">x,y</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x &gt; y:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">res = max2(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>用三元表达式可以一行解决</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span></span><br><span class="line">y=<span class="number">2</span></span><br><span class="line">res = x <span class="keyword">if</span> x &gt; y <span class="keyword">else</span> y <span class="comment"># 三元表达式</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-6b5e335f9c2baca1a9d076721c672b19_720w.jpg" alt="img"></p>
<h2 id="3-2-列表生成式"><a href="#3-2-列表生成式" class="headerlink" title="3.2 列表生成式"></a>3.2 列表生成式</h2><p>列表生成式是python为我们提供的一种简化代码的解决方案，用来快速生成列表，语法如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[expression <span class="keyword">for</span> item1 <span class="keyword">in</span> iterable1 <span class="keyword">if</span> condition1</span><br><span class="line"><span class="keyword">for</span> item2 <span class="keyword">in</span> iterable2 <span class="keyword">if</span> condition2</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> itemN <span class="keyword">in</span> iterableN <span class="keyword">if</span> conditionN</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#类似于</span></span><br><span class="line">res=[]</span><br><span class="line"><span class="keyword">for</span> item1 <span class="keyword">in</span> iterable1:</span><br><span class="line">    <span class="keyword">if</span> condition1:</span><br><span class="line">        <span class="keyword">for</span> item2 <span class="keyword">in</span> iterable2:</span><br><span class="line">            <span class="keyword">if</span> condition2</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">for</span> itemN <span class="keyword">in</span> iterableN:</span><br><span class="line">                    <span class="keyword">if</span> conditionN:</span><br><span class="line">                        res.append(expression)</span><br></pre></td></tr></table></figure>

<p>针对下述场景</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">egg_list=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    egg_list.append(<span class="string">&#x27;鸡蛋%s&#x27;</span> %i)</span><br></pre></td></tr></table></figure>

<p>用列表生成式可以一行解决</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">egg_list=[<span class="string">&#x27;鸡蛋%s&#x27;</span> %i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>

<p><img src="https://pic3.zhimg.com/80/v2-d9640f4c3f1c13bbd78e7cf6de6dc316_720w.jpg" alt="img"></p>
<h2 id="3-3-生成器表达式"><a href="#3-3-生成器表达式" class="headerlink" title="3.3 生成器表达式"></a>3.3 生成器表达式</h2><p>创建一个生成器对象有两种方式，一种是调用带yield关键字的函数，另一种就是生成器表达式，与列表生成式的语法格式相同，只需要将[]换成()，即：</p>
<p><img src="https://pic3.zhimg.com/80/v2-70257d333a3e9a49704c10982ce48856_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">（expression <span class="keyword">for</span> item <span class="keyword">in</span> iterable <span class="keyword">if</span> condition）</span><br></pre></td></tr></table></figure>

<p>对比列表生成式返回的是一个列表，生成器表达式返回的是一个生成器对象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g=(x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x101be0ba0</span>&gt;</span><br></pre></td></tr></table></figure>

<p>对比列表生成式，生成器表达式的优点自然是节省内存（一次只产生一个值在内存中）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(g) <span class="comment">#抛出异常StopIteration</span></span><br></pre></td></tr></table></figure>

<p>如果我们要读取一个大文件的字节数，应该基于生成器表达式的方式完成</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;db.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    nums=(<span class="built_in">len</span>(line) <span class="keyword">for</span> line <span class="keyword">in</span> f)</span><br><span class="line">    total_size=<span class="built_in">sum</span>(nums) <span class="comment"># 依次执行next(nums)，然后累加到一起得到结果=</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-f0a061871b663d857e13ada7c10b31ac_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=52">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=52<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=53">python快速入门（一）_哔哩哔哩 (゜-゜)つロ 干杯~-bilibiliwww.bilibili.com/video/av73342471?p=53<img src="https://pic4.zhimg.com/v2-c64ada0dd06d0c57ed905be65d17acb7_180x120.jpg" alt="img"></a></p>
<p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=54">https://www.bilibili.com/video/av73342471?p=54www.bilibili.com/video/av73342471?p=54</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title>16-迭代器</title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/16_%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
    <content><![CDATA[<h2 id="一-迭代器介绍"><a href="#一-迭代器介绍" class="headerlink" title="一 迭代器介绍"></a>一 迭代器介绍</h2><p>迭代器即用来迭代取值的工具，而迭代是重复反馈过程的活动，其目的通常是为了逼近所需的目标或结果，每一次对过程的重复称为一次“迭代”，而每一次迭代得到的结果会作为下一次迭代的初始值,单纯的重复并不是迭代</p>
<p><img src="https://pic4.zhimg.com/80/v2-565373773a847faa7a97a79b8851d2db_720w.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;: &#x27;</span>).strip()</span><br><span class="line">    <span class="built_in">print</span>(msg)</span><br></pre></td></tr></table></figure>

<p>下述while循环才是一个迭代过程，不仅满足重复，而且以每次重新赋值后的index值作为下一次循环中新的索引进行取值，反复迭代，最终可以取尽列表中的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">goods=[<span class="string">&#x27;mac&#x27;</span>,<span class="string">&#x27;lenovo&#x27;</span>,<span class="string">&#x27;acer&#x27;</span>,<span class="string">&#x27;dell&#x27;</span>,<span class="string">&#x27;sony&#x27;</span>]</span><br><span class="line"></span><br><span class="line">index=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> index &lt; <span class="built_in">len</span>(goods):</span><br><span class="line">    <span class="built_in">print</span>(goods[index])</span><br><span class="line">    index+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-70866f67008dbbd32b1db9a0122e5a85_720w.jpg" alt="img"></p>
<h2 id="1-1-可迭代对象"><a href="#1-1-可迭代对象" class="headerlink" title="1.1 可迭代对象"></a>1.1 可迭代对象</h2><p>通过索引的方式进行迭代取值，实现简单，但仅适用于序列类型：字符串，列表，元组。对于没有索引的字典、集合等非序列类型，必须找到一种不依赖索引来进行迭代取值的方式，这就用到了迭代器。</p>
<p>要想了解迭代器为何物，必须事先搞清楚一个很重要的概念：可迭代对象(Iterable)。从语法形式上讲，内置有__iter__方法的对象都是可迭代对象，字符串、列表、元组、字典、集合、打开的文件都是可迭代对象：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;egon&#x27;</span>&#125;.__iter__</span><br><span class="line">&#123;<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;.__iter__</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-2d426dd7229747e25b7342c4bba5be50_720w.jpg" alt="img"></p>
<h3 id="1-2-迭代器对象"><a href="#1-2-迭代器对象" class="headerlink" title="1.2 迭代器对象"></a>1.2 迭代器对象</h3><p>调用obj.<strong>iter</strong>()方法返回的结果就是一个迭代器对象(Iterator)。迭代器对象是内置有<strong>iter</strong>和<strong>next</strong>方法的对象，打开的文件本身就是一个迭代器对象，执行迭代器对象.<strong>iter</strong>()方法得到的仍然是迭代器本身，而执行迭代器.<strong>next</strong>()方法就会计算出迭代器中的下一个值。 迭代器是Python提供的一种统一的、不依赖于索引的迭代取值方式，只要存在多个“值”，无论序列类型还是非序列类型都可以按照迭代器的方式取值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; <span class="comment"># 可迭代对象s</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i=<span class="built_in">iter</span>(s)  <span class="comment"># 本质就是在调用s.__iter__(),返回s的迭代器对象i，</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(i) <span class="comment"># 本质就是在调用i.__next__()</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(i)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(i)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(i)  <span class="comment">#抛出StopIteration的异常，代表无值可取，迭代结束</span></span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/80/v2-737e0d369eb76a990b772d9666e25a4f_720w.jpg" alt="img"></p>
<h2 id="二-for循环原理"><a href="#二-for循环原理" class="headerlink" title="二 for循环原理"></a>二 for循环原理</h2><p>有了迭代器后，我们便可以不依赖索引迭代取值了，使用while循环的实现方式如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">goods=[<span class="string">&#x27;mac&#x27;</span>,<span class="string">&#x27;lenovo&#x27;</span>,<span class="string">&#x27;acer&#x27;</span>,<span class="string">&#x27;dell&#x27;</span>,<span class="string">&#x27;sony&#x27;</span>]</span><br><span class="line">i=<span class="built_in">iter</span>(goods) <span class="comment">#每次都需要重新获取一个迭代器对象</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">next</span>(i))</span><br><span class="line">    <span class="keyword">except</span> StopIteration: <span class="comment">#捕捉异常终止循环</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>for循环又称为迭代循环，in后可以跟任意可迭代对象，上述while循环可以简写为</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">goods=[<span class="string">&#x27;mac&#x27;</span>,<span class="string">&#x27;lenovo&#x27;</span>,<span class="string">&#x27;acer&#x27;</span>,<span class="string">&#x27;dell&#x27;</span>,<span class="string">&#x27;sony&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> goods:   </span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<p>for 循环在工作时，首先会调用可迭代对象goods内置的<strong>iter</strong>方法拿到一个迭代器对象，然后再调用该迭代器对象的<strong>next</strong>方法将取到的值赋给item,执行循环体完成一次循环，周而复始，直到捕捉StopIteration异常，结束迭代。</p>
<p><img src="https://pic2.zhimg.com/80/v2-c64b3c28a2b8977bfce7621078da63b9_720w.jpg" alt="img"></p>
<h2 id="三-迭代器的优缺点"><a href="#三-迭代器的优缺点" class="headerlink" title="三 迭代器的优缺点"></a>三 迭代器的优缺点</h2><p>基于索引的迭代取值，所有迭代的状态都保存在了索引中，而基于迭代器实现迭代的方式不再需要索引，所有迭代的状态就保存在迭代器中，然而这种处理方式优点与缺点并存：</p>
<h2 id="3-1-优点："><a href="#3-1-优点：" class="headerlink" title="3.1 优点："></a>3.1 优点：</h2><p>1、为序列和非序列类型提供了一种统一的迭代取值方式。</p>
<p>2、惰性计算：迭代器对象表示的是一个数据流，可以只在需要时才去调用<strong>next</strong>来计算出一个值，就迭代器本身来说，同一时刻在内存中只有一个值，因而可以存放无限大的数据流，而对于其他容器类型，如列表，需要把所有的元素都存放于内存中，受内存大小的限制，可以存放的值的个数是有限的。</p>
<p><img src="https://pic2.zhimg.com/80/v2-c91b05bd30f1abae45ec6867bb5e9625_720w.jpg" alt="img"></p>
<h2 id="3-2-缺点："><a href="#3-2-缺点：" class="headerlink" title="3.2 缺点："></a>3.2 缺点：</h2><p>1、除非取尽，否则无法获取迭代器的长度</p>
<p>2、只能取下一个值，不能回到开始，更像是‘一次性的’，迭代器产生后的唯一目标就是重复执行next方法直到值取尽，否则就会停留在某个位置，等待下一次调用next；若是要再次迭代同个对象，你只能重新调用iter方法去创建一个新的迭代器对象，如果有两个或者多个循环使用同一个迭代器，必然只会有一个循环能取到值。</p>
<p><img src="https://pic2.zhimg.com/80/v2-8e0f71376333332d0411bb2199131c6d_720w.jpg" alt="img"></p>
<h2 id="视频链接："><a href="#视频链接：" class="headerlink" title="视频链接："></a>视频链接：</h2><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/av73342471?p=51">https://www.bilibili.com/video/av73342471?p=51www.bilibili.com/video/av73342471?p=51</a></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>Python入门</category>
      </categories>
  </entry>
  <entry>
    <title></title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/54_%E9%99%84%E5%BD%95%E4%B9%9D%EF%BC%9AType/</url>
    <content><![CDATA[<p>类型提示 <strong>Type hinting</strong>（最低Python版本为3.5）</p>
<p>python3新增类型提示功能，例如我们可以为函数增加类型提示信息，而不影响函数本身的执行：</p>
<p>注释的一般规则是参数名后跟一个冒号（：），然后再跟一个expression，这个expression可以是任何形式。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def func(a: &#x27;spam&#x27;, b: (1, 10), c: float) -&gt; int:</span><br><span class="line">    return a + b + c</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; func(1, 2, 3)</span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<p>返回值的形式是 -&gt; int，annotation可被保存为函数的attributes。查看所有的annotation，可通过如下语句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; func.__annotations__</span><br><span class="line">&#123;&#x27;c&#x27;: &lt;class &#x27;float&#x27;&gt;, &#x27;a&#x27;: &#x27;spam&#x27;, &#x27;b&#x27;: (1, 10), &#x27;return&#x27;: &lt;class &#x27;int&#x27;&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>如果为函数增加了注释，可不可以继续使用默认参数呢？答案是肯定的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def func(a: &#x27;spam&#x27; = 4, b: (1, 10) = 5, c: float = 6) -&gt; int:</span><br><span class="line">...   return a + b + c</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; func(1, 2, 3)</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; func()</span><br><span class="line">15</span><br><span class="line">&gt;&gt;&gt; func(1, c=10)</span><br><span class="line">16</span><br><span class="line">&gt;&gt;&gt; func.__annotations__</span><br><span class="line">&#123;&#x27;c&#x27;: &lt;class &#x27;float&#x27;&gt;, &#x27;a&#x27;: &#x27;spam&#x27;, &#x27;b&#x27;: (1, 10), &#x27;return&#x27;: &lt;class &#x27;int&#x27;&gt;&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/2022/07/18/03_Python/02_Python%E8%BF%9B%E9%98%B6/01_%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/2022/07/18/03_Python/01_Python%E5%9F%BA%E7%A1%80/hinting/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>运维之基础命令--虚拟机安装</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day01-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="day01-课堂笔记"><a href="#day01-课堂笔记" class="headerlink" title="day01 : 课堂笔记"></a>day01 : 课堂笔记</h1><h2 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h2><p><strong>1、安装虚拟机</strong></p>
<p><img src="/.%5Cassets%5Cimage-20210302121236930.png" alt="image-20210302121236930"></p>
<p>解压上述软件，创建vmware.exe快捷方式，然后用快捷方式打开。</p>
<p><img src="/.%5Cassets%5Cimage-20210302121408360.png" alt="image-20210302121408360"></p>
<p><strong>2、创建虚拟机</strong></p>
<p><img src="/.%5Cassets%5Cimage-20210302121456338.png" alt="image-20210302121456338"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121550128.png" alt="image-20210302121550128"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121622000.png" alt="image-20210302121622000"></p>
<p><img src="/.%5Cassets%5Cimage-20210302121745568.png" alt="image-20210302121745568"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122035359.png" alt="image-20210302122035359"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122256831.png" alt="image-20210302122256831"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122359568.png" alt="image-20210302122359568"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122603313.png" alt="image-20210302122603313"></p>
<p><img src="/.%5Cassets%5Cimage-20210302122657199.png" alt="image-20210302122657199"></p>
<p><img src="/.%5Cassets%5Cimage-20210302123826623.png" alt="image-20210302123826623"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124229475.png" alt="image-20210302124229475"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124308081.png" alt="image-20210302124308081"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124327456.png" alt="image-20210302124327456"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124404318.png" alt="image-20210302124404318"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124713502.png" alt="image-20210302124713502"></p>
<p><img src="/.%5Cassets%5Cimage-20210302124741038.png" alt="image-20210302124741038"></p>
<p><img src="/.%5Cassets%5Cimage-20210302125049653.png" alt="image-20210302125049653"></p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--打包与压缩</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day08-%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9/%E6%89%93%E5%8C%85%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="打包和压缩"><a href="#打包和压缩" class="headerlink" title="打包和压缩"></a>打包和压缩</h1><blockquote>
<p>将文件或文件夹合并成一个包，然后通过压缩算法进行数据压缩，减小包的体积，方便网络传输。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">windows：</span><br><span class="line">	zip</span><br><span class="line">	rar</span><br><span class="line"></span><br><span class="line">linux:</span><br><span class="line">	zip</span><br><span class="line">	tar</span><br><span class="line">	gz</span><br><span class="line">	bz2</span><br><span class="line">	tar.gz</span><br><span class="line">	tar.bz2</span><br><span class="line"></span><br><span class="line">压缩算法：</span><br><span class="line">	gzip</span><br><span class="line">	bzip2</span><br></pre></td></tr></table></figure>

<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><blockquote>
<p>是一个Windows和Linux中常用打包压缩工具，支持的压缩算法是zip。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zip工具需要安装</span><br><span class="line">	yum install zip unzip -y</span><br></pre></td></tr></table></figure>

<h3 id="zip压缩一个文件"><a href="#zip压缩一个文件" class="headerlink" title="zip压缩一个文件"></a>zip压缩一个文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 格式</span></span><br><span class="line">	zip [参数] 压缩包名称  文件路径</span><br><span class="line"></span><br><span class="line">[root@abc ~]<span class="comment"># zip 123.zip 123.log </span></span><br><span class="line">  adding: 123.log (deflated 87%)</span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4732</span><br><span class="line">-rw-r--r--  1 root root  646165 Mar  9 10:31 123.log</span><br><span class="line">-rw-r--r--  1 root root   85296 Mar 11 11:58 123.zip</span><br></pre></td></tr></table></figure>

<h3 id="zip压缩文件夹"><a href="#zip压缩文件夹" class="headerlink" title="zip压缩文件夹"></a>zip压缩文件夹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 需要一个-r参数去递归压缩文件夹下的所有内容</span></span><br><span class="line">[root@abc ~]<span class="comment"># zip -r dir.zip dir/</span></span><br><span class="line">  adding: dir/ (stored 0%)</span><br><span class="line">  adding: dir/one/ (stored 0%)</span><br><span class="line">  adding: dir/123.log (deflated 87%)</span><br></pre></td></tr></table></figure>

<h3 id="zip的静默输出"><a href="#zip的静默输出" class="headerlink" title="zip的静默输出"></a>zip的静默输出</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -q：参数就是不输出任何打包信息</span></span><br><span class="line">[root@abc opt]<span class="comment"># zip -r -q etc.zip /etc/</span></span><br><span class="line">[root@abc opt]<span class="comment"># ls -l</span></span><br><span class="line">total 14200</span><br><span class="line">-rw-r--r-- 1 root root 13674457 Mar 11 12:15 etc.zip</span><br></pre></td></tr></table></figure>

<h3 id="zip解压命令（unzip）"><a href="#zip解压命令（unzip）" class="headerlink" title="zip解压命令（unzip）"></a>zip解压命令（unzip）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 格式</span></span><br><span class="line">	unzip [参数] 压缩包路径</span><br><span class="line"></span><br><span class="line"><span class="comment"># unzip解压命令只能解压由zip打包的压缩文件</span></span><br><span class="line">[root@abc ~]<span class="comment"># unzip dir.zip </span></span><br><span class="line">Archive:  dir.zip</span><br><span class="line">  inflating: dir/123.log             </span><br><span class="line">[root@abc ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他压缩包由unzip解压时随即报错。</span></span><br><span class="line">[root@abc opt]<span class="comment"># unzip nginx-.tar.gz</span></span><br><span class="line">Archive:  nginx-.tar.gz</span><br><span class="line">  End-of-central-directory signature not found.  Either this file is not</span><br><span class="line">  a zipfile, or it constitutes one disk of a multi-part archive.  In the</span><br><span class="line">  latter <span class="keyword">case</span> the central directory and zipfile comment will be found on</span><br><span class="line">  the last disk(s) of this archive.</span><br><span class="line">unzip:  cannot find zipfile directory <span class="keyword">in</span> one of nginx-.tar.gz or</span><br><span class="line">        nginx-.tar.gz.zip, and cannot find nginx-.tar.gz.ZIP, period.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看压缩包中压缩那些内容，不解压？</span></span><br><span class="line"><span class="comment"># 只查看压缩包内容不解压需要使用 -l 参数</span></span><br><span class="line">[root@abc opt]<span class="comment"># unzip -l dir.zip </span></span><br><span class="line">Archive:  dir.zip</span><br><span class="line">  Length      Date    Time    Name</span><br><span class="line">---------  ---------- -----   ----</span><br><span class="line">        0  03-11-2021 12:04   dir/</span><br><span class="line">---------                     -------</span><br><span class="line">        0                     1 file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压到指定目录（-d）</span></span><br><span class="line">[root@abc ~]<span class="comment"># unzip -d /root/  etc.zip </span></span><br><span class="line">[root@abc opt]<span class="comment"># cd /root/</span></span><br><span class="line">[root@abc ~]<span class="comment"># ls</span></span><br><span class="line">]        anaconda-ks.cfg  dir.zip  index.html           test.pdf.gz  xxxeth0xxx           系统优化.md</span><br><span class="line">123.log  demo.txt         etc      nginx-0.1.22.tar.gz  test.txt     上传与下载.md</span><br><span class="line">123.zip  dir              eth0xxx  <span class="built_in">test</span>                 xxxeth0      文件管理_(高级).pdf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静默输出(-q)</span></span><br><span class="line">[root@abc ~]<span class="comment"># rm -rf etc</span></span><br><span class="line">[root@abc ~]<span class="comment"># unzip -q -d /root/ /opt/etc.zip </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4828</span><br><span class="line">drwxr-xr-x  91 root root    8192 Mar 11 11:16 etc</span><br></pre></td></tr></table></figure>

<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><blockquote>
<p>tar压缩支持多种压缩算法</p>
<p>tar.gz   gzip (用的最多)</p>
<p>tar.bz2 bzip2</p>
</blockquote>
<h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h3><blockquote>
<p>通过gzip压缩算法，将文件压缩一定体积，有利于传输, 不支持打包</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4828</span><br><span class="line">-rw-r--r--   1 root root  244977 Mar 10 12:12 index.html</span><br><span class="line">[root@abc ~]<span class="comment"># gzip index.html </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4612</span><br><span class="line">-rw-r--r--   1 root root   22652 Mar 10 12:12 index.html.gz</span><br></pre></td></tr></table></figure>

<h4 id="gzip压缩一个目录"><a href="#gzip压缩一个目录" class="headerlink" title="gzip压缩一个目录"></a>gzip压缩一个目录</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc etc]<span class="comment"># gzip -r /etc</span></span><br><span class="line">[root@abc etc]<span class="comment"># ls </span></span><br><span class="line">abrt                        GREP_COLORS.gz               my.cnf.d                 security</span><br><span class="line">adjtime.gz                  groff                        my.cnf.gz                selinux</span><br><span class="line">aliases.db.gz               group-.gz                    NetworkManager           services.gz</span><br><span class="line">aliases.gz                  group.gz                     networks.gz              sestatus.conf.gz</span><br><span class="line">alternatives                grub2.cfg                    nsswitch.conf.bak.gz     sgml</span><br><span class="line">anacrontab.gz               grub.d                       nsswitch.conf.gz         shadow</span><br></pre></td></tr></table></figure>

<h3 id="gzip解压-d"><a href="#gzip解压-d" class="headerlink" title="gzip解压(-d)"></a>gzip解压(-d)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">-rw-r--r--   1 0 0   22652 Mar 10 12:12 index.html.gz</span><br><span class="line">[root@abc ~]<span class="comment"># gzip -d index.html.gz </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4828</span><br><span class="line">-rw-r--r--   1 0 0  244977 Mar 10 12:12 index.html</span><br></pre></td></tr></table></figure>

<h3 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h3><blockquote>
<p>使用bzip2 压缩算法来压缩一定体积的文件。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4828</span><br><span class="line">-rw-r--r--   1 root root  646165 Mar  9 10:31 123.log     </span><br><span class="line">[root@abc ~]<span class="comment"># bzip2 123.log </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4240</span><br><span class="line">-rw-r--r--   1 root root       0 Mar 10 12:04 ]</span><br><span class="line">-rw-r--r--   1 root root   42210 Mar  9 10:31 123.log.bz2</span><br></pre></td></tr></table></figure>

<h3 id="bzip2解压（-d）"><a href="#bzip2解压（-d）" class="headerlink" title="bzip2解压（-d）"></a>bzip2解压（-d）</h3><blockquote>
<p>bzip2解压是针对于bzip2压缩的压缩包来进行解压。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4240</span><br><span class="line">-rw-r--r--   1 root root   42210 Mar  9 10:31 123.log.bz2</span><br><span class="line">[root@abc ~]<span class="comment"># bzip2 -d 123.log.bz2 </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 4828</span><br><span class="line">-rw-r--r--   1 root root  646165 Mar  9 10:31 123.log</span><br></pre></td></tr></table></figure>

<h3 id="tar-1"><a href="#tar-1" class="headerlink" title="tar"></a>tar</h3><blockquote>
<p>tar其实是一个打包工具，不具备压缩功能，但是可以使用参数调用压缩工具来进行解压。</p>
</blockquote>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>-c : 创建压缩包</p>
</li>
<li><p>-f : 指定压缩包名称</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -c -f test.tar 123.log </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 5468</span><br><span class="line">-rw-r--r--   1 root root  655360 Mar 11 15:49 test.tar</span><br></pre></td></tr></table></figure>
</li>
<li><p>-z ： 指定使用gzip压缩工具进行压缩</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar  -c -z -f test-one.tar 123.log </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l </span></span><br><span class="line">total 5084</span><br><span class="line">-rw-r--r--   1 root root   85279 Mar 11 15:56 test-one.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：使用-z参数，不会自动添加.gz后缀</span></span><br><span class="line"></span><br><span class="line">[root@abc ~]<span class="comment"># tar -c -z -f anaconda.tar.gz  anaconda-ks.cfg </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 5084</span><br><span class="line">-rw-r--r--   1 root root    1010 Mar 11 15:58 anaconda.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>-j : 指定使用bzip2压缩工具进行压缩</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -c -j -f 123-bask-one.tar 123.log </span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">total 5172</span><br><span class="line">-rw-r--r--   1 root root   42328 Mar 11 16:00 123-bak.tar.bz2</span><br><span class="line">-rw-r--r--   1 root root   42328 Mar 11 16:01 123-bask-one.tar</span><br></pre></td></tr></table></figure>
</li>
<li><p>-J : 指定使用xz压缩工具进行压缩</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc test-tar]<span class="comment"># tar -c -J  -f etc.tar.xz /etc/</span></span><br><span class="line">[root@abc ~]<span class="comment"># ls -l</span></span><br><span class="line">-rw-r--r-- 1 root root 9493376 Mar 11 17:00 etc.tar.xz</span><br></pre></td></tr></table></figure>
</li>
<li><p>-t : 查看压缩包内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -t -f 123-bak.tar.bz2 </span></span><br><span class="line">123.log</span><br><span class="line">[root@abc ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-v ： 显示压缩包压缩过程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -x -v -f etc.tar -C /opt/</span></span><br><span class="line">/etc/centos-release</span><br><span class="line">/etc/DIR_COLORS.lightbgcolor</span><br><span class="line">/etc/libaudit.conf</span><br><span class="line">/etc/mail.rc</span><br></pre></td></tr></table></figure>
</li>
<li><p>-P : 允许使用绝对路径进行打包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -c -P -f 123-three.tar /etc/passwd</span></span><br><span class="line">[root@abc ~]<span class="comment"># tar -c -f 123-three.tar /etc/passwd</span></span><br><span class="line">tar: Removing leading `/<span class="string">&#x27; from member names</span></span><br><span class="line"><span class="string">[root@abc ~]# </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-x ： 解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tar解压是按照原来的路径进行解压</span></span><br><span class="line">[root@abc <span class="built_in">test</span>]<span class="comment"># tar -x -f etc.tar </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tar会自动识别压缩功能</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-C ： 指定解压路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc ~]<span class="comment"># tar -x -f etc.tar -C /opt/</span></span><br><span class="line">tar: Removing leading `/<span class="string">&#x27; from member names</span></span><br><span class="line"><span class="string">[root@abc ~]# cd /opt/</span></span><br><span class="line"><span class="string">[root@abc opt]# ls</span></span><br><span class="line"><span class="string">abc23  dir  dir.zip  etc  nginx-0.1.22.tar.gz  nginx-.tar.gz  xxx</span></span><br><span class="line"><span class="string">[root@abc opt]# </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>–exclude : 排除某些文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc test-tar]<span class="comment"># tar -c -f abc.tar ./* --exclude=abc7 --exclude=abc5   --exclude=abc1 </span></span><br><span class="line">[root@abc test-tar]<span class="comment"># tar -t -f abc.tar </span></span><br><span class="line">./abc2</span><br><span class="line">./abc3</span><br><span class="line">./abc4</span><br><span class="line">./abc6</span><br><span class="line">./abc8</span><br><span class="line">./abc9</span><br><span class="line">[root@abc test-tar]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>–exclude-from : 根据某个文件列表排除多个文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc test-tar]<span class="comment"># cat list.txt </span></span><br><span class="line">abc995</span><br><span class="line">abc996</span><br><span class="line">abc997</span><br><span class="line">abc998</span><br><span class="line">abc999</span><br><span class="line">[root@abc test-tar]<span class="comment"># tar -c -f abc.tar ./* --exclude-from=list.txt </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-h : 打包软连接</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@abc test-tar]<span class="comment"># tar -c -h -f bin-h.tar /bin</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar参数</span><br><span class="line">	-c : 创建压缩</span><br><span class="line">	-f ； 指定压缩包名称</span><br><span class="line">	-z : 使用gzip压缩工具进行压缩</span><br><span class="line">	-j : 使用bzip2压缩工具进行压缩</span><br><span class="line">	-J : 使用xz压缩工具进行压缩</span><br><span class="line">	-t : 显示压缩包内容，不解压</span><br><span class="line">	-v : 显示压缩过程</span><br><span class="line">	-P : 允许使用绝对路径进行压缩</span><br><span class="line">	-x : 解压</span><br><span class="line">	-C : 指定解压路径</span><br><span class="line">	-h : 打包软连接</span><br><span class="line">	--exclude : 排除某些文件</span><br><span class="line">	--exclude-from : 根据文件列表排除多个文件</span><br></pre></td></tr></table></figure>





<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.linux下常见的压缩包类型有哪些</span><br><span class="line">zip </span><br><span class="line">gz </span><br><span class="line">bz2 </span><br><span class="line">tar.gz </span><br><span class="line">tar.bz </span><br><span class="line">tar</span><br><span class="line"></span><br><span class="line">2.将/etc/hosts文件用tar格式打包。</span><br><span class="line">tar -c -P -f hosts.tar /etc/hosts</span><br><span class="line"></span><br><span class="line">3.查看打包之后的/etc/hosts的文件内容，在不解压的情况下查看。</span><br><span class="line">tar -t -f hosts.tar</span><br><span class="line"></span><br><span class="line">4.使用tar打包/var/<span class="built_in">log</span>/目录。</span><br><span class="line">tar -c -P -f hosts.tar /var/<span class="built_in">log</span>/</span><br><span class="line"></span><br><span class="line">5.使用zip打包/etc目录。</span><br><span class="line">zip -r etc.zip /etc</span><br><span class="line"></span><br><span class="line">6.查看/var/<span class="built_in">log</span>/abc.zip目录的压缩包中有哪些内容。</span><br><span class="line">unzip -l /var/<span class="built_in">log</span>/abc.zip</span><br><span class="line"></span><br><span class="line">7.将/var/<span class="built_in">log</span>/abc.zip目录解压到/opt目录中。</span><br><span class="line">unzip -d /opt /var/<span class="built_in">log</span>/abc.zip</span><br><span class="line"></span><br><span class="line">10.解压/etc/abc.tar.gz目录到/opt目录中。</span><br><span class="line">tar -xf /etc/abc.tar.gz -C /opt</span><br><span class="line"></span><br><span class="line">11.用zip打包/opt目录，要求不显示打包过程。</span><br><span class="line">zip -q opt.zip /opt</span><br><span class="line"></span><br><span class="line">zip [参数] 压缩包名称  压缩文件路径</span><br><span class="line"> </span><br><span class="line">12.打包/etc/目录，要求是.bz2格式</span><br><span class="line">tar -c -j -f etc.tar /etc</span><br><span class="line"></span><br><span class="line">13.打包/var/<span class="built_in">log</span>目录，要求是.xz格式</span><br><span class="line">tar -c -J -f log.tar.xz /var/<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">14.使用tar命令打包/etc/时，会出现一个删根的操作，怎样打包不会进行删根的操作</span><br><span class="line">tar -c -P -f etc.tar /etc</span><br><span class="line"></span><br><span class="line">15.打包/etc/目录，要求不打包/etc/hosts这个文件。</span><br><span class="line"></span><br><span class="line">16.打包/etc/目录，要求不打包/etc/hosts和/etc/hostname这两个文件。</span><br><span class="line"></span><br><span class="line">17.打包/etc/目录，但要排除passwd,shadow,group,gshadow,hosts,hostname这些文件。(你能用两种方法实现吗)</span><br><span class="line"></span><br><span class="line">18.已知/etc/grub2.cfg文件是个软连接文件，在你不知道的情况下，请问怎么打包该文件的真实文件。</span><br><span class="line"></span><br><span class="line">19.把/var/<span class="built_in">log</span>/目录中所有.<span class="built_in">log</span>的文件进行打包成一个压缩包，名称定义为log.tar.gz的压缩包。</span><br><span class="line"></span><br><span class="line">20.已知文件oldboy.gz,请问在不解压的情况下，怎样查看该文件的内容。</span><br><span class="line"></span><br><span class="line">21.打包/etc/目录，当前时间方式的压缩包:比如: 2019-12-24_etc.tar.gz</span><br><span class="line"></span><br><span class="line">22.创建/data/bak目录，然后复制如下文件到/data/bak目录下</span><br><span class="line"></span><br><span class="line">23.接22题，使用tar命令对/data/bak目录下的文件及目录以gzip的格式进行归档压缩到/data目录下（压缩包的名字以自己名字命名）</span><br><span class="line"></span><br><span class="line">24.使用tar命令查看上题/data目录下压缩包内的内容。</span><br><span class="line"></span><br><span class="line">25.把第23题/data目录下的压缩包，解压到/backup目录下</span><br><span class="line"></span><br><span class="line">26.再次使用tar命令把/data/bak目录下的文件及目录以gzip的格式进行归档压缩到/data目录下，但是在进行归档压缩时，排除文件“sudoers”，然后查看该压缩包内容是否存在文件“sudoers”（压缩包名自行拟定）</span><br><span class="line"></span><br><span class="line">27.打包/etc目录下所有普通文件到root用户家目录。</span><br><span class="line"></span><br><span class="line">28.打包/etc/目录到/opt/目录下，名称要求以当前主机名和ip地址命名，例：oldboy_10.0.0.100.tar.gz</span><br><span class="line"></span><br><span class="line">29.如何使用gzip命令对文件进行压缩、解压</span><br><span class="line"></span><br><span class="line">30.如何用zip命令对文件以及目录进行压缩、解压</span><br><span class="line"></span><br><span class="line">32.打包opt整个目录，并命名test_opt.tar.gz</span><br><span class="line"></span><br><span class="line">33.查看打包好的test_opt.tar.gz里的文件</span><br><span class="line"></span><br><span class="line">34.将打包好的test_opt.tar.gz内容指定解压至/tmp目录</span><br><span class="line"></span><br><span class="line">35.打包etc目录下的所有文件，不要目录只要文件</span><br><span class="line"></span><br><span class="line">36.打包etc目录下的所有文件，排除passwd，shadow</span><br><span class="line"></span><br><span class="line">37.打包etc目录下的所有以p开头的文件</span><br><span class="line"></span><br><span class="line">38.打包etc目录下所有大于1M的文件</span><br></pre></td></tr></table></figure>







<h2 id="习题-1"><a href="#习题-1" class="headerlink" title="习题"></a>习题</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2.权限中的rwx-，每个字符所代表什么意思？对应的数字是什么？</span><br><span class="line"></span><br><span class="line">r		可读		4</span><br><span class="line"></span><br><span class="line">w		可写		2</span><br><span class="line"></span><br><span class="line">x		可执行		1</span><br><span class="line"></span><br><span class="line">-		没有权限	0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.-rwxr-xr-x，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.-rwxr--r--，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.-r-xr-x--x，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.-rw-r-xr-x，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7.-r--r--r--，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.-r-xr-----，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9.---x-w-r--，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10.-rwxr--rw-，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">11.-rw-r--r--，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">12.---xr--rwx，写出对应数字权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">13.777，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">14.545，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">15.744，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">16.600，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">17.641，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">18.711，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">19.700，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">20.555，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">21.733，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">22.713，写出对应字母权限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">23.建一个目录/<span class="built_in">test</span>,查看这个目录的默认权限是?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">24.进入/<span class="built_in">test</span>目录中,建一个文件abc,查看其默认的权限为？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">25.创建一个文件test.txt,并其将权限改为600.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">26.将test.txt文件的权限改为755.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">27.将test.txt文件的权限改为000.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">28.修改test.txt文件的权限为644.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">29.给test.txt文件的属主加上x权限。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">30.给test.txt文件的其他用户加上x权限。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">31.去除test.txt文件的所有执行权限。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">32.给/<span class="built_in">test</span>目录及目录下的所有文件或目录的权限统一改为744。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--用户组管理</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day09-%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h2 id="linux中用户介绍"><a href="#linux中用户介绍" class="headerlink" title="linux中用户介绍"></a>linux中用户介绍</h2><p>什么是用户？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">用户其实就是相当于权限的化身，</span><br><span class="line">处于安全考虑</span><br><span class="line">所以，我们在进入系统之前都需要登录，根据用户给相应权限</span><br></pre></td></tr></table></figure>

<p>Linux系统中用户角色</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">uid : Linux系统当中用户ID（相当于身份证号）</span><br><span class="line">gid : ANTA20163307</span><br><span class="line"></span><br><span class="line">用户组其实是统一某一类用户权限</span><br><span class="line"></span><br><span class="line">需求：</span><br><span class="line">	大项目 ： </span><br><span class="line">		开发者：a b c d</span><br><span class="line">		运维 ： e f</span><br><span class="line">		测试：g</span><br><span class="line">	共同的权限：</span><br></pre></td></tr></table></figure>

<p>超级用户</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">linux当中的老大（皇帝）: root</span><br><span class="line">Windows当中的老大：administrator</span><br></pre></td></tr></table></figure>

<h2 id="用户与组相关的文件"><a href="#用户与组相关的文件" class="headerlink" title="用户与组相关的文件"></a>用户与组相关的文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">用户名称   是否存在密码   uid  gid  组名称/注释信息 家目录  默认解析器 </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--用户权限</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day10-Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="修改用户信息-usermod"><a href="#修改用户信息-usermod" class="headerlink" title="修改用户信息(usermod)"></a>修改用户信息(usermod)</h1><blockquote>
<p>修改用户信息最主要的命令是usermod命令，其参数跟useradd基本一致。</p>
</blockquote>
<ul>
<li><p>修改UID</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2002:2002::/home/xiaoyu:/bin/bash</span><br><span class="line">[root@localhost ~]<span class="comment"># usermod -u 2302 xiaoyu</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2002::/home/xiaoyu:/bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改基本组及附加组</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 基本组 : 一个用户必须拥有的哪个组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2002::/home/xiaoyu:/bin/bash</span><br><span class="line">[root@localhost ~]<span class="comment"># id xiaoyu</span></span><br><span class="line">uid=2302(xiaoyu) gid=2002(xiaoyu) groups=2002(xiaoyu)</span><br><span class="line">[root@localhost ~]<span class="comment"># usermod -g group1 xiaoyu</span></span><br><span class="line">[root@localhost ~]<span class="comment"># id xiaoyu</span></span><br><span class="line">uid=2302(xiaoyu) gid=2003(group1) groups=2003(group1)</span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2003::/home/xiaoyu:/bin/bash</span><br><span class="line">[root@localhost ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 附加组 ： 用户加入的其他用户组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># groupadd group1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),1000(oldboy),1001(sssssssssssssssssssssss),1002(<span class="built_in">test</span>)</span><br><span class="line">[root@localhost ~]<span class="comment"># usermod -G group1 root</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/group</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">group1:x:2003:root</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改家目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># usermod  -d /home/xiaoyu123 xiaoyu</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：修改家目录仅仅修改了配置，而原来的家目录文件没有迁移</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改用户描述信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2003::/home/xiaoyu123:/bin/bash</span><br><span class="line">[root@localhost ~]<span class="comment"># usermod -c &quot;这是一个甩锅&quot; xiaoyu</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改用户默认解析器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># usermod -s /bin/sh xiaoyu</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">xiaoyu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>锁定与解锁</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># usermod -L xiaoyu</span></span><br><span class="line">[root@localhost home]<span class="comment"># usermod -U xiaoyu</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改登录名称</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># usermod -l dayu xiaoyu</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">dayu:x:2302:2003:这是一个甩锅:/home/xiaoyu123:/bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>追加</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),1000(oldboy)</span><br><span class="line">[root@localhost home]<span class="comment"># usermod -G root dayu</span></span><br><span class="line">[root@localhost home]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),0(root)</span><br><span class="line">[root@localhost home]<span class="comment"># usermod -G oldboy dayu</span></span><br><span class="line">[root@localhost home]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),1000(oldboy)</span><br><span class="line">[root@localhost home]<span class="comment"># usermod -a -G root dayu</span></span><br><span class="line">[root@localhost home]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),0(root),1000(oldboy)</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="密码（passwd）"><a href="#密码（passwd）" class="headerlink" title="密码（passwd）"></a>密码（passwd）</h1><blockquote>
<p>修改或添加Linux普通用户的密码。直接影响的文件是&#x2F;etc&#x2F;shadow</p>
</blockquote>
<ul>
<li><p>增加或修改密码</p>
<p>当用户密码不存在的时候即为增加密码，当用户密码存在时即为修改密码。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># useradd password</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">password:x:2303:2303::/home/password:/bin/bash</span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/shadow</span></span><br><span class="line">password:!!:18701:0:99999:7:::</span><br><span class="line">[root@localhost home]<span class="comment"># passwd password</span></span><br><span class="line">Changing password <span class="keyword">for</span> user password.</span><br><span class="line">New password: </span><br><span class="line">BAD PASSWORD: The password is a palindrome</span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">password:x:2303:2303::/home/password:/bin/bash</span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/shadow</span></span><br><span class="line">password:$6$.EmM.4Bl<span class="variable">$f</span>.LimfvMsxxFZq6yFklfyk08JKQORdQovlk2a2dtrpkP31lAMLQpezFqLheBYOTm4Sur9aAqZlC/6MN6wHFBM1:18701:0:99999:7:::</span><br><span class="line">[root@localhost home]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>免交互修改密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># echo &quot;123&quot; | passwd --stdin dayu</span></span><br><span class="line">Changing password <span class="keyword">for</span> user dayu.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h1><blockquote>
<p>就类似于班级，是某个同权限用户的集合。</p>
</blockquote>
<h2 id="创建组"><a href="#创建组" class="headerlink" title="创建组"></a>创建组</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># groupadd group2</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">group2:x:2304:</span><br><span class="line">[root@localhost home]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<ul>
<li>指定gid</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># groupadd -g 2204 group3</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">group3:x:2204:</span><br></pre></td></tr></table></figure>

<ul>
<li>创建系统组</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># groupadd -r group4</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">group4:x:996:</span><br></pre></td></tr></table></figure>

<h2 id="修改组"><a href="#修改组" class="headerlink" title="修改组"></a>修改组</h2><ul>
<li><p>修改名称</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># tail -8 /etc/group</span></span><br><span class="line">girl:x:2001:</span><br><span class="line">[root@localhost home]<span class="comment"># groupmod -n boy girl</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -8 /etc/group</span></span><br><span class="line">boy:x:2001:</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改gid</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># groupmod -g 2021 boy</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -8 /etc/group</span></span><br><span class="line">boy:x:2021:</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="删除组"><a href="#删除组" class="headerlink" title="删除组"></a>删除组</h2><blockquote>
<p>用户组在系统中删除，如果一个组被用户占用则不能删除。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># groupdel group4</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -8 /etc/group</span></span><br><span class="line">dajige:x:1003:</span><br><span class="line">abc:x:2000:</span><br><span class="line">xiaoyu:x:2002:</span><br><span class="line">group1:x:2003:root</span><br><span class="line">password:x:2303:</span><br><span class="line">group2:x:2304:</span><br><span class="line">group3:x:2204:</span><br><span class="line">boy:x:2021:</span><br><span class="line">[root@localhost home]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：用户被删除，用户基本组也会被删除</span></span><br><span class="line">[root@localhost home]<span class="comment"># useradd test-group-del</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">test-group-del:x:2304:2305::/home/test-group-del:/bin/bash</span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">test-group-del:x:2305:</span><br><span class="line">[root@localhost home]<span class="comment"># userdel -r test-group-del</span></span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">password:x:2303:2303::/home/password:/bin/bash</span><br><span class="line">[root@localhost home]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">boy:x:2021:</span><br><span class="line">[root@localhost home]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<h2 id="组成员管理"><a href="#组成员管理" class="headerlink" title="组成员管理"></a>组成员管理</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加一个组到用户</span></span><br><span class="line">[root@localhost home]<span class="comment"># useradd gtest</span></span><br><span class="line">[root@localhost home]<span class="comment"># vim /etc/group</span></span><br><span class="line">[root@localhost home]<span class="comment"># id gtest</span></span><br><span class="line">uid=2304(gtest) gid=2305(gtest) groups=2305(gtest),2204(group3)</span><br><span class="line">[root@localhost home]<span class="comment"># gpasswd -a gtest group2</span></span><br><span class="line">Adding user gtest to group group2</span><br><span class="line">[root@localhost home]<span class="comment"># id gtest</span></span><br><span class="line">uid=2304(gtest) gid=2305(gtest) groups=2305(gtest),2304(group2),2204(group3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加多个组到用户</span></span><br><span class="line">[root@localhost home]<span class="comment"># gpasswd -M gtest,root,dayu group</span></span><br><span class="line">gpasswd: group <span class="string">&#x27;group&#x27;</span> does not exist <span class="keyword">in</span> /etc/group</span><br><span class="line">[root@localhost home]<span class="comment"># gpasswd -M gtest,root,dayu group3</span></span><br><span class="line">[root@localhost home]<span class="comment"># id root</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),2000(abc),2003(group1),2204(group3)</span><br><span class="line">[root@localhost home]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),0(root),1000(oldboy),2204(group3)</span><br><span class="line">[root@localhost home]<span class="comment"># id gtest</span></span><br><span class="line">uid=2304(gtest) gid=2305(gtest) groups=2305(gtest),2304(group2),2204(group3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为一个组添加组长(组长有权限向组内添加用户，其他用户[除root外]没有权限添加用户到该组)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># gpasswd -A dayu group3</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/gshadow</span></span><br><span class="line">group3:!:dayu:gtest,dayu,oldboy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组权限</span></span><br><span class="line">[root@localhost ~]<span class="comment"># id dayu</span></span><br><span class="line">uid=2302(dayu) gid=2003(group1) groups=2003(group1),1000(oldboy),2204(group3)</span><br><span class="line">[root@localhost ~]<span class="comment"># chown .group3 /tmp/12.txt </span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l /tmp/12.txt</span></span><br><span class="line">-rw-r--r-- 1 root group3 4 Mar 15 11:35 /tmp/12.txt</span><br><span class="line">[root@localhost ~]<span class="comment"># chmod g+w /tmp/12.txt</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l /tmp/12.txt</span></span><br><span class="line">-rw-rw-r-- 1 root group3 4 Mar 15 11:35 /tmp/12.txt</span><br><span class="line">[root@localhost ~]<span class="comment"># su - dayu</span></span><br><span class="line">Last login: Mon Mar 15 11:37:05 CST 2021 on pts/3</span><br><span class="line">[dayu@localhost ~]$ <span class="built_in">echo</span> <span class="string">&quot;456&quot;</span> &gt; /tmp/12.txt </span><br><span class="line">[dayu@localhost ~]$ cat /tmp/12.txt</span><br><span class="line">456</span><br><span class="line">[dayu@localhost ~]$ </span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--sudo和su</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/sudo%20and%20su/</url>
    <content><![CDATA[<h1 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h1><blockquote>
<p>用于普通用提升权限的。</p>
</blockquote>
<ul>
<li><p>相关的文件：<code>/etc/sudoers</code></p>
</li>
<li><p>检查<code>/etc/sudoers</code>是否修改正确：visudo -c</p>
</li>
<li><p>sudoers文件格式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tom       ALL=           (ALL)          ALL</span><br><span class="line">用户名称   所有机器可登陆    所有IP或主机名   所有的指令</span><br></pre></td></tr></table></figure>
</li>
<li><p>指令编写格式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 必须写全路径：which查看命令全路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 只支持vim命令提权</span></span><br><span class="line">xianchen ALL=(ALL)  /usr/bin/vim</span><br><span class="line"></span><br><span class="line"><span class="comment">## 支持所有的命令提权</span></span><br><span class="line">tom ALL=(ALL)  ALL</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不支持某个命令提权</span></span><br><span class="line">tom ALL=(ALL) ALL, !/usr/bin/vim</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不支持某个命令的部分功能</span></span><br><span class="line">xiaochen ALL=(ALL)   ALL, !/usr/bin/vim /root/123.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="su"><a href="#su" class="headerlink" title="su"></a>su</h1><ul>
<li><p>su - xxx  和 su xxx之间区别</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、su - xxx ：相当于切换一个窗口，su xxx 仅仅切换了用户</span><br><span class="line"></span><br><span class="line">2、su - xxx ： 切换用户执行的系统文件要多于 su xxx</span><br><span class="line"></span><br><span class="line">3、su - xxx 是登录</span><br><span class="line">   su  xxx  切换用户</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--文件ACL</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day11-sudo%E4%B8%8Esu/facl/</url>
    <content><![CDATA[<h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><blockquote>
<p>补充：</p>
<p>​	权限的归属</p>
<p>​		a : 属组、属主以及其他人的权限一起设置。</p>
<p>​		o : 其他人</p>
<p>​		g : 属组</p>
<p>​		u : 属主</p>
</blockquote>
<h2 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h2><blockquote>
<p>就是解决目录及文件的默认权限。</p>
</blockquote>
<ul>
<li>文件的最高权限是多少     777</li>
<li>文件夹的最高权限是多少  777</li>
</ul>
<h2 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h2><blockquote>
<p>ACL是为了解决某种特殊环境下的，用户权限需求。</p>
</blockquote>
<ul>
<li>setfacl ： 设置acl权限</li>
<li>getfacl ：查看ACL权限</li>
</ul>
<h3 id="acl权限归属"><a href="#acl权限归属" class="headerlink" title="acl权限归属"></a>acl权限归属</h3><ul>
<li>u : 指定用户</li>
<li>g : 指定组</li>
<li>o : 修改其他用户权限</li>
<li>m : 指定mask权限</li>
</ul>
<p>注：默认情况下，ACL权限跟普通权限保持一致。</p>
<h2 id="ACL-的流程"><a href="#ACL-的流程" class="headerlink" title="ACL 的流程"></a>ACL 的流程</h2><ul>
<li><p>1、创建文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod o+x /root</span><br><span class="line">chmod o+x /root/xiaochen</span><br><span class="line"><span class="built_in">cd</span> xiaochen</span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># touch abc.txt</span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># chmod 000 abc.txt </span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">---------- 1 root root 0 Mar 16 11:39 abc.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost xiaochen]<span class="comment"># echo 111 &gt; abc.txt </span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># cat abc.txt </span></span><br><span class="line">111</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置ACL权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost xiaochen]<span class="comment"># useradd xiaozhang</span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># setfacl -m u:xiaozhang:r abc.txt </span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">user:xiaozhang:r--</span><br><span class="line">group::---</span><br><span class="line">mask::r--</span><br><span class="line">other::---</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：</span></span><br><span class="line">setfacl -m u:用户名称:权限(rwx) 文件名称</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># su - xiaozhang</span></span><br><span class="line">[xiaozhang@localhost ~]$ cat /root/xiaochen/abc.txt</span><br><span class="line">111</span><br></pre></td></tr></table></figure></li>
</ul>
<p>mask :  rw-</p>
<p>xxxx :   -w-</p>
<p>-w-</p>
<h2 id="ACL权限的删除"><a href="#ACL权限的删除" class="headerlink" title="ACL权限的删除"></a>ACL权限的删除</h2><ul>
<li><p>删除某个权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">user:xiaozhang:r--</span><br><span class="line">group::---</span><br><span class="line">group:xiaochen:r-x		<span class="comment">#effective:r--</span></span><br><span class="line">mask::rw-</span><br><span class="line">other::r--</span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># setfacl -x u:xiaozhang abc.txt</span></span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">group::---</span><br><span class="line">group:xiaochen:r-x</span><br><span class="line">mask::r-x</span><br><span class="line">other::r--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">group::---</span><br><span class="line">group:xiaochen:r-x</span><br><span class="line">mask::r-x</span><br><span class="line">other::r--</span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># setfacl -x g:xiaochen abc.txt </span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">group::---</span><br><span class="line">mask::---</span><br><span class="line">other::r--</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>清空acl权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">user:xiaochen:rw-</span><br><span class="line">user:xiaocao:rw-</span><br><span class="line">group::---</span><br><span class="line">group:xiaochen:rw-</span><br><span class="line">group:xiaocao:rw-</span><br><span class="line">mask::rw-</span><br><span class="line">other::r--</span><br><span class="line"></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># setfacl -b abc.txt </span></span><br><span class="line">[root@localhost xiaochen]<span class="comment"># getfacl abc.txt </span></span><br><span class="line"><span class="comment"># file: abc.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::---</span><br><span class="line">group::---</span><br><span class="line">other::r--</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ACL继承"><a href="#ACL继承" class="headerlink" title="ACL继承"></a>ACL继承</h2><blockquote>
<p>默认情况下，ACL是不会继承上层目录的权限的。只有目录设置可继承子集文件才可以继承ACL权限。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost linux12]<span class="comment"># setfacl -m d:u:xiaochen:w ../linux12</span></span><br><span class="line">[root@localhost linux12]<span class="comment"># touch bcd.txt</span></span><br><span class="line">[root@localhost linux12]<span class="comment"># ls -l</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--  1 root root 0 Mar 16 15:40 abc.txt</span><br><span class="line">-rw-rw-r--+ 1 root root 0 Mar 16 15:43 bcd.txt</span><br><span class="line">[root@localhost linux12]<span class="comment"># getfacl bcd.txt </span></span><br><span class="line"><span class="comment"># file: bcd.txt</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::rw-</span><br><span class="line">user:xiaochen:-w-</span><br><span class="line">group::r-x			<span class="comment">#effective:r--</span></span><br><span class="line">mask::rw-</span><br><span class="line">other::r--</span><br><span class="line"></span><br><span class="line">[root@localhost linux12]<span class="comment"># </span></span><br></pre></td></tr></table></figure>













]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--yum仓库</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day13-yum%E4%BB%93%E5%BA%93/yum%E4%BB%93%E5%BA%93/</url>
    <content><![CDATA[<h1 id="yum仓库"><a href="#yum仓库" class="headerlink" title="yum仓库"></a>yum仓库</h1><p>1、克隆两台主机</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum仓库主机</span><br><span class="line">	外网地址：192.168.15.30</span><br><span class="line">	内网地址：172.16.1.30</span><br><span class="line"></span><br><span class="line">yum测试主机</span><br><span class="line">	外网地址：192.168.15.31</span><br><span class="line">	内网地址：172.16.1.31</span><br><span class="line"></span><br><span class="line">修改的命令：</span><br><span class="line">	vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">	vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">	</span><br><span class="line">	重启网卡：systemctl restart network</span><br><span class="line">	</span><br><span class="line">	修改主机名：</span><br><span class="line">		yum仓库主机：hostnamectl set-hostname warehouse</span><br><span class="line">		yum测试主机：hostnamectl set-hostname yum-test</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>2、配置yum仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、需要有一个软件包目录，存放软件包的</span><br><span class="line">[root@warehouse ~]<span class="comment"># mkdir /backup</span></span><br><span class="line">	</span><br><span class="line">	1.1、缓存yum安装下载的软件包</span><br><span class="line">	[root@warehouse 7]<span class="comment"># vim /etc/yum.conf</span></span><br><span class="line">	[main]</span><br><span class="line">    cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">    keepcache=1</span><br><span class="line">    [root@warehouse ~]<span class="comment"># yum install mariadb -y</span></span><br><span class="line">	</span><br><span class="line">	1.2、将缓存的软件包复制到yum仓库目录</span><br><span class="line">	[root@warehouse ~]<span class="comment"># cd /var/cache/yum/x86_64/7/base/packages/</span></span><br><span class="line">	[root@warehouse packages]<span class="comment"># cp -rp ./* /backup/</span></span><br><span class="line">    [root@warehouse packages]<span class="comment"># cd /backup/</span></span><br><span class="line">    [root@warehouse backup]<span class="comment"># ll</span></span><br><span class="line">    total 8964</span><br><span class="line">    -rw-r--r-- 1 root root 9175948 Oct 15 02:55 mariadb-5.5.68-1.el7.x86_64.rpm</span><br><span class="line">	</span><br><span class="line">2、建立软件包依赖关系</span><br><span class="line">	[root@warehouse backup]<span class="comment"># yum install createrepo -y</span></span><br><span class="line">	[root@warehouse backup]<span class="comment"># createrepo /backup/</span></span><br><span class="line">    Spawning worker 0 with 1 pkgs</span><br><span class="line">    Spawning worker 1 with 0 pkgs</span><br><span class="line">    Workers Finished</span><br><span class="line">    Saving Primary metadata</span><br><span class="line">    Saving file lists metadata</span><br><span class="line">    Saving other metadata</span><br><span class="line">    Generating sqlite DBs</span><br><span class="line">    Sqlite DBs complete</span><br><span class="line">    [root@warehouse backup]<span class="comment"># ll</span></span><br><span class="line">    total 8968</span><br><span class="line">    -rw-r--r-- 1 root root 9175948 Oct 15 02:55 mariadb-5.5.68-1.el7.x86_64.rpm</span><br><span class="line">    drwxr-xr-x 2 root root    4096 Mar 18 08:54 repodata</span><br><span class="line">    [root@warehouse backup]<span class="comment"># ll repodata/</span></span><br><span class="line">    total 28</span><br><span class="line">    -rw-r--r-- 1 root root 1970 Mar 18 08:54 5d54624b2aa7a1fe974ff5553a9a78289683189c6a7b60c8c1421ecf011d270f-other.sqlite.bz2</span><br><span class="line">    -rw-r--r-- 1 root root 3449 Mar 18 08:54 5e68ee34f7e8f1a11a039f55c990bcc044f16bceb6af7f4486b55d518ad91346-primary.sqlite.bz2</span><br><span class="line">    -rw-r--r-- 1 root root  539 Mar 18 08:54 6e94b0fa1d98955542fb8238348ea171be7a130ba97573eb3ac756e1aadcec50-filelists.xml.gz</span><br><span class="line">    -rw-r--r-- 1 root root 1291 Mar 18 08:54 a9afb0b2457f41f5c2d64744a07d5d12599e6c2588c870ae73568cf345a0abca-other.xml.gz</span><br><span class="line">    -rw-r--r-- 1 root root 1333 Mar 18 08:54 cf41627875b17ef4bea5f0ea566ac63a5c83adc606d3ca730a74944ceb969028-primary.xml.gz</span><br><span class="line">    -rw-r--r-- 1 root root 1158 Mar 18 08:54 f34cbfd9e5608e8402041e98100f853e913f3df04d6946874c73ba31a78969ba-filelists.sqlite.bz2</span><br><span class="line">    -rw-r--r-- 1 root root 2969 Mar 18 08:54 repomd.xml</span><br><span class="line">    [root@warehouse backup]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>3、测试连接（本地版本）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、备份系统所有的yum源</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># mkdir backup1</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># mv *.repo backup1</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># vim local.repo</span></span><br><span class="line">[<span class="built_in">local</span>]</span><br><span class="line">name=<span class="string">&quot;This is xxx&quot;</span></span><br><span class="line">baseurl=file:///backup</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理yum缓存</span></span><br><span class="line">[root@warehouse ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@warehouse ~]<span class="comment"># rm -rf /var/cache/yum/x86_64/7/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成新的yum缓存</span></span><br><span class="line">[root@warehouse ~]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试连接</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># rpm -e mariadb</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># rpm -ql mariadb</span></span><br><span class="line">package mariadb is not installed</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># yum install mariadb</span></span><br></pre></td></tr></table></figure>



<p>4、测试连接（远程版本）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#########################  yum仓库机器上执行  ###################################</span></span><br><span class="line">1、备份系统所有的yum源</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># mkdir local</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># mv *.repo local</span></span><br><span class="line"></span><br><span class="line">2、安装远程访问软件</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># mv backup1/*  .</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># yum install vsftpd -y</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># systemctl enable --now vsftpd </span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br><span class="line">3、配置系统yum仓库</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># cd /var/ftp</span></span><br><span class="line">[root@warehouse ftp]<span class="comment"># mkdir yum_warehouse</span></span><br><span class="line"></span><br><span class="line">4、将软件包复制到yum仓库目录</span><br><span class="line">[root@warehouse ftp]<span class="comment"># cp -rp /backup/* /var/ftp/yum_warehouse/</span></span><br><span class="line">[root@warehouse ftp]<span class="comment"># ll yum_warehouse/</span></span><br><span class="line">total 8968</span><br><span class="line">-rw-r--r-- 1 root root 9175948 Oct 15 02:55 mariadb-5.5.68-1.el7.x86_64.rpm</span><br><span class="line">drwxr-xr-x 2 root root    4096 Mar 18 08:54 repodata</span><br><span class="line"></span><br><span class="line">5、建立yum软件包依赖关系</span><br><span class="line">[root@warehouse ftp]<span class="comment"># createrepo /var/ftp/yum_warehouse/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################  yum测试机器上执行  ###################################</span></span><br><span class="line">1、本机测试网络连接</span><br><span class="line">    1、备份系统所有的yum源</span><br><span class="line">    [root@warehouse ftp]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># mv *.repo backup1</span></span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># vim local.repo</span></span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># cat local.repo </span></span><br><span class="line">    [local-ftp]</span><br><span class="line">    name=<span class="string">&quot;This is ftp server&quot;</span></span><br><span class="line">    baseurl=ftp://172.16.1.30/yum_warehouse</span><br><span class="line">    gpgcheck=0</span><br><span class="line">    enabled=1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清理yum缓存</span></span><br><span class="line">    [root@warehouse ~]<span class="comment"># yum clean all</span></span><br><span class="line">    [root@warehouse ~]<span class="comment"># rm -rf /var/cache/yum/x86_64/7/*</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成新的yum缓存</span></span><br><span class="line">    [root@warehouse ~]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试连接</span></span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># rpm -e mariadb</span></span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># rpm -ql mariadb</span></span><br><span class="line">    package mariadb is not installed</span><br><span class="line">    [root@warehouse yum.repos.d]<span class="comment"># yum install mariadb</span></span><br><span class="line"></span><br><span class="line">2、yum测试机器执行</span><br><span class="line">	1、备份yum仓库内容</span><br><span class="line">	[root@yum-test ~]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># mkdir backup1</span></span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># mv *.repo backup1</span></span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># ll</span></span><br><span class="line">    total 0</span><br><span class="line">    drwxr-xr-x. 2 root root 187 Mar  4 09:55 backup</span><br><span class="line">    drwxr-xr-x  2 root root 220 Mar 18 09:20 backup1</span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># </span></span><br><span class="line">    </span><br><span class="line">    2、编写本地yum源配置文件</span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># vim local.repo</span></span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># cat local.repo </span></span><br><span class="line">    [loacl-ftp-30]</span><br><span class="line">    name=<span class="string">&quot;This is 30 ftp server&quot;</span></span><br><span class="line">    baseurl=ftp://172.16.1.30/yum_warehouse</span><br><span class="line">    gpgcheck=0</span><br><span class="line">    enabled=1</span><br><span class="line">    </span><br><span class="line">    3、清理yum缓存</span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># yum clean all</span></span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># rm -rf /var/cache/yum/x86_64/7/*</span></span><br><span class="line">    </span><br><span class="line">    4、生成yum缓存</span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># yum makecache</span></span><br><span class="line">    </span><br><span class="line">    5、测试安装</span><br><span class="line">    [root@yum-test yum.repos.d]<span class="comment"># yum install mariadb</span></span><br></pre></td></tr></table></figure>



<p>4、同步远程yum仓库内容到本机</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、安装华为云镜像仓库</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># rm -rf /etc/yum.repos.d/*</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-7-reg.repo</span></span><br><span class="line"></span><br><span class="line">2、生成yum缓存</span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># yum clean all</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># rm -rf /var/cache/yum/x86_64/7/*</span></span><br><span class="line">[root@warehouse yum.repos.d]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">3、同步华为云镜像站软件包到本地yum仓库</span><br><span class="line">[root@warehouse ftp]<span class="comment"># yum install yum-utils -y</span></span><br><span class="line">[root@warehouse ftp]<span class="comment"># reposync -r (仓库名称：yum repolist)</span></span><br><span class="line"></span><br><span class="line">4、建立依赖关系</span><br><span class="line">[root@warehouse ftp]<span class="comment"># createrepo base</span></span><br><span class="line"></span><br><span class="line">5、测试</span><br><span class="line">    [loacl-ftp-30]</span><br><span class="line">    name=<span class="string">&quot;This is 30 ftp server&quot;</span></span><br><span class="line">    baseurl=ftp://172.16.1.30/base</span><br><span class="line">    gpgcheck=0</span><br><span class="line">    enabled=1</span><br></pre></td></tr></table></figure>

<p><img src="/.%5Cassets%5Cimage-20210318112338781.png" alt="image-20210318112338781"></p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--软件包管理</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day12-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/%E8%BD%AF%E4%BB%B6%E5%8C%85/</url>
    <content><![CDATA[<h1 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h1><ul>
<li><p>rpm包来源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、来源网络下载</span><br><span class="line">2、来源本地：自己的镜像自带的rpm包</span><br></pre></td></tr></table></figure>




</li>
<li><p>rpm命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line"></span><br><span class="line">rpm -ivh xxx.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://nginx.org/packages/centos/7/x86_64/RPMS/</span></span><br><span class="line"></span><br><span class="line">-v : 显示安装过程</span><br><span class="line">-i ：显示安装包的详细信息</span><br><span class="line">-h : 安装包哈希标记</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载Nginx rpm安装包的全名</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm</span></span><br><span class="line">--2021-03-17 12:16:47--  http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.18.0-1.el7.ngx.x86_64.rpm</span><br><span class="line">Resolving nginx.org (nginx.org)... 52.58.199.22, 3.125.197.172, 2a05:d014:edb:5702::6, ...</span><br><span class="line">Connecting to nginx.org (nginx.org)|52.58.199.22|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 790284 (772K) [application/x-redhat-package-manager]</span><br><span class="line">Saving to: ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’</span><br><span class="line"></span><br><span class="line">100%[====================================================&gt;] 790,284      339KB/s   <span class="keyword">in</span> 2.3s   </span><br><span class="line"></span><br><span class="line">2021-03-17 12:16:51 (339 KB/s) - ‘nginx-1.18.0-1.el7.ngx.x86_64.rpm’ saved [790284/790284]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装rpm安装包</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span></span><br><span class="line">warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY</span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:nginx-1:1.18.0-1.el7.ngx         <span class="comment">################################# [100%]</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Thanks <span class="keyword">for</span> using nginx!</span><br><span class="line"></span><br><span class="line">Please find the official documentation <span class="keyword">for</span> nginx here:</span><br><span class="line">* http://nginx.org/en/docs/</span><br><span class="line"></span><br><span class="line">Please subscribe to nginx-announce mailing list to get</span><br><span class="line">the most important news about nginx:</span><br><span class="line">* http://nginx.org/en/support.html</span><br><span class="line"></span><br><span class="line">Commercial subscriptions <span class="keyword">for</span> nginx are available on:</span><br><span class="line">* http://nginx.com/products/</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证nginx是否安装成功</span></span><br><span class="line">[root@localhost ~]<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.18.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -e nginx (软件包名称)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># nginx -v</span></span><br><span class="line">-bash: /usr/sbin/nginx: No such file or directory</span><br><span class="line">[root@localhost ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统当中安装了哪些rpm软件包</span></span><br><span class="line">rpm -qa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统当中是否安装了某个rpm软件包</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -q nginx（软件包名）</span></span><br><span class="line">nginx-1.18.0-1.el7.ngx.x86_64</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -q safsdgsfdgfd</span></span><br><span class="line">package safsdgsfdgfd is not installed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示已经安装过的rpm包详细信息。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qi nginx</span></span><br><span class="line">Name        : nginx</span><br><span class="line">Epoch       : 1</span><br><span class="line">Version     : 1.18.0</span><br><span class="line">Release     : 1.el7.ngx</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Wed 17 Mar 2021 04:18:55 PM CST</span><br><span class="line">Group       : System Environment/Daemons</span><br><span class="line">Size        : 2830028</span><br><span class="line">License     : 2-clause BSD-like license</span><br><span class="line">Signature   : RSA/SHA1, Tue 21 Apr 2020 11:19:18 PM CST, Key ID abf5bd827bd9bf62</span><br><span class="line">Source RPM  : nginx-1.18.0-1.el7.ngx.src.rpm</span><br><span class="line">Build Date  : Tue 21 Apr 2020 11:07:33 PM CST</span><br><span class="line">Build Host  : ip-10-1-17-101.eu-central-1.compute.internal</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Vendor      : Nginx, Inc.</span><br><span class="line">URL         : http://nginx.org/</span><br><span class="line">Summary     : High performance web server</span><br><span class="line">Description :</span><br><span class="line">nginx [engine x] is an HTTP and reverse proxy server, as well as</span><br><span class="line">a mail proxy server.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看安装包的内容</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># rpm -ql nginx</span></span><br><span class="line">/etc/logrotate.d/nginx</span><br><span class="line">/etc/nginx</span><br><span class="line">/etc/nginx/conf.d</span><br><span class="line">/etc/nginx/conf.d/default.conf</span><br><span class="line">/etc/nginx/fastcgi_params</span><br><span class="line">/etc/nginx/koi-utf</span><br><span class="line">/etc/nginx/koi-win</span><br><span class="line">/etc/nginx/mime.types</span><br><span class="line">/etc/nginx/modules</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/etc/nginx/scgi_params</span><br><span class="line">/etc/nginx/uwsgi_params</span><br><span class="line">/etc/nginx/win-utf</span><br><span class="line">/etc/sysconfig/nginx</span><br><span class="line">/etc/sysconfig/nginx-debug</span><br><span class="line">/usr/lib/systemd/system/nginx-debug.service</span><br><span class="line">/usr/lib/systemd/system/nginx.service</span><br><span class="line">/usr/lib64/nginx</span><br><span class="line">/usr/lib64/nginx/modules</span><br><span class="line">/usr/libexec/initscripts/legacy-actions/nginx</span><br><span class="line">/usr/libexec/initscripts/legacy-actions/nginx/check-reload</span><br><span class="line">/usr/libexec/initscripts/legacy-actions/nginx/upgrade</span><br><span class="line">/usr/sbin/nginx</span><br><span class="line">/usr/sbin/nginx-debug</span><br><span class="line">/usr/share/doc/nginx-1.18.0</span><br><span class="line">/usr/share/doc/nginx-1.18.0/COPYRIGHT</span><br><span class="line">/usr/share/man/man8/nginx.8.gz</span><br><span class="line">/usr/share/nginx</span><br><span class="line">/usr/share/nginx/html</span><br><span class="line">/usr/share/nginx/html/50x.html</span><br><span class="line">/usr/share/nginx/html/index.html</span><br><span class="line">/var/cache/nginx</span><br><span class="line">/var/<span class="built_in">log</span>/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看配置信息</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># rpm -qc nginx</span></span><br><span class="line">/etc/logrotate.d/nginx</span><br><span class="line">/etc/nginx/conf.d/default.conf</span><br><span class="line">/etc/nginx/fastcgi_params</span><br><span class="line">/etc/nginx/koi-utf</span><br><span class="line">/etc/nginx/koi-win</span><br><span class="line">/etc/nginx/mime.types</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/etc/nginx/scgi_params</span><br><span class="line">/etc/nginx/uwsgi_params</span><br><span class="line">/etc/nginx/win-utf</span><br><span class="line">/etc/sysconfig/nginx</span><br><span class="line">/etc/sysconfig/nginx-debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看文件帮助信息</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># rpm -qd zlib</span></span><br><span class="line">/usr/share/doc/zlib-1.2.7/ChangeLog</span><br><span class="line">/usr/share/doc/zlib-1.2.7/FAQ</span><br><span class="line">/usr/share/doc/zlib-1.2.7/README</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qf /usr/sbin/nginx</span></span><br><span class="line">nginx-1.18.0-1.el7.ngx.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 -p 可以查看未安装软件包的详细信息</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qip nginx-1.18.0-1.el7.ngx.x86_64.rpm </span></span><br><span class="line">warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY</span><br><span class="line">Name        : nginx</span><br><span class="line">Epoch       : 1</span><br><span class="line">Version     : 1.18.0</span><br><span class="line">Release     : 1.el7.ngx</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: (not installed)</span><br><span class="line">Group       : System Environment/Daemons</span><br><span class="line">Size        : 2830028</span><br><span class="line">License     : 2-clause BSD-like license</span><br><span class="line">Signature   : RSA/SHA1, Tue 21 Apr 2020 11:19:18 PM CST, Key ID abf5bd827bd9bf62</span><br><span class="line">Source RPM  : nginx-1.18.0-1.el7.ngx.src.rpm</span><br><span class="line">Build Date  : Tue 21 Apr 2020 11:07:33 PM CST</span><br><span class="line">Build Host  : ip-10-1-17-101.eu-central-1.compute.internal</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Vendor      : Nginx, Inc.</span><br><span class="line">URL         : http://nginx.org/</span><br><span class="line">Summary     : High performance web server</span><br><span class="line">Description :</span><br><span class="line">nginx [engine x] is an HTTP and reverse proxy server, as well as</span><br><span class="line">a mail proxy server.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级软件包</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -Uvh nginx-1.18.0-1.el7.ngx.x86_64.rpm </span></span><br><span class="line">warning: nginx-1.18.0-1.el7.ngx.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY</span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:nginx-1:1.18.0-1.el7.ngx         <span class="comment">################################# [ 50%]</span></span><br><span class="line">Cleaning up / removing...</span><br><span class="line">   2:nginx-1:1.14.0-1.el7_4.ngx       <span class="comment">################################# [100%]</span></span><br><span class="line">[root@localhost ~]<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.18.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除软件包--nodeps</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -e zlib --nodeps</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><blockquote>
<p>yum是CentOS的软件包管理工具，自动为我们解决软件依赖问题。yum包管理工具必须使用yum源指定软件下载地址去下载需要安装的软件包。配置的路径是：&#x2F;etc&#x2F;yum.repos.d</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 清空本机所有的yum源</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># rm -rf /etc/yum.repos.d/*</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>yum源命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前系统的yum源列表</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum repolist </span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">repo id                   repo name                                           status</span><br><span class="line">base                      <span class="string">&quot;This is local repo, and 非常屌&quot;</span>                    10,072</span><br><span class="line">repolist: 10,072</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum清空缓存</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum clean all</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Cleaning repos: base</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">Other repos take up 76 M of disk space (use --verbose <span class="keyword">for</span> details)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立yum缓存</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum makecache</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>yum源的执行原理</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、需要在/etc/yum.repos.d目录下配置yum源地址</span><br><span class="line">2、清空缓存建立新的缓存</span><br><span class="line">3、安装软件（自动解决依赖关系）</span><br></pre></td></tr></table></figure>
</li>
<li><p>yum常用的基础命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装软件包的命令</span></span><br><span class="line">yum install 软件包名称</span><br><span class="line">	-y : 免交互安装</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载软件（直接将软件的依赖包一起删除）</span></span><br><span class="line">yum remove 软件包名称</span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum remove httpd</span></span><br><span class="line">	-y : 免交互移除</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前系统需要更新软件</span></span><br><span class="line">yum check-update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新所有的需要更新的软件</span></span><br><span class="line">yum update </span><br><span class="line">	-y ： 免交互</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新某一个软件</span></span><br><span class="line">yum update (软件包名称)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重装软件</span></span><br><span class="line">yum reinstall (软件包名称)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索软件包</span></span><br><span class="line">[root@www httpd]<span class="comment"># yum search （软件包名称）</span></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看yum执行历史</span></span><br><span class="line">yum <span class="built_in">history</span></span><br><span class="line">[root@www httpd]<span class="comment"># yum history info (历史ID号)</span></span><br><span class="line">[root@www httpd]<span class="comment"># yum history undo (历史ID号)</span></span><br><span class="line"><span class="comment"># 查看当前系统当中可更新的软件包</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum check-update </span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"></span><br><span class="line">postfix.x86_64                                        2:2.10.1-9.0.1.el7.centos.plus                                      centosplus</span><br><span class="line">python-perf.x86_64                                    3.10.0-1160.15.2.el7.centos.plus                                    centosplus</span><br><span class="line">[root@www yum.repos.d]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统中有哪些仓库地址</span></span><br><span class="line">yum repolist    <span class="comment"># 正在启用的yum仓库</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">repo id                   repo name                                           status</span><br><span class="line">base/7/x86_64             CentOS-7 - Base - repo.huaweicloud.com              10,072</span><br><span class="line">extras/7/x86_64           CentOS-7 - Extras - repo.huaweicloud.com               453</span><br><span class="line">updates/7/x86_64          CentOS-7 - Updates - repo.huaweicloud.com            1,729</span><br><span class="line"></span><br><span class="line">yum repolist all <span class="comment"># 查看系统中所有的yum仓库</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum repolist all</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">repo id                                        repo name                                                             status</span><br><span class="line">base/7/x86_64                                  CentOS-7 - Base - repo.huaweicloud.com                                enabled: 10,072</span><br><span class="line">centosplus/7/x86_64                            CentOS-7 - Plus - repo.huaweicloud.com                                disabled</span><br><span class="line">extras/7/x86_64                                CentOS-7 - Extras - repo.huaweicloud.com                              enabled:    453</span><br><span class="line">updates/7/x86_64                               CentOS-7 - Updates - repo.huaweicloud.com                             enabled:  1,72</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用repo仓库</span></span><br><span class="line">yum install yum-utils -y</span><br><span class="line"></span><br><span class="line">启用一个yum仓库：yum-config-manager --<span class="built_in">enable</span> (仓库名称)</span><br><span class="line">关闭一个yum仓库：yum-config-manager --<span class="built_in">disable</span> (仓库名称)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一个仓库中的软件包列表</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看软件包组</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum grouplist</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装软件包组</span></span><br><span class="line">[root@www yum.repos.d]<span class="comment"># yum groupinstall &quot;Development Tools&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>本地yum源配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、备份/etc/yum.repos.d/下的所文件</span><br><span class="line">	rm -rf /etc/yum.repos.d/*</span><br><span class="line"></span><br><span class="line">2、编写本地yum源</span><br><span class="line">[root@www yum.repos.d]<span class="comment"># cat test.repo </span></span><br><span class="line">[base] <span class="comment"># yum源名称</span></span><br><span class="line">name=<span class="string">&quot;This is repo infomation&quot;</span> <span class="comment">#yum源的简介</span></span><br><span class="line">baseurl=file:///opt    <span class="comment"># 指定yum源地址</span></span><br><span class="line">enabled=1				<span class="comment"># 是否启用yum源</span></span><br><span class="line">gpgcheck=0				<span class="comment"># 是否检查gpg秘钥</span></span><br><span class="line"></span><br><span class="line">3、更新缓存</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">4、安装软件</span><br><span class="line">yum install dos2unix</span><br></pre></td></tr></table></figure>
</li>
<li><p>共享yum源配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、安装ftp</span><br><span class="line">yum install vsftpd -y</span><br><span class="line"></span><br><span class="line">2、启动vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now vsftpd <span class="comment"># 设置开机自启动并且立即启动</span></span><br><span class="line"></span><br><span class="line">3、创建yum源共享文件夹</span><br><span class="line">[root@www ftp]<span class="comment"># mkdir /var/ftp/centos</span></span><br><span class="line"></span><br><span class="line">4、将映像中的软件复制到/var/ftp/centos</span><br><span class="line">cp -rp /opt/* /var/ftp/centos</span><br><span class="line"></span><br><span class="line">5、编辑本地yum源，接入ftp</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># cat local.repo </span></span><br><span class="line">[base]</span><br><span class="line">baseurl=ftp://192.168.15.100/centos</span><br><span class="line">name=<span class="string">&quot;This is ftp repo&quot;</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">6、测试安装</span><br><span class="line">yum install dos2unix -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>yum的配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yum仓库的机器上执行</span></span><br><span class="line">1、修改/etc/yum.conf</span><br><span class="line">    cachedir=/var/ftp/centos/Packages   <span class="comment"># 指定yum缓存目录</span></span><br><span class="line">    keepcache=1							<span class="comment"># 下载的缓存软件不立即删除， 0为立即删除</span></span><br><span class="line"></span><br><span class="line">2、安装ftp</span><br><span class="line">yum install vsftpd -y</span><br><span class="line"></span><br><span class="line">3、启动vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now vsftpd <span class="comment"># 设置开机自启动并且立即启动</span></span><br><span class="line"></span><br><span class="line">4、创建yum源共享文件夹</span><br><span class="line">[root@www ftp]<span class="comment"># mkdir /var/ftp/centos</span></span><br><span class="line"></span><br><span class="line">5、更新yum仓库</span><br><span class="line">[root@www ftp]<span class="comment"># yum clean all</span></span><br><span class="line">[root@www ftp]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">6、建立一个快捷方式</span><br><span class="line"><span class="built_in">cd</span> /var/ftp/centos/Packages/base</span><br><span class="line">ln -s packages Packages</span><br><span class="line"></span><br><span class="line">7、安装mariadb</span><br><span class="line">yum install mariadb -y</span><br><span class="line"></span><br><span class="line">8、建立/var/ftp/centos/Packages/base/repodata</span><br><span class="line">mkdir /var/ftp/centos/Packages/base/repodata</span><br><span class="line"></span><br><span class="line">9、把/var/ftp/centos/Packages/base下面的自动生成的压缩文件复制到/var/ftp/centos/Packages/base/repodata用做认证。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用yum仓库的机器上执行</span></span><br><span class="line">1、建立yum配置文件</span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/yum.repos.d/local.repo </span></span><br><span class="line">[base]</span><br><span class="line">baseurl=ftp://192.168.15.100/centos/Packages/base</span><br><span class="line">name=<span class="string">&quot;This is ftp repo&quot;</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">2、更新yum仓库</span><br><span class="line">[root@www ftp]<span class="comment"># yum clean all</span></span><br><span class="line">[root@www ftp]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">3、测试安装mariadb</span><br><span class="line">yum install mariadb -y</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--进程管理</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day16-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><p>程序：安装包</p>
<p>进程：正在运行的实例</p>
<p>CPU：计算</p>
<p>内存：存储CPU计算使用的临时数据</p>
<p>存储：</p>
<p>进程和线程</p>
<p>僵尸进程和孤儿进程</p>
<p>僵尸进程：进程生命周期结束了，但是PID未被回收</p>
<p>孤儿进程：父进程生命周期结束了，但是子进程未结束，子进程被系统进程接收</p>
<p>1、查看进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：ps, 默认查看当前进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数</span></span><br><span class="line">-a : 查询所有进程</span><br><span class="line">-x : 查看后台所有的进程</span><br><span class="line">-u : 查看进程的用户</span><br><span class="line"></span><br><span class="line">USER ： 开启当前进程的用户</span><br><span class="line">PID  ： 当前进程的ID号</span><br><span class="line">%CPU ： CPU的使用率</span><br><span class="line">%MEM ： 内存使用率</span><br><span class="line">VSZ  ： 进程启动时默认向计算机申请的内存</span><br><span class="line">RSS  ： 进程运行时实际使用的内存</span><br><span class="line">TTY  ： 进程运行的终端</span><br><span class="line">	？： 后台运行（没有终端）</span><br><span class="line">	tty：使用系统终端</span><br><span class="line">	pts：使用虚拟终端</span><br><span class="line">STAT ：进程运行状态</span><br><span class="line">	R ： 正在运行中的进程</span><br><span class="line">	+ ： 在前台运行</span><br><span class="line">	S ： 睡眠中状态</span><br><span class="line">	D ： 不可中断睡眠</span><br><span class="line">	T ： 停止状态</span><br><span class="line">	Z :  僵尸状态</span><br><span class="line">	X ： 死掉的进程</span><br><span class="line">	&lt; : 优先级较高的进程</span><br><span class="line">	N ：优先级较低的进程</span><br><span class="line">	s : 包含子进程       yum install psmisc -y </span><br><span class="line">	l : 已线程的方式运行</span><br><span class="line">	| ： 代表管道</span><br><span class="line">START ： 进程的启动时间</span><br><span class="line">TIME  ： 占用CPU的时间</span><br><span class="line">COMMAND ： 进程执行的命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-e : 显示所有的进程</span><br><span class="line">-f : 格式化输出同时显示PPID</span><br><span class="line"></span><br><span class="line">PPID ： 父进程ID</span><br></pre></td></tr></table></figure>

<p>2、top</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据一定频率的去监控系统</span></span><br><span class="line"></span><br><span class="line">up前是系统时间</span><br><span class="line">up后是开启的时间</span><br><span class="line"></span><br><span class="line">load average: 0.01, 0.42, 0.73</span><br><span class="line">0.01  ： 一分钟平均负载</span><br><span class="line">0.42  ： 五分钟平均负载</span><br><span class="line">0.73  ： 十五分钟平均负载</span><br><span class="line"></span><br><span class="line">平均负载：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU加压工具</span></span><br><span class="line">stress --cpu [需要加压的系统核心数] --timeout [加压的时间]</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU 性能加压工具</span></span><br><span class="line"><span class="comment">## 添加epel源（epel源主要用来安装红帽系列操作系统附加软件）</span></span><br><span class="line">yum install stress -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU 性能分析工具</span></span><br><span class="line">yum install sysstat -y</span><br><span class="line"></span><br><span class="line">mpstat -P ALL 3   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程性能分析⼯具</span></span><br><span class="line">pidstat -u 1 5  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tasks</span><br><span class="line">Tasks: 125 total,   1 running, 124 sleeping,   0 stopped,   0 zombie</span><br><span class="line"></span><br><span class="line">total : 当前系统一共运行的是125个进程</span><br><span class="line">running : 正在运行的是1个</span><br><span class="line">sleeping : 124个处于睡眠状态</span><br><span class="line">stopped : 停止运行的进程数</span><br><span class="line">zombie  ：僵尸进程数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line"></span><br><span class="line">us ：在单位时间进程使用CPU所占用的时间百分比</span><br><span class="line">sy : 在单位时间内系统进程占用CPU时间百分比</span><br><span class="line">ni : 在单位时间内优先使用CPU所占时间百分比</span><br><span class="line">id ：在单位时间内CPU空闲所占时间百分比</span><br><span class="line">wa : 在单位时间内CPU阻塞态所占CPU时间的百分比</span><br><span class="line">hi : 硬件中断</span><br><span class="line">si : 软件中断</span><br><span class="line">st : 其他占用CPU时间百分比</span><br><span class="line"></span><br><span class="line">KiB Mem :  2027892 total,  1234180 free,   176352 used,   617360 buff/cache</span><br><span class="line"></span><br><span class="line">total ：系统总内存</span><br><span class="line">free  ：系统空闲内存</span><br><span class="line">used  : 系统使用内存</span><br><span class="line">buff/cache ： 缓存使用内存</span><br><span class="line">avail Mem ：</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  </span><br><span class="line">  </span><br><span class="line">PID ： 进程编号</span><br><span class="line">USER ： 启动进程的用户</span><br><span class="line">PR : 优先级</span><br><span class="line">NI ：nice值</span><br><span class="line">VIRT ： 虚拟内存</span><br><span class="line">RES  ： 使用内存</span><br><span class="line">SHR  ： 共享内存</span><br><span class="line">%CPU ： cpu使用率</span><br><span class="line">%MEM ：内存使用率</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、top快捷键</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">按1 : 展示所有的CPU的详情</span><br><span class="line">按s : 设置top监控频率（默认3秒）</span><br><span class="line">按m : 按照内存排序 </span><br><span class="line">按z : 添加颜色</span><br><span class="line">按p : 按照CPU排序</span><br><span class="line">按l : 展示CPU总负载（默认显示）</span><br></pre></td></tr></table></figure>

<p>4、top的参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-d ： 设置top的刷新频率</span><br><span class="line">-p :  设置查看的进程PID</span><br><span class="line">	top -d 1 -p `pgrep nginx | head -1`</span><br><span class="line"></span><br><span class="line">-u :  查询指定用户的经常的进程</span><br><span class="line">	top -u oldboy</span><br><span class="line"></span><br><span class="line">-n : 表示查询n次</span><br><span class="line">	 top -d 0.1 -u oldboy -n 20</span><br></pre></td></tr></table></figure>







<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/<span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;arch=$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Debug</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/<span class="variable">$basearch</span>/debug</span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;arch=$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Source</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/SRPMS</span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;arch=$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--磁盘分区</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/01_%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="一、磁盘分区方案"><a href="#一、磁盘分区方案" class="headerlink" title="一、磁盘分区方案"></a>一、磁盘分区方案</h2><h3 id="1-1-MBR与GPT介绍"><a href="#1-1-MBR与GPT介绍" class="headerlink" title="1.1 MBR与GPT介绍"></a>1.1 MBR与GPT介绍</h3><p>Linux中磁盘分区有两种方案</p>
<ul>
<li><strong>MBR</strong>（主引导记录）</li>
<li><strong>GPT</strong>（GUID分区表）</li>
</ul>
<p>**<font color='blue'>MBR分区方案</font>**的特点（支持的磁盘容量&lt;&#x3D;2T）：</p>
<ol>
<li>最多支持四个主分区 </li>
<li>在Linux上使用扩展分区和逻辑分区最多可以创建15个分区， </li>
<li>由于分区中的数据以32位存储，使用MBR分区是最大支持2T空间。 </li>
<li>用fdisk管理工具来创建MBR分区</li>
</ol>
<p>**<font color='red'>GPT分区方案</font>**的特点（支持的磁盘容量&gt;2T）：</p>
<ol>
<li>是UEFI标准的一部分，主板必须要支持UEFI标准 </li>
<li>GPT分区列表支持最大128PB(1PB&#x3D;1024TB) </li>
<li>可以定义128个分区 </li>
<li>没有主分区，扩展分区和逻辑分区的概念，所有分区都能格式化 </li>
<li>gdisk和parted管理工具可以创建GPT分区</li>
</ol>
<h3 id="1-2-MBR与GTP的区别"><a href="#1-2-MBR与GTP的区别" class="headerlink" title="1.2 MBR与GTP的区别"></a>1.2 MBR与GTP的区别</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>MBR</th>
<th>GPT</th>
</tr>
</thead>
<tbody><tr>
<td>新旧度</td>
<td>旧</td>
<td>新</td>
</tr>
<tr>
<td>支持的硬盘容量大小</td>
<td>最大2TB</td>
<td>支持2T以上</td>
</tr>
<tr>
<td>分区计数</td>
<td>最多支持4个主分区或3个主分区一个扩展分区</td>
<td>最多支持128个分区,部分主分区、扩展分区</td>
</tr>
<tr>
<td>安全功能</td>
<td>不提供任何安全功能</td>
<td>支持CRC32校验和机制</td>
</tr>
</tbody></table>
<h2 id="二、分区工具使用"><a href="#二、分区工具使用" class="headerlink" title="二、分区工具使用"></a>二、分区工具使用</h2><h3 id="2-1-MBR分区工具fdisk"><a href="#2-1-MBR分区工具fdisk" class="headerlink" title="2.1 MBR分区工具fdisk"></a>2.1 MBR分区工具fdisk</h3><h3 id="2-2-GPT分区工具gdisk"><a href="#2-2-GPT分区工具gdisk" class="headerlink" title="2.2 GPT分区工具gdisk"></a>2.2 GPT分区工具gdisk</h3><h3 id="2-3-GPT分区工具parted"><a href="#2-3-GPT分区工具parted" class="headerlink" title="2.3 GPT分区工具parted"></a>2.3 GPT分区工具parted</h3><p>​	parted用于对磁盘（或RAID磁盘）进行分区及管理，与fdisk分区工具相比，支持2TB以上的磁盘分区，并且允许调整分区的大小，<font color='red'>支持命令行方式或交互式方式</font>，常用命令如下：</p>
<table>
<thead>
<tr>
<th>parted交互命令</th>
<th>说 明</th>
</tr>
</thead>
<tbody><tr>
<td>check NUMBER</td>
<td>做一次简单的文件系统检测</td>
</tr>
<tr>
<td>cp [FROM-DEVICE] FROM-NUMBER TO-NUMBER</td>
<td>复制文件系统到另一个分区</td>
</tr>
<tr>
<td>help [COMMAND]</td>
<td>显示所有的命令帮助</td>
</tr>
<tr>
<td>mklabel,mktable LABEL-TYPE</td>
<td>创建新的磁盘卷标（分区表）</td>
</tr>
<tr>
<td>mkfs NUMBER FS-TYPE</td>
<td>在分区上建立文件系统</td>
</tr>
<tr>
<td>mkpart PART-TYPE [FS-TYPE] START END</td>
<td>创建一个分区</td>
</tr>
<tr>
<td>mkpartfs PART-TYPE FS-TYPE START END</td>
<td>创建分区，并建立文件系统</td>
</tr>
<tr>
<td>move NUMBER START END</td>
<td>移动分区</td>
</tr>
<tr>
<td>name NUMBER NAME</td>
<td>给分区命名</td>
</tr>
<tr>
<td>print [devices|free|list,all|NUMBER]</td>
<td>显示分区表、活动设备、空闲空间、所有分区</td>
</tr>
<tr>
<td>quit</td>
<td>退出</td>
</tr>
<tr>
<td>rescue START END</td>
<td>修复丢失的分区</td>
</tr>
<tr>
<td>resize NUMBER START END</td>
<td>修改分区大小</td>
</tr>
<tr>
<td>rm NUMBER</td>
<td>删除分区</td>
</tr>
<tr>
<td>select DEVICE</td>
<td>选择需要编辑的设备</td>
</tr>
<tr>
<td>set NUMBER FLAG STATE</td>
<td>改变分区标记</td>
</tr>
<tr>
<td>toggle [NUMBER [FLAG]]</td>
<td>切换分区表的状态</td>
</tr>
<tr>
<td>unit UNIT</td>
<td>设置默认的单位</td>
</tr>
<tr>
<td>Version</td>
<td>显示版本</td>
</tr>
</tbody></table>
<blockquote>
<p>关于mkpart与PART-TYPE（FS-TYPE）的解释：</p>
<p>Make a part-type partition for filesystem fs-type (if specified), beginning at start and ending at end (by default in megabytes).  fs-type can  be  one  of  “btrfs”,  “ext2”, “ext3”, “ext4”, “fat16”, “fat32”, “hfs”, “hfs+”, “linux-swap”, “ntfs”, “reiserfs”, or “xfs”.  part-type should be one of “primary”, “logical”, or “extended”.</p>
</blockquote>
<h4 id="2-3-1-使用parted"><a href="#2-3-1-使用parted" class="headerlink" title="2.3.1 使用parted"></a>2.3.1 使用parted</h4><h4 id="2-3-1-1-列出所有块设备分区情况"><a href="#2-3-1-1-列出所有块设备分区情况" class="headerlink" title="2.3.1.1 列出所有块设备分区情况"></a>2.3.1.1 列出所有块设备分区情况</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前有哪些块设备</span></span><br><span class="line">[root@lb01 ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   50G  0 disk</span><br><span class="line">├─sda1   8:1    0    1G  0 part /boot</span><br><span class="line">├─sda2   8:2    0    2G  0 part [SWAP]</span><br><span class="line">└─sda3   8:3    0   47G  0 part /</span><br><span class="line">sdb      8:16   0   10G  0 disk</span><br><span class="line">sr0     11:0    1  792M  0 rom</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看分区情况</span></span><br><span class="line">[root@lb01 ~]# parted -l</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sda: 53.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system     Flags</span><br><span class="line"> 1      1049kB  1075MB  1074MB  primary  xfs             boot</span><br><span class="line"> 2      1075MB  3223MB  2149MB  primary  linux-swap(v1)</span><br><span class="line"> 3      3223MB  53.7GB  50.5GB  primary  xfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error: /dev/sdb: unrecognised disk label	# sdb还没有分区</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: unknown</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Warning: Unable to open /dev/sr0 read-write (Read-only file system).  /dev/sr0</span><br><span class="line">has been opened read-only.</span><br><span class="line">Model: NECVMWar VMware IDE CDR10 (scsi)</span><br><span class="line">Disk /dev/sr0: 830MB</span><br><span class="line">Sector size (logical/physical): 2048B/2048B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End     Size    Type     File system  Flags</span><br><span class="line"> 2      885kB  37.7MB  36.8MB  primary</span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-2-创建分区"><a href="#2-3-1-2-创建分区" class="headerlink" title="2.3.1.2 创建分区"></a>2.3.1.2 创建分区</h4><blockquote>
<p>案例：在&#x2F;dev&#x2F;sdb中创建一个1GB的分区</p>
</blockquote>
<p>a、命令行方式，创建一个主分区</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 转换为MBR分区方案msdos, GPT方案为gpt</span></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb mklabel msdos</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建主分区</span></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb mkpart primary ext4 0GB 1GB  # 把1GB换成100%就是分完剩余空间</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   50G  0 disk</span><br><span class="line">├─sda1   8:1    0    1G  0 part /boot</span><br><span class="line">├─sda2   8:2    0    2G  0 part [SWAP]</span><br><span class="line">└─sda3   8:3    0   47G  0 part /</span><br><span class="line">sdb      8:16   0   10G  0 disk</span><br><span class="line">└─sdb1   8:17   0  953M  0 part</span><br><span class="line">sr0     11:0    1  792M  0 rom</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>b、再用交互方式，继续创建一个主分区</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/sda</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) select /dev/sdb # 选择块设备</span><br><span class="line">Using /dev/sdb</span><br><span class="line">(parted) mkpart	# 新建分区</span><br><span class="line">Partition type?  primary/extended? primary</span><br><span class="line">File system type?  [ext2]? ext4</span><br><span class="line">Start? 1GB</span><br><span class="line">End? 2GB</span><br></pre></td></tr></table></figure>

<p>c、扩展分区与逻辑分区的创建</p>
<blockquote>
<p>扩展分区最多只有一个，再创建会提示选择primary&#x2F;logical</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(parted) select /dev/sdb</span><br><span class="line">Using /dev/sdb</span><br><span class="line">(parted) print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary   ext4</span><br><span class="line"> 2      1000MB  4000MB  3000MB  extended               lba</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给扩展分区2创建一个逻辑分区（使用范围只能在扩展分区2的范围内）</span></span><br><span class="line">(parted) mkpart logical 1GB 2GB</span><br><span class="line">(parted) print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary   ext4</span><br><span class="line"> 2      1000MB  4000MB  3000MB  extended               lba</span><br><span class="line"> 5      1001MB  2000MB  998MB   logical</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给扩展分区2再创建一个逻辑分区</span></span><br><span class="line">(parted) mkpart logical 2GB 3GB</span><br><span class="line">(parted) print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary   ext4</span><br><span class="line"> 2      1000MB  4000MB  3000MB  extended               lba</span><br><span class="line"> 5      1001MB  2000MB  998MB   logical</span><br><span class="line"> 6      2001MB  3000MB  999MB   logical</span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-3-查看分区"><a href="#2-3-1-3-查看分区" class="headerlink" title="2.3.1.3 查看分区"></a>2.3.1.3 查看分区</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(parted) print # 打印分区</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary</span><br><span class="line"> 2      1000MB  2000MB  999MB  primary</span><br><span class="line"> </span><br><span class="line"> (parted) print free # 查看剩余空间</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line">        32.3kB  1049kB  1016kB           Free Space</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary</span><br><span class="line"> 2      1000MB  2000MB  999MB   primary</span><br><span class="line">        2000MB  10.7GB  8738MB           Free Space</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-4-调整分区大小"><a href="#2-3-1-4-调整分区大小" class="headerlink" title="2.3.1.4 调整分区大小"></a>2.3.1.4 调整分区大小</h4><blockquote>
<p>将分区2从1GB扩展到2GB</p>
<p>PS：v2.4之后的版本，resize命令已经移除，更新到3.1-32版本有resizepart</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary</span><br><span class="line"> 2      1000MB  2000MB  999MB  primary</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 调整分区2的大小为2GB</span></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb resizepart 2 3GB	(3GB是指END位置，即使用1GB-3GB的空间，共2GB)</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary</span><br><span class="line"> 2      1000MB  3000MB  2000MB  primary</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 如果已经格式化并挂载使用，需要重新调整文件系统大小</span></span><br><span class="line"> [root@lb01 ~]# resize2fs /dev/sdb2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>缩小分区大小会怎样？将提示有数据丢失的风险</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb resizepart 2 2GB</span><br><span class="line">Warning: Shrinking a partition can cause data loss, are you sure you want to continue?</span><br><span class="line">Yes/No?</span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-5-删除分区"><a href="#2-3-1-5-删除分区" class="headerlink" title="2.3.1.5 删除分区"></a>2.3.1.5 删除分区</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB   primary</span><br><span class="line"> 2      1000MB  4000MB  3000MB  primary  ext4</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb rm 2   // 删除2号分区，因为已挂载，会提示要先卸载</span><br><span class="line">Error: Partition /dev/sdb2 is being used. You must unmount it before you modify it with Parted.</span><br><span class="line">[root@lb01 ~]# umount /dev/sdb2</span><br><span class="line">[root@lb01 ~]# parted /dev/sdb rm 2 // 删除成功</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# print</span><br><span class="line">-bash: print: command not found</span><br><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary</span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-6-设置-x2F-更改分区标志"><a href="#2-3-1-6-设置-x2F-更改分区标志" class="headerlink" title="2.3.1.6 设置&#x2F;更改分区标志"></a>2.3.1.6 设置&#x2F;更改分区标志</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb set 1 lvm on</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary               lvm</span><br></pre></td></tr></table></figure>

<p>查看有哪些标志可以设置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted</span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/sda</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted) help set</span><br><span class="line">  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER</span><br><span class="line"></span><br><span class="line">        NUMBER is the partition number used by Linux.  On MS-DOS disk labels, the primary partitions number from 1 to 4, logical partitions from 5 onwards.</span><br><span class="line">        FLAG is one of: boot, root, swap, hidden, raid, lvm, lba, hp-service, palo, prep, msftres, bios_grub, atvrecv, diag, legacy_boot</span><br><span class="line">        STATE is one of: on, off</span><br></pre></td></tr></table></figure>

<h4 id="2-3-16-GPT分区方案下的NAME标签"><a href="#2-3-16-GPT分区方案下的NAME标签" class="headerlink" title="2.3.16 GPT分区方案下的NAME标签"></a>2.3.16 GPT分区方案下的NAME标签</h4><p>GPT分区的print</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  File system  Name  Flags</span><br></pre></td></tr></table></figure>

<p>MBR分区的print</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb mklabel msdos</span><br><span class="line">Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you want to continue?</span><br><span class="line">Yes/No? Yes</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  Type  File system  Flags</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><font color='red'>可见GPT标志中多了一个Name标签</font></strong></p>
</blockquote>
<p>使用的时候GPT分区方式可以指定分区名，不用指定主分区、扩展分区这些类型</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb mkpart BOOT 0GB 1GB</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# parted /dev/sdb print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   File system  Name  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  xfs          BOOT</span><br></pre></td></tr></table></figure>

<p>但是MBR就不能</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# parted /dev/sdb mkpart BOOT 0GB 1GB</span><br><span class="line">parted: invalid token: BOOT</span><br><span class="line">Partition type?  primary/extended?</span><br><span class="line">[root@lb01 ~]# parted /dev/sdb mkpart primary BOOT 0GB 1GB</span><br><span class="line">parted: invalid token: BOOT</span><br><span class="line">File system type?  [ext2]?</span><br></pre></td></tr></table></figure>

<h2 id="三、磁盘挂载"><a href="#三、磁盘挂载" class="headerlink" title="三、磁盘挂载"></a>三、磁盘挂载</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、开机自动挂载</span><br><span class="line">	开机自动执行：/etc/rc.local</span><br><span class="line">	</span><br><span class="line">	chmod +x /etc/ec.local</span><br><span class="line">	</span><br><span class="line">	echo &quot;mount /dev/sdc1 /root/test&quot; &gt;&gt; /etc/rc.local</span><br><span class="line"></span><br><span class="line">2、修改配置文件 /etc/fstab</span><br><span class="line">/dev/sdc100     /opt    xfs         defaults   0      0</span><br><span class="line">设备				挂载点  文件系统类型   挂载类型  是否备份  是否检测</span><br><span class="line">UUID=1327e665-44b3-4223-a93b-69c36ec602f9   /root/oldboy  xfs   defaults 0 0</span><br><span class="line"></span><br><span class="line"> /dev/sdc100  等价于  UUID</span><br><span class="line"></span><br><span class="line">3、查询设备UUID</span><br><span class="line">	[root@localhost ~]# blkid </span><br><span class="line">/dev/sdc1: UUID=&quot;b5797ad6-9b98-452c-8962-fa12f6590fa6&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux filesystem&quot;</span><br></pre></td></tr></table></figure>

<h2 id="四、创建SWAP分区"><a href="#四、创建SWAP分区" class="headerlink" title="四、创建SWAP分区"></a>四、创建SWAP分区</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、创建一个硬盘分区</span><br><span class="line"></span><br><span class="line">2、制作swap分区</span><br><span class="line">mkswap /dev/sdb3</span><br><span class="line"></span><br><span class="line">3、激活swap</span><br><span class="line">swapon /dev/sdb3</span><br><span class="line"></span><br><span class="line">4、关闭swap</span><br><span class="line">swapoff </span><br><span class="line"></span><br><span class="line">5、自动挂载</span><br><span class="line">	5.1、</span><br><span class="line">        echo &quot;mkswap /dev/sdb3&quot; &gt;&gt; /etc/rc.local</span><br><span class="line">        echo &quot;swapon /dev/sdb3&quot; &gt;&gt; /etc/rc.local</span><br><span class="line">	5.2、</span><br><span class="line">		echo &quot;/dev/sdb3  swap  swap  defaults 0  0&quot; &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--linux信号</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day17-Linux%E4%BF%A1%E5%8F%B7/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>1、设置进程的nice值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置进程的优先级</span></span><br><span class="line">nice -n -11 bash test.sh</span><br><span class="line"></span><br><span class="line">-n ： 设置优先级</span><br><span class="line">	普通用户：（0~19）</span><br><span class="line">	超级用户：（-20~19）</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 给指定进程设置优先级</span></span><br><span class="line">renice [设置优先级] pid</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、Linux系统信号</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">中断信号</span><br><span class="line">	ctrl + c</span><br><span class="line">	ctrl + z</span><br><span class="line"></span><br><span class="line">	INT(2) : </span><br><span class="line">		<span class="built_in">kill</span> -[信号名称|信号ID]　pid</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">kill</span> -SIGINT  PID</span><br><span class="line">		<span class="built_in">kill</span> -INT     PID</span><br><span class="line">		<span class="built_in">kill</span> -2       PID </span><br><span class="line"></span><br><span class="line">退出信号:</span><br><span class="line">	ctrl + d</span><br><span class="line"></span><br><span class="line">暂停信号：将进程暂停</span><br><span class="line">	SIGTSTP（20）</span><br><span class="line">		<span class="built_in">kill</span> -20 PID </span><br><span class="line">		<span class="built_in">kill</span> -SIGTSTP PID </span><br><span class="line">		<span class="built_in">kill</span> -TSTP PID</span><br><span class="line"></span><br><span class="line">杀死进程信号</span><br><span class="line">	SIGKILL</span><br><span class="line">		<span class="built_in">kill</span> -9 PID </span><br><span class="line">		<span class="built_in">kill</span> -SIGKILL PID</span><br><span class="line">		<span class="built_in">kill</span> -KILL PID</span><br><span class="line">注：不能够被捕捉</span><br><span class="line"></span><br><span class="line">终止信号</span><br><span class="line">	SIGTREM</span><br><span class="line">		<span class="built_in">kill</span> -15 PID </span><br><span class="line">		<span class="built_in">kill</span> -SIGTERM PID</span><br><span class="line">		<span class="built_in">kill</span> -TERM PID</span><br><span class="line"></span><br><span class="line">注：优雅终止进程</span><br><span class="line"></span><br><span class="line">暂停和恢复信号</span><br><span class="line">	SIGCONT : 恢复</span><br><span class="line">	SIGSTOP ：暂停</span><br><span class="line"></span><br><span class="line">重载信号</span><br><span class="line">	SIGHUP（1）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1、nohup [执行的命令] &amp;</span><br><span class="line">后台启动，会在当前目录生成一个nohub.out文件，用于执行的命令的输出。</span><br><span class="line">2、setsid : 实际上开了一个孤儿进程</span><br><span class="line">3、（执行的命令&amp;）</span><br><span class="line">4、screen  开启一个子窗口</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--逻辑卷管理</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day19-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/02_%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="一、LVM介绍"><a href="#一、LVM介绍" class="headerlink" title="一、LVM介绍"></a>一、LVM介绍</h2><p>​	逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可以创建和管理“逻辑”卷，而不是直接使用物理硬盘。可以让管理员弹性的管理逻辑卷的扩大缩小，操作简单，而不损坏已存储的数据。可以随意将新的硬盘添加到LVM，以直接扩展已经存在的逻辑卷。LVM并不需要重启就可以让内核知道分区的存在。</p>
<p>LVM使用分层结构，如下如所示：</p>
<p><img src="/02_%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86.assets/134408sa12dauefffyszfg.jpg" alt="img"></p>
<p>​	图中顶部，首先是实际的物理磁盘及其划分的分区和其上的物理卷（PV）。一个或多个物理卷可以用来创建卷组（VG）。然后基于卷组可以创建逻辑卷（LV）。只要在卷组中有可用空间，就可以随心所欲的创建逻辑卷。文件系统就是在逻辑卷上创建的，然后可以在操作系统挂载和访问</p>
<h2 id="二、LVM使用"><a href="#二、LVM使用" class="headerlink" title="二、LVM使用"></a>二、LVM使用</h2><h3 id="2-1-磁盘准备"><a href="#2-1-磁盘准备" class="headerlink" title="2.1 磁盘准备"></a>2.1 磁盘准备</h3><p>加装两块硬盘，sdb-10G与sdc-5G</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   50G  0 disk</span><br><span class="line">├─sda1   8:1    0    1G  0 part /boot</span><br><span class="line">├─sda2   8:2    0    2G  0 part [SWAP]</span><br><span class="line">└─sda3   8:3    0   47G  0 part /</span><br><span class="line">sdb      8:16   0   10G  0 disk</span><br><span class="line">sdc      8:32   0    5G  0 disk</span><br><span class="line">sr0     11:0    1  792M  0 rom</span><br></pre></td></tr></table></figure>

<p>给sbd创建LVM分区</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# fdisk /dev/sdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m for help): n  # 新建分区</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):</span><br><span class="line">Using default response p</span><br><span class="line">Partition number (1-4, default 1):</span><br><span class="line">First sector (2048-20971519, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-20971519, default 20971519): +2G</span><br><span class="line">Partition 1 of type Linux and of size 2 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): t  # 将分区改为LVM分区</span><br><span class="line">Selected partition 1</span><br><span class="line">Hex code (type L to list all codes): L</span><br><span class="line"></span><br><span class="line"> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris</span><br><span class="line"> 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-</span><br><span class="line"> 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-</span><br><span class="line"> 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-</span><br><span class="line"> 4  FAT16 &lt;32M      40  Venix 80286     85  Linux extended  c7  Syrinx</span><br><span class="line"> 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data</span><br><span class="line"> 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .</span><br><span class="line"> 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility</span><br><span class="line"> 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt</span><br><span class="line"> 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access</span><br><span class="line"> a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O</span><br><span class="line"> b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor</span><br><span class="line"> c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs</span><br><span class="line"> e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT</span><br><span class="line"> f  W95 Ext&#x27;d (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/</span><br><span class="line">10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b</span><br><span class="line">11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor</span><br><span class="line">12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor</span><br><span class="line">14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary</span><br><span class="line">16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS</span><br><span class="line">17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE</span><br><span class="line">18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto</span><br><span class="line">1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep</span><br><span class="line">1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT</span><br><span class="line">1e  Hidden W95 FAT1 80  Old Minix</span><br><span class="line">Hex code (type L to list all codes): 8e</span><br><span class="line">Changed type of partition &#x27;Linux&#x27; to &#x27;Linux LVM&#x27;</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0005122b</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     4196351     2097152   8e  Linux LVM</span><br></pre></td></tr></table></figure>

<p>重复添加，再加一个3G，一个2G的分区，可见分区表如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# fdisk -l /dev/sdb</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0005122b</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     4196351     2097152   8e  Linux LVM</span><br><span class="line">/dev/sdb2         4196352    10487807     3145728   8e  Linux LVM</span><br><span class="line">/dev/sdb3        10487808    14682111     2097152   8e  Linux LVM</span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建物理卷（PV）"><a href="#2-2-创建物理卷（PV）" class="headerlink" title="2.2 创建物理卷（PV）"></a>2.2 创建物理卷（PV）</h3><p>安装LVM工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# yum install lvm2 </span><br></pre></td></tr></table></figure>

<p>将准备好的LVM分区生成为物理卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# pvcreate /dev/sdb1</span><br><span class="line">WARNING: ext4 signature detected on /dev/sdb1 at offset 1080. Wipe it? [y/n]: y</span><br><span class="line">  Wiping ext4 signature on /dev/sdb1.</span><br><span class="line">  Physical volume &quot;/dev/sdb1&quot; successfully created.</span><br><span class="line">[root@lb01 ~]# pvcreate /dev/sdb2</span><br><span class="line">  Physical volume &quot;/dev/sdb2&quot; successfully created.</span><br><span class="line">[root@lb01 ~]# pvcreate /dev/sdb3</span><br><span class="line">  Physical volume &quot;/dev/sdb3&quot; successfully created.</span><br></pre></td></tr></table></figure>

<p>查看物理卷信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# pvdisplay</span><br><span class="line">  &quot;/dev/sdb1&quot; is a new physical volume of &quot;2.00 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb1</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               2.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               YUHdrd-AH1x-ew0m-Mp9i-3GHp-S4zc-XxlDJM</span><br><span class="line"></span><br><span class="line">  &quot;/dev/sdb2&quot; is a new physical volume of &quot;3.00 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb2</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               3.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               wGDQvx-7zfs-g018-wqx4-Y8rh-1kWT-PnLuFu</span><br><span class="line"></span><br><span class="line">  &quot;/dev/sdb3&quot; is a new physical volume of &quot;2.00 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb3</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               2.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               fykcuR-jooY-WKbi-yM8j-7fQ5-mhnH-JCkXC8</span><br></pre></td></tr></table></figure>

<p>补充：如何删除物理卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# pvremove /dev/sdb1</span><br></pre></td></tr></table></figure>

<h3 id="2-3-创建卷组（VG）"><a href="#2-3-创建卷组（VG）" class="headerlink" title="2.3 创建卷组（VG）"></a>2.3 创建卷组（VG）</h3><p>将&#x2F;dev&#x2F;sdb{1,2,3}合并为卷组vg01</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# vgcreate vg01 /dev/sdb1 /dev/sdb2 /dev/sdb3</span><br></pre></td></tr></table></figure>

<p>查看卷组信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# vgdisplay</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               vg01</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        3</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                3</span><br><span class="line">  Act PV                3</span><br><span class="line">  VG Size               &lt;6.99 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              1789</span><br><span class="line">  Alloc PE / Size       0 / 0</span><br><span class="line">  Free  PE / Size       1789 / &lt;6.99 GiB</span><br><span class="line">  VG UUID               gzeouH-16qO-n6xv-V6VM-A9ep-eK6E-ODuIwU</span><br></pre></td></tr></table></figure>

<p>补充：如何删除卷组</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# vgremove vg01</span><br><span class="line">  Volume group &quot;vg01&quot; successfully removed</span><br></pre></td></tr></table></figure>

<h3 id="2-4-创建逻辑卷（LV）"><a href="#2-4-创建逻辑卷（LV）" class="headerlink" title="2.4 创建逻辑卷（LV）"></a>2.4 创建逻辑卷（LV）</h3><p>创建一个名为lv01，大小为100M的逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvcreate -L 100M -n lv01 vg01</span><br><span class="line">  Logical volume &quot;lv01&quot; created.</span><br></pre></td></tr></table></figure>

<p>查看逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg01/lv01</span><br><span class="line">  LV Name                lv01</span><br><span class="line">  VG Name                vg01</span><br><span class="line">  LV UUID                xFksnb-ENc2-mEo4-5gEb-yaJj-wP2c-oFuBeT</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time lb01, 2021-09-01 20:39:16 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line"><span class="meta">  #</span><span class="bash"> open                 0</span></span><br><span class="line">  LV Size                100.00 MiB</span><br><span class="line">  Current LE             25</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure>

<p>补充：删除逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvremove /dev/vg01/lv02</span><br><span class="line">Do you really want to remove active logical volume vg01/lv02? [y/n]: y</span><br><span class="line">  Logical volume &quot;lv02&quot; successfully removed</span><br></pre></td></tr></table></figure>

<h3 id="2-5-逻辑卷挂载"><a href="#2-5-逻辑卷挂载" class="headerlink" title="2.5 逻辑卷挂载"></a>2.5 逻辑卷挂载</h3><p>格式化逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# mkfs.ext4 /dev/vg01/lv01</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=1024 (log=0)</span><br><span class="line">Fragment size=1024 (log=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">25688 inodes, 102400 blocks</span><br><span class="line">5120 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=1</span><br><span class="line">Maximum filesystem blocks=33685504</span><br><span class="line">13 block groups</span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">1976 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        8193, 24577, 40961, 57345, 73729</span><br><span class="line"></span><br><span class="line">Allocating group tables: done</span><br><span class="line">Writing inode tables: done</span><br><span class="line">Creating journal (4096 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br></pre></td></tr></table></figure>

<p>挂载逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# mkdir /mnt/test-lv01</span><br><span class="line">[root@lb01 ~]# mount /dev/vg01/lv01 /mnt/test-lv01</span><br><span class="line">[root@lb01 ~]# df -h</span><br><span class="line">Filesystem             Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3               47G  1.9G   46G   4% /</span><br><span class="line">devtmpfs               479M     0  479M   0% /dev</span><br><span class="line">tmpfs                  489M     0  489M   0% /dev/shm</span><br><span class="line">tmpfs                  489M  6.8M  482M   2% /run</span><br><span class="line">tmpfs                  489M     0  489M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             1014M  119M  896M  12% /boot</span><br><span class="line">tmpfs                   98M     0   98M   0% /run/user/0</span><br><span class="line">/dev/mapper/vg01-lv01   93M  1.6M   85M   2% /mnt/test-lv01</span><br></pre></td></tr></table></figure>

<h3 id="2-6-扩展逻辑卷"><a href="#2-6-扩展逻辑卷" class="headerlink" title="2.6 扩展逻辑卷"></a>2.6 扩展逻辑卷</h3><p>卸载逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# umount /dev/vg01/lv01</span><br></pre></td></tr></table></figure>

<p>将逻辑卷lv01调整为200M</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvresize -L 200M /dev/vg01/lv01 </span><br><span class="line">  Size of logical volume vg01/lv01 changed from 100.00 MiB (25 extents) to 200.00 MiB (50 extents).</span><br><span class="line">  Logical volume vg01/lv01 successfully resized.</span><br></pre></td></tr></table></figure>

<p>检查磁盘错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# e2fsck -f /dev/vg01/lv01</span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">/dev/vg01/lv01: 11/25688 files (9.1% non-contiguous), 8896/102400 blocks</span><br></pre></td></tr></table></figure>

<p>调整文件系统大小</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# resize2fs /dev/vg01/lv01</span><br></pre></td></tr></table></figure>

<p>查看逻辑卷信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg01/lv01</span><br><span class="line">  LV Name                lv01</span><br><span class="line">  VG Name                vg01</span><br><span class="line">  LV UUID                svm5Xk-B8jZ-QhZw-egCm-x6b2-e5Jt-wvMi2F</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time lb01, 2021-09-01 20:41:53 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line"><span class="meta">  #</span><span class="bash"> open                 0</span></span><br><span class="line">  LV Size                200.00 MiB</span><br><span class="line">  Current LE             50</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:0</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>重新挂载使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# !mount</span><br><span class="line">mount /dev/vg01/lv01 /mnt/test-lv01</span><br><span class="line">[root@lb01 ~]# df -h</span><br><span class="line">Filesystem             Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3               47G  1.9G   46G   4% /</span><br><span class="line">devtmpfs               479M     0  479M   0% /dev</span><br><span class="line">tmpfs                  489M     0  489M   0% /dev/shm</span><br><span class="line">tmpfs                  489M  6.8M  482M   2% /run</span><br><span class="line">tmpfs                  489M     0  489M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             1014M  119M  896M  12% /boot</span><br><span class="line">tmpfs                   98M     0   98M   0% /run/user/0</span><br><span class="line">/dev/mapper/vg01-lv01  190M  1.6M  175M   1% /mnt/test-lv01</span><br></pre></td></tr></table></figure>

<h3 id="2-7-缩减逻辑卷"><a href="#2-7-缩减逻辑卷" class="headerlink" title="2.7 缩减逻辑卷"></a>2.7 缩减逻辑卷</h3><p>卸载逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# umount /dev/vg01/lv01</span><br></pre></td></tr></table></figure>

<p>检查磁盘错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# e2fsck -f /dev/vg01/lv01</span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">/dev/vg01/lv01: 11/49400 files (9.1% non-contiguous), 11884/204800 blocks</span><br></pre></td></tr></table></figure>

<p>缩减文件系统大小，更新ext4信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# resize2fs /dev/vg01/lv01 100M</span><br><span class="line">resize2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Resizing the filesystem on /dev/vg01/lv01 to 102400 (1k) blocks.</span><br><span class="line">The filesystem on /dev/vg01/lv01 is now 102400 blocks long.</span><br></pre></td></tr></table></figure>

<p>完成后，减小逻辑卷大小</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvresize -L 100M /dev/vg01/lv01</span><br><span class="line">  WARNING: Reducing active logical volume to 100.00 MiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce vg01/lv01? [y/n]: y</span><br><span class="line">  Size of logical volume vg01/lv01 changed from 200.00 MiB (50 extents) to 100.00 MiB (25 extents).</span><br><span class="line">  Logical volume vg01/lv01 successfully resized.</span><br></pre></td></tr></table></figure>

<p>查看逻辑卷信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg01/lv01</span><br><span class="line">  LV Name                lv01</span><br><span class="line">  VG Name                vg01</span><br><span class="line">  LV UUID                svm5Xk-B8jZ-QhZw-egCm-x6b2-e5Jt-wvMi2F</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time lb01, 2021-09-01 20:41:53 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line"><span class="meta">  #</span><span class="bash"> open                 0</span></span><br><span class="line">  LV Size                100.00 MiB</span><br><span class="line">  Current LE             25</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:0</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>挂载使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# !mo</span><br><span class="line">mount /dev/vg01/lv01 /mnt/test-lv01</span><br><span class="line">[root@lb01 ~]# df -h</span><br><span class="line">Filesystem             Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3               47G  1.9G   46G   4% /</span><br><span class="line">devtmpfs               479M     0  479M   0% /dev</span><br><span class="line">tmpfs                  489M     0  489M   0% /dev/shm</span><br><span class="line">tmpfs                  489M  6.8M  482M   2% /run</span><br><span class="line">tmpfs                  489M     0  489M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             1014M  119M  896M  12% /boot</span><br><span class="line">tmpfs                   98M     0   98M   0% /run/user/0</span><br><span class="line">/dev/mapper/vg01-lv01   93M  1.6M   85M   2% /mnt/test-lv01</span><br></pre></td></tr></table></figure>

<h3 id="2-8-VG增加一块磁盘"><a href="#2-8-VG增加一块磁盘" class="headerlink" title="2.8 VG增加一块磁盘"></a>2.8 VG增加一块磁盘</h3><p>新盘创建lvm分区</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# fdisk /dev/sdc</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x05ff27fa.</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):</span><br><span class="line">Using default response p</span><br><span class="line">Partition number (1-4, default 1):</span><br><span class="line">First sector (2048-10485759, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-10485759, default 10485759): +4G</span><br><span class="line">Partition 1 of type Linux and of size 4 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): t</span><br><span class="line">Selected partition 1</span><br><span class="line">Hex code (type L to list all codes):</span><br><span class="line">Hex code (type L to list all codes): 8e</span><br><span class="line">Changed type of partition &#x27;Linux&#x27; to &#x27;Linux LVM&#x27;</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdc: 5368 MB, 5368709120 bytes, 10485760 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x05ff27fa</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdc1            2048     8390655     4194304   8e  Linux LVM</span><br></pre></td></tr></table></figure>

<p>创建物理卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# pvcreate /dev/sdc1</span><br><span class="line">  Physical volume &quot;/dev/sdc1&quot; successfully created.</span><br></pre></td></tr></table></figure>

<p>扩容VG</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# vgextend vg01 /dev/sdc1</span><br><span class="line">  Volume group &quot;vg01&quot; successfully extended</span><br></pre></td></tr></table></figure>

<p>查看VG信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# vgdisplay vg01</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               vg01</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        4</span><br><span class="line">  Metadata Sequence No  10</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                2</span><br><span class="line">  Open LV               1</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                4</span><br><span class="line">  Act PV                4</span><br><span class="line">  VG Size               10.98 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              2812</span><br><span class="line">  Alloc PE / Size       50 / 200.00 MiB</span><br><span class="line">  Free  PE / Size       2762 / &lt;10.79 GiB</span><br><span class="line">  VG UUID               2Tjzna-XmXI-9MQ7-zeyc-AARV-84r5-jyymkf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：尽管我们使用一个单独的磁盘做示范，其实只要是‘8e’类型的磁盘分区都可以用来扩展卷组。</p>
</blockquote>
<p>在VG中创建LV，可以看到磁盘都用上了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@lb01 ~]# lvcreate -L 10G -n lv03 vg01</span><br><span class="line">  Logical volume &quot;lv03&quot; created.</span><br><span class="line">[root@lb01 ~]# lsblk</span><br><span class="line">NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda             8:0    0   50G  0 disk</span><br><span class="line">├─sda1          8:1    0    1G  0 part /boot</span><br><span class="line">├─sda2          8:2    0    2G  0 part [SWAP]</span><br><span class="line">└─sda3          8:3    0   47G  0 part /</span><br><span class="line">sdb             8:16   0   10G  0 disk</span><br><span class="line">├─sdb1          8:17   0    2G  0 part</span><br><span class="line">│ ├─vg01-lv01 253:0    0  100M  0 lvm  /mnt/test-lv01</span><br><span class="line">│ ├─vg01-lv02 253:1    0  100M  0 lvm</span><br><span class="line">│ └─vg01-lv03 253:2    0   10G  0 lvm</span><br><span class="line">├─sdb2          8:18   0    3G  0 part</span><br><span class="line">│ └─vg01-lv03 253:2    0   10G  0 lvm</span><br><span class="line">└─sdb3          8:19   0    2G  0 part</span><br><span class="line">  └─vg01-lv03 253:2    0   10G  0 lvm</span><br><span class="line">sdc             8:32   0    5G  0 disk</span><br><span class="line">└─sdc1          8:33   0    4G  0 part</span><br><span class="line">  └─vg01-lv03 253:2    0   10G  0 lvm</span><br><span class="line">sr0            11:0    1  792M  0 rom</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--netstat使用</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day18-netstat%E4%BD%BF%E7%94%A8/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>1、netstat</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat主要用来查询系统端口相关问题</span><br><span class="line"></span><br><span class="line">注：要使用netstat，需要安装yum install -y net-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># netstat常用参数</span></span><br><span class="line">-t : 打印tcp链接的进程</span><br><span class="line">-u : 打印UDP链接的进程</span><br><span class="line">-l : 监听</span><br><span class="line">-p : 打印进程的PID</span><br><span class="line">-n : 不反解，不将ip地址解析成域名同时不将端口解析成对应的协议名称</span><br><span class="line"></span><br><span class="line">netstat -nutlp</span><br></pre></td></tr></table></figure>

<p>2、分区</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看系统磁盘</span></span><br><span class="line">[root@localhost ~]<span class="comment"># lsblk </span></span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   20G  0 disk </span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   19G  0 part </span><br><span class="line">  ├─centos-root 253:0    0   18G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0    1G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0   40G  0 disk </span><br><span class="line">sdc               8:32   0  3.9T  0 disk </span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区</span></span><br><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb </span></span><br><span class="line"></span><br><span class="line">n : 新建一个分区</span><br><span class="line">p : 查看分区情况</span><br><span class="line">m ：查看帮助</span><br><span class="line">d : 删除分区</span><br><span class="line">w ；保存分区修改内容</span><br></pre></td></tr></table></figure>

<p>3、使用文件系统的流程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、装硬盘</span><br><span class="line"></span><br><span class="line">2、查看当前系统硬盘</span><br><span class="line">[root@localhost a]<span class="comment"># lsblk </span></span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   20G  0 disk </span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   19G  0 part </span><br><span class="line">  ├─centos-root 253:0    0   18G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0    1G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0   40G  0 disk </span><br><span class="line">sdc               8:32   0  3.9T  0 disk </span><br><span class="line">sr0              11:0    1  4.3G  0 rom  </span><br><span class="line"></span><br><span class="line">3、分区</span><br><span class="line">	2TB 以下的硬盘，使用MBR分区</span><br><span class="line">	2TB 以上的硬盘，使用GPT分区</span><br><span class="line">	</span><br><span class="line">	fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">4、格式化分区（将分区做成文件系统）</span><br><span class="line">	mkfs.xfs /dev/sdb1</span><br><span class="line"></span><br><span class="line">5、挂载分区</span><br><span class="line">	mount /dev/sdb1  /a</span><br><span class="line"></span><br><span class="line">6、检测</span><br><span class="line">	df</span><br><span class="line">		-h : 显示硬盘大小单位</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：挂载哪个硬盘则显示对应硬盘里面的内容</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--dd与文件系统备份</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day20-dd%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD/%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><p>1、dd命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/dev/sdb bs=500M count=1 </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> : 从哪里读文件</span><br><span class="line">of : 写入到哪里</span><br><span class="line">bs : 写入500M</span><br><span class="line">count : 写一块</span><br></pre></td></tr></table></figure>

<p>2、模拟文件系统出问题</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、直接向硬盘中写数据，不能测试向分区写数据</span><br><span class="line">2、卸载之后重新挂载</span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/sdc1 /root/test</span></span><br><span class="line">mount: mount /dev/sdc1 on /root/<span class="built_in">test</span> failed: Structure needs cleaning</span><br><span class="line"></span><br><span class="line">3、对文件系统进行修复</span><br><span class="line">xfs_repair [磁盘或分区路径]</span><br><span class="line"></span><br><span class="line">注： xfs_repair修改硬盘之后，硬盘数据丢失，所以对重要的数据要进行数据备份</span><br></pre></td></tr></table></figure>

<p>3、文件系统的备份与恢复</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">备份：另外在保存一份</span><br><span class="line">恢复：将以前保存的数据进行还原</span><br><span class="line"></span><br><span class="line">touch 1.txt</span><br><span class="line"><span class="built_in">echo</span> aaaa &gt; 1.txt</span><br><span class="line">cp  1.txt   2.txt</span><br><span class="line"></span><br><span class="line">rm 1.txt</span><br><span class="line"></span><br><span class="line">cp 2.txt 1.txt</span><br><span class="line"></span><br><span class="line">1.log   1T = 1024G</span><br><span class="line"></span><br><span class="line">全量备份和增量备份</span><br><span class="line">全量备份：将需要备份的文件全部复制一份</span><br><span class="line">增量备份：在原来备份基础上，把新增数据重新备份一份</span><br><span class="line"></span><br><span class="line">备份与恢复的命令</span><br><span class="line">xfsdump : 备份的命令</span><br><span class="line">xfsrestore  : 恢复的命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份的步骤</span></span><br><span class="line">1、安装备份命令</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># yum install xfsdump -y</span></span><br><span class="line"></span><br><span class="line">2、备份的等级</span><br><span class="line">0  全量备份</span><br><span class="line"></span><br><span class="line">1 ~ 9 增量备份（等级）</span><br><span class="line"></span><br><span class="line">3、备份的参数</span><br><span class="line">-L ：记录每次备份的地方</span><br><span class="line">-M ：注释，此次备份的注释</span><br><span class="line">-l ：指定备份的等级</span><br><span class="line">-f ：备份的文件名称</span><br><span class="line">-I ：查看备份信息</span><br><span class="line"></span><br><span class="line">4、备份的条件（限制）</span><br><span class="line">	1、必须使用root权限</span><br><span class="line">	2、只能备份已经挂载的内容</span><br><span class="line">	3、只能备份xfs文件系统</span><br><span class="line">	4、只能够用xfsrestore来恢复</span><br><span class="line"></span><br><span class="line">5、备份的命令格式</span><br><span class="line">xfsdump [参数] 备份路径</span><br><span class="line">xfsdump -L sdb1_bak -M <span class="string">&quot;sbd1_from_xxx&quot;</span> -l 0 -f sdb1_from_bak_1 /root/oldboy</span><br><span class="line"></span><br><span class="line">6、数据恢复</span><br><span class="line">xfsrestore</span><br><span class="line"></span><br><span class="line">7、恢复数据的参数</span><br><span class="line">-f : 指定备份的文件路径</span><br><span class="line"></span><br><span class="line">8、恢复的格式</span><br><span class="line">xfsrestore [参数] 恢复的路径</span><br><span class="line">[root@localhost oldboy]<span class="comment"># xfsrestore -f /root/sdb1_from_bak_3 /root/oldboy/</span></span><br></pre></td></tr></table></figure>

<p>4、LVM</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、什么是lvm</span><br><span class="line"></span><br><span class="line">你如何保证你的硬盘空间恰好够用？</span><br><span class="line">如果你的硬盘你够用了怎么扩容？</span><br><span class="line"></span><br><span class="line">LVM是文件系统管理工具</span><br><span class="line"></span><br><span class="line">/root/oldboy ---&gt;  lv[5G]</span><br><span class="line">/root/oldboy ---&gt;  lv[3G]</span><br><span class="line"></span><br><span class="line">2、LVM的优点</span><br><span class="line">	1、可以动态扩容与缩容</span><br><span class="line">	2、可以将新增加的硬盘添加到VG存储池</span><br><span class="line">	3、可以突破物理存储卷的限制</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、使用lvm</span><br><span class="line">	1、安装lvm软件包</span><br><span class="line">		yum install lvm2 -y</span><br><span class="line">	2、将磁盘交给pv</span><br><span class="line">		pvreate [磁盘|磁盘分区]</span><br><span class="line">	3、查看pv</span><br><span class="line">		pvs</span><br><span class="line">		pvscan</span><br><span class="line">	4、创建vg</span><br><span class="line">		vgcreate [vg名称] [pv路径]</span><br><span class="line">	5、查看vg</span><br><span class="line">	6、创建lvm逻辑卷（lv）</span><br><span class="line">		-L ： 创建逻辑卷的大小</span><br><span class="line">		-n : 逻辑卷的名字</span><br><span class="line">		lvcreate [参数] 逻辑卷名称</span><br><span class="line">	7、制作文件系统</span><br><span class="line">		mkfs.xfs /dev/vg1/xxx</span><br><span class="line">	</span><br><span class="line">	8、挂载文件系统</span><br><span class="line">		mount [lv的路径] [挂载点的路径]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--计划任务</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day21-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h1 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h1><p>1、Crontab表达式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*  *  *  * * </span><br><span class="line">分 时 日 月 周</span><br><span class="line"></span><br><span class="line">每天的凌晨2点   02：00     00 02 * * *</span><br><span class="line">每月执行一次    00  00  01  * *</span><br><span class="line">每个月的一号零点零时零分同时这一天时星期六 00  00  01  *  6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、系统级别的计划任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1、/etc/crontab</span><br><span class="line"></span><br><span class="line">2、如下的目录</span><br><span class="line">    /etc/cron.hourly/ <span class="comment"># 系统定时任务每个⼩时运⾏这个⽬录⾥的内容</span></span><br><span class="line">    /etc/cron.daily/ <span class="comment"># 系统定时任务每天运⾏这个⽬录⾥的内容</span></span><br><span class="line">    /etc/cron.weekly/ <span class="comment"># 系统定时任务每周运⾏这个⽬录⾥的内容</span></span><br><span class="line">    /etc/cron.monthly/ <span class="comment"># 系统定时任务每⽉运⾏这个⽬录⾥的内容</span></span><br></pre></td></tr></table></figure>

<p>3、用户级别的计划任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"></span><br><span class="line">-e : 编辑计划任务</span><br><span class="line">-l : 查看计划任务</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：用户级别的计划任务存放在/var/spool/cron/，不同的用户存放的计划任务是以其自己的名字命名的脚本</span></span><br></pre></td></tr></table></figure>

<p>4、crontab语法</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1 3 5</span></span><br><span class="line">00 00 1,3,5 * *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1到5号</span></span><br><span class="line">00 00 1-5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每几分钟，每几个小数，每几天</span></span><br><span class="line">0/2  /2 </span><br><span class="line">00 0/2    00 /2</span><br><span class="line">00 00 0/2   00 00 /2</span><br></pre></td></tr></table></figure>



<p>5、每3分钟同步一下系统时间</p>
]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
  <entry>
    <title>运维之基础命令--防火墙与iptables</title>
    <url>/2022/07/06/01_%E8%BF%90%E7%BB%B4/01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/day22-%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8Eiptables/iptables%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="iptables使用手册"><a href="#iptables使用手册" class="headerlink" title="iptables使用手册"></a>iptables使用手册</h1><h2 id="一、简单实践"><a href="#一、简单实践" class="headerlink" title="一、简单实践"></a>一、简单实践</h2><blockquote>
<p>从信息查看、保存规则、清除规则、恢复规则、更改规则五个方面来学习。</p>
</blockquote>
<h3 id="1-1-信息查看"><a href="#1-1-信息查看" class="headerlink" title="1.1 信息查看"></a>1.1 信息查看</h3><p>查看现有规则</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">neutron-linuxbri-INPUT  all  --  anywhere             anywhere</span><br><span class="line">nova-api-INPUT  all  --  anywhere             anywhere</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">neutron-filter-top  all  --  anywhere             anywhere</span><br><span class="line">neutron-linuxbri-FORWARD  all  --  anywhere             anywhere</span><br><span class="line">nova-filter-top  all  --  anywhere             anywhere</span><br><span class="line">nova-api-FORWARD  all  --  anywhere             anywhere</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>查看现有规则，显示主机ip和端口号，-n</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables -L -n</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">neutron-linuxbri-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">nova-api-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">neutron-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">neutron-linuxbri-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">nova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">nova-api-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果显示：</p>
<p>默认显示三条链的规则INPUT、FORWARD、OUTPUT，而且所有的规则都是默认接受的</p>
<p>每条链下面显示的信息是：</p>
<p>动作  协议 参数 源地址 目标地址</p>
</blockquote>
<p>显示详细信息，-v</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 11839 packets, 2842K bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">11839 2842K neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">12985 3090K nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 neutron-linuxbri-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果显示：</p>
<p>-v显示的内容比-L -n 显示的内容多了四个字段</p>
<p>pkts  规则匹配到的报文数量的多少</p>
<p>bytes 规则匹配到的报文内容量的大小</p>
<p>in   规则匹配到的流入的接口，*代表任意接口</p>
<p>out   规则匹配到的流出的接口</p>
</blockquote>
<p>显示规则的标号 –line-numbers</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables -L -n -v --line-numbers</span><br><span class="line">Chain INPUT (policy ACCEPT 13663 packets, 3221K bytes)</span><br><span class="line">num   pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">1    13663 3221K neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2    14809 3469K nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line">num   pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">1        0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2        0     0 neutron-linuxbri-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">3        0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">4        0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>打印规则命令，将防火墙的编写命令给我们打印出来，可以通过这种方式来学习规则的编写。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables -S</span><br><span class="line">-P INPUT ACCEPT</span><br><span class="line">-P FORWARD ACCEPT</span><br><span class="line">-P OUTPUT ACCEPT</span><br><span class="line">-N neutron-filter-top</span><br><span class="line">-N neutron-linuxbri-FORWARD</span><br><span class="line">-N neutron-linuxbri-INPUT</span><br><span class="line">-N neutron-linuxbri-OUTPUT</span><br><span class="line">-N neutron-linuxbri-local</span><br><span class="line">-N neutron-linuxbri-scope</span><br><span class="line">-N neutron-linuxbri-sg-chain</span><br><span class="line">-N neutron-linuxbri-sg-fallback</span><br><span class="line">-N nova-api-FORWARD</span><br><span class="line">-N nova-api-INPUT</span><br><span class="line">-N nova-api-OUTPUT</span><br><span class="line">-N nova-api-local</span><br><span class="line">-N nova-filter-top</span><br><span class="line">-A INPUT -j neutron-linuxbri-INPUT</span><br><span class="line">-A INPUT -j nova-api-INPUT</span><br><span class="line">-A FORWARD -j neutron-filter-top</span><br><span class="line">-A FORWARD -j neutron-linuxbri-FORWARD</span><br><span class="line">-A FORWARD -j nova-filter-top</span><br><span class="line">-A FORWARD -j nova-api-FORWARD</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="1-2-保存规则"><a href="#1-2-保存规则" class="headerlink" title="1.2 保存规则"></a>1.2 保存规则</h3><blockquote>
<p>使用 iptables-save命令可以保存规则</p>
</blockquote>
<p>将当前的规则保存到文件中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@controller ~]# iptables-save &gt; iptables.rules</span><br><span class="line">[root@controller ~]# cat iptables.rules</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Wed Oct 20 09:22:53 2021</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [16785:3861723]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [16549:3883715]</span><br><span class="line">:neutron-filter-top - [0:0]</span><br><span class="line">:neutron-linuxbri-FORWARD - [0:0]</span><br><span class="line">:neutron-linuxbri-INPUT - [0:0]</span><br><span class="line">:neutron-linuxbri-OUTPUT - [0:0]</span><br><span class="line">:neutron-linuxbri-local - [0:0]</span><br><span class="line">:neutron-linuxbri-scope - [0:0]</span><br><span class="line">:neutron-linuxbri-sg-chain - [0:0]</span><br><span class="line">:neutron-linuxbri-sg-fallback - [0:0]</span><br><span class="line">:nova-api-FORWARD - [0:0]</span><br><span class="line">:nova-api-INPUT - [0:0]</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="1-3-清除规则"><a href="#1-3-清除规则" class="headerlink" title="1.3 清除规则"></a>1.3 清除规则</h3><p>清除单个规则</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 先查看</span></span><br><span class="line">[root@controller ~]# iptables -L -n --line-numbers</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt source               destination</span><br><span class="line">1    neutron-linuxbri-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2    nova-api-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">num  target     prot opt source               destination</span><br><span class="line">1    neutron-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2    neutron-linuxbri-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">3    nova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">4    nova-api-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除FORWARD的第2条规则</span></span><br><span class="line">[root@controller ~]# iptables -D FORWARD 2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次查看，删除成功</span></span><br><span class="line">[root@controller ~]# iptables -L -n --line-numbers</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt source               destination</span><br><span class="line">1    neutron-linuxbri-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2    nova-api-INPUT  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">num  target     prot opt source               destination</span><br><span class="line">1    neutron-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">2    nova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">3    nova-api-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果不指定删除的序号，会报错</span></span><br><span class="line">[root@controller ~]# iptables -D FORWARD</span><br><span class="line">iptables: Bad rule (does a matching rule exist in that chain?).</span><br></pre></td></tr></table></figure>

<p>清除规则计数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看原内容</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 3196 packets, 657K bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">23118 5147K neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">24264 5395K nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除规则计数 -Z</span></span><br><span class="line">[root@controller ~]# iptables -Z</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看效果，pkts与bytes减少，即规则匹配到的报文数量与报文内容大小均减少，清除成功</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 58 packets, 11344 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">   58 11344 neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   58 11344 nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>清除所有规则</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 清除默认规则</span></span><br><span class="line">[root@controller ~]# iptables -F</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除自定义规则</span></span><br><span class="line">[root@controller ~]# iptables -X</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看效果</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 424 packets, 84770 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 398 packets, 83826 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br></pre></td></tr></table></figure>

<h3 id="1-4-恢复规则"><a href="#1-4-恢复规则" class="headerlink" title="1.4 恢复规则"></a>1.4 恢复规则</h3><p>从备份文件恢复规则</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从文件恢复</span></span><br><span class="line">[root@controller ~]# iptables-restore &lt; iptables.rules</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看确认已恢复</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 268 packets, 46570 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">  268 46570 neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  268 46570 nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 neutron-linuxbri-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="1-5-更改规则"><a href="#1-5-更改规则" class="headerlink" title="1.5 更改规则"></a>1.5 更改规则</h3><p>可以从ACCEPT改为DROP</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看原规则</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 342 packets, 49890 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"> 4455  836K neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"> 4455  836K nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 neutron-linuxbri-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -P 修改</span></span><br><span class="line">[root@controller ~]# iptables -P FORWARD DROP</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次查看，FORWARD链修改DROP成功</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 38 packets, 5017 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"> 4849  905K neutron-linuxbri-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"> 4849  905K nova-api-INPUT  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 neutron-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 neutron-linuxbri-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-filter-top  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 nova-api-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-P 更改的规则，使用 -F 不能自动还原</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[root@controller ~]<span class="comment"># iptables -F</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">[root@controller ~]<span class="comment"># iptables -L -n -v</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">Chain INPUT (policy ACCEPT 36 packets, 6554 bytes)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">....</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>重启iptables服务后，可以使用系统所有默认规则</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 清除所有默认规则</span></span><br><span class="line">[root@controller ~]# iptables -F</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看，没有默认规则</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 8 packets, 520 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 4 packets, 448 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启iptables服务</span></span><br><span class="line">[root@controller ~]# systemctl restart iptables</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次查看，新增了系统的默认规则</span></span><br><span class="line">[root@controller ~]# iptables -L -n -v</span><br><span class="line">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    6   432 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED</span><br><span class="line">    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22</span><br><span class="line">    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br><span class="line">    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 4 packets, 544 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>运维</category>
        <category>（一）基础命令</category>
      </categories>
  </entry>
</search>
