

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GongSheng">
  <meta name="keywords" content="">
  
    <meta name="description" content="Devops架构-Jenkins-02今日内容：  CD持续交付&#x2F;部署的方案介绍 案例04：Jenkins从gitlab拉取站点代码并部署 案例05：Jenkins拉取java代码, maven编译后部署  一、CD持续交付&#x2F;部署方案   CD方案 优点 缺点 应用场景    1、使用Jenkins执行shell命令、脚本 简单、通用 集群中有大批量节点时，效率低 通用的、初学">
<meta property="og:type" content="article">
<meta property="og:title" content="day76-Devops-Jenkins(二)">
<meta property="og:url" content="http://gsproj.github.io/2024/07/12/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day76-Devops-Jenkins-2/index.html">
<meta property="og:site_name" content="迎风之豚的博客">
<meta property="og:description" content="Devops架构-Jenkins-02今日内容：  CD持续交付&#x2F;部署的方案介绍 案例04：Jenkins从gitlab拉取站点代码并部署 案例05：Jenkins拉取java代码, maven编译后部署  一、CD持续交付&#x2F;部署方案   CD方案 优点 缺点 应用场景    1、使用Jenkins执行shell命令、脚本 简单、通用 集群中有大批量节点时，效率低 通用的、初学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713211637176.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713211951085.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212035743.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212510293.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212535865.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212641143.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212707264.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713212939235.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713215749779.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713214608889.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713214739435.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713213445476.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713213504959.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713213629602.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713213852380.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713214038102.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713214217352.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713215311527.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713220021961.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713220134058.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713222801538.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240713222827973.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716094835318.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716101220613.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716101242040.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716100737824.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716100817753.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716105310410.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716105543157.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716105751359.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716105853153.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716111424306.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716112858722.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240716112955544.png">
<meta property="article:published_time" content="2024-07-12T03:08:52.000Z">
<meta property="article:modified_time" content="2024-08-02T01:48:34.361Z">
<meta property="article:author" content="GongSheng">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://gsproj.github.io/img/image-20240713211637176.png">
  
  
  
  <title>day76-Devops-Jenkins(二) - 迎风之豚的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gsproj.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Haris的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="day76-Devops-Jenkins(二)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-12 11:08" pubdate>
          2024年7月12日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          17 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">day76-Devops-Jenkins(二)</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Devops架构-Jenkins-02"><a href="#Devops架构-Jenkins-02" class="headerlink" title="Devops架构-Jenkins-02"></a>Devops架构-Jenkins-02</h1><p>今日内容：</p>
<ul>
<li>CD持续交付&#x2F;部署的方案介绍</li>
<li>案例04：Jenkins从gitlab拉取站点代码并部署</li>
<li>案例05：Jenkins拉取java代码, maven编译后部署</li>
</ul>
<h1 id="一、CD持续交付-部署方案"><a href="#一、CD持续交付-部署方案" class="headerlink" title="一、CD持续交付&#x2F;部署方案"></a>一、CD持续交付&#x2F;部署方案</h1><table>
<thead>
<tr>
<th>CD方案</th>
<th>优点</th>
<th>缺点</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>1、使用Jenkins执行shell命令、脚本</td>
<td>简单、通用</td>
<td>集群中有大批量节点时，效率低</td>
<td>通用的、初学者</td>
</tr>
<tr>
<td>2、Jenkins插件Publish Over SSH插件实现（分发文件、远程执行命令等）</td>
<td>简单</td>
<td>所有被管理节点都要在Jenkins页面配置</td>
<td>机器较少可以用</td>
</tr>
<tr>
<td>3、Jenkins执行Ansible剧本、Ad-hoc</td>
<td>便于批量管理与维护</td>
<td>需要掌握Ans剧本、模块</td>
<td>网站集群批量更新.jk+ansible命令<br/>或jk+ansible插件</td>
</tr>
<tr>
<td>4、Jenkins执行Docker命令</td>
<td>更加简单、适用于集群部署</td>
<td>需要掌握dockerfile、docker-compose的编写</td>
<td>jk+docker命令或插件、jk+ansible+docker</td>
</tr>
<tr>
<td>5、jenkins交付到k8s集群</td>
<td>…</td>
<td>….</td>
<td>jk+k8s</td>
</tr>
</tbody></table>
<h1 id="二、案例04：搭建开发测试专用的任务"><a href="#二、案例04：搭建开发测试专用的任务" class="headerlink" title="二、案例04：搭建开发测试专用的任务"></a>二、案例04：搭建开发测试专用的任务</h1><p>任务要求：</p>
<ul>
<li>开发人员书写代码，上传到代码仓库.</li>
<li>只要仓库收到开发上传的代码，触发jenkins的<code>04-webhook-job</code>测试任务.</li>
<li>jenkins去拉取代码仓库最新的代码并部署到测试环境中.</li>
<li>这个案例一般用于测试环境自动化部署代码.</li>
</ul>
<p>案例流程如下：</p>
<p><img src="/../../../img/image-20240713211637176.png" srcset="/img/loading.gif" lazyload alt="image-20240713211637176"></p>
<h2 id="2-1-详细步骤"><a href="#2-1-详细步骤" class="headerlink" title="2.1 详细步骤"></a>2.1 详细步骤</h2><p>步骤概览：</p>
<ul>
<li>jenkins添加gitlab插件</li>
<li>在jenkins创建钩子令牌(认证).</li>
<li>在gitlab配置jenkins钩子和令牌.</li>
<li>测试，提交代码</li>
</ul>
<h3 id="2-1-1-Jenkins安装插件"><a href="#2-1-1-Jenkins安装插件" class="headerlink" title="2.1.1 Jenkins安装插件"></a>2.1.1 Jenkins安装插件</h3><p>在jenkins安装两个插件<code>gitlab</code>和<code>Generic Webhook Trigger</code></p>
<p>gitlab插件</p>
<p><img src="/../../../img/image-20240713211951085.png" srcset="/img/loading.gif" lazyload alt="image-20240713211951085"></p>
<p>钩子插件</p>
<p><img src="/../../../img/image-20240713212035743.png" srcset="/img/loading.gif" lazyload alt="image-20240713212035743"></p>
<h3 id="2-1-2-Jenkins创建任务"><a href="#2-1-2-Jenkins创建任务" class="headerlink" title="2.1.2 Jenkins创建任务"></a>2.1.2 Jenkins创建任务</h3><p>1、创建一个自由风格的任务</p>
<p><img src="/../../../img/image-20240713212510293.png" srcset="/img/loading.gif" lazyload alt="image-20240713212510293"></p>
<p>2、配置“丢弃旧的构建”</p>
<p><img src="/../../../img/image-20240713212535865.png" srcset="/img/loading.gif" lazyload alt="image-20240713212535865"></p>
<p>3、设置Git项目仓库信息</p>
<p><img src="/../../../img/image-20240713212641143.png" srcset="/img/loading.gif" lazyload alt="image-20240713212641143"></p>
<p>4、开启构建触发器，获取钩子地址（URL），并创建令牌（Token）</p>
<p><img src="/../../../img/image-20240713212707264.png" srcset="/img/loading.gif" lazyload alt="image-20240713212707264"></p>
<p>继续点下面的“高级” — “Generate”生成token令牌</p>
<p><img src="/../../../img/image-20240713212939235.png" srcset="/img/loading.gif" lazyload alt="image-20240713212939235"></p>
<p>5、设置构建步骤，添加Shell命令</p>
<p><img src="/../../../img/image-20240713215749779.png" srcset="/img/loading.gif" lazyload alt="image-20240713215749779"></p>
<h3 id="2-1-3-Gitlab配置钩子"><a href="#2-1-3-Gitlab配置钩子" class="headerlink" title="2.1.3 Gitlab配置钩子"></a>2.1.3 Gitlab配置钩子</h3><h4 id="1、解除钩子的局域网访问限制"><a href="#1、解除钩子的局域网访问限制" class="headerlink" title="1、解除钩子的局域网访问限制"></a>1、解除钩子的局域网访问限制</h4><p>用root用户登录gitlab，来到管理中心，选择“设置” — “网络”</p>
<p><img src="/../../../img/image-20240713214608889.png" srcset="/img/loading.gif" lazyload alt="image-20240713214608889"></p>
<p>在“出站点请求”—勾选“允许webhook”即可</p>
<p><img src="/../../../img/image-20240713214739435.png" srcset="/img/loading.gif" lazyload alt="image-20240713214739435"></p>
<p>在旧版中的设置截图如下：</p>
<p><img src="/../../../img/image-20240713213445476.png" srcset="/img/loading.gif" lazyload alt="image-20240713213445476"></p>
<p>都允许上</p>
<p><img src="/../../../img/image-20240713213504959.png" srcset="/img/loading.gif" lazyload alt="image-20240713213504959"></p>
<h4 id="2、gitlab配置钩子"><a href="#2、gitlab配置钩子" class="headerlink" title="2、gitlab配置钩子"></a>2、gitlab配置钩子</h4><p>进入webhook的设置页面</p>
<p><img src="/../../../img/image-20240713213629602.png" srcset="/img/loading.gif" lazyload alt="image-20240713213629602"></p>
<p>添加新的webhook</p>
<p><img src="/../../../img/image-20240713213852380.png" srcset="/img/loading.gif" lazyload alt="image-20240713213852380"></p>
<p>再勾上“合并请求事件”，取消勾选“SSL验证”</p>
<p><img src="/../../../img/image-20240713214038102.png" srcset="/img/loading.gif" lazyload alt="image-20240713214038102"></p>
<p>提示：</p>
<blockquote>
<p>如果不做第1步的解除限制，在这会报错</p>
<p><img src="/../../../img/image-20240713214217352.png" srcset="/img/loading.gif" lazyload alt="image-20240713214217352"></p>
</blockquote>
<h3 id="2-1-4-测试执行"><a href="#2-1-4-测试执行" class="headerlink" title="2.1.4 测试执行"></a>2.1.4 测试执行</h3><p>1、先进行推送测试，返回HTTP 200即为正常</p>
<p><img src="/../../../img/image-20240713215311527.png" srcset="/img/loading.gif" lazyload alt="image-20240713215311527"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>2、在Jenkins看测试结果，成功收到一条推送</p>
<p><img src="/../../../img/image-20240713220021961.png" srcset="/img/loading.gif" lazyload alt="image-20240713220021961"></p>
<p>3、站点也部署成功</p>
<p><img src="/../../../img/image-20240713220134058.png" srcset="/img/loading.gif" lazyload alt="image-20240713220134058"></p>
<p>4、修改站点代码，自己推送测试</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 修改代码
$ cat index.html
hello4 myproj
&lt;title&gt;MyProj V4.0 Release&lt;&#x2F;tiltle&gt;

# 打新标签，推送
$ git add .
$ git commit -m &#39;v4.0&#39;
$ git tag -a &quot;v4.0&quot; -m &quot;v4.0&quot;
$ git push -u origin master
$ git push -u origin --tags
Enumerating objects: 1, done.
Counting objects: 100% (1&#x2F;1), done.
...
 * [new tag]         v4.0 -&gt; v4.0</code></pre></div></figure>

<p>5、推送完，查看jenkins，收到推送，并已经处理</p>
<p><img src="/../../../img/image-20240713222801538.png" srcset="/img/loading.gif" lazyload alt="image-20240713222801538"></p>
<p>6、访问站点，已经部署成功，成功实现代码在git上传后Jenkins自动部署</p>
<p><img src="/../../../img/image-20240713222827973.png" srcset="/img/loading.gif" lazyload alt="image-20240713222827973"></p>
<h1 id="三、案例05：Java代码上线"><a href="#三、案例05：Java代码上线" class="headerlink" title="三、案例05：Java代码上线"></a>三、案例05：Java代码上线</h1><p>步骤概览：</p>
<ul>
<li>java程序的源代码存放在了代码仓库中.</li>
<li>通过jk拉取java源代码,通过工具(maven,gradle)对代码进行编译,最终生成war或jar包.</li>
<li>通过jk,分发部署,重启服务.</li>
</ul>
<h2 id="3-1-环境准备"><a href="#3-1-环境准备" class="headerlink" title="3.1 环境准备"></a>3.1 环境准备</h2><table>
<thead>
<tr>
<th>主机</th>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>gitlab</td>
<td>代码仓库</td>
<td>10.0.0.71&#x2F;172.16.1.71</td>
</tr>
<tr>
<td>jenkins</td>
<td>jenkins</td>
<td>10.0.0.72&#x2F;172.16.1.72</td>
</tr>
<tr>
<td>web03</td>
<td>tomcat+jdk</td>
<td>10.0.0.9&#x2F;172.16.1.9</td>
</tr>
<tr>
<td>lb01</td>
<td>负载均衡</td>
<td>10.0.0.5&#x2F;172.16.1.5</td>
</tr>
</tbody></table>
<h2 id="3-2-详细步骤"><a href="#3-2-详细步骤" class="headerlink" title="3.2 详细步骤"></a>3.2 详细步骤</h2><p>步骤总览：</p>
<ul>
<li>手动上传代码到gitlab</li>
<li>手动在jenkins上拉取代码</li>
<li>手动通过maven编译代码生成war&#x2F;jar包</li>
<li>war包改名为ROOT.war</li>
<li>部署<ul>
<li>war包发送到web节点</li>
<li>war包部署在webapp&#x2F;目录中</li>
<li>重启tomcat</li>
</ul>
</li>
</ul>
<h3 id="3-2-1-代码上传到gitlab"><a href="#3-2-1-代码上传到gitlab" class="headerlink" title="3.2.1 代码上传到gitlab"></a>3.2.1 代码上传到gitlab</h3><p>1、gitlab创建空白项目<code>hello-world-war</code></p>
<p><img src="/../../../img/image-20240716094835318.png" srcset="/img/loading.gif" lazyload alt="image-20240716094835318"></p>
<p>2、从gitee获取需要的源码</p>
<p>代码获取：<a target="_blank" rel="noopener" href="https://github.com/efsavage/hello-world-war">https://github.com/efsavage/hello-world-war</a></p>
<p>3、把源码上传到gitlab的项目中</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">git init
git remote add origin git@gitlab.test.cn:dev&#x2F;hello-world-war.git
git status
git add .
git commit -m &#39;添加源码&#39;
git tag -a v1.0 -m v1.0
git push origin master
git push -u origin --tags</code></pre></div></figure>



<h3 id="3-2-2-jenkins服务器部署maven"><a href="#3-2-2-jenkins服务器部署maven" class="headerlink" title="3.2.2 jenkins服务器部署maven"></a>3.2.2 jenkins服务器部署maven</h3><p>mvn会读取项目中的pom.xml文件，实现自动化编译</p>
<p>1、安装JDK</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@devops02 ~]#java --version
java 17.0.11 2024-04-16 LTS
Java(TM) SE Runtime Environment (build 17.0.11+7-LTS-207)
Java HotSpot(TM) 64-Bit Server VM (build 17.0.11+7-LTS-207, mixed mode, sha</code></pre></div></figure>

<p>2、获取maven二进制包，配置环境变量</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 下载
wget https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;maven&#x2F;maven-3&#x2F;3.9.8&#x2F;binaries&#x2F;apache-maven-3.9.8-bin.tar.gz

# 部署
[root@devops02 &#x2F;app&#x2F;rpms]#mkdir &#x2F;app&#x2F;tools
[root@devops02 &#x2F;app&#x2F;rpms]#tar -xf apache-maven-3.9.8-bin.tar.gz -C &#x2F;app&#x2F;tools&#x2F;
[root@devops02 &#x2F;app&#x2F;rpms]#ln -s &#x2F;app&#x2F;tools&#x2F;apache-maven-3.9.8&#x2F; &#x2F;app&#x2F;tools&#x2F;maven

# 设置环境变量
[root@devops02 &#x2F;app&#x2F;rpms]#echo &quot;export PATH&#x3D;&#x2F;app&#x2F;tools&#x2F;maven&#x2F;bin:$PATH&quot; &gt;&gt; &#x2F;etc&#x2F;profile
[root@devops02 &#x2F;app&#x2F;rpms]#source &#x2F;etc&#x2F;profile

# 查看版本信息
[root@devops02 &#x2F;app&#x2F;rpms]#mvn --version
Apache Maven 3.9.8 (36645f6c9b5079805ea5009217e36f2cffd34256)
Maven home: &#x2F;app&#x2F;tools&#x2F;maven
Java version: 17.0.11, vendor: Oracle Corporation, runtime: &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;jdk-17-oracle-x64
Default locale: en_US, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;3.10.0-1160.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix</code></pre></div></figure>

<p>3、设置mvn国内下载源（加速）</p>
<p>编辑<code>/app/tools/maven/conf/settings.xml</code></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">&lt;mirrors&gt; # 在此标签后面添加
    &lt;mirror&gt;
      &lt;id&gt;aliyun-maven&lt;&#x2F;id&gt;
      &lt;mirrorOf&gt;*&lt;&#x2F;mirrorOf&gt;
      &lt;name&gt;阿里云公共仓库&lt;&#x2F;name&gt;
      &lt;url&gt;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;public&lt;&#x2F;url&gt;
  &lt;&#x2F;mirror&gt;</code></pre></div></figure>

<h3 id="3-2-3-jenkins拉取代码与手动编译"><a href="#3-2-3-jenkins拉取代码与手动编译" class="headerlink" title="3.2.3 jenkins拉取代码与手动编译"></a>3.2.3 jenkins拉取代码与手动编译</h3><p>1、配置maven工具的路径</p>
<p>进入“系统管理”—“全局工具配置”</p>
<p>手动改指定<code>settings.xml</code>文件的路径</p>
<p><img src="/../../../img/image-20240716101220613.png" srcset="/img/loading.gif" lazyload alt="image-20240716101220613"></p>
<p>手动指定maven工具的路径</p>
<p><img src="/../../../img/image-20240716101242040.png" srcset="/img/loading.gif" lazyload alt="image-20240716101242040"></p>
<p>2、创建jk自由风格项目</p>
<p><img src="/../../../img/image-20240716100737824.png" srcset="/img/loading.gif" lazyload alt="image-20240716100737824"></p>
<p>3、配置Git项目信息和ssh密钥</p>
<p><img src="/../../../img/image-20240716100817753.png" srcset="/img/loading.gif" lazyload alt="image-20240716100817753"></p>
<p>4、配置maven编译选项</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maven clean package
# 删除已有的target目录，重新编译生成war&#x2F;jar包</code></pre></div></figure>

<p><img src="/../../../img/image-20240716105310410.png" srcset="/img/loading.gif" lazyload alt="image-20240716105310410"></p>
<h3 id="3-2-4-运行项目生成war包"><a href="#3-2-4-运行项目生成war包" class="headerlink" title="3.2.4 运行项目生成war包"></a>3.2.4 运行项目生成war包</h3><p>1、第一次运行失败，在生成war包时出现错误</p>
<p><img src="/../../../img/image-20240716105543157.png" srcset="/img/loading.gif" lazyload alt="image-20240716105543157"></p>
<p>2、问题原因：项目中指定的<code>maven-war-plugin</code>插件版本过低</p>
<p>解决方法：修改项目<code>pom.xml</code>文件，将插件版本改为<code>3.1.1</code>，并重新上传至gitlab</p>
<p><img src="/../../../img/image-20240716105751359.png" srcset="/img/loading.gif" lazyload alt="image-20240716105751359"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41062276/article/details/120214674">https://blog.csdn.net/qq_41062276/article/details/120214674</a></p>
<p>3、再次运行，生成成功</p>
<p><img src="/../../../img/image-20240716105853153.png" srcset="/img/loading.gif" lazyload alt="image-20240716105853153"></p>
<h3 id="3-2-5-war包部署（手动实现）"><a href="#3-2-5-war包部署（手动实现）" class="headerlink" title="3.2.5 war包部署（手动实现）"></a>3.2.5 war包部署（手动实现）</h3><p>1、配置jenkins服务器到tomcat服务器的密钥认证</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@devops02 &#x2F;app&#x2F;tools&#x2F;maven&#x2F;bin]#ssh-copy-id root@172.16.1.9</code></pre></div></figure>

<p>2、将war包拷贝到tomcat服务器，改名为<code>ROOT.war</code></p>
<blockquote>
<p>war包生成路径：<code>/var/lib/jenkins/workspace/05-hello-war-job/target/hello-world-war-1.0.0.war</code></p>
</blockquote>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@devops02 &#x2F;app&#x2F;tools&#x2F;maven&#x2F;bin]#scp &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;05-hello-war-job&#x2F;target&#x2F;hello-world-war-1.0.0.war 172.16.1.9:&#x2F;opt&#x2F;ROOT.war</code></pre></div></figure>

<p>3、配置tomcat项目目录</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 清理以前的war包
[root@web03 &#x2F;opt]#rm &#x2F;app&#x2F;tools&#x2F;tomcat&#x2F;webapps&#x2F;ROOT* -fr

# 部署新的war包，并重启服务
[root@web03 &#x2F;opt]#mv &#x2F;opt&#x2F;ROOT.war &#x2F;app&#x2F;tools&#x2F;tomcat&#x2F;webapps&#x2F;
[root@web03 &#x2F;opt]#systemctl restart tomcat</code></pre></div></figure>

<p>4、测试访问：<a target="_blank" rel="noopener" href="http://10.0.0.9:8080/">http://10.0.0.9:8080</a></p>
<p><img src="/../../../img/image-20240716111424306.png" srcset="/img/loading.gif" lazyload alt="image-20240716111424306"></p>
<h3 id="3-2-6-war包部署（jenkins实现）"><a href="#3-2-6-war包部署（jenkins实现）" class="headerlink" title="3.2.6 war包部署（jenkins实现）"></a>3.2.6 war包部署（jenkins实现）</h3><p>jenkins添加shell命令步骤</p>
<p><img src="/../../../img/image-20240716112858722.png" srcset="/img/loading.gif" lazyload alt="image-20240716112858722"></p>
<p>脚本如下：</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">echo &quot;您当前部署的代码版本为: $&#123;TAG_NAME&#125;&quot;
echo &quot;您任务的URL地址:$&#123;JOB_DISPLAY_URL&#125;&quot;

# .vars
date&#x3D;$(date +%F)

# web_list后面可以设置为参数化构建,文本参数
web_list&#x3D;&quot;172.16.1.9&quot;

# 路径 $WORKSPACE
src_dir&#x3D;.&#x2F;target&#x2F;
dst_dir&#x3D;&#x2F;opt&#x2F;

# web节点的变量
code_dir&#x3D;&#x2F;app&#x2F;tools&#x2F;tomcat&#x2F;webapps&#x2F;ROOT
code_file&#x3D;&#x2F;app&#x2F;tools&#x2F;tomcat&#x2F;webapps&#x2F;ROOT.war

# 1. 分发
fenfa() &#123;
  for ip in $&#123;web_list&#125;
  do
    scp $&#123;src_dir&#125;&#x2F;hello-world-war-1.0.0.war root@$&#123;ip&#125;:$&#123;dst_dir&#125;
  done
&#125;

# 2、部署
deploy() &#123;
  for ip in $&#123;web_list&#125;
  do
    # 进入&#x2F;opt文件夹
    ssh root@$&#123;ip&#125; &quot;cd $&#123;dst_dir&#125;;
    # 改war包名字 ROOT-时间.war
    mv hello-world-war-1.0.0.war ROOT-$&#123;date&#125;.war;
    [ -d $&#123;code_dir&#125; ] &amp;&amp; &#123;
      # 将war包、目录、按时间放到临时文件夹中
      mkdir -p &#x2F;tmp&#x2F;$&#123;date&#125;;
      mv $&#123;code_dir&#125; $&#123;code_file&#125; &#x2F;tmp&#x2F;$&#123;date&#125; ;
    &#125;;
    # 创建软连接
    ln -s $&#123;dst_dir&#125;&#x2F;ROOT-$&#123;date&#125;.war $&#123;code_file&#125;
    # 重启服务
    systemctl restart tomcat
    &quot;
  done
&#125; 

# 主函数
main() &#123;
  fenfa
  deploy
&#125;
main</code></pre></div></figure>

<p>执行测试成功</p>
<p><img src="/../../../img/image-20240716112955544.png" srcset="/img/loading.gif" lazyload alt="image-20240716112955544"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%BF%90%E7%BB%B4/" class="category-chain-item">运维</a>
  
  
    <span>></span>
    
  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" class="category-chain-item">（二）综合架构</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>day76-Devops-Jenkins(二)</div>
      <div>http://gsproj.github.io/2024/07/12/07_85期运维/03_自动化架构/day76-Devops-Jenkins-2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>GongSheng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年7月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/07/16/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day77-Devops-Jenkins-3/" title="day77-Devops-Jenkins(三)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">day77-Devops-Jenkins(三)</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/07/10/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day75-Devops-Jenkins-1/" title="day75-Devops-Jenkins(一)">
                        <span class="hidden-mobile">day75-Devops-Jenkins(一)</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.29.0/components/prism-core.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
