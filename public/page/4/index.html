<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gsproj.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="GongSheng Blog">
<meta property="og:url" content="http://gsproj.github.io/page/4/index.html">
<meta property="og:site_name" content="GongSheng Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="GongSheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://gsproj.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>GongSheng Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">GongSheng Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">山川異域，風月同天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/07/08/01_%E8%BF%90%E7%BB%B4/05-K8S/K8S%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85K8S/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/08/01_%E8%BF%90%E7%BB%B4/05-K8S/K8S%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85K8S/" class="post-title-link" itemprop="url">K8S系列(一)-安装K8S</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-08 23:05:17" itemprop="dateCreated datePublished" datetime="2021-07-08T23:05:17+08:00">2021-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:21:00" itemprop="dateModified" datetime="2022-07-06T15:21:00+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%94%EF%BC%89K8S/" itemprop="url" rel="index"><span itemprop="name">（五）K8S</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>课程目录：</p>
<blockquote>
<p>第一部分：K8S概念和架构</p>
<p>第二部分：K8S安装</p>
<p>​	kubeadm</p>
<p>​	二进制</p>
<p>第三部分：K8S核心概念</p>
<p>POD </p>
<p>CONTROLLER</p>
<p>SERVICE</p>
<p>INGRESS</p>
<p>RABC</p>
<p>HELM</p>
<p>持久化存储</p>
<p>第四部分：集群监控平台</p>
<p>第五部分：从零开始搭建高可用K8S集群</p>
<p>第六部分：在集群环境中部署项目</p>
</blockquote>
<h2 id="一、K8S概念和架构"><a href="#一、K8S概念和架构" class="headerlink" title="一、K8S概念和架构"></a>一、K8S概念和架构</h2><h3 id="1-K8S概述和特性"><a href="#1-K8S概述和特性" class="headerlink" title="1 K8S概述和特性"></a>1 K8S概述和特性</h3><h4 id="1-1-基本介绍"><a href="#1-1-基本介绍" class="headerlink" title="1.1 基本介绍"></a>1.1 基本介绍</h4><ul>
<li>K8S是谷歌在2014年开发的容器化集群管理系统</li>
<li>使用K8S可以进行容器化应用部署</li>
<li>使用K8S利于应用扩展</li>
<li>K8S目标是让部署容器化应用更加简洁和高效</li>
</ul>
<p>容器化部署的好处：</p>
<h4 id="1-2-K8S的特性和优势"><a href="#1-2-K8S的特性和优势" class="headerlink" title="1.2 K8S的特性和优势"></a>1.2 K8S的特性和优势</h4><p>自动装箱：自动部署应用容器</p>
<p>自我修复（自愈能力）： </p>
<p>水平扩展：副本数量增加</p>
<p>服务发现（负载均衡）：通过Service实现，为多个副本对外提供统一的入口，节点调度负载均衡</p>
<p>滚动更新：</p>
<p>版本回退：</p>
<p>密钥配置管理：不需要重新构建镜像，可以部署和更新密钥和应用配置</p>
<p>存储编排：</p>
<p>批处理：	</p>
<h3 id="2-K8S架构组件"><a href="#2-K8S架构组件" class="headerlink" title="2 K8S架构组件"></a>2 K8S架构组件</h3><h3 id="3-K8S核心概念"><a href="#3-K8S核心概念" class="headerlink" title="3 K8S核心概念"></a>3 K8S核心概念</h3><p>3.1 Pod</p>
<p>3.2 Controller</p>
<p>3.3 Service</p>
<h2 id="二、K8S安装"><a href="#二、K8S安装" class="headerlink" title="二、K8S安装"></a>二、K8S安装</h2><blockquote>
<p>master  192.168.44.146</p>
<p>node1	192.168.44.145</p>
<p>node2	192.168.44.144</p>
</blockquote>
<h3 id="1-kubeadm安装"><a href="#1-kubeadm安装" class="headerlink" title="1 kubeadm安装"></a>1 kubeadm安装</h3><h3 id="2-二进制安装"><a href="#2-二进制安装" class="headerlink" title="2 二进制安装"></a>2 二进制安装</h3><hr>
<p>生产环境通用需求：</p>
<p>​	服务的自动发现和负载均衡</p>
<p>​	自愈</p>
<p>​	一键升级和回滚</p>
<p>​	水平扩展（弹性伸缩） </p>
<h3 id="1-容器管理平台"><a href="#1-容器管理平台" class="headerlink" title="1 容器管理平台"></a>1 容器管理平台</h3><p>docker swarm</p>
<p>messos</p>
<p>marathon</p>
<p>kubernetes  (90%市场)</p>
<h2 id="2-K8S发展"><a href="#2-K8S发展" class="headerlink" title="2 K8S发展"></a>2 K8S发展</h2><p>发布频繁，一年4个版本	</p>
<h3 id="3-核心组件"><a href="#3-核心组件" class="headerlink" title="3 核心组件"></a>3 核心组件</h3><h2 id="二、K8S安装-1"><a href="#二、K8S安装-1" class="headerlink" title="二、K8S安装"></a>二、K8S安装</h2><blockquote>
<p>K8S安装方式很多：</p>
<ul>
<li>源码编译安装 ：golang编译环境</li>
<li>二进制安装 ：文档，全程手动，ansible等</li>
<li>kubeadm安装：网络要求</li>
<li>minikube ：开发者学习</li>
<li>yum安装</li>
</ul>
<p>这里使用yum安装的方法</p>
</blockquote>
<h3 id="1-虚拟机准备"><a href="#1-虚拟机准备" class="headerlink" title="1 虚拟机准备"></a>1 虚拟机准备</h3><blockquote>
<p>centos7, 1CPU 1G</p>
<p>设置主机名，<strong>添加hosts解析</strong></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">k8s-master  --  10.0.0.21
k8s-node1   --  10.0.0.22
k8s-node2   --  10.0.0.23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>配置Centos7源和epel7源</p>
<pre class="line-numbers language-he" data-language="he"><code class="language-he">curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo
yum clean all
yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-Master节点安装"><a href="#2-Master节点安装" class="headerlink" title="2 Master节点安装"></a>2 Master节点安装</h3><h4 id="2-1-安装docker"><a href="#2-1-安装docker" class="headerlink" title="2.1 安装docker"></a>2.1 安装docker</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install docker -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-2-安装etcd"><a href="#2-2-安装etcd" class="headerlink" title="2.2 安装etcd"></a>2.2 安装etcd</h4><blockquote>
<p>etcd是一个nosql数据库</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install etcd -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改etcd配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;etcd&#x2F;etcd.conf
ETCD_LISTEN_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;0.0.0.0:2379&quot;
ETCD_ADVERTISE_CLIENT_URLS&#x3D;&quot;http:&#x2F;&#x2F;10.0.0.21:2379&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>启动etcd服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl enable etcd
systemctl restart etcd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>测试etcd</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">etcdctl set testdir&#x2F;testkey0 0
etcdctl get testdir&#x2F;testkey0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>etcdctl相关设置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">etcdctl -C http:&#x2F;&#x2F;10.0.0.21:2379 cluster-health<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-3-安装k8s服务"><a href="#2-3-安装k8s服务" class="headerlink" title="2.3 安装k8s服务"></a>2.3 安装k8s服务</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install kubernetes-master -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置文件修改</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;kubernetes&#x2F;apiserver
KUBE_API_ADDRESS&#x3D;&quot;--insecure-bind-address&#x3D;0.0.0.0&quot;
KUBE_API_PORT&#x3D;&quot;--port&#x3D;8080&quot;
KUBE_ETCD_SERVERS&#x3D;&quot;--etcd-servers&#x3D;http:&#x2F;&#x2F;10.0.0.21:2379&quot;
# 23行删除ServiceAccount，如下
KUBE_ADMISSION_CONTROL&#x3D;&quot;--admission-control&#x3D;NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota&quot; # <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;kubernetes&#x2F;config
KUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;10.0.0.21:8080&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>开放防火墙端口【重要】</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">firewall-cmd --zone&#x3D;public --add-port&#x3D;2379&#x2F;tcp --permanent
firewall-cmd --zone&#x3D;public --add-port&#x3D;8080&#x2F;tcp --permanent
firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>启动服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl enable kube-apiserver
systemctl restart kube-apiserver
systemctl enable kube-controller-manager
systemctl restart kube-controller-manager
systemctl enable kube-scheduler
systemctl restart kube-scheduler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-Node节点安装"><a href="#3-Node节点安装" class="headerlink" title="3 Node节点安装"></a>3 Node节点安装</h3><h4 id="3-1-安装k8s-node服务"><a href="#3-1-安装k8s-node服务" class="headerlink" title="3.1 安装k8s-node服务"></a>3.1 安装k8s-node服务</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install kubernetes-node<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>编辑配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;kubernetes&#x2F;config
KUBE_MASTER&#x3D;&quot;--master&#x3D;http:&#x2F;&#x2F;10.0.0.21:8080&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;kubernetes&#x2F;kubelet
KUBELET_ADDRESS&#x3D;&quot;--address&#x3D;0.0.0.0&quot;
KUBELET_PORT&#x3D;&quot;--port&#x3D;10250&quot;
KUBELET_HOSTNAME&#x3D;&quot;--hostname-override&#x3D;10.0.0.22&quot;
KUBELET_API_SERVER&#x3D;&quot;--api-servers&#x3D;http:&#x2F;&#x2F;10.0.0.21:8080&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl enable kubelet
systemctl restart kubelet
systemctl enable kube-proxy
systemctl restart kube-proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-2-fannel网络服务安装"><a href="#3-2-fannel网络服务安装" class="headerlink" title="3.2 fannel网络服务安装"></a>3.2 fannel网络服务安装</h4><blockquote>
<p>用于节点之间通信</p>
</blockquote>
<p>所有节点安装并配置fannel</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install flannel -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;sysconfig&#x2F;flanneld
FLANNEL_ETCD_ENDPOINTS&#x3D;&quot;http:&#x2F;&#x2F;10.0.0.21:2379&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">etcdctl mk &#x2F;atomic.io&#x2F;network&#x2F;config &#39;&#123;&quot;Network&quot;:&quot;172.16.0.0&#x2F;16&quot;&#125;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>重新启动服务—Master节点</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl enable fanneld
systemctl restart fanneld
systemctl restart kube-apiserver
systemctl restart kube-controller-manager
systemctl restart kube-scheduler	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重新启动服务—Node节点</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl enable fanneld
systemctl restart fanneld
systemctl restart kubelet
systemctl restart kube-proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-配置Master为镜像服务器"><a href="#4-配置Master为镜像服务器" class="headerlink" title="4 配置Master为镜像服务器"></a>4 配置Master为镜像服务器</h3><h2 id="三、K8S使用"><a href="#三、K8S使用" class="headerlink" title="三、K8S使用"></a>三、K8S使用</h2><p>1 查看节点</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl get nodes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2 查看服务状态</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl get componentstatus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="1-Pod使用"><a href="#1-Pod使用" class="headerlink" title="1 Pod使用"></a>1 Pod使用</h3><p>创建pod</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl create -f k8s_pod.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>删除pod</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">kubectl delete pod oldboy
kubectl delete pod --all 删除所有<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查看pod</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl get pods
kubectl get pods -o wides<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查看pod详细信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl descripe pod nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 更新</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl replace xxxx.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="1-1-创建一个pod-为什么要启动两个容器？"><a href="#1-1-创建一个pod-为什么要启动两个容器？" class="headerlink" title="1.1 创建一个pod,为什么要启动两个容器？"></a>1.1 创建一个pod,为什么要启动两个容器？</h4><blockquote>
<p>一个pod中可以挂多个容器</p>
</blockquote>
<p>比如创建一个niginx pod，将启动一个pod容器，一个nginx容器</p>
<p>Pod容器172.16.18.2</p>
<p>Nginx容器，共用pod容器ip</p>
<p>主要通过用POD来实现K8S的高级功能</p>
<h4 id="1-2-rc副本控制器的使用"><a href="#1-2-rc副本控制器的使用" class="headerlink" title="1.2 rc副本控制器的使用"></a>1.2 rc副本控制器的使用</h4><p>通过rc保证容器高可用</p>
<p>调整rc副本数</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl scale rc myweb --replicates&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="1-3-利用rc实现滚动升级和一键回滚"><a href="#1-3-利用rc实现滚动升级和一键回滚" class="headerlink" title="1.3 利用rc实现滚动升级和一键回滚"></a>1.3 利用rc实现滚动升级和一键回滚</h4><p>案例：nginx 1.13升级1.15</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 每5s升级一个
kubectl rolling-update myweb -f nginx-rc1.15.yaml --update-period&#x3D;5s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>案例：nginx1.15回滚到1.13</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl rolling-update mywebv2 -f nginx-rc1.13.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="service的创建和访问"><a href="#service的创建和访问" class="headerlink" title="service的创建和访问"></a>service的创建和访问</h3><blockquote>
<p>外部访问容器，端口映射</p>
</blockquote>
<h4 id="K8S小结"><a href="#K8S小结" class="headerlink" title="K8S小结"></a>K8S小结</h4><p>1 端口30000开始？</p>
<p>2 查看yml字段编写帮助</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl explain svc.spec<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/07/07/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%8D%81-Dokcer%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92docker-compose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/07/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%8D%81-Dokcer%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92docker-compose/" class="post-title-link" itemprop="url">Docker系列(十)-Dokcer单机编排docker-compose</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-07 09:51:12" itemprop="dateCreated datePublished" datetime="2021-07-07T09:51:12+08:00">2021-07-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:45" itemprop="dateModified" datetime="2022-07-06T15:19:45+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>docker-compose 单机版的容器编排工具</p>
</blockquote>
<h2 id="一、安装docker-compose"><a href="#一、安装docker-compose" class="headerlink" title="一、安装docker-compose"></a>一、安装docker-compose</h2><p>添加Centos7的epel源</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">curl -o epel-7.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo
yum clean all
yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>安装pip</p>
<blockquote>
<p>Python 2.7已于2020年1月1日到期，请停止使用。请升级您的Python，因为不再维护Python 2.7。pip 21.0将于2021年1月停止对Python 2.7的支持。pip 21.0将删除对此功能的支持。因此安装&lt;21.0的版本</p>
</blockquote>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">yum install -y python2-pip
pip install --upgrade &quot;pip &lt; 21.0&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>安装docker-compose</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip install docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建文件夹用于存放docker-compose脚本</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkdir &#x2F;opt&#x2F;docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="一、案例：compose构建wordpress并使用nginx负载均衡"><a href="#一、案例：compose构建wordpress并使用nginx负载均衡" class="headerlink" title="一、案例：compose构建wordpress并使用nginx负载均衡"></a>一、案例：compose构建wordpress并使用nginx负载均衡</h2><p>docker01主机创建docker-compose文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;opt&#x2F;docker-compose&#x2F;wordpress&#x2F;docker-compose.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db_data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> somewordpress
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> wordpress
      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> wordpress

  <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> web_data<span class="token punctuation">:</span>/var/www/html
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">"80"</span>  <span class="token comment"># 随机端口映射到内网80端口</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
     <span class="token key atrule">WORDPRESS_DB_HOST</span><span class="token punctuation">:</span> db<span class="token punctuation">:</span><span class="token number">3306</span>
     <span class="token key atrule">WORDPRESS_DB_USER</span><span class="token punctuation">:</span> wordpress
     <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span> wordpress
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">db_data</span><span class="token punctuation">:</span>
  web_data<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构建Docker容器(三个wordpress，一个mysql）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker-compose up --scale wordpress&#x3D;3 -d
-d 后台运行
--scale 生成的实例数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-she" data-language="she"><code class="language-she">netstaus -lntup可以看到3个连续的端口号
tcp        0      0 0.0.0.0:49156           0.0.0.0:*               LISTEN      2110&#x2F;docker-proxy
tcp        0      0 0.0.0.0:49157           0.0.0.0:*               LISTEN      2126&#x2F;docker-proxy
tcp        0      0 0.0.0.0:49158           0.0.0.0:*               LISTEN      2143&#x2F;docker-proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>docker02主机安装nginx，用于负载均衡</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">curl -o epel-7.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo
yum clean all
yum makecache
yum install nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>配置nginx</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">cd &#x2F;etc&#x2F;nginx&#x2F;
mv nginx.conf nginx.conf.bak
grep -Ev &#39;^$|#&#39; nginx.conf.default  &gt; nginx.conf
vim nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">worker_processes  1;
events &#123;
    worker_connections  1024;
&#125;
http &#123;
    include       mime.types;
    default_type  application&#x2F;octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    upstream wordpress &#123;
        server 10.0.0.11:49156;
        server 10.0.0.11:49157;
        server 10.0.0.11:49158;
    &#125;

    server &#123;
        listen       80;
        server_name  localhost;
        location &#x2F; &#123;
            proxy_pass  http:&#x2F;&#x2F;wordpress;
            proxy_set_header Host $host;  # 不加上网页没有Host信息，显示不全
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重启nginx服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nginx -t
systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>测试访问</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">浏览器访问:10.0.0.12,可以进入wordpress<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看是否负载均衡</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创建一个查看信息的页面
cd &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;wordpress_web_data&#x2F;_data&#x2F;
vim info.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>浏览器访问：10.0.0.12&#x2F;info.php，查看其中IP信息</p>
<h2 id="二、案例：构建zabbix"><a href="#二、案例：构建zabbix" class="headerlink" title="二、案例：构建zabbix"></a>二、案例：构建zabbix</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B9%9D-Dokcer%E8%B7%A8%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B9%9D-Dokcer%E8%B7%A8%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/" class="post-title-link" itemprop="url">Docker系列(九)-Dokcer跨主机容器互连</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-06 21:21:33" itemprop="dateCreated datePublished" datetime="2021-07-06T21:21:33+08:00">2021-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:18" itemprop="dateModified" datetime="2022-07-06T15:19:18+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、Docker容器的四种网络类型"><a href="#一、Docker容器的四种网络类型" class="headerlink" title="一、Docker容器的四种网络类型"></a>一、Docker容器的四种网络类型</h2><blockquote>
<p>哪四种？</p>
<ul>
<li>bridge（默认）：NAT桥接模式</li>
<li>none：不分配网络，什么服务都访问不了</li>
<li>host：与宿主机共享网络，共享主机名，端口共用(宿主机用了的端口，容器也不能用)，【网络性能最高】</li>
<li>container:容器id：与容器xx共享网络，共享主机名、hosts、hostname、端口等….【K8S常用】</li>
</ul>
</blockquote>
<h3 id="1-指定与查看容器网络类型的方法"><a href="#1-指定与查看容器网络类型的方法" class="headerlink" title="1 指定与查看容器网络类型的方法"></a>1 指定与查看容器网络类型的方法</h3><p>指定容器网络类型</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --network none # 指定网络类型<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看容器网络类型</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker instpect 容器id # 可以查看当前的容器网络类型
# 查看字段
&quot;NetworkSettings&quot;: &#123;
	&quot;Bridge&quot;: &quot;&quot;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看有哪些网络类型</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker network ls # 查看有哪些网络类型<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="二、使用macvlan实现"><a href="#二、使用macvlan实现" class="headerlink" title="二、使用macvlan实现"></a>二、使用macvlan实现</h2><blockquote>
<p>优势：</p>
<p>​	性能比overlay高</p>
<p>​	不用做端口映射，外界可直接访问</p>
<p>劣势：</p>
<p>​	IP需要手动指定</p>
</blockquote>
<h3 id="1-案例：使用macvlan实现两个centos6-9-ssh容器跨主机网络通信"><a href="#1-案例：使用macvlan实现两个centos6-9-ssh容器跨主机网络通信" class="headerlink" title="1 案例：使用macvlan实现两个centos6.9_ssh容器跨主机网络通信"></a>1 案例：使用macvlan实现两个centos6.9_ssh容器跨主机网络通信</h3><blockquote>
<p>宿主机信息（虚拟机）：</p>
<p>​	docker01: 10.0.0.11 网关: 10.0.0.2</p>
<p>​	docker02: 10.0.0.12 网关: 10.0.0.2</p>
</blockquote>
<p>宿主机1,2分别创建macvlan</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker network create --driver macvlan --subnet 10.0.0.0&#x2F;24 --gateway 10.0.0.2 -o parent&#x3D;ens33 macvlan_1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置网卡为混杂模式【Ubuntu需要设置】</p>
<blockquote>
<p>混杂模式是计算机网络中的术语。 是指一台机器的网卡能够接收所有经过它的数据流，而不论其目的地址是否是它。</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ip link set ens33 promisc on<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>宿主机1,2分别使用centos7.9_ssh:v2镜像创建容器，并指定为macvlan_1网络</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># docker01
docker run -d --network macvlan_1 --ip&#x3D;10.0.0.100 centos6.9_ssh:v2
# docker02
docker run -d --network macvlan_1 --ip&#x3D;10.0.0.200 centos6.9_ssh:v2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试，docker exec进入docker01中运行容器，开启抓包，并使用docker02中的容器ping它</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tcpdump icmp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通过xshell或者mobaxterm可以直接ssh到容器中 (PS:并没有 -p 22端口)</p>
<blockquote>
<p>实际测试宿主机并不能ssh到容器，显示No route to host，但是物理机可以连接</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ssh root@10.0.0.100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="三、使用overlay实现"><a href="#三、使用overlay实现" class="headerlink" title="三、使用overlay实现"></a>三、使用overlay实现</h2><blockquote>
<p>优势：</p>
<p>​	可以自动分配ip地址</p>
<p>劣势：</p>
<p>​	需要做端口映射才能访问容器服务</p>
<p>overlay参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/CloudMan6/p/7270551.html">https://www.cnblogs.com/CloudMan6/p/7270551.html</a></p>
</blockquote>
<h3 id="1-案例：使用overlay实现两个centos6-9-ssh容器跨主机网络通信"><a href="#1-案例：使用overlay实现两个centos6-9-ssh容器跨主机网络通信" class="headerlink" title="1 案例：使用overlay实现两个centos6.9_ssh容器跨主机网络通信"></a>1 案例：使用overlay实现两个centos6.9_ssh容器跨主机网络通信</h3><p>docker01启动consul</p>
<blockquote>
<p>consul是一个key:value类型的存储数据库</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 8500:8500 --restart&#x3D;always -h consul --name consul progrium&#x2F;consul -server -bootstrap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>docker01,02上设置daemon.json文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"hosts"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"tcp://0.0.0.0:2376"</span><span class="token punctuation">,</span><span class="token string">"unix:///var/run/docker.sock"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">"cluster-store"</span><span class="token operator">:</span><span class="token string">"consul://10.0.0.11:8500"</span><span class="token punctuation">,</span>
<span class="token property">"cluster-advertise"</span><span class="token operator">:</span><span class="token string">"10.0.0.11:2376"</span> # 此处不同，docker01为<span class="token number">10.0</span>.<span class="token number">0.11</span>，docker02为<span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>修改docker.service文件</p>
<blockquote>
<p>因为daemon.json中的hosts项与docker.service中的-H参数冲突，需要去掉</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service
ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H fd:&#x2F;&#x2F; --containerd&#x3D;&#x2F;run&#x2F;containerd&#x2F;containerd.sock
# 删除-H fd:&#x2F;&#x2F;
ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd --containerd&#x3D;&#x2F;run&#x2F;containerd&#x2F;containerd.sock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>重启docker服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl daemon-reload
systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>测试consul是否搭建成功</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">浏览器访问：http:&#x2F;&#x2F;10.0.0.11:8500&#x2F;
在KEY&#x2F;VALUE标签页正常显示10.0.0.11和12两台宿主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>docker01,02创建overlay网络</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker network create -d overlay --subnet 172.16.1.0&#x2F;24 --gateway 172.16.1.254 ol1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># docker01
docker run -d --network ol1 --name centos6.9_01 centos6.9_ssh:v2
# docker02
docker run -d --network ol1 --name centos6.9_02 centos6.9_ssh:v2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试容器间网络</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># docker01中的容器ping另一容器的hostname
[root@e1e8cc01792d &#x2F;]# ping centos6.9_02
PING centos6.9_02 (172.16.1.2) 56(84) bytes of data.
64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.197 ms
64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.269 ms
64 bytes from centos6.9_02.ol1 (172.16.1.2): icmp_seq&#x3D;3 ttl&#x3D;64 time&#x3D;1.04 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-Overlay的网络访问流程图"><a href="#2-Overlay的网络访问流程图" class="headerlink" title="2 Overlay的网络访问流程图"></a>2 Overlay的网络访问流程图</h3><img src="/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B9%9D-Dokcer%E8%B7%A8%E4%B8%BB%E6%9C%BA%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/overlay%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE.png" class="" title="overlay网络访问">


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AB-Docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/06/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AB-Docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">Docker系列(八)-Docker私有仓库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-06 13:58:52" itemprop="dateCreated datePublished" datetime="2021-07-06T13:58:52+08:00">2021-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:08" itemprop="dateModified" datetime="2022-07-06T15:19:08+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、官方私有仓库registry"><a href="#一、官方私有仓库registry" class="headerlink" title="一、官方私有仓库registry"></a>一、官方私有仓库registry</h2><h3 id="1-安装步骤"><a href="#1-安装步骤" class="headerlink" title="1 安装步骤"></a>1 安装步骤</h3><p>拉取私有仓库镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动私有仓库容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -di --name&#x3D;registry -p 5000:5000 registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>验证是否正常</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 浏览器输入
10.0.0.12:5000&#x2F;v2&#x2F;_catalog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改daemon.json，让 docker信任私有仓库地址</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vi &#x2F;etc&#x2F;docker&#x2F;daemon.json
# 添加
&#123;
	&quot;insecure-registries&quot;:[&quot;10.0.0.12:5000&quot;]
&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重启docker服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl reset-failed docker.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上传镜像到私有仓库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker push 10.0.0.11:5000&#x2F;registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>从私有仓库下载镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull http:&#x2F;&#x2F;10.0.0.12:5000&#x2F;registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="二、企业级私有仓库Harbor"><a href="#二、企业级私有仓库Harbor" class="headerlink" title="二、企业级私有仓库Harbor"></a>二、企业级私有仓库Harbor</h2><blockquote>
<p>Harbor：第三方registry组件</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a></p>
<p>老男孩强哥博客地址：<a target="_blank" rel="noopener" href="https://oldqiang.com/">https://oldqiang.com/</a></p>
</blockquote>
<h3 id="1-为什么使用Harbor"><a href="#1-为什么使用Harbor" class="headerlink" title="1 为什么使用Harbor"></a>1 为什么使用Harbor</h3><p>因为官方仓库registry存在诸多问题：</p>
<ul>
<li><p>https问题</p>
</li>
<li><p>网页简陋，查看镜像、删除镜像不方便</p>
</li>
<li><p>权限控制不方便（要么有权限，要么完全没权限），不支持多用户</p>
</li>
</ul>
<h3 id="2-Harbor安装步骤"><a href="#2-Harbor安装步骤" class="headerlink" title="2 Harbor安装步骤"></a>2 Harbor安装步骤</h3><blockquote>
<p>这里以v2.2.3为例</p>
</blockquote>
<p>离线安装包获取</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget https:&#x2F;&#x2F;github.com&#x2F;goharbor&#x2F;harbor&#x2F;releases&#x2F;download&#x2F;v2.2.3&#x2F;harbor-offline-installer-v2.2.3.tgz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解压文件，并修改配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tar -vxf harbor-offline-installer-v2.2.3.tgz
cd harbor&#x2F;
cp harbor.yml.tmpl harbor.yml
vim harbor.yml
# 注释https设置项，并修改以下内容
hostname &#x3D; 10.0.0.12  
harbor_admin_password &#x3D; 1qaz@WSX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行安装脚本（时间比较长）</p>
<blockquote>
<p>需要先安装docker-compose，</p>
<p><a href="https://gsproj.github.io/2021/07/07/Docker%E7%B3%BB%E5%88%97-%E5%8D%81-Dokcer%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92docker-compose/">docker-compose安装参考</a></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">.&#x2F;install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>网页访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">http:&#x2F;&#x2F;10.0.0.12
admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="3-镜像推送与下载"><a href="#3-镜像推送与下载" class="headerlink" title="3 镜像推送与下载"></a>3 镜像推送与下载</h3><p>docker配置文件添加白名单</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json
&quot;insecure-registries&quot;:[&quot;10.0.0.12&quot;],  # 不要加端口,可以是IP或域名，中间逗号隔开可加多个<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>镜像打标签</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull 10.0.0.12&#x2F;xxx&#x2F;centos6.9_ssh:v2   # xxx是仓库中的创建的项目名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>登录到仓库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker login 10.0.0.12<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>推送到仓库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker push 10.0.0.12&#x2F;xxx&#x2F;centos6.9_ssh:v2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>从仓库下载镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull 10.0.0.12&#x2F;xxx&#x2F;centos6.9_ssh:v2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-将Harbor升级为https访问"><a href="#4-将Harbor升级为https访问" class="headerlink" title="4 将Harbor升级为https访问"></a>4 将Harbor升级为https访问</h3><p>配置文件修改，主要是添加证书路径</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># https related config
https:
  # https port for harbor, default is 443
  port: 443
  # The path of cert and key files for nginx
  certificate: &#x2F;your&#x2F;certificate&#x2F;path
  private_key: &#x2F;your&#x2F;private&#x2F;key&#x2F;path<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再次执行安装脚本</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">.&#x2F;install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/07/05/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%83-Docker%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E4%B8%8E%E5%90%8C%E4%B8%BB%E6%9C%BA%E4%B8%AD%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/05/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%83-Docker%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E4%B8%8E%E5%90%8C%E4%B8%BB%E6%9C%BA%E4%B8%AD%E5%AE%B9%E5%99%A8%E4%BA%92%E8%BF%9E/" class="post-title-link" itemprop="url">Docker系列(七)-Docker镜像分层与同主机中容器互连</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-05 15:28:40" itemprop="dateCreated datePublished" datetime="2021-07-05T15:28:40+08:00">2021-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:35" itemprop="dateModified" datetime="2022-07-06T15:19:35+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、Docker镜像分层"><a href="#一、Docker镜像分层" class="headerlink" title="一、Docker镜像分层"></a>一、Docker镜像分层</h2><blockquote>
<p>镜像分层的好处：</p>
<p>​	复用、节省磁盘空间，相同的内容只需加载一份到内存</p>
<p>​	修改dockerfile后，重新构建时可以用缓存，速度快</p>
</blockquote>
<h3 id="1-查看docker镜像分层"><a href="#1-查看docker镜像分层" class="headerlink" title="1 查看docker镜像分层"></a>1 查看docker镜像分层</h3><p>通过导入镜像可以查看到镜像分层</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker load -i [镜像文件]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通过查看镜像历史可以查看到分层</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker01 ~]# docker image history centos6.9_ssh:v2
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
57761235f898   2 days ago    &#x2F;bin&#x2F;sh -c #(nop)  CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot; &quot;-D…   0B
c0a2c21457c4   2 days ago    &#x2F;bin&#x2F;sh -c echo &#39;123456&#39; | passwd --stdin ro…   537B
29d10ff8b8e0   2 days ago    &#x2F;bin&#x2F;sh -c service sshd restart                 4.91kB
666b9ddfff15   2 days ago    &#x2F;bin&#x2F;sh -c yum install openssh-server -y        154MB
5b00553af9fc   2 days ago    &#x2F;bin&#x2F;sh -c #(nop) ADD file:65a30e1b327fec80b…   1.18kB
2199b8eb8390   2 years ago   &#x2F;bin&#x2F;sh -c #(nop)  CMD [&quot;&#x2F;bin&#x2F;bash&quot;]            0B
&lt;missing&gt;      2 years ago   &#x2F;bin&#x2F;sh -c #(nop)  LABEL name&#x3D;CentOS Base Im…   0B
&lt;missing&gt;      2 years ago   &#x2F;bin&#x2F;sh -c #(nop) ADD file:0e6d175401c5b4260…   195MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所有的这些层都会在<code>Docker</code>主机本地存储区域内存储，可以通过以下指令来列出：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ls &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-通过Dockerfile优化分层信息"><a href="#2-通过Dockerfile优化分层信息" class="headerlink" title="2  通过Dockerfile优化分层信息"></a>2  通过Dockerfile优化分层信息</h3><ul>
<li>尽量合并RUN和ADD来减少镜像分层数</li>
<li>新加的Dockerfile语句加到最后，不要加到前面</li>
</ul>
<h2 id="二、同主机中容器互连（–link是单向的）"><a href="#二、同主机中容器互连（–link是单向的）" class="headerlink" title="二、同主机中容器互连（–link是单向的）"></a>二、同主机中容器互连（–link是单向的）</h2><blockquote>
<p>docker官方已不推荐使用docker run –link来链接2个容器互相通信，随后的版本中会删除–link</p>
</blockquote>
<h3 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1 功能介绍"></a>1 功能介绍</h3><p>docker run –link可以用来链接2个容器，使得源容器（被链接的容器）和接受容器（主动去链接的容器）之间可以互相通信，并且接收容器可以获取源容器的一些数据，如源容器的环境变量。使用案例如下：</p>
<p>源容器启动：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d --name src_docker nginx 
容器ID:xxxx01, IP:172.16.0.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>接受容器连接：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d --name dest_docker --link src_docker:web centos7.9:v2
容器ID:xxxx02, IP:172.16.0.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>进入接受容器测试，不需要ping IP，直接ping别名就可以，web和src_docker都指向172.16.0.2<font color=red>（单向）</font></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker exec -it xxxx01 &#x2F;bin&#x2F;bash
ping web
ping src_docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>接受容器的&#x2F;etc&#x2F;hosts将更新</p>
</blockquote>
<h3 id="2-案例：构建zabbix-server"><a href="#2-案例：构建zabbix-server" class="headerlink" title="2 案例：构建zabbix-server"></a>2 案例：构建zabbix-server</h3><p>启动一个mysql的容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name mysql-server -t \
      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \
      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \
      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \
      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \
      -d mysql:5.7 \
      --character-set-server&#x3D;utf8 --collation-server&#x3D;utf8_bin <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动java-gateway容器监控java服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name zabbix-java-gateway -t \
      -d zabbix&#x2F;zabbix-java-gateway:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>启动zabbix-mysql容器使用link连接mysql与java-gateway</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --name zabbix-server-mysql -t \
      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \
      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \
      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \
      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \
      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \
      -e ZBX_JAVAGATEWAY&#x3D;&quot;zabbix-java-gateway&quot; \
      --link mysql-server:mysql \
      --link zabbix-java-gateway:zabbix-java-gateway \
      -p 10051:10051 \
      -d zabbix&#x2F;zabbix-server-mysql:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动zabbix web显示，使用link连接zabbix-mysql与mysql</p>
<blockquote>
<p>zabbix的默认端口已有80改为8080，可见配置文件&#x2F;etc&#x2F;zabbix&#x2F;nginx.conf</p>
</blockquote>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">docker run --name zabbix-web-nginx-mysql -t \
      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \
      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \
      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \
      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \
      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \
      --link mysql-server:mysql \
      --link zabbix-server-mysql:zabbix-server \
      -p 8082:8080 \     
      -d zabbix&#x2F;zabbix-web-nginx-mysql:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>登录Zabbix</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">浏览器访问：10.0.0.11:8082
Admin
zabbix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>添加被监控节点-安装zabbix-agent</p>
<blockquote>
<p>获取zabbix-agent：</p>
<p>uname -a 查看内核版本</p>
<p>web页面查看zabbix版本</p>
<p><a target="_blank" rel="noopener" href="https://www.zabbix.com/download">https://www.zabbix.com/download</a> 获取对应agent的安装方法</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">rpm -Uvh https:&#x2F;&#x2F;repo.zabbix.com&#x2F;zabbix&#x2F;5.4&#x2F;rhel&#x2F;7&#x2F;x86_64&#x2F;zabbix-release-5.4-1.el7.noarch.rpm
yum clean all
yum install zabbix-agent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>添加被监控节点-agent配置文件修改</p>
<blockquote>
<p>117行：Server&#x3D;10.0.0.11, 注意防火墙和selinux的阻挡</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;zabbix&#x2F;zabbix_agentd.conf
systemctl restart zabbix-agent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="三、docker重启后容器不退出"><a href="#三、docker重启后容器不退出" class="headerlink" title="三、docker重启后容器不退出"></a>三、docker重启后容器不退出</h2><blockquote>
<p>默认情况下，systemctl restart docker之后，容器将处于Exited状态</p>
</blockquote>
<h3 id="1-添加容器启动参数"><a href="#1-添加容器启动参数" class="headerlink" title="1 添加容器启动参数"></a>1 添加容器启动参数</h3><blockquote>
<p>docker重启后，容器先停止，再立即重新启动</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --restart&#x3D;always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-daemon配置文件修改（不推荐）"><a href="#2-daemon配置文件修改（不推荐）" class="headerlink" title="2 daemon配置文件修改（不推荐）"></a>2 daemon配置文件修改（不推荐）</h3><blockquote>
<p>docker重启后，容器不会停止，一直在运行，不推荐使用，不好控制</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json
# 添加一行，上行后面加逗号
&quot;live-restore&quot;:true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>





<p>​	</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/30/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AD-Dockfile%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/30/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%85%AD-Dockfile%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Docker系列(六)-Dockfile的使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-30 08:43:52" itemprop="dateCreated datePublished" datetime="2021-06-30T08:43:52+08:00">2021-06-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:30" itemprop="dateModified" datetime="2022-07-06T15:19:30+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、Dokerfile简介"><a href="#一、Dokerfile简介" class="headerlink" title="一、Dokerfile简介"></a>一、Dokerfile简介</h2><blockquote>
<p>Dockerfile 是一个用来自动构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>建议存放在&#x2F;opt&#x2F;dockerfile中，如创建centosXX的镜像，则创建&#x2F;opt&#x2F;dockerfile&#x2F;centosXX&#x2F;Dockerfile</p>
</blockquote>
<h3 id="1-Dockerfile的简单使用"><a href="#1-Dockerfile的简单使用" class="headerlink" title="1 Dockerfile的简单使用"></a>1 Dockerfile的简单使用</h3><blockquote>
<p>创建一个开启sshd服务的centos6.9镜像</p>
</blockquote>
<p>创建yum源文件，用于拷贝到centos6.9镜像中</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;opt&#x2F;dockfile&#x2F;centos6.9_ssh
vim CentOS-Base.repo
...内容省略<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>创建Dockerfile文件&#x2F;opt&#x2F;dockfile&#x2F;centos6.9_ssh&#x2F;Dockerfile，内容如下：</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM centos:6.9
ADD CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d
RUN yum install openssh-server -y
RUN service sshd restart
RUN echo &#39;123456&#39; | passwd --stdin root
CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,&quot;-D&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>PS：RUN的执行过程：创建临时容器，执行命令，提交成临时镜像，删除临时容器，重复此步骤。</p>
</blockquote>
<p>构建镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker build -t centos6.9_ssh:v2 &#x2F;opt&#x2F;dockfile&#x2F;centos6.9_ssh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>PS：最后传入的是包含Dockerfile的文件夹，区分大小写，可以用”.”代替 </p>
</blockquote>
<p>验证镜像是否正常</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 1022:22 centos6.9_ssh:v2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>PS：最后不用接命令，将自动执行CMD指定的命令</p>
</blockquote>
<h3 id="2-小案例"><a href="#2-小案例" class="headerlink" title="2 小案例"></a>2 小案例</h3><blockquote>
<p>创建centos6.9 + ssh + nginx的Dockerfile</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker01 centos6.9_ssh_nginx]# pwd
&#x2F;opt&#x2F;dockfile&#x2F;centos6.9_ssh_nginx
[root@docker01 centos6.9_ssh_nginx]# ls
CentOS-Base.repo  Dockerfile  epel.repo  init.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># init.sh
#!&#x2F;bin&#x2F;bash
service sshd restart
nginx -g &quot;daemon off;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>编写Dockerfile</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FROM centos:6.9
ADD CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d
ADD epel.repo &#x2F;etc&#x2F;yum.repos.d
ADD init.sh &#x2F;root
RUN yum install openssh-server nginx -y
RUN echo &#39;123456&#39; | passwd --stdin root
CMD [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;&#x2F;root&#x2F;init.sh&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构建镜像</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">docker build -t centos6.9_ssh_nginx:v3 .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试使用</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 1022:22 -p 81:80 centos6.9_ssh_nginx:v3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="二、Docker指令"><a href="#二、Docker指令" class="headerlink" title="二、Docker指令"></a>二、Docker指令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">FROM</td>
<td align="left">基于那个镜像来构建</td>
</tr>
<tr>
<td align="left">MAINTAINER</td>
<td align="left">镜像的创建者</td>
</tr>
<tr>
<td align="left">ENV</td>
<td align="left">设置环境变量</td>
</tr>
<tr>
<td align="left">ADD</td>
<td align="left">添加宿主机文件到容器里，有需要解压的文件会自动解压</td>
</tr>
<tr>
<td align="left">COPY</td>
<td align="left">添加宿主机文件到容器里</td>
</tr>
<tr>
<td align="left">WORKDIR</td>
<td align="left">切换工作目录</td>
</tr>
<tr>
<td align="left">EXPOSE</td>
<td align="left">开放可用端口</td>
</tr>
<tr>
<td align="left">CMD</td>
<td align="left">容器启动后执行的命令，可被docker run指定的命令覆盖</td>
</tr>
<tr>
<td align="left">ENTRYPOINT</td>
<td align="left">容器启动后执行的命令，但不回被docker run指定的命令覆盖，如需覆盖，需要加–entrypoint参数</td>
</tr>
<tr>
<td align="left">VOLUME</td>
<td align="left">创建挂载卷，将宿主机的目录挂载到容器里</td>
</tr>
</tbody></table>
<h2 id="三、案例：Dockerfile构建可道云容器"><a href="#三、案例：Dockerfile构建可道云容器" class="headerlink" title="三、案例：Dockerfile构建可道云容器"></a>三、案例：Dockerfile构建可道云容器</h2><blockquote>
<p>项目：</p>
<p>​	可道云网盘kodexplorer</p>
<p>环境：</p>
<p>​	httpd+php或者nginx+php<br>​	php所需模块：php5.5以上<br>​	基础镜像：centos:7.9<br>​	项目下载地址: <a target="_blank" rel="noopener" href="http://static.kodcloud.com/update/download/kodexplorer4.37.zip">http://static.kodcloud.com/update/download/kodexplorer4.37.zip</a><br>​	项目官网：<a target="_blank" rel="noopener" href="https://kodcloud.com/download/">https://kodcloud.com/download/</a></p>
</blockquote>
<h3 id="1-手工部署一遍"><a href="#1-手工部署一遍" class="headerlink" title="1 手工部署一遍"></a>1 手工部署一遍</h3><blockquote>
<p>写Dockerfile前自己手动部署一遍，主要是nginx + php的搭建，参考博客</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1015237">https://cloud.tencent.com/developer/article/1015237</a></p>
</blockquote>
<p>修改nginx.conf</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># For more information on configuration, see:
#   * Official English Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;
#   * Official Russian Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;

user nginx;
worker_processes auto;
error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;
pid &#x2F;run&#x2F;nginx.pid;

# Load dynamic modules. See &#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx&#x2F;README.dynamic.
include &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;modules&#x2F;*.conf;

events &#123;
    worker_connections 1024;
&#125;

http &#123;
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             &#x2F;etc&#x2F;nginx&#x2F;mime.types;
    default_type        application&#x2F;octet-stream;

    # Load modular configuration files from the &#x2F;etc&#x2F;nginx&#x2F;conf.d directory.
    # See http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;ngx_core_module.html#include
    # for more information.
    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;

    server &#123;
        listen       80;
        listen       [::]:80;
        server_name  _;
        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;

        # Load configuration files for the default server block.
        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;

        error_page 404 &#x2F;404.html;
        location &#x3D; &#x2F;404.html &#123;
        &#125;

        error_page 500 502 503 504 &#x2F;50x.html;
        location &#x3D; &#x2F;50x.html &#123;
        &#125;

    	location ~ \.php$ &#123;
        try_files $uri &#x3D;404;
        fastcgi_pass unix:&#x2F;var&#x2F;run&#x2F;php-fpm&#x2F;php-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    	&#125;
	
    	location &#x2F; &#123;
        index  index.php index.html index.htm;
        try_files $uri $uri&#x2F; &#x2F;index.php?$args;
    	&#125;
    &#125;

# Settings for a TLS enabled server.
#
#    server &#123;
#        listen       443 ssl http2;
#        listen       [::]:443 ssl http2;
#        server_name  _;
#        root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;
#
#        ssl_certificate &quot;&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;server.crt&quot;;
#        ssl_certificate_key &quot;&#x2F;etc&#x2F;pki&#x2F;nginx&#x2F;private&#x2F;server.key&quot;;
#        ssl_session_cache shared:SSL:1m;
#        ssl_session_timeout  10m;
#        ssl_ciphers HIGH:!aNULL:!MD5;
#        ssl_prefer_server_ciphers on;
#
#        # Load configuration files for the default server block.
#        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;
#
#        error_page 404 &#x2F;404.html;
#            location &#x3D; &#x2F;40x.html &#123;
#        &#125;
#
#        error_page 500 502 503 504 &#x2F;50x.html;
#            location &#x3D; &#x2F;50x.html &#123;
#        &#125;
#    &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改php-fpm.conf</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">;;;;;;;;;;;;;;;;;;;;;
; FPM Configuration ;
;;;;;;;;;;;;;;;;;;;;;

; All relative paths in this configuration file are relative to PHP&#39;s install
; prefix.

; Include one or more files. If glob(3) exists, it is used to include a bunch of
; files from a glob(3) pattern. This directive can be used everywhere in the
; file.
include&#x3D;&#x2F;etc&#x2F;php-fpm.d&#x2F;*.conf

;;;;;;;;;;;;;;;;;;
; Global Options ;
;;;;;;;;;;;;;;;;;;

[global]
; Pid file
; Default Value: none
pid &#x3D; &#x2F;run&#x2F;php-fpm&#x2F;php-fpm.pid

; Error log file
; Default Value: &#x2F;var&#x2F;log&#x2F;php-fpm.log
error_log &#x3D; &#x2F;var&#x2F;log&#x2F;php-fpm&#x2F;error.log

; Log level
; Possible Values: alert, error, warning, notice, debug
; Default Value: notice
;log_level &#x3D; notice

; If this number of child processes exit with SIGSEGV or SIGBUS within the time
; interval set by emergency_restart_interval then FPM will restart. A value
; of &#39;0&#39; means &#39;Off&#39;.
; Default Value: 0
;emergency_restart_threshold &#x3D; 0

; Interval of time used by emergency_restart_interval to determine when 
; a graceful restart will be initiated.  This can be useful to work around
; accidental corruptions in an accelerator&#39;s shared memory.
; Available Units: s(econds), m(inutes), h(ours), or d(ays)
; Default Unit: seconds
; Default Value: 0
;emergency_restart_interval &#x3D; 0

; Time limit for child processes to wait for a reaction on signals from master.
; Available units: s(econds), m(inutes), h(ours), or d(ays)
; Default Unit: seconds
; Default Value: 0
;process_control_timeout &#x3D; 0

; Send FPM to background. Set to &#39;no&#39; to keep FPM in foreground for debugging.
; Default Value: yes
daemonize &#x3D; no

;;;;;;;;;;;;;;;;;;;;
; Pool Definitions ; 
;;;;;;;;;;;;;;;;;;;;

; See &#x2F;etc&#x2F;php-fpm.d&#x2F;*.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改<a target="_blank" rel="noopener" href="http://www.conf/">www.conf</a></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 12行
listen &#x3D; &#x2F;var&#x2F;run&#x2F;php-fpm&#x2F;php-fpm.sock
# 31-32行
listen.owner &#x3D; nobody
listen.group &#x3D; nobody
# 39-41行
user &#x3D; nginx
; RPM: Keep a group allowed to write in log dir.
group &#x3D; nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改php.ini</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cgi.fix_pathinfo 把它的值设置为 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-Dockerfile部署"><a href="#2-Dockerfile部署" class="headerlink" title="2 Dockerfile部署"></a>2 Dockerfile部署</h3><p>文件存放</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker01 centos7.9_kod]# ll
total 92
-rw-r--r--. 1 root root   661 Jul  2 11:21 Dockerfile
-rw-r--r--. 1 root root   171 Jul  1 14:28 init.sh
-rw-r--r--. 1 root root  2715 Jul  1 13:50 nginx.conf
-rw-r--r--. 1 root root  1691 Jul  1 13:50 php-fpm.conf
-rw-r--r--. 1 root root 64945 Jul  1 14:48 php.ini
-rw-r--r--. 1 root root 10029 Jul  1 13:50 www.conf
[root@docker01 centos7.9_kod]# pwd
&#x2F;opt&#x2F;dockfile&#x2F;centos7.9_kod<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编写Dockerfile</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM centos:7.9.2009
RUN curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo &amp;&amp; \
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo &amp;&amp; \
yum install openssh-server nginx net-tools php-cli php-fpm unzip php-gd php-mbstring  -y
ADD nginx.conf &#x2F;etc&#x2F;nginx&#x2F;nginx.conf
ADD php-fpm.conf &#x2F;etc&#x2F;php-fpm.conf
ADD www.conf &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf
ADD php.ini &#x2F;etc
ADD init.sh &#x2F;root&#x2F;
EXPOSE 80 22
WORKDIR &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html
RUN curl -o kod.zip https:&#x2F;&#x2F;static.kodcloud.com&#x2F;update&#x2F;download&#x2F;kodexplorer4.45.zip &amp;&amp; \
unzip kod.zip &amp;&amp; \
chmod -R 777 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;
CMD [&quot;&#x2F;bin&#x2F;bash&quot;,&quot;&#x2F;root&#x2F;init.sh&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构建镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker build -t centos7.9_kod:v1 .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>运行容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 80:80 -p 1022:22 -e &quot;SSH_PWD&#x3D;redhat123&quot; --privileged centos7.9_kod:v1 &#x2F;usr&#x2F;sbin&#x2F;init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>进入容器，并运行初始化命令</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker exec -it 865 &#x2F;bin&#x2F;bash
# 容器启动服务，设置root密码
[root@88179198e672 html]#systemctl restart sshd php-fpm nginx
[root@88179198e672 html]#echo &quot;redhat123&quot; | passwd --stdin root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试访问：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">网页访问：http:&#x2F;&#x2F;10.0.0.11可进去可道云界面
ssh 10.0.0.11 -p1022 可以登录镜像<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%94-%E6%89%8B%E5%8A%A8%E5%88%B6%E4%BD%9Cdocker%E9%95%9C%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%94-%E6%89%8B%E5%8A%A8%E5%88%B6%E4%BD%9Cdocker%E9%95%9C%E5%83%8F/" class="post-title-link" itemprop="url">Docker系列(五)-手动制作docker镜像</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 13:35:26" itemprop="dateCreated datePublished" datetime="2021-06-29T13:35:26+08:00">2021-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:57" itemprop="dateModified" datetime="2022-07-06T15:19:57+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、制作Docker镜像"><a href="#一、制作Docker镜像" class="headerlink" title="一、制作Docker镜像"></a>一、制作Docker镜像</h2><h3 id="1-启动基础容器"><a href="#1-启动基础容器" class="headerlink" title="1 启动基础容器"></a>1 启动基础容器</h3><pre class="line-numbers language-she" data-language="she"><code class="language-she">docker run -it centos:6.9 # yum
docker run -it alpine:3.9 # apk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-在容器中安装服务"><a href="#2-在容器中安装服务" class="headerlink" title="2 在容器中安装服务"></a>2 在容器中安装服务</h3><p>修改yum源（Centos6阿里源已停止维护）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">echo &#39;[centos-office]
name&#x3D;centos-office
failovermethod&#x3D;priority
baseurl&#x3D;https:&#x2F;&#x2F;vault.centos.org&#x2F;6.10&#x2F;os&#x2F;x86_64&#x2F;
gpgcheck&#x3D;1
gpgkey&#x3D;https:&#x2F;&#x2F;vault.centos.org&#x2F;6.10&#x2F;os&#x2F;x86_64&#x2F;RPM-GPG-KEY-CentOS-6&#39; &gt; CentOS-Base.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>安装并启动openssh服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install openssh-server -y
service sshd restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改root密码(默认没有密码)</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">echo &#39;123456&#39; | passwd --stdin root
# 或者
echo root:123456 | chpassw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>将已经安装好sshd服务的容器打包成镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container commit 981877f137c9 centos6.9_ssh:v1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试镜像</p>
<blockquote>
<p>sshd -D：以后台守护进程的方式运行服务</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 启动sshd并将22端口映射出来，可以使用xshell连接
docker run -d -p 1022:22 centos6.9_ssh:v1 &#x2F;usr&#x2F;sbin&#x2F;sshd -D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="二、小案例：创建一个ssh-nginx双服务的镜像"><a href="#二、小案例：创建一个ssh-nginx双服务的镜像" class="headerlink" title="二、小案例：创建一个ssh+nginx双服务的镜像"></a>二、小案例：创建一个ssh+nginx双服务的镜像</h2><p>创建容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 1023:22 centos6.9_ssh:v1 &#x2F;usr&#x2F;sbin&#x2F;sshd -D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改yum源和epel源</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she">由于Centos6阿里云停止维护
参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;u013250554&#x2F;article&#x2F;details&#x2F;110684307<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>安装nginx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install nginx -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建运行服务的脚本</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;root&#x2F;init.sh
#!&#x2F;bin&#x2F;bash
service sshd restart
nginx -g &#39;daemon off;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>将容器封装成镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker commit e6a6dsa6 centos6.9_ssh_nginx:v2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动镜像，开启服务，并夯住</p>
<blockquote>
<p>可以使用工具ssh登录，并且可以访问到nginx的欢迎页面</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 1025:22 -p 80:80 centos6.9_ssh_nginx:v2 &#x2F;bin&#x2F;bash &#x2F;root&#x2F;init.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="三、通过环境变量设置容器密码"><a href="#三、通过环境变量设置容器密码" class="headerlink" title="三、通过环境变量设置容器密码"></a>三、通过环境变量设置容器密码</h2><p>修改&#x2F;root&#x2F;init.sh文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;bash

if [ -z $SSH_PWD ];then
        SSH_PWD&#x3D;123456
fi
echo &quot;$SSH_PWD&quot; | passwd --stdin root

service sshd restart
nginx -g &#39;daemon off;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>打包成镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker commit 12386c6504d4 centos6.9_ssh_nginx_passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>运行容器</p>
<blockquote>
<p>docker run -e：指定环境变量</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 1022:22 -p 80:80 -e &quot;SSH_PWD&#x3D;123456&quot; centos6.9_ssh_nginx_passwd &#x2F;bin&#x2F;bash &#x2F;root&#x2F;init.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%9B%9B-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E4%B8%8E%E5%B0%8F%E6%A1%88%E4%BE%8B%E7%BB%83%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E5%9B%9B-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E4%B8%8E%E5%B0%8F%E6%A1%88%E4%BE%8B%E7%BB%83%E4%B9%A0/" class="post-title-link" itemprop="url">Docker系列(四)-容器的数据卷挂载与小案例练习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 10:31:05" itemprop="dateCreated datePublished" datetime="2021-06-29T10:31:05+08:00">2021-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:50" itemprop="dateModified" datetime="2022-07-06T15:19:50+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、数据卷挂载"><a href="#一、数据卷挂载" class="headerlink" title="一、数据卷挂载"></a>一、数据卷挂载</h2><h3 id="1-临时挂载"><a href="#1-临时挂载" class="headerlink" title="1 临时挂载"></a>1 临时挂载</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 将&#x2F;opt&#x2F;xiaoniao目录挂载到容器的html目录
docker run -d -p 80:80 -v &#x2F;opt&#x2F;xiaoniao:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-使用卷挂载"><a href="#2-使用卷挂载" class="headerlink" title="2 使用卷挂载"></a>2 使用卷挂载</h3><blockquote>
<p>容器被删除，创建的卷可以保留，可以再次挂载到新建的容器中</p>
</blockquote>
<p>创建名为myvol的容器卷并挂载到容器html目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 80:80 -v myvol:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看当前有哪些容器卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker volume ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看名为myvol的卷的信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker volume inspect myvol<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>删除容器并删除卷（无效）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># PS：删除容器并删除卷，无法将卷删除
docker rm -f -v [容器ID]
    -v --volume<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="二、小案例：多端口多站点"><a href="#二、小案例：多端口多站点" class="headerlink" title="二、小案例：多端口多站点"></a>二、小案例：多端口多站点</h2><blockquote>
<p>80端口访问nginx首页</p>
<p>81端口访问水果忍者</p>
</blockquote>
<p>获取水果忍者HTML5小游戏源码</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget https:&#x2F;&#x2F;7npmedia.w3cschool.cn&#x2F;1-FruitNinja.7z<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建81端口nginx配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;opt&#x2F;fruitninjia.conf
server &#123;
    listen       81;
    listen  [::]:81;
    server_name  localhost;

    #access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;host.access.log  main;

    location &#x2F; &#123;
        root   &#x2F;data;
        index  index.html index.htm;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>将游戏源码文件解压至&#x2F;opt&#x2F;fruitninjia，并运行nginx容器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 将&#x2F;opt&#x2F;fruitninjia挂载到容器&#x2F;data中
docker run -d -p 80:80 -p 81:81 -v &#x2F;opt&#x2F;fruitninjia:&#x2F;data -v &#x2F;opt&#x2F;fruitninjia.conf:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;fruitninjia.conf nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>网页访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">https:&#x2F;&#x2F;10.0.0.11:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%89-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/29/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%89-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE/" class="post-title-link" itemprop="url">Docker系列(三)-容器的网络访问</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-29 09:34:01" itemprop="dateCreated datePublished" datetime="2021-06-29T09:34:01+08:00">2021-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:40" itemprop="dateModified" datetime="2022-07-06T15:19:40+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、容器的网络访问流程"><a href="#一、容器的网络访问流程" class="headerlink" title="一、容器的网络访问流程"></a>一、容器的网络访问流程</h2><blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://z.itpub.net/article/detail/FE8EBAC62D5881E3A432291F8C8E4F02">https://z.itpub.net/article/detail/FE8EBAC62D5881E3A432291F8C8E4F02</a></p>
</blockquote>
<h3 id="1-虚拟机注意事项"><a href="#1-虚拟机注意事项" class="headerlink" title="1 虚拟机注意事项"></a>1 虚拟机注意事项</h3><p>查看net.ipv4.ip_forward值是否为1</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sysctl -a | grep ipv4 | grep forward <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>只有值为1时docker容器才能上网，而vmware虚拟机挂起将使他变成0，解决方法：</p>
<ul>
<li>sysctl net.ipv4.ip_forward &#x3D; 1 设置为1</li>
<li>不要挂起虚拟机，直接关机重启，docker服务在启动时会将它改为1</li>
</ul>
<h2 id="二、容器端口映射"><a href="#二、容器端口映射" class="headerlink" title="二、容器端口映射"></a>二、容器端口映射</h2><h3 id="1-docker-run-p端口映射参数"><a href="#1-docker-run-p端口映射参数" class="headerlink" title="1 docker run -p端口映射参数"></a>1 docker run -p端口映射参数</h3><p>指定端口访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 将容器80端口，映射到主机180端口
docker run -p 180:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>指定IP+端口访问</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 多网卡环境下，将容器80端口映射到10.0.0.1的180端口
docker run -p 10.0.0.1:180:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>指定随机端口</p>
<pre class="line-numbers language-she" data-language="she"><code class="language-she"># 将容器80端口，映射到主机随机端口
docker run -p 10.0.0.1::80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>指定随机端口+UDP (默认映射TCP)</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 将容器80端口映射到主机随机端口，并使用UDP协议
-p 10.0.0.100:80:udp # 指定随机端口 + udp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可以指定多个端口</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-p 180:80 -p 1443:443 # 指定多个端口<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>随机映射</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -P<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%8C-Docker%E5%B8%B8%E7%94%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%BA%8C-Docker%E5%B8%B8%E7%94%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Docker系列(二)-Docker常用管理命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-28 22:59:33" itemprop="dateCreated datePublished" datetime="2021-06-28T22:59:33+08:00">2021-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:14" itemprop="dateModified" datetime="2022-07-06T15:19:14+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、常用镜像管理命令"><a href="#一、常用镜像管理命令" class="headerlink" title="一、常用镜像管理命令"></a>一、常用镜像管理命令</h2><blockquote>
<p>​	Docker镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数(如匿名卷、环境变量、用户等)。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
</blockquote>
<h3 id="1-在镜像仓库查找镜像"><a href="#1-在镜像仓库查找镜像" class="headerlink" title="1 在镜像仓库查找镜像"></a>1 在镜像仓库查找镜像</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker search tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-在镜像仓库拉取镜像"><a href="#2-在镜像仓库拉取镜像" class="headerlink" title="2 在镜像仓库拉取镜像"></a>2 在镜像仓库拉取镜像</h3><blockquote>
<p>不指定版本号时默认下载最新版（latest），版本可在dockerhub(官方仓库)、DaoCloud(私有仓库)等仓库查到</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># dockerhub拉取
docker pull alpine:3.6
# daocloud拉取
docker pull daocloud.io&#x2F;jermine&#x2F;alpine:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-查看已有镜像"><a href="#3-查看已有镜像" class="headerlink" title="3 查看已有镜像"></a>3 查看已有镜像</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker image ls
# 别名
docker images<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-导出镜像"><a href="#4-导出镜像" class="headerlink" title="4 导出镜像"></a>4 导出镜像</h3><blockquote>
<p>弃用export，导出的镜像不带版本TAG信息</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker image save alpine -o alpine.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="5-删除镜像"><a href="#5-删除镜像" class="headerlink" title="5 删除镜像"></a>5 删除镜像</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 删除alpine镜像
docker image rm d4ff818577bc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="6-导入镜像"><a href="#6-导入镜像" class="headerlink" title="6 导入镜像"></a>6 导入镜像</h3><blockquote>
<p>弃用import，导入的镜像不带版本TAG信息</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker image load -i alpine.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="7-查看镜像属性"><a href="#7-查看镜像属性" class="headerlink" title="7 查看镜像属性"></a>7 查看镜像属性</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker image inspect 4f380adfc10f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="8-镜像批量删除"><a href="#8-镜像批量删除" class="headerlink" title="8 镜像批量删除"></a>8 镜像批量删除</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker image prune<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="9-指定TAG信息"><a href="#9-指定TAG信息" class="headerlink" title="9 指定TAG信息"></a>9 指定TAG信息</h3><blockquote>
<p>docker images查看docker image import的镜像，没有镜像名和TAG，可以使用此方法来修改</p>
</blockquote>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">docker image tag d4ff818577bc oldbly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="二、常用容器管理命令"><a href="#二、常用容器管理命令" class="headerlink" title="二、常用容器管理命令"></a>二、常用容器管理命令</h2><blockquote>
<p>​	镜像(image)和容器(container)的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。<br>​	容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的root文件系统、自己的网络配置、自己的进程空间，甚至自己的用户ID空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立宿主的系统下操作一样。这种特性使容器封装的应用比直接在宿主运行更加安全。</p>
</blockquote>
<h3 id="1-运行容器"><a href="#1-运行容器" class="headerlink" title="1 运行容器"></a>1 运行容器</h3><blockquote>
<p>1、docker容器内的第一个进程（初始命令）必须一直处于前台运行的状态（必须夯住），否则这个容器，就会处于退出状态。</p>
<p>2、业务在容器中运行：前台运行夯住，启动服务</p>
<p>3、如果不指定执行命令，会运行默认的执行命令</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 放后台运行
docker run -d -p 80:80 nginx:latest
run 创建并运行一个容器
-d	放在后台运行
-p 	端口映射
-v 	源地址(宿主机)：目标地址(容器)

# 交互式方式进入容器执行
docker run -it --name centos6 centos:6.9 &#x2F;bin&#x2F;bash
-it 	分配交互式的终端
--name 	制定容器的名称
&#x2F;bin&#x2F;sh 容器执行的命令，每个进程默认有初始执行命令，可以覆盖<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-查看已有容器"><a href="#2-查看已有容器" class="headerlink" title="2 查看已有容器"></a>2 查看已有容器</h3><blockquote>
<p>-a 显示所有容器（默认只显示running的容器）</p>
<p>-l 显示最新的容器</p>
<p>–no-trunc 显示完整id</p>
<p>-q 静默输出（只显示容器id）</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container ls -a
# 别名
docker ps -a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="3-停止容器"><a href="#3-停止容器" class="headerlink" title="3 停止容器"></a>3 停止容器</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container stop 55e9c7c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-杀死容器"><a href="#4-杀死容器" class="headerlink" title="4 杀死容器"></a>4 杀死容器</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container kill 55e9c7c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>kill与stop的区别：</p>
<ul>
<li><p>kill：不管容器同不同意，发送SIGKILL信号，强行终止。</p>
</li>
<li><p>stop：首先给容器发送一个SIGTERM信号，让容器做一些退出前必须的保护性、安全性操作，然后让容器自动停止运行，如果在一段时间内，容器还是没有停止，再发送SIGKILL信号，强行终止。</p>
</li>
</ul>
</blockquote>
<h3 id="5-启动容器"><a href="#5-启动容器" class="headerlink" title="5 启动容器"></a>5 启动容器</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container start 55e9c7c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="6-进入容器（重要！调试、排错）"><a href="#6-进入容器（重要！调试、排错）" class="headerlink" title="6 进入容器（重要！调试、排错）"></a>6 进入容器（重要！调试、排错）</h3><p>使用同一终端：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 交互式方式运行容器（开启新终端）
docker run -it --name centos6.9 centos:6.9 &#x2F;bin&#x2F;bash
# 暂时退出当前终端
ctrl + p 再 ctrl + q
# 重新进入该终端
docker attach d4ff818577bc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用不同终端（常用）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker exec -it d4ff818577bc &#x2F;bin&#x2F;bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="7-删除容器"><a href="#7-删除容器" class="headerlink" title="7 删除容器"></a>7 删除容器</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker container rm 55e9c7cb59a6 55e9c7cb59a5
# 别名
docker rm 55e9c7cb59a6
# 批量删除容器
docker rm &#96;docker ps -a -q&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%AE%89%E8%A3%85Docker/" class="post-title-link" itemprop="url">Docker系列(一)-安装Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-28 16:06:37" itemprop="dateCreated datePublished" datetime="2021-06-28T16:06:37+08:00">2021-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:20:02" itemprop="dateModified" datetime="2022-07-06T15:20:02+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、容器简介"><a href="#一、容器简介" class="headerlink" title="一、容器简介"></a>一、容器简介</h2><blockquote>
<p>容器就是在隔离环境中运行一个进程，如果进程停止，容器就会销毁，隔离环境拥有自己的系统文件，ip地址，主机名等。</p>
</blockquote>
<h3 id="1-容器和虚拟化的区别"><a href="#1-容器和虚拟化的区别" class="headerlink" title="1 容器和虚拟化的区别"></a>1 容器和虚拟化的区别</h3><ul>
<li><p>KVM虚拟化：</p>
<ul>
<li><p>需要硬件的支持，需要模拟硬件，可以运行不同的操作系统，启动时间分钟级（有开机启动流程）</p>
<p>开机启动流程</p>
<p>bios开机硬件自检</p>
<p>根据bios设置的优先启动项boot</p>
<p>读取mbr&#x2F;gpt引导，读取mbr硬盘分区信息，内核加载路径</p>
<p>加载内核</p>
<p>启动第一个进程（C6：&#x2F;sbin&#x2F;init，C7：systemd）</p>
<p>系统初始化完成</p>
<p>运行服务</p>
</li>
</ul>
</li>
<li><p>容器：</p>
<ul>
<li><p>不需要硬件的支持，不需要模拟硬件，公用宿主机内核，启动时间秒级（没有开机启动流程）</p>
<p>容器的第一个进程直接运行服务，损耗少，启动快，性能高</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-容器的优缺点"><a href="#2-容器的优缺点" class="headerlink" title="2 容器的优缺点"></a>2 容器的优缺点</h3><ul>
<li><p>优点</p>
<ul>
<li><p>与宿主机使用同一个内核，性能损耗小</p>
<p>不需要指令级模拟</p>
<p>容器可以再cpu核心的本地运行指令，不需要任何专门的解释机制</p>
<p>避免了准虚拟化和系统调用替换中的复杂性</p>
<p>轻量级隔离，在隔离的同事还提供共享机制，以实现容器与宿主机的资源共享</p>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>使用同一内核，存在安全性问题</li>
</ul>
</li>
</ul>
<h3 id="3-容器技术的发展过程"><a href="#3-容器技术的发展过程" class="headerlink" title="3 容器技术的发展过程"></a>3 容器技术的发展过程</h3><blockquote>
<p>chroot — lxc —- docker</p>
</blockquote>
<h3 id="4-Docker组成"><a href="#4-Docker组成" class="headerlink" title="4 Docker组成"></a>4 Docker组成</h3><p>​	Docker基于Go语言开发，C&#x2F;S模式</p>
<ul>
<li>主要组件<ul>
<li>镜像</li>
<li>容器</li>
<li>仓库：最大的dockerhub</li>
<li>网络</li>
<li>存储</li>
</ul>
</li>
</ul>
<h2 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h2><blockquote>
<p>参考网站：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/">https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/</a></p>
</blockquote>
<h3 id="1-联网在线安装"><a href="#1-联网在线安装" class="headerlink" title="1 联网在线安装"></a>1 联网在线安装</h3><p>开启rpm包缓存，方便制作离线安装包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vim &#x2F;etc&#x2F;yum.conf
keepcache&#x3D;1 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果你之前安装过 docker，请先删掉</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo yum remove docker docker-common docker-selinux docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安装一些依赖</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo yum install -y yum-utils device-mapper-persistent-data lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>根据你的发行版下载repo文件（Centos）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>把软件仓库替换为TUNA：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo sed -i &#39;s+download.docker.com+mirrors.tuna.tsinghua.edu.cn&#x2F;docker-ce+&#39; &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最后安装:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo yum makecache fast
    sudo yum install docker-ce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-无网环境下离线安装"><a href="#2-无网环境下离线安装" class="headerlink" title="2 无网环境下离线安装"></a>2 无网环境下离线安装</h3><p>搜集联网环境下下载的rpm包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">find &#x2F;var&#x2F;cache&#x2F;yum&#x2F;x86_64&#x2F;7&#x2F; -name &quot;*.rpm&quot; | xargs -i mv &#123;&#125; docker_rpm&#x2F;
tar -zvcf docker_rpm.tgz docker_rpm&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>拷贝到无网环境的服务器中安装</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tar -vxf docker_rpm.tgz # 解压
cd docker_rpm	
rpm -Uvh .&#x2F;*.rpm # 安装<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="3-启动服务并验证安装是否成功"><a href="#3-启动服务并验证安装是否成功" class="headerlink" title="3 启动服务并验证安装是否成功"></a>3 启动服务并验证安装是否成功</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 启动服务
systemctl enable docker
systemctl start docker

# 验证是否安装成功
docker version
docker info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-Docker镜像下载加速"><a href="#4-Docker镜像下载加速" class="headerlink" title="4 Docker镜像下载加速"></a>4 Docker镜像下载加速</h3><ul>
<li>阿里云docker镜像加速器服务</li>
<li>配置docker镜像加速(推荐)</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创建文件
vi &#x2F;etc&#x2F;docker&#x2F;daemon.json
&#123;    
	&quot;registry-mirrors&quot;:[&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;]
&#125; 
# 重新加载
systemctl daemon-reload
systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-创建并运行一个nginx容器"><a href="#5-创建并运行一个nginx容器" class="headerlink" title="5 创建并运行一个nginx容器"></a>5 创建并运行一个nginx容器</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 80:80 nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gsproj.github.io/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E9%9B%B6-Docker%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.png">
      <meta itemprop="name" content="GongSheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GongSheng Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/28/01_%E8%BF%90%E7%BB%B4/03-Docker/Docker%E7%B3%BB%E5%88%97-%E9%9B%B6-Docker%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">Docker系列(零)-Docker介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-28 16:06:37" itemprop="dateCreated datePublished" datetime="2021-06-28T16:06:37+08:00">2021-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-06 15:19:24" itemprop="dateModified" datetime="2022-07-06T15:19:24+08:00">2022-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%B8%89%EF%BC%89Docker/" itemprop="url" rel="index"><span itemprop="name">（三）Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、容器简介"><a href="#一、容器简介" class="headerlink" title="一、容器简介"></a>一、容器简介</h1><p>容器就是在隔离环境中运行一个进程，如果进程停止，容器就会销毁。</p>
<p>隔离环境拥有自己的系统文件，ip地址，主机名等。</p>
<h2 id="1-1-容器和虚拟化的区别"><a href="#1-1-容器和虚拟化的区别" class="headerlink" title="1.1 容器和虚拟化的区别"></a>1.1 容器和虚拟化的区别</h2><p>KVM虚拟化：</p>
<p>需要硬件的支持，需要模拟硬件，可以运行不同的操作系统，启动时间分钟级（有开机启动流程）</p>
<p>开机启动流程</p>
<p>bios开机硬件自检</p>
<p>根据bios设置的优先启动项boot</p>
<p>读取mbr&#x2F;gpt引导，读取mbr硬盘分区信息，内核加载路径</p>
<p>加载内核</p>
<p>启动第一个进程（C6：&#x2F;sbin&#x2F;init，C7：systemd）</p>
<p>系统初始化完成</p>
<p>运行服务</p>
<p>容器：</p>
<p>不需要硬件的支持，不需要模拟硬件，公用宿主机内核，启动时间秒级（没有开机启动流程）</p>
<p>容器的第一个进程直接运行服务，损耗少，启动快，性能高</p>
<h2 id="1-2-容器的优缺点："><a href="#1-2-容器的优缺点：" class="headerlink" title="1.2 容器的优缺点："></a>1.2 容器的优缺点：</h2><p>优点：</p>
<p>与宿主机使用同一个内核，性能损耗小</p>
<p>不需要指令级模拟</p>
<p>容器可以再cpu核心的本地运行指令，不需要任何专门的解释机制</p>
<p>避免了准虚拟化和系统调用替换中的复杂性</p>
<p>轻量级隔离，在隔离的同事还提供共享机制，以实现容器与宿主机的资源共享</p>
<p>缺点：</p>
<p>使用同一内核，存在安全性问题</p>
<h2 id="1-3-容器技术的发展过程"><a href="#1-3-容器技术的发展过程" class="headerlink" title="1.3 容器技术的发展过程"></a>1.3 容器技术的发展过程</h2><p>chroot — lxc —- docker</p>
<h1 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h1><p># 添加docker安装源 </p>
<p>yum-config-manager –add-repo <a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a> </p>
<p>查看所有仓库中docker版本，并选择特定版本安装：(此处我们查看社区版 docker-ce) yum list docker-ce –showduplicates | sort -r # 安装docker-ce yum install docker-ce -y</p>
<h1 id="三、Docker镜像的常用命令"><a href="#三、Docker镜像的常用命令" class="headerlink" title="三、Docker镜像的常用命令"></a>三、Docker镜像的常用命令</h1><p># 搜索镜像docker search [镜像名称]# 拉取镜像docker pull [域名镜像名称]:[版本号]例如：docker pull daocloud.io&#x2F;hzc&#x2F;alpine:3.6 # 默认拉取Lastest最新版PS: docker image pull &#x3D; docker pull# 如何查看镜像有那些版本？dockerhub网页搜索 daocloud 国内的dockhub# 镜像加速：（1）阿里云docker镜像加速器服务（2）配置docker镜像加速(推荐) vi &#x2F;etc&#x2F;docker&#x2F;daemon.json {   “registry-mirrors”:[“<a href="https://registry.docker-cn.com”]">https://registry.docker-cn.com”]</a> } systemctl daemon-reload# 上传镜像docker push [镜像名称]# 查看已有镜像docker images &#x3D; docker image ls# 导出镜像docker image save alpine:latest -o docker_alpine.tar.gz # save跟export选哪个？都是导出镜像，但是export没带版本标签，export弃用# 导入镜像docker image load -i docker_alpine.tar.gz # load跟import选哪个？都是导入镜像，load对应save，import不带版本标签，import弃用# 删除镜像docker image rm alpine:3.6# 构建镜像docker image build# 查看构建镜像用到的历史命令docker image histroy# 查看镜像的详细属性docker image inspect# 批量删除镜像docker image prune# 给镜像打标签docker image tag [镜像ID] oldboy:v1 # Docker的容器管理1、查看容器列表 docker container ls -a docker ps # 默认只查看活着的容器 docker ps -a # 查看所有容器 docker ps -a -q # 静默输出，显示所有容器的ID docker ps -a -l docker ps -a -l –no-trunc # 查看完整命令（不隐藏）# 停止容器docker container stop [容器ID] docker container kill [容器ID]# 恢复容器 docker container start 【容器ID】# 启动容器 docker run -d -p 80:80 nginx:latest run 创建并运行一个容器 -d   放在后台运行 -p 端口映射 -v 源地址(宿主机)：目标地址(容器) docker run -it –name centos6 centos:6.9 &#x2F;bin&#x2F;bash -it 分配交互式的终端 –name 制定容器的名称 &#x2F;bin&#x2F;sh 容器执行的命令，每个进程默认有初始执行命令，可以覆盖※进入容器（调试、排错）docker exec - it [容器名称&#x2F;ID] &#x2F;bin&#x2F;bash docker attach 【容器名称&#x2F;ID】 (使用同一个终端)临时退出容器：ctrl +p和ctrl + q退出# 删除容器docker container rm [容器ID] docker rm [容器ID]如何批量删除容器：docker rm <code>docker ps -a -q</code></p>
<p><strong>总结：</strong></p>
<p>docker容器内的第一个进程（初始命令）必须一直处于前台运行的状态（必须夯住），否则这个容器，就会处于退出状态。</p>
<p>业务在容器中运行：前台运行夯住，启动服务</p>
<h1 id="四、-Docker的网络访问"><a href="#四、-Docker的网络访问" class="headerlink" title="四、 Docker的网络访问"></a>四、 Docker的网络访问</h1><h2 id="4-1-容器网络访问流程"><a href="#4-1-容器网络访问流程" class="headerlink" title="4.1 容器网络访问流程"></a>4.1 容器网络访问流程</h2><p>实际上是端口映射，docker容器有自己的ip，需要靠宿主机NAT上网 </p>
<p> -p设置自动端口映射，在iptables中有增的Chain Docker, 也可以手动设置NAT</p>
<p>查看当前设置的nat：iptables -t nat -L -n</p>
<h2 id="4-2-容器网络访问注意事项："><a href="#4-2-容器网络访问注意事项：" class="headerlink" title="4.2 容器网络访问注意事项："></a>4.2 容器网络访问注意事项：</h2><p>sysctl -a | grep ipv4 | grep forward </p>
<p>查看</p>
<p>net.ipv4.ip_forward &#x3D; 1 # 为1时，docker容器才能上网，虚拟机挂起将使他变成0</p>
<p>解决方法:</p>
<p>1、sysctl net.ipv4.ip_forward &#x3D; 1 设置为1</p>
<p>2、不要挂起虚拟机，直接关机重启，docker服务在启动时会将它改为1</p>
<h2 id="4-3-指定映射-p-参数详解"><a href="#4-3-指定映射-p-参数详解" class="headerlink" title="4.3 指定映射(-p)参数详解"></a>4.3 指定映射(-p)参数详解</h2><p>-p hostPort:containerPort # 指定端口 -p ip:hostPort:containerPort # 指定ip+端口 -p ip::containerPort # 指定随机端口 -p 10.0.0.100:53:udp # 指定随机端口 + udp -p hostPort:containerPort -p hostPort:containerPort # 指定多个端口</p>
<h1 id="五、容器的数据卷挂载"><a href="#五、容器的数据卷挂载" class="headerlink" title="五、容器的数据卷挂载"></a>五、容器的数据卷挂载</h1><h2 id="5-1-临时挂载"><a href="#5-1-临时挂载" class="headerlink" title="5.1 临时挂载"></a>5.1 临时挂载</h2><p># 将&#x2F;opt&#x2F;xiaoniao目录挂载到容器的html目录 docker run -d -p 80:80 -v &#x2F;opt&#x2F;xiaoniao:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest</p>
<h2 id="5-2-持久化挂载"><a href="#5-2-持久化挂载" class="headerlink" title="5.2 持久化挂载"></a>5.2 持久化挂载</h2><p>容器被删除，创建的卷可以保留，可以再次挂载到新建的容器中</p>
<p># 创建名为oldboy的容器卷并挂载到容器html目录 docker run -d -p 80:80 -v oldboy:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest # 查看当前有哪些容器卷 docker volume ls # 查看名为oldboy的卷的信息 docker volume inspect oldboy # PS：删除容器并删除卷，无法将卷删除 docker rm -f -v [容器ID]   -v –volume</p>
<h1 id="六、小案例练习"><a href="#六、小案例练习" class="headerlink" title="六、小案例练习"></a>六、小案例练习</h1><p>&gt;&gt; 基于Nginx多端点的多站点 基于nginx启动一个容器，监听80和81，访问80，出现nginx默认的欢迎首页，访问81，出现小鸟页面。</p>
<h1 id="七、如何制作Docker镜像"><a href="#七、如何制作Docker镜像" class="headerlink" title="七、如何制作Docker镜像"></a>七、如何制作Docker镜像</h1><h2 id="7-1-启动一个基础的容器"><a href="#7-1-启动一个基础的容器" class="headerlink" title="7.1 启动一个基础的容器"></a>7.1 启动一个基础的容器</h2><p>docker run -it centos:6.9 # yum docker run -it alpine:3.9 # apk</p>
<h2 id="7-2-容器中安装服务"><a href="#7-2-容器中安装服务" class="headerlink" title="7.2 容器中安装服务"></a>7.2 容器中安装服务</h2><p># dns重定向 echo ‘192.168.15.84 mirrors.aliyun.com’ &gt;&gt; &#x2F;etc&#x2F;hosts # 替换源为阿里源 curl -o &#x2F;etc&#x2F;yum.repo.d&#x2F;CentOS-Base.repo <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/repo/CentOS-6.repo">https://mirrors.aliyun.com/repo/CentOS-6.repo</a> # 安装并启动openssh服务 yum install openssh-server -y service opensshd restart # 修改root密码 echo ‘123456’ | passwd –stdin root 或者 echo 123456:root | chpassw</p>
<p>7.3 把已经安装服务的容器打包成镜像</p>
<p>docker contanier commit 5617e5d123432 centos6.9_ssh:v1</p>
<h2 id="7-4-测试镜像的功能"><a href="#7-4-测试镜像的功能" class="headerlink" title="7.4 测试镜像的功能"></a>7.4 测试镜像的功能</h2><p># 使用镜像启动一个新容器,并开启ssh服务 docker run -d -p 1022:22 centos6.9_ssh:v1 tail -f &#x2F;usr&#x2F;sbin&#x2F;sshd -D</p>
<h2 id="7-5-创建一个ssh-nginx双服务的镜像"><a href="#7-5-创建一个ssh-nginx双服务的镜像" class="headerlink" title="7.5 创建一个ssh + nginx双服务的镜像"></a>7.5 创建一个ssh + nginx双服务的镜像</h2><p>(1) 启动一个基础容器 docker yun -it -p 80:80 -p 1023:22 centos6.9_ssh:v1 &#x2F;bin&#x2F;bash (2) 在容器中安装服务(hosts与repo源在新容器会重新挂载) # dns重定向 echo ‘192.168.15.84 mirrors.aliyun.com’ &gt;&gt; &#x2F;etc&#x2F;hosts # 替换源为阿里源 curl -o &#x2F;etc&#x2F;yum.repo.d&#x2F;epel.repo <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/repo/epel.repo">https://mirrors.aliyun.com/repo/epel.repo</a> # 安装nginx服务 yum install nginx -y (3) 把已经安装好服务的容器，提交为镜像 docker commit e6a6dsa6 centos6.9_ssh_nginx:v2 (4) 测试镜像功能 vim init.sh &gt;&gt;&gt;&gt;&gt; #!&#x2F;bin&#x2F;bash service sshd restart nginx -g ‘daemon off;’ &gt;&gt;&gt;&gt;&gt; # 启动镜像，执行脚本：开启服务，并夯住 docker run -d -p 1025:22 -p 80:80 centos6.9_ssh_nginx:v2 &#x2F;bin&#x2F;bash &#x2F;init.sh</p>
<h3 id="7-6-自定义容器镜像的密码"><a href="#7-6-自定义容器镜像的密码" class="headerlink" title="7.6 自定义容器镜像的密码"></a>7.6 自定义容器镜像的密码</h3><p># 修改脚本，添加密码相关的脚本行，见右图 vim init.sh # 启动容器，并附带环境变量 docker run -d -p 1025:22 -p 80:80 -e “SSH_PWD&#x3D;123456” centos6.9_ssh_nginx:v2 &#x2F;bin&#x2F;bash &#x2F;init.sh</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="7-7-作业"><a href="#7-7-作业" class="headerlink" title="7.7 作业"></a>7.7 作业</h3><p>制作基于centos6的lnmp架构的镜像，discuz论坛</p>
<p>怎么夯住？</p>
<p>启动所有需要的服务</p>
<p>最后tail -F (大F无论文件有没有) </p>
<h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="八、Dockfile的使用"><a href="#八、Dockfile的使用" class="headerlink" title="八、Dockfile的使用"></a>八、Dockfile的使用</h1><p>发布镜像太大了，而dockerfile只有几kb，使用dockfile文件可以构建出相同的镜像，</p>
<h2 id="8-1-使用dockfile自动构建镜像"><a href="#8-1-使用dockfile自动构建镜像" class="headerlink" title="8.1 使用dockfile自动构建镜像"></a>8.1 使用dockfile自动构建镜像</h2><p>自动构建镜像的步骤：</p>
<p>1、手动构建一遍</p>
<p>2、参考历史命令，编写dockerfile</p>
<p>3、构建镜像</p>
<p>dockerfile build -t centos6.9_ssh .</p>
<p>4、测试</p>
<h2 id="8-2-Dockerfile常用命令详解"><a href="#8-2-Dockerfile常用命令详解" class="headerlink" title="8.2 Dockerfile常用命令详解"></a>8.2 Dockerfile常用命令详解</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GongSheng"
      src="/images/myavatar.png">
  <p class="site-author-name" itemprop="name">GongSheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GongSheng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
