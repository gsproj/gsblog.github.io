---
title: 01-负载均衡产品
date: 2023-05-04 9:05:17
categories:
-  腾讯云TCE50训前
-  网络
tag:
---

# 负载均衡-CLB

# 一、产品介绍

**定义**

负载均衡是对多台服务器进行流量分发的服务。

**技术实现及功能**

CLB的实现主要由TGW/STGW实现：

- 通过设置虚拟服务地址（VIP），将位于同一地域的多态云服务器资源虚拟成一个高性能、高可用的应用服务池
- 根据流量分发算法。将来自客户端的网络请求分发到云服务池中。负载均衡服务会检查云服务器池中云服务器实例的健康状态，自动隔离异常状态的实例，从而解决云服务器单点的问题，同时提高应用的整体服务能

CLB具备自助管理、自动故障修复，防网络攻击等高级功能。当有大量业务访问或接入时，可以部署负载均衡，通过负载均衡的收敛IP、多通接入、流量分发、集群容灾等功能，实现业务的高可用

**图示：**

![image-20230504091440721](D:/C++/gsproj.github.io/source/img/image-20230504091440721.png)

**图中名词解释：**

- 虚拟VIP: 统一对外服务IP，接受访问请求
- CLB实例：通过监听器监听请求并分发流量
- 后端RS：后端服务器处理访问请求并返回结果

## 1.1 EIP产品定义

**定义**

EIP全称弹性公网IP（Elastic IP），是可以单独购买和持有的，某个地域下固定不变的公网IP地址。EIP可以与CVM、NAT网关、弹性网卡和高可用虚拟IP绑定，提供访问公网和被公网访问的能力

**功能场景**

弹性公网IP未释放前，可以一直保存在帐号中

公网IP仅可跟随服务器一起释放，而弹性公网IP可以和云服务器解耦，作为云资源单独进行操作

**和普通公网IP的区别：**

EIP：可以独立购买和持有，可随时与CVM、NAT网关、弹性网卡和高可用虚拟IP绑定、解耦

普通公网IP：仅能在CVM购买时分配，且无法与云服务器解绑，如购买时未分配，则无法获得

## 1.2  IPV6 EIP产品定义

定义：

云服务器UPV6的公网网关

产品功能：

弹性网卡申请IPV6地址后，默认关闭公网访问能力，仅支持VPC内部的IPV6地址通讯，通过弹性公网IPV6，支持单个或多个IPV6地址开通公网或者关闭公网，并可设置公网带宽。

## 1.3 IPV6 NAT64负责均衡

腾讯云给实例分配一个IPV6公网地址，该VIP会将来自IPV6客户端的请求转发给后端的IPV4云服务器

产品功能：

该服务是基于NAT64 IPV6过渡技术实现的负责均衡器，使用它，后端云服务器无需做任何IPV6改造，即可快速接入IPV6用户的访问。

负载均衡平滑的将IPV6地址转换为IPV4地址，适配原有的服务，快速实现IPV6改造

![image-20230504093602978](D:/C++/gsproj.github.io/source/img/image-20230504093602978.png)

## 1.4 IPV6负载均衡

负载均衡支持IPV4、IPV6、IPV6 NAT64三个IP版本。

IPV6负载均衡支持TCP\UDP\TCP SSL\HTTP\HTTPS协议

产品功能：

IPV6负载均衡支持获取客户端IPV6源地址，四层IPV6负载均衡支持直接获取客户端IPV6源地址，七层IPV6负载均衡支持通过HTTP的X-Forwarded-For头域获取客户端IPV6地址

当前IPV6负载均衡是纯公网负载均衡，相同VPC的客户端无法通过内网访问该IPV6负载均衡

## 1.5 基本概念

![image-20230504093828444](D:/C++/gsproj.github.io/source/img/image-20230504093828444.png)

## 1.6 应用场景

流量分发：构建高性能、高可用服务池，业务流量均衡转发到这批云服务器上

消除单点故障

![image-20230504093959799](D:/C++/gsproj.github.io/source/img/image-20230504093959799.png)

## 1.7 EIP应用场景

![image-20230504094054601](D:/C++/gsproj.github.io/source/img/image-20230504094054601.png)

## 1.8 IPV6应用场景

![image-20230504094135514](D:/C++/gsproj.github.io/source/img/image-20230504094135514.png)

![image-20230504094210319](D:/C++/gsproj.github.io/source/img/image-20230504094210319.png)

## 1.9 IPV6负责均衡使用场景

![image-20230504094251815](D:/C++/gsproj.github.io/source/img/image-20230504094251815.png)

## 1.10 3100新特性

1、租户端七层监听器，支持国密加密

![image-20230504094357768](D:/C++/gsproj.github.io/source/img/image-20230504094357768.png)

2、七层监听器，支持日志查询（依赖CLS产品）

![image-20230504094438606](D:/C++/gsproj.github.io/source/img/image-20230504094438606.png)

3、七层监听器，支持个性化配置

![image-20230504094504038](D:/C++/gsproj.github.io/source/img/image-20230504094504038.png)

## 1.11 模块说明

![image-20230504094605790](D:/C++/gsproj.github.io/source/img/image-20230504094605790.png)

# 二、 架构

## 2.1 业务架构

![image-20230504094629003](D:/C++/gsproj.github.io/source/img/image-20230504094629003.png)

## 2.2  系统架构

![image-20230504094713748](D:/C++/gsproj.github.io/source/img/image-20230504094713748.png)

## 2.3 运维端流程

![image-20230504094855560](D:/C++/gsproj.github.io/source/img/image-20230504094855560.png)

## 2.4 租户端流程

![image-20230504094944445](D:/C++/gsproj.github.io/source/img/image-20230504094944445.png)

## 2.5 隧道封装技术

![image-20230504095015415](D:/C++/gsproj.github.io/source/img/image-20230504095015415.png)

## 2.6 多协议转发

![image-20230504095035044](D:/C++/gsproj.github.io/source/img/image-20230504095035044.png)

## 2.7 四层CLB

### 2.7.1 四层TGW逻辑架构

![image-20230504095119550](D:/C++/gsproj.github.io/source/img/image-20230504095119550.png)

### 2.7.2 CLB数据处理架构-4层TGW

![image-20230504095230385](D:/C++/gsproj.github.io/source/img/image-20230504095230385.png)

### 2.7.3 四层CLB高可用性

![image-20230504095252374](D:/C++/gsproj.github.io/source/img/image-20230504095252374.png)

![image-20230504095308220](D:/C++/gsproj.github.io/source/img/image-20230504095308220.png)

### 2.7.4 四层CLB组件关系

![image-20230504095344220](D:/C++/gsproj.github.io/source/img/image-20230504095344220.png)

### 2.7.5 四层CLB健康检查

![image-20230504095408453](D:/C++/gsproj.github.io/source/img/image-20230504095408453.png)

### 2.7.6 数据流向 四层CLB

![image-20230504095455828](D:/C++/gsproj.github.io/source/img/image-20230504095455828.png)

## 2.8 七层CLB

### 2.8.1 七层CLB逻辑架构

![image-20230504095529372](D:/C++/gsproj.github.io/source/img/image-20230504095529372.png)

### 2.8.2 七层CLB数据处理

![image-20230504095552494](D:/C++/gsproj.github.io/source/img/image-20230504095552494.png)

### 2.8.3 七层CLB健康检查

![image-20230504095614720](D:/C++/gsproj.github.io/source/img/image-20230504095614720.png)

### 2.8.4七层多协议接入和卸载

![image-20230504103057369](D:/C++/gsproj.github.io/source/img/image-20230504103057369.png)

### 2.8.5 数据流向 七层CLB

![image-20230504103120276](D:/C++/gsproj.github.io/source/img/image-20230504103120276.png)

## 2.9 IPV6负载均衡 架构链路

![image-20230504103143259](D:/C++/gsproj.github.io/source/img/image-20230504103143259.png)

## 2.10 3100新特性

还在测试阶段

![image-20230504103223087](D:/C++/gsproj.github.io/source/img/image-20230504103223087.png)

# 三、CLB部署过程

## 3.1 CLB管控部署

镜像

![image-20230504103407247](D:/C++/gsproj.github.io/source/img/image-20230504103407247.png)

DBSQL

![image-20230504103332703](D:/C++/gsproj.github.io/source/img/image-20230504103332703.png)

前端

![image-20230504103441302](D:/C++/gsproj.github.io/source/img/image-20230504103441302.png)

## 3.2 CLB管控组件介绍

![image-20230504103507671](D:/C++/gsproj.github.io/source/img/image-20230504103507671.png)

## 3.3 TGW数据库表说明

**![image-20230504103530805](D:/C++/gsproj.github.io/source/img/image-20230504103530805.png)**

### 3.3.1 举例说明

![image-20230504103545993](D:/C++/gsproj.github.io/source/img/image-20230504103545993.png)

## 3.4 CLB生产节点部署

![image-20230504103606338](D:/C++/gsproj.github.io/source/img/image-20230504103606338.png)

页面部署

![image-20230504103622755](D:/C++/gsproj.github.io/source/img/image-20230504103622755.png)

![image-20230504103634313](D:/C++/gsproj.github.io/source/img/image-20230504103634313.png)

## 3.5 常见问题

![image-20230504103652766](D:/C++/gsproj.github.io/source/img/image-20230504103652766.png)

## 3.6 LD常用命令

![image-20230504103724694](D:/C++/gsproj.github.io/source/img/image-20230504103724694.png)

## 3.7 运维巡检工具

![image-20230504103745998](D:/C++/gsproj.github.io/source/img/image-20230504103745998.png)

### 3.7.1 运维工具常见故障处理

![image-20230504103818936](D:/C++/gsproj.github.io/source/img/image-20230504103818936.png)

![image-20230504103834036](D:/C++/gsproj.github.io/source/img/image-20230504103834036.png)

![image-20230504103842851](D:/C++/gsproj.github.io/source/img/image-20230504103842851.png)

## 3.9 常见问题

![image-20230504103922973](D:/C++/gsproj.github.io/source/img/image-20230504103922973.png)

## 3.10 故障案例分析

![image-20230504103949871](D:/C++/gsproj.github.io/source/img/image-20230504103949871.png)